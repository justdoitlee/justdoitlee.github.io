<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Integerç”¨==è¿˜æ˜¯equals</title>
    <url>/2020/09/03/Integer%E7%94%A8-%E8%BF%98%E6%98%AFequals/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä»Šå¤©åˆ·minimum-window-substringé—®é¢˜æ—¶ï¼Œå†™çš„ä»£ç è·‘é€šäº†267/268çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæœ€åä¸€ä¸ªæ²¡è·‘é€šï¼Œæœ€åå‘ç°æ˜¯</p>
<p><code>window.get(d) == need.get(d)</code>å‡ºçš„é—®é¢˜ï¼Œä¸¤ä¸ªå€¼éƒ½æ˜¯371ä½†æ˜¯ç»“æœæ˜¯falseï¼Œç„¶åæ‰æƒ³èµ·æ¥Intergeråº•éƒ¨æ˜¯æœ‰ç¼“å­˜çš„ï¼Œå…³ç³»å¦‚ä¸‹ï¼š</p>
<p>Integerä¸intç±»å‹çš„å…³ç³»ï¼Œå¯ä»¥ç®€å•çš„å›ç­”ï¼ŒIntegeræ˜¯intçš„åŒ…è£…ç±»ï¼Œintçš„é»˜è®¤å€¼æ˜¯0ï¼Œè€ŒIntegerçš„é»˜è®¤å€¼æ˜¯nullï¼ˆjdk1.5çš„æ–°ç‰¹æ€§ è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±ï¼ŒInteger.valueOfï¼ˆï¼‰ å’Œxx.intValueï¼ˆï¼‰ ï¼‰,éœ€è¦æ³¨æ„çš„æ˜¯Integeré‡Œé¢é»˜è®¤çš„ç¼“å­˜æ•°å­—æ˜¯<code>-128-127</code>ã€‚</p>
<p>1ã€Integerä¸Integerç›¸äº’æ¯”è¾ƒï¼Œæ•°æ®åœ¨<code>-128-127</code>èŒƒå›´å†…ï¼Œå°±ä¼šä»ç¼“å­˜ä¸­æ‹¿å»æ•°æ®ï¼Œæ¯”è¾ƒå°±ç›¸ç­‰ï¼›å¦‚æœä¸åœ¨è¿™ä¸ªèŒƒå›´ï¼Œå°±ä¼šç›´æ¥æ–°åˆ›å»ºä¸€ä¸ªIntegerå¯¹è±¡ï¼Œä½¿ç”¨ == åˆ¤æ–­çš„æ˜¯ä¸¤ä¸ªå†…å­˜çš„åº”ç”¨åœ°å€ï¼Œæ‰€ä»¥è‡ªç„¶ä¸ç›¸ç­‰ï¼Œåº”è¯¥ç”¨equalsæ¥åˆ¤æ–­å€¼æ˜¯å¦æƒ³ç­‰</p>
<p>2ã€Integerå’Œintç±»å‹ç›¸æ¯”ï¼Œåœ¨jdk1.5,ä¼šè‡ªåŠ¨æ‹†ç®±ï¼Œç„¶åæ¯”è¾ƒæ ˆå†…å­˜ä¸­çš„æ•°æ®ï¼Œæ‰€ä»¥æ²¡æœ‰ä¸æƒ³ç­‰çš„æƒ…å†µ</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®—æ³•æ¡†æ¶</title>
    <url>/2020/08/31/%E7%AE%97%E6%B3%95%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h3 id="1-åŠ¨æ€è§„åˆ’è§£é¢˜å¥—è·¯æ¡†æ¶"><a href="#1-åŠ¨æ€è§„åˆ’è§£é¢˜å¥—è·¯æ¡†æ¶" class="headerlink" title="1.åŠ¨æ€è§„åˆ’è§£é¢˜å¥—è·¯æ¡†æ¶"></a>1.åŠ¨æ€è§„åˆ’è§£é¢˜å¥—è·¯æ¡†æ¶</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"># åˆå§‹åŒ– base case</span><br><span class="line">dp[<span class="number">0</span>][<span class="number">0</span>][...] = base</span><br><span class="line"># è¿›è¡ŒçŠ¶æ€è½¬ç§»</span><br><span class="line"><span class="keyword">for</span> çŠ¶æ€<span class="number">1</span> in çŠ¶æ€<span class="number">1</span>çš„æ‰€æœ‰å–å€¼ï¼š</span><br><span class="line">    <span class="keyword">for</span> çŠ¶æ€<span class="number">2</span> in çŠ¶æ€<span class="number">2</span>çš„æ‰€æœ‰å–å€¼ï¼š</span><br><span class="line">        <span class="keyword">for</span> ...</span><br><span class="line">            dp[çŠ¶æ€<span class="number">1</span>][çŠ¶æ€<span class="number">2</span>][...] = æ±‚æœ€å€¼(é€‰æ‹©<span class="number">1</span>ï¼Œé€‰æ‹©<span class="number">2</span>...)</span><br></pre></td></tr></table></figure>
<p>tips:</p>
<p>é€šè¿‡ã€Œå¤‡å¿˜å½•ã€æˆ–è€…ã€Œdp tableã€çš„æ–¹æ³•æ¥ä¼˜åŒ–é€’å½’æ ‘</p>
<a id="more"></a>
<h3 id="2-å›æº¯ç®—æ³•è§£é¢˜å¥—è·¯æ¡†æ¶"><a href="#2-å›æº¯ç®—æ³•è§£é¢˜å¥—è·¯æ¡†æ¶" class="headerlink" title="2.å›æº¯ç®—æ³•è§£é¢˜å¥—è·¯æ¡†æ¶"></a>2.å›æº¯ç®—æ³•è§£é¢˜å¥—è·¯æ¡†æ¶</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">result = []</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">backtrack</span><span class="params">(è·¯å¾„, é€‰æ‹©åˆ—è¡¨)</span>:</span></span><br><span class="line"><span class="function">    <span class="keyword">if</span> æ»¡è¶³ç»“æŸæ¡ä»¶:</span></span><br><span class="line"><span class="function">        result.<span class="title">add</span><span class="params">(è·¯å¾„)</span></span></span><br><span class="line"><span class="function">        return</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="keyword">for</span> é€‰æ‹© in é€‰æ‹©åˆ—è¡¨:</span></span><br><span class="line"><span class="function">        åšé€‰æ‹©</span></span><br><span class="line"><span class="function">        <span class="title">backtrack</span><span class="params">(è·¯å¾„, é€‰æ‹©åˆ—è¡¨)</span></span></span><br><span class="line"><span class="function">        æ’¤é”€é€‰æ‹©</span></span><br></pre></td></tr></table></figure>
<h3 id="3-BFS-ç®—æ³•è§£é¢˜å¥—è·¯æ¡†æ¶"><a href="#3-BFS-ç®—æ³•è§£é¢˜å¥—è·¯æ¡†æ¶" class="headerlink" title="3.BFS ç®—æ³•è§£é¢˜å¥—è·¯æ¡†æ¶"></a>3.BFS ç®—æ³•è§£é¢˜å¥—è·¯æ¡†æ¶</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—ä»èµ·ç‚¹ start åˆ°ç»ˆç‚¹ target çš„æœ€è¿‘è·ç¦»</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BFS</span><span class="params">(Node start, Node target)</span> </span>&#123;</span><br><span class="line">    Queue&lt;Node&gt; q; <span class="comment">// æ ¸å¿ƒæ•°æ®ç»“æ„</span></span><br><span class="line">    Set&lt;Node&gt; visited; <span class="comment">// é¿å…èµ°å›å¤´è·¯</span></span><br><span class="line"></span><br><span class="line">    q.offer(start); <span class="comment">// å°†èµ·ç‚¹åŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line">    visited.add(start);</span><br><span class="line">    <span class="keyword">int</span> step = <span class="number">0</span>; <span class="comment">// è®°å½•æ‰©æ•£çš„æ­¥æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (q not empty) &#123;</span><br><span class="line">        <span class="keyword">int</span> sz = q.size();</span><br><span class="line">        <span class="comment">/* å°†å½“å‰é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å‘å››å‘¨æ‰©æ•£ */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz; i++) &#123;</span><br><span class="line">            Node cur = q.poll();</span><br><span class="line">            <span class="comment">/* åˆ’é‡ç‚¹ï¼šè¿™é‡Œåˆ¤æ–­æ˜¯å¦åˆ°è¾¾ç»ˆç‚¹ */</span></span><br><span class="line">            <span class="keyword">if</span> (cur is target)</span><br><span class="line">                <span class="keyword">return</span> step;</span><br><span class="line">            <span class="comment">/* å°† cur çš„ç›¸é‚»èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ— */</span></span><br><span class="line">            <span class="keyword">for</span> (Node x : cur.adj())</span><br><span class="line">                <span class="keyword">if</span> (x not in visited) &#123;</span><br><span class="line">                    q.offer(x);</span><br><span class="line">                    visited.add(x);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* åˆ’é‡ç‚¹ï¼šæ›´æ–°æ­¥æ•°åœ¨è¿™é‡Œ */</span></span><br><span class="line">        step++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>tips:</p>
<p>åŒå‘ BFS ä¼˜åŒ–ï¼Œä¼ ç»Ÿçš„ BFS æ¡†æ¶å°±æ˜¯ä»èµ·ç‚¹å¼€å§‹å‘å››å‘¨æ‰©æ•£ï¼Œé‡åˆ°ç»ˆç‚¹æ—¶åœæ­¢ï¼›è€ŒåŒå‘ BFS åˆ™æ˜¯ä»èµ·ç‚¹å’Œç»ˆç‚¹åŒæ—¶å¼€å§‹æ‰©æ•£ï¼Œå½“ä¸¤è¾¹æœ‰äº¤é›†çš„æ—¶å€™åœæ­¢ã€‚</p>
<h3 id="4-äºŒåˆ†æœç´¢å¥—è·¯æ¡†æ¶"><a href="#4-äºŒåˆ†æœç´¢å¥—è·¯æ¡†æ¶" class="headerlink" title="4.äºŒåˆ†æœç´¢å¥—è·¯æ¡†æ¶"></a>4.äºŒåˆ†æœç´¢å¥—è·¯æ¡†æ¶</h3><figure class="highlight vbscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span> binarySearch(<span class="built_in">int</span>[] nums, <span class="built_in">int</span> target) &#123;</span><br><span class="line">    <span class="built_in">int</span> <span class="built_in">left</span> = <span class="number">0</span>, <span class="built_in">right</span> = ...;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(...) &#123;</span><br><span class="line">        <span class="built_in">int</span> <span class="built_in">mid</span> = <span class="built_in">left</span> + (<span class="built_in">right</span> - <span class="built_in">left</span>) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums[<span class="built_in">mid</span>] == target) &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[<span class="built_in">mid</span>] &lt; target) &#123;</span><br><span class="line">            <span class="built_in">left</span> = ...</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[<span class="built_in">mid</span>] &gt; target) &#123;</span><br><span class="line">            <span class="built_in">right</span> = ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return ...;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>tips:</p>
<p>åˆ†æäºŒåˆ†æŸ¥æ‰¾çš„ä¸€ä¸ªæŠ€å·§æ˜¯ï¼šä¸è¦å‡ºç° elseï¼Œè€Œæ˜¯æŠŠæ‰€æœ‰æƒ…å†µç”¨ else if å†™æ¸…æ¥šï¼Œè¿™æ ·å¯ä»¥æ¸…æ¥šåœ°å±•ç°æ‰€æœ‰ç»†èŠ‚ã€‚è®¡ç®— mid æ—¶éœ€è¦é˜²æ­¢æº¢å‡ºï¼Œä»£ç ä¸­ <code>left + (right - left) / 2</code> å°±å’Œ <code>(left + right) / 2</code> çš„ç»“æœç›¸åŒï¼Œä½†æ˜¯æœ‰æ•ˆé˜²æ­¢äº† <code>left</code> å’Œ <code>right</code> å¤ªå¤§ç›´æ¥ç›¸åŠ å¯¼è‡´æº¢å‡ºã€‚</p>
<h3 id="5-æ»‘åŠ¨çª—å£ç®—æ³•"><a href="#5-æ»‘åŠ¨çª—å£ç®—æ³•" class="headerlink" title="5.æ»‘åŠ¨çª—å£ç®—æ³•"></a>5.æ»‘åŠ¨çª—å£ç®—æ³•</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* æ»‘åŠ¨çª—å£ç®—æ³•æ¡†æ¶ */</span></span><br><span class="line">  void slidingWindow(<span class="type">String</span> s, <span class="type">String</span> t) &#123;</span><br><span class="line">      <span class="type">HashMap</span>&lt;<span class="type">Character</span>, <span class="type">Integer</span>&gt; need, window;</span><br><span class="line">      <span class="keyword">for</span> (char <span class="built_in">c</span> : t.toCharArray()) &#123;</span><br><span class="line">          need.put(<span class="built_in">c</span>, need.getOrDefault(<span class="built_in">c</span>, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      int <span class="keyword">left</span> = <span class="number">0</span>, <span class="keyword">right</span> = <span class="number">0</span>;</span><br><span class="line">      int valid = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (<span class="keyword">right</span> &lt; s.length()) &#123;</span><br><span class="line">          <span class="comment">// c æ˜¯å°†ç§»å…¥çª—å£çš„å­—ç¬¦</span></span><br><span class="line">          char <span class="built_in">c</span> = s.charAt(<span class="keyword">right</span>);</span><br><span class="line">          <span class="comment">// å³ç§»çª—å£</span></span><br><span class="line">          <span class="keyword">right</span>++;</span><br><span class="line">          <span class="comment">// è¿›è¡Œçª—å£å†…æ•°æ®çš„ä¸€ç³»åˆ—æ›´æ–°</span></span><br><span class="line">      		...</span><br><span class="line"></span><br><span class="line">          <span class="comment">/*** debug è¾“å‡ºçš„ä½ç½® ***/</span></span><br><span class="line">          <span class="type">System</span>.out.printf(<span class="string">"window: [%d, %d)\n"</span>, <span class="keyword">left</span>, <span class="keyword">right</span>);</span><br><span class="line">          <span class="comment">/********************/</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">// åˆ¤æ–­å·¦ä¾§çª—å£æ˜¯å¦è¦æ”¶ç¼©</span></span><br><span class="line">          <span class="keyword">while</span> (window needs shrink)&#123;</span><br><span class="line">              <span class="comment">// d æ˜¯å°†ç§»å‡ºçª—å£çš„å­—ç¬¦</span></span><br><span class="line">              char d = s.charAt(<span class="keyword">left</span>);</span><br><span class="line">              <span class="comment">// å·¦ç§»çª—å£</span></span><br><span class="line">              <span class="keyword">left</span>++;</span><br><span class="line">              <span class="comment">// è¿›è¡Œçª—å£å†…æ•°æ®çš„ä¸€ç³»åˆ—æ›´æ–°</span></span><br><span class="line">        		  ...</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-è‚¡ç¥¨ä¹°å–"><a href="#6-è‚¡ç¥¨ä¹°å–" class="headerlink" title="6.è‚¡ç¥¨ä¹°å–"></a>6.è‚¡ç¥¨ä¹°å–</h3><p>ä¸€ã€ç©·ä¸¾æ¡†æ¶</p>
<blockquote>
<p>å…·ä½“åˆ°æ¯ä¸€å¤©ï¼Œçœ‹çœ‹æ€»å…±æœ‰å‡ ç§å¯èƒ½çš„ã€ŒçŠ¶æ€ã€ï¼Œå†æ‰¾å‡ºæ¯ä¸ªã€ŒçŠ¶æ€ã€å¯¹åº”çš„ã€Œé€‰æ‹©ã€ã€‚æˆ‘ä»¬è¦ç©·ä¸¾æ‰€æœ‰ã€ŒçŠ¶æ€ã€ï¼Œç©·ä¸¾çš„ç›®çš„æ˜¯æ ¹æ®å¯¹åº”çš„ã€Œé€‰æ‹©ã€æ›´æ–°çŠ¶æ€</p>
</blockquote>
<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">for çŠ¶æ€<span class="number">1</span> in çŠ¶æ€<span class="number">1</span>çš„æ‰€æœ‰å–å€¼ï¼š</span><br><span class="line">    for çŠ¶æ€<span class="number">2</span> in çŠ¶æ€<span class="number">2</span>çš„æ‰€æœ‰å–å€¼ï¼š</span><br><span class="line">        for ...</span><br><span class="line">            dp[çŠ¶æ€<span class="number">1</span>][çŠ¶æ€<span class="number">2</span>][...] = æ‹©ä¼˜(é€‰æ‹©<span class="number">1</span>ï¼Œé€‰æ‹©<span class="number">2.</span>..)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ã€Œé€‰æ‹©ã€ï¼šä¹°å…¥ã€å–å‡ºã€æ— æ“ä½œ<br>ã€ŒçŠ¶æ€ã€ï¼šå¤©æ•°ã€å…è®¸äº¤æ˜“çš„æœ€å¤§æ¬¡æ•°ã€å½“å‰çš„æŒæœ‰çŠ¶æ€(1æŒæœ‰ï¼Œ0æœªæŒæœ‰)</p>
<p><code>dp[3][2][1]</code> ï¼šä»Šå¤©æ˜¯ç¬¬ä¸‰å¤©ï¼Œæˆ‘ç°åœ¨æ‰‹ä¸ŠæŒæœ‰ç€è‚¡ç¥¨ï¼Œè‡³ä»Šæœ€å¤šè¿›è¡Œ 2 æ¬¡äº¤æ˜“</p>
<p>æ±‚<code>dp[n - 1][K][0]</code></p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">dp[<span class="string">i</span>][<span class="symbol">k</span>][<span class="string">0 or 1</span>]</span><br><span class="line">0 <span class="xml"><span class="tag">&lt;<span class="name">=</span> <span class="attr">i</span> &lt;= <span class="string">n-1,</span> <span class="attr">1</span> &lt;= <span class="string">k</span> &lt;= <span class="string">K</span></span></span></span><br><span class="line"><span class="xml">n ä¸ºå¤©æ•°ï¼Œå¤§ K ä¸ºæœ€å¤šäº¤æ˜“æ•°</span></span><br><span class="line"><span class="xml">æ­¤é—®é¢˜å…± n Ã— K Ã— 2 ç§çŠ¶æ€ï¼Œå…¨éƒ¨ç©·ä¸¾å°±èƒ½æå®šã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="xml">for 0 <span class="tag">&lt;<span class="name">=</span> <span class="attr">i</span> &lt; <span class="attr">n:</span></span></span></span><br><span class="line"><span class="xml">    for 1 <span class="tag">&lt;<span class="name">=</span> <span class="attr">k</span> &lt;= <span class="string">K:</span></span></span></span><br><span class="line"><span class="xml">        for s in &#123;0, 1&#125;:</span></span><br><span class="line"><span class="xml">            dp[i][k][s] = max(buy, sell, rest)</span></span><br></pre></td></tr></table></figure>
<p>äºŒã€çŠ¶æ€è½¬ç§»æ¡†æ¶</p>
<p><img src="/img/gupiaowenti.png"></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">dp[<span class="string">i</span>][<span class="symbol">k</span>][<span class="string">0</span>] = max(dp[<span class="string">i-1</span>][<span class="symbol">k</span>][<span class="string">0</span>], dp[<span class="string">i-1</span>][<span class="symbol">k</span>][<span class="string">1</span>] + prices[i])</span><br><span class="line"><span class="code">             	max(é€‰æ‹© rest,      é€‰æ‹© sell)</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä»Šå¤©æˆ‘æ²¡æœ‰æŒæœ‰è‚¡ç¥¨ï¼Œæœ‰ä¸¤ç§å¯èƒ½ï¼š<br>è¦ä¹ˆæ˜¯æˆ‘æ˜¨å¤©å°±æ²¡æœ‰æŒæœ‰ï¼Œç„¶åä»Šå¤©é€‰æ‹© restï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©è¿˜æ˜¯æ²¡æœ‰æŒæœ‰ï¼›<br>è¦ä¹ˆæ˜¯æˆ‘æ˜¨å¤©æŒæœ‰è‚¡ç¥¨ï¼Œä½†æ˜¯ä»Šå¤©æˆ‘ sell äº†ï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©æ²¡æœ‰æŒæœ‰è‚¡ç¥¨äº†ã€‚</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">dp[<span class="string">i</span>][<span class="symbol">k</span>][<span class="string">1</span>] = max(dp[<span class="string">i-1</span>][<span class="symbol">k</span>][<span class="string">1</span>], dp[<span class="string">i-1</span>][<span class="symbol">k-1</span>][<span class="string">0</span>] - prices[i])</span><br><span class="line"><span class="code">              max(é€‰æ‹© rest,      é€‰æ‹© buy)</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä»Šå¤©æˆ‘æŒæœ‰ç€è‚¡ç¥¨ï¼Œæœ‰ä¸¤ç§å¯èƒ½ï¼š<br>è¦ä¹ˆæˆ‘æ˜¨å¤©å°±æŒæœ‰ç€è‚¡ç¥¨ï¼Œç„¶åä»Šå¤©é€‰æ‹© restï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©è¿˜æŒæœ‰ç€è‚¡ç¥¨ï¼›<br>è¦ä¹ˆæˆ‘æ˜¨å¤©æœ¬æ²¡æœ‰æŒæœ‰ï¼Œä½†ä»Šå¤©æˆ‘é€‰æ‹© buyï¼Œæ‰€ä»¥ä»Šå¤©æˆ‘å°±æŒæœ‰è‚¡ç¥¨äº†ã€‚</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">dp[<span class="string">-1</span>][<span class="symbol">k</span>][<span class="string">0</span>] = 0</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å› ä¸º i æ˜¯ä» 0 å¼€å§‹çš„ï¼Œæ‰€ä»¥ i = -1 æ„å‘³ç€è¿˜æ²¡æœ‰å¼€å§‹ï¼Œè¿™æ—¶å€™çš„åˆ©æ¶¦å½“ç„¶æ˜¯ 0 ã€‚</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">dp[<span class="string">-1</span>][<span class="symbol">k</span>][<span class="string">1</span>] = -infinity</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿˜æ²¡å¼€å§‹çš„æ—¶å€™ï¼Œæ˜¯ä¸å¯èƒ½æŒæœ‰è‚¡ç¥¨çš„ï¼Œç”¨è´Ÿæ— ç©·è¡¨ç¤ºè¿™ç§ä¸å¯èƒ½ã€‚</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">dp[<span class="string">i</span>][<span class="symbol">0</span>][<span class="string">0</span>] = 0</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å› ä¸º k æ˜¯ä» 1 å¼€å§‹çš„ï¼Œæ‰€ä»¥ k = 0 æ„å‘³ç€æ ¹æœ¬ä¸å…è®¸äº¤æ˜“ï¼Œè¿™æ—¶å€™åˆ©æ¶¦å½“ç„¶æ˜¯ 0 ã€‚</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">dp[<span class="string">i</span>][<span class="symbol">0</span>][<span class="string">1</span>] = -infinity</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸å…è®¸äº¤æ˜“çš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸å¯èƒ½æŒæœ‰è‚¡ç¥¨çš„ï¼Œç”¨è´Ÿæ— ç©·è¡¨ç¤ºè¿™ç§ä¸å¯èƒ½ã€‚</p>
</blockquote>
<p>â€‹                                                                            â¬â¬â¬</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">base caseï¼š</span><br><span class="line">dp[<span class="string">-1</span>][<span class="symbol">k</span>][<span class="string">0</span>] = dp[<span class="string">i</span>][<span class="symbol">0</span>][<span class="string">0</span>] = 0</span><br><span class="line">dp[<span class="string">-1</span>][<span class="symbol">k</span>][<span class="string">1</span>] = dp[<span class="string">i</span>][<span class="symbol">0</span>][<span class="string">1</span>] = -infinity</span><br><span class="line"></span><br><span class="line">çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</span><br><span class="line">dp[<span class="string">i</span>][<span class="symbol">k</span>][<span class="string">0</span>] = max(dp[<span class="string">i-1</span>][<span class="symbol">k</span>][<span class="string">0</span>], dp[<span class="string">i-1</span>][<span class="symbol">k</span>][<span class="string">1</span>] + prices[i])</span><br><span class="line">dp[<span class="string">i</span>][<span class="symbol">k</span>][<span class="string">1</span>] = max(dp[<span class="string">i-1</span>][<span class="symbol">k</span>][<span class="string">1</span>], dp[<span class="string">i-1</span>][<span class="symbol">k-1</span>][<span class="string">0</span>] - prices[i])</span><br></pre></td></tr></table></figure>
<p>tips:</p>
<p>å¦‚æœ buyï¼Œå°±è¦ä»åˆ©æ¶¦ä¸­å‡å» prices[i]ï¼Œå¦‚æœ sellï¼Œå°±è¦ç»™åˆ©æ¶¦å¢åŠ  prices[i]ã€‚ä»Šå¤©çš„æœ€å¤§åˆ©æ¶¦å°±æ˜¯è¿™ä¸¤ç§å¯èƒ½é€‰æ‹©ä¸­è¾ƒå¤§çš„é‚£ä¸ªã€‚è€Œä¸”æ³¨æ„ k çš„é™åˆ¶ï¼Œæˆ‘ä»¬åœ¨é€‰æ‹© buy çš„æ—¶å€™ï¼ŒæŠŠ k å‡å°äº† 1ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨ sell çš„æ—¶å€™å‡ 1ï¼Œä¸€æ ·çš„ã€‚</p>
<h3 id="7-æ‰“å®¶åŠ«èˆé—®é¢˜"><a href="#7-æ‰“å®¶åŠ«èˆé—®é¢˜" class="headerlink" title="7.æ‰“å®¶åŠ«èˆé—®é¢˜"></a>7.æ‰“å®¶åŠ«èˆé—®é¢˜</h3><p>è¿˜æ˜¯åŠ¨æ€è§„åˆ’</p>
<p>ã€ŒçŠ¶æ€ã€ï¼šé¢å‰æˆ¿å­çš„ç´¢å¼•</p>
<p>ã€Œé€‰æ‹©ã€ï¼šæŠ¢æˆ–ä¸æŠ¢</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">	<span class="comment">//è‡ªé¡¶å‘ä¸‹</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">dp</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> start)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> res = Math.<span class="built_in">max</span>(dp(nums, start + <span class="number">1</span>), nums[start] + dp(nums, start + <span class="number">2</span>));</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//è‡ªåº•å‘ä¸Š</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rob</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> n = nums.length;</span><br><span class="line">      <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[n + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">          dp[i] = Math.<span class="built_in">max</span>(dp[i + <span class="number">1</span>], nums[i] + dp[i + <span class="number">2</span>]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> dp[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//å½“å‰çŠ¶æ€è½¬ç§»åªå’Œdp[i]åä¸¤é—´ç›¸å…³ ä¼˜åŒ–ç©ºé—´O(1)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rob2</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> n = nums.length;</span><br><span class="line">      <span class="keyword">int</span> dp_i_1 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">int</span> dp_i_2 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">int</span> dp_i = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">          dp_i = Math.<span class="built_in">max</span>(dp_i_1, nums[i] + dp_i_2);</span><br><span class="line">          dp_i_2 = dp_i_1;</span><br><span class="line">          dp_i_1 = dp_i;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> dp_i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//äºŒå‰æ ‘é¢˜</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * [0]:ä¸æŠ¢root</span></span><br><span class="line"><span class="comment">   * [1]:æŠ¢root</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">int</span>[] dp(TreeNode root) &#123;</span><br><span class="line">      <span class="keyword">if</span> (root == null) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">int</span>[] left = dp(root.left);</span><br><span class="line">      <span class="keyword">int</span>[] right = dp(root.right);</span><br><span class="line">      <span class="comment">//æŠ¢root ä¸‹å®¶å°±ä¸èƒ½æŠ¢</span></span><br><span class="line">      <span class="keyword">int</span> rob = root.val + left[<span class="number">0</span>] + right[<span class="number">0</span>];</span><br><span class="line">      <span class="comment">//ä¸æŠ¢root ä¸‹å®¶å¯ä»¥æŠ¢</span></span><br><span class="line">      <span class="keyword">int</span> not_rob = Math.<span class="built_in">max</span>(left[<span class="number">0</span>], left[<span class="number">1</span>]) + Math.<span class="built_in">max</span>(right[<span class="number">0</span>], right[<span class="number">1</span>]);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;not_rob, rob&#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-nSum-é—®é¢˜"><a href="#8-nSum-é—®é¢˜" class="headerlink" title="8.nSum é—®é¢˜"></a>8.nSum é—®é¢˜</h3><figure class="highlight excel"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line">     * <span class="number">100</span><span class="built_in">sum</span></span><br><span class="line">     * è°ƒç”¨å‰ å…ˆç»™æ•°ç»„æ’åº  Arrays.sort(nums);</span><br><span class="line">     */</span><br><span class="line">    public List&lt;List&lt;Integer&gt;&gt; nSumTarget(<span class="built_in">int</span>[] nums, <span class="built_in">int</span> <span class="built_in">n</span>, <span class="built_in">int</span> start, <span class="built_in">int</span> target) &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;();</span><br><span class="line">        <span class="built_in">int</span> sz = nums.length;</span><br><span class="line">        //è‡³å°‘<span class="number">2</span><span class="built_in">sum</span></span><br><span class="line">        <span class="built_in">if</span> (<span class="built_in">n</span> &lt; <span class="number">2</span> || sz &lt; <span class="built_in">n</span>) &#123;</span><br><span class="line">            return res;</span><br><span class="line">        &#125;</span><br><span class="line">        //ä»<span class="number">2</span><span class="built_in">sum</span>å¼€å§‹</span><br><span class="line">        <span class="built_in">if</span> (<span class="built_in">n</span> == <span class="number">2</span>) &#123;</span><br><span class="line">            //åŒæŒ‡é’ˆ</span><br><span class="line">            <span class="built_in">int</span> <span class="built_in">left</span> = start;</span><br><span class="line">            <span class="built_in">int</span> <span class="built_in">right</span> = sz - <span class="number">1</span>;</span><br><span class="line">            while (<span class="built_in">left</span> &lt; <span class="built_in">right</span>) &#123;</span><br><span class="line">                <span class="built_in">int</span> <span class="built_in">sum</span> = nums[<span class="built_in">left</span>] + nums[<span class="built_in">right</span>];</span><br><span class="line">                <span class="built_in">int</span> lv = nums[<span class="built_in">left</span>];</span><br><span class="line">                <span class="built_in">int</span> rv = nums[<span class="built_in">right</span>];</span><br><span class="line">                <span class="built_in">if</span> (<span class="built_in">sum</span> &lt; target) &#123;</span><br><span class="line">                    while (<span class="built_in">left</span> &lt; <span class="built_in">right</span> &amp;&amp; nums[<span class="built_in">left</span>] == lv) &#123;</span><br><span class="line">                        <span class="built_in">left</span>++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else <span class="built_in">if</span> (<span class="built_in">sum</span> &gt; target) &#123;</span><br><span class="line">                    while (<span class="built_in">left</span> &lt; <span class="built_in">right</span> &amp;&amp; nums[<span class="built_in">right</span>] == rv) &#123;</span><br><span class="line">                        <span class="built_in">right</span>--;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    List&lt;Integer&gt; l = new ArrayList&lt;&gt;();</span><br><span class="line">                    l.add(lv);</span><br><span class="line">                    l.add(rv);</span><br><span class="line">                    res.add(l);</span><br><span class="line">                    while (<span class="built_in">left</span> &lt; <span class="built_in">right</span> &amp;&amp; nums[<span class="built_in">left</span>] == lv) &#123;</span><br><span class="line">                        <span class="built_in">left</span>++;</span><br><span class="line">                    &#125;</span><br><span class="line">                    while (<span class="built_in">left</span> &lt; <span class="built_in">right</span> &amp;&amp; nums[<span class="built_in">right</span>] == rv) &#123;</span><br><span class="line">                        <span class="built_in">right</span>--;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // <span class="built_in">n</span> &gt; <span class="number">2</span>æ—¶ é€’å½’è®¡ç®—ï¼ˆ<span class="built_in">n</span> - <span class="number">1</span>ï¼‰<span class="built_in">sum</span> çš„ç»“æœ</span><br><span class="line">            for (<span class="built_in">int</span> i = start; i &lt; sz; i++) &#123;</span><br><span class="line">                List&lt;List&lt;Integer&gt;&gt; sub = nSumTarget(nums, <span class="built_in">n</span> - <span class="number">1</span>, i + <span class="number">1</span>, target - nums[i]);</span><br><span class="line">                for (List&lt;Integer&gt; arr <span class="symbol">:</span> sub) &#123;</span><br><span class="line">                    //ï¼ˆ<span class="built_in">n</span> - <span class="number">1</span>ï¼‰<span class="built_in">sum</span> + num[i] = nsum</span><br><span class="line">                    arr.add(nums[i]);</span><br><span class="line">                    res.add(arr);</span><br><span class="line">                &#125;</span><br><span class="line">                while (i &lt; sz - <span class="number">1</span> &amp;&amp; nums[i] == nums[i + <span class="number">1</span>]) &#123;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>tips:</p>
<p>è°ƒç”¨å‰å…ˆç»™æ•°ç»„æ’åº</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line">nsumè°ƒç”¨</span><br><span class="line"><span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;&#125;;</span><br><span class="line">Arrays.sort(arr);</span><br><span class="line">nSumTarget(arr, n, <span class="number">0</span>, <span class="keyword">target</span>)</span><br></pre></td></tr></table></figure>
<h3 id="9-é«˜æ¥¼æ‰”é¸¡è›‹é—®é¢˜"><a href="#9-é«˜æ¥¼æ‰”é¸¡è›‹é—®é¢˜" class="headerlink" title="9.é«˜æ¥¼æ‰”é¸¡è›‹é—®é¢˜"></a>9.é«˜æ¥¼æ‰”é¸¡è›‹é—®é¢˜</h3><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">// å½“å‰çŠ¶æ€ä¸º (K ä¸ªé¸¡è›‹ï¼Œ<span class="keyword">N</span> å±‚æ¥¼)</span><br><span class="line">// è¿”å›è¿™ä¸ªçŠ¶æ€ä¸‹çš„æœ€ä¼˜ç»“æœ</span><br><span class="line"><span class="keyword">int</span> <span class="keyword">dp</span>(K, <span class="keyword">N</span>):</span><br><span class="line">    <span class="keyword">int</span> <span class="keyword">res</span></span><br><span class="line">    <span class="keyword">for</span> <span class="number">1</span> &lt;= i &lt;= <span class="keyword">N</span>:</span><br><span class="line">        <span class="keyword">res</span> = <span class="built_in">min</span>(<span class="keyword">res</span>, è¿™æ¬¡åœ¨ç¬¬ i å±‚æ¥¼æ‰”é¸¡è›‹)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">res</span></span><br><span class="line">    </span><br><span class="line">base case:</span><br><span class="line">    <span class="keyword">if</span> K == <span class="number">1</span>: <span class="keyword">return</span> <span class="keyword">N</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">N</span> == <span class="number">0</span>: <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœé¸¡è›‹ç¢äº†ï¼Œé‚£ä¹ˆé¸¡è›‹çš„ä¸ªæ•°Kåº”è¯¥å‡ä¸€ï¼Œæœç´¢çš„æ¥¼å±‚åŒºé—´åº”è¯¥ä»[1..N]å˜ä¸º[1..i-1]å…±i-1å±‚æ¥¼</p>
<p>å¦‚æœé¸¡è›‹æ²¡ç¢ï¼Œé‚£ä¹ˆé¸¡è›‹çš„ä¸ªæ•°Kä¸å˜ï¼Œæœç´¢çš„æ¥¼å±‚åŒºé—´åº”è¯¥ä» [1..N]å˜ä¸º[i+1..N]å…±N-iå±‚æ¥¼</p>
<p>æœ€åæƒ…å†µä¸‹æ‰”é¸¡è›‹çš„æ¬¡æ•°ï¼Œæ‰€ä»¥é¸¡è›‹åœ¨ç¬¬iå±‚æ¥¼ç¢æ²¡ç¢ï¼Œå–å†³äºå“ªç§æƒ…å†µçš„ç»“æœæ›´å¤§</p>
<p>ğŸ”½ğŸ”½ğŸ”½</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">Map&lt;<span class="keyword">int</span>[], Integer&gt; <span class="built_in">map</span> = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dp</span><span class="params">(<span class="keyword">int</span> K, <span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> res = Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">if</span> (K == <span class="number">1</span>) <span class="keyword">return</span> N;</span><br><span class="line">        <span class="keyword">if</span> (N == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;K, N&#125;;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">map</span>.containsKey(arr)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">map</span>.<span class="built_in">get</span>(arr);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</span><br><span class="line">            <span class="comment">// æœ€åæƒ…å†µä¸‹çš„æœ€å°‘æ‰”é¸¡è›‹æ¬¡æ•°</span></span><br><span class="line">            res = Math.<span class="built_in">min</span>(res,</span><br><span class="line">                    Math.<span class="built_in">max</span>(dp(K, N - i), <span class="comment">// æ²¡ç¢</span></span><br><span class="line">                            dp(K - <span class="number">1</span>, i - <span class="number">1</span>)) <span class="comment">//ç¢</span></span><br><span class="line">                            + <span class="number">1</span> <span class="comment">//åœ¨ç¬¬ i æ¥¼æ‰”äº†ä¸€æ¬¡</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">map</span>.<span class="built_in">put</span>(arr, res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>tips:</p>
<p>å¯ä»¥å°†forå¾ªç¯æ”¹æˆäºŒåˆ†æœç´¢</p>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>æ¡†æ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>äºŒå‰æ ‘éå†</title>
    <url>/2020/08/24/%E4%BA%8C%E5%8F%89%E6%A0%91%E9%81%8D%E5%8E%86/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>äºŒå‰æ ‘çš„å…ˆåºã€ä¸­åºã€ååºéå†</p>
<a id="more"></a>
<p><strong>æ ‘èŠ‚ç‚¹ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">    <span class="comment">//å·¦å­æ ‘</span></span><br><span class="line">    TreeNode left;</span><br><span class="line">    <span class="comment">//å³å­æ ‘</span></span><br><span class="line">    TreeNode right;</span><br><span class="line">    <span class="comment">//æ„é€ æ–¹æ³•</span></span><br><span class="line">    TreeNode(<span class="keyword">int</span> x) &#123;</span><br><span class="line">        val = x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/img/treeNode.png"></p>
<blockquote>
<p>å…ˆåºï¼š1 2 4 6 7 8 3 5<br>ä¸­åºï¼š4 7 6 8 2 1 3 5<br>ååºï¼š7 8 6 4 2 5 3 1</p>
</blockquote>
<p><strong>å…ˆåºï¼š</strong>è€ƒå¯Ÿåˆ°ä¸€ä¸ªèŠ‚ç‚¹åï¼Œå³åˆ»è¾“å‡ºè¯¥èŠ‚ç‚¹çš„å€¼ï¼Œå¹¶ç»§ç»­éå†å…¶å·¦å³å­æ ‘ã€‚(æ ¹å·¦å³)</p>
<p><strong>ä¸­åºï¼š</strong>è€ƒå¯Ÿåˆ°ä¸€ä¸ªèŠ‚ç‚¹åï¼Œå°†å…¶æš‚å­˜ï¼Œéå†å®Œå·¦å­æ ‘åï¼Œå†è¾“å‡ºè¯¥èŠ‚ç‚¹çš„å€¼ï¼Œç„¶åéå†å³å­æ ‘ã€‚(å·¦æ ¹å³)</p>
<p><strong>ååºï¼š</strong>è€ƒå¯Ÿåˆ°ä¸€ä¸ªèŠ‚ç‚¹åï¼Œå°†å…¶æš‚å­˜ï¼Œéå†å®Œå·¦å³å­æ ‘åï¼Œå†è¾“å‡ºè¯¥èŠ‚ç‚¹çš„å€¼ã€‚(å·¦å³æ ¹)</p>
<h4 id="é€’å½’å…ˆåºéå†"><a href="#é€’å½’å…ˆåºéå†" class="headerlink" title="é€’å½’å…ˆåºéå†"></a>é€’å½’å…ˆåºéå†</h4><p>é€’å½’å…ˆåºéå†å¾ˆå®¹æ˜“ç†è§£ï¼Œå…ˆè¾“å‡ºèŠ‚ç‚¹çš„å€¼ï¼Œå†é€’å½’éå†å·¦å³å­æ ‘ã€‚ä¸­åºå’Œååºçš„é€’å½’ç±»ä¼¼ï¼Œæ”¹å˜æ ¹èŠ‚ç‚¹è¾“å‡ºä½ç½®å³å¯ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€’å½’å…ˆåºéå†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">recursionPreorderTraversal</span>(<span class="params">TreeNode root</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.print(root.val + <span class="string">" "</span>);</span><br><span class="line">        recursionPreorderTraversal(root.left);</span><br><span class="line">        recursionPreorderTraversal(root.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="éé€’å½’å…ˆåºéå†"><a href="#éé€’å½’å…ˆåºéå†" class="headerlink" title="éé€’å½’å…ˆåºéå†"></a>éé€’å½’å…ˆåºéå†</h4><p>å› ä¸ºè¦åœ¨éå†å®ŒèŠ‚ç‚¹çš„å·¦å­æ ‘åæ¥ç€éå†èŠ‚ç‚¹çš„å³å­æ ‘ï¼Œä¸ºäº†èƒ½æ‰¾åˆ°è¯¥èŠ‚ç‚¹ï¼Œéœ€è¦ä½¿ç”¨<strong>æ ˆ</strong>æ¥è¿›è¡Œæš‚å­˜ã€‚ä¸­åºå’Œååºä¹Ÿéƒ½æ¶‰åŠåˆ°å›æº¯ï¼Œæ‰€ä»¥éƒ½éœ€è¦ç”¨åˆ°<strong>æ ˆ</strong>ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// éé€’å½’å…ˆåºéå†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">preorderTraversal</span>(<span class="params">TreeNode root</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ç”¨æ¥æš‚å­˜èŠ‚ç‚¹çš„æ ˆ</span></span><br><span class="line">    Stack&lt;TreeNode&gt; treeNodeStack = <span class="keyword">new</span> Stack&lt;TreeNode&gt;();</span><br><span class="line">    <span class="comment">// æ–°å»ºä¸€ä¸ªæ¸¸æ ‡èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹</span></span><br><span class="line">    TreeNode node = root;</span><br><span class="line">    <span class="comment">// å½“éå†åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ— è®ºå®ƒçš„å·¦å³å­æ ‘éƒ½ä¸ºç©ºï¼Œå¹¶ä¸”æ ˆä¹Ÿä¸ºç©º</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥ï¼Œåªè¦ä¸åŒæ—¶æ»¡è¶³è¿™ä¸¤ç‚¹ï¼Œéƒ½éœ€è¦è¿›å…¥å¾ªç¯</span></span><br><span class="line">    <span class="keyword">while</span> (node != <span class="literal">null</span> || !treeNodeStack.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// è‹¥å½“å‰è€ƒæŸ¥èŠ‚ç‚¹éç©ºï¼Œåˆ™è¾“å‡ºè¯¥èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        <span class="comment">// ç”±è€ƒæŸ¥é¡ºåºå¾—çŸ¥ï¼Œéœ€è¦ä¸€ç›´å¾€å·¦èµ°</span></span><br><span class="line">        <span class="keyword">while</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.<span class="keyword">out</span>.print(node.val + <span class="string">" "</span>);</span><br><span class="line">            <span class="comment">// ä¸ºäº†ä¹‹åèƒ½æ‰¾åˆ°è¯¥èŠ‚ç‚¹çš„å³å­æ ‘ï¼Œæš‚å­˜è¯¥èŠ‚ç‚¹</span></span><br><span class="line">            treeNodeStack.push(node);</span><br><span class="line">            node = node.left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¸€ç›´åˆ°å·¦å­æ ‘ä¸ºç©ºï¼Œåˆ™å¼€å§‹è€ƒè™‘å³å­æ ‘</span></span><br><span class="line">        <span class="comment">// å¦‚æœæ ˆå·²ç©ºï¼Œå°±ä¸éœ€è¦å†è€ƒè™‘</span></span><br><span class="line">        <span class="comment">// å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œå°†æ¸¸æ ‡ç­‰äºè¯¥èŠ‚ç‚¹çš„å³å­æ ‘</span></span><br><span class="line">        <span class="keyword">if</span> (!treeNodeStack.isEmpty()) &#123;</span><br><span class="line">            node = treeNodeStack.pop();</span><br><span class="line">            node = node.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é€’å½’å…ˆåºéå†ï¼š 1 2 4 6 7 8 3 5<br>éé€’å½’å…ˆåºéå†ï¼š1 2 4 6 7 8 3 5</p>
</blockquote>
<h4 id="é€’å½’ä¸­åºéå†"><a href="#é€’å½’ä¸­åºéå†" class="headerlink" title="é€’å½’ä¸­åºéå†"></a>é€’å½’ä¸­åºéå†</h4><p>è¿‡ç¨‹å’Œé€’å½’å…ˆåºéå†ç±»ä¼¼</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€’å½’ä¸­åºéå†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">recursionMiddleorderTraversal</span>(<span class="params">TreeNode root</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">        recursionMiddleorderTraversal(root.left);</span><br><span class="line">        System.<span class="keyword">out</span>.print(root.val + <span class="string">" "</span>);</span><br><span class="line">        recursionMiddleorderTraversal(root.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="éé€’å½’ä¸­åºéå†"><a href="#éé€’å½’ä¸­åºéå†" class="headerlink" title="éé€’å½’ä¸­åºéå†"></a>éé€’å½’ä¸­åºéå†</h4><p>å’Œéé€’å½’å…ˆåºéå†ç±»ä¼¼ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯è€ƒæŸ¥åˆ°å½“å‰èŠ‚ç‚¹æ—¶ï¼Œå¹¶ä¸ç›´æ¥è¾“å‡ºè¯¥èŠ‚ç‚¹ã€‚</p>
<p>è€Œæ˜¯å½“è€ƒæŸ¥èŠ‚ç‚¹ä¸ºç©ºæ—¶ï¼Œä»æ ˆä¸­å¼¹å‡ºçš„æ—¶å€™å†è¿›è¡Œè¾“å‡º(æ°¸è¿œå…ˆè€ƒè™‘å·¦å­æ ‘ï¼Œç›´åˆ°å·¦å­æ ‘ä¸ºç©ºæ‰è®¿é—®æ ¹èŠ‚ç‚¹)ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// éé€’å½’ä¸­åºéå†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">middleorderTraversal</span>(<span class="params">TreeNode root</span>)</span> &#123;</span><br><span class="line">    Stack&lt;TreeNode&gt; treeNodeStack = <span class="keyword">new</span> Stack&lt;TreeNode&gt;();</span><br><span class="line">    TreeNode node = root;</span><br><span class="line">    <span class="keyword">while</span> (node != <span class="literal">null</span> || !treeNodeStack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">while</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">            treeNodeStack.push(node);</span><br><span class="line">            node = node.left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!treeNodeStack.isEmpty()) &#123;</span><br><span class="line">            node = treeNodeStack.pop();</span><br><span class="line">            System.<span class="keyword">out</span>.print(node.val + <span class="string">" "</span>);</span><br><span class="line">            node = node.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é€’å½’ä¸­åºéå†ï¼š 4 7 6 8 2 1 3 5<br>éé€’å½’ä¸­åºéå†ï¼š4 7 6 8 2 1 3 5</p>
</blockquote>
<h4 id="é€’å½’ååºéå†"><a href="#é€’å½’ååºéå†" class="headerlink" title="é€’å½’ååºéå†"></a>é€’å½’ååºéå†</h4><p>è¿‡ç¨‹å’Œé€’å½’å…ˆåºéå†ç±»ä¼¼</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€’å½’ååºéå†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">recursionPostorderTraversal</span>(<span class="params">TreeNode root</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">        recursionPostorderTraversal(root.left);</span><br><span class="line">        recursionPostorderTraversal(root.right);</span><br><span class="line">        System.<span class="keyword">out</span>.print(root.val + <span class="string">" "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="éé€’å½’ååºéå†"><a href="#éé€’å½’ååºéå†" class="headerlink" title="éé€’å½’ååºéå†"></a>éé€’å½’ååºéå†</h4><p>åç»­éå†å’Œå…ˆåºã€ä¸­åºéå†ä¸å¤ªä¸€æ ·ã€‚</p>
<p>ååºéå†åœ¨å†³å®šæ˜¯å¦å¯ä»¥è¾“å‡ºå½“å‰èŠ‚ç‚¹çš„å€¼çš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘å…¶å·¦å³å­æ ‘æ˜¯å¦éƒ½å·²ç»éå†å®Œæˆã€‚</p>
<p>æ‰€ä»¥éœ€è¦è®¾ç½®ä¸€ä¸ª<strong>lastVisitæ¸¸æ ‡</strong>ã€‚</p>
<p>è‹¥lastVisitç­‰äºå½“å‰è€ƒæŸ¥èŠ‚ç‚¹çš„å³å­æ ‘ï¼Œè¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„å·¦å³å­æ ‘éƒ½å·²ç»éå†å®Œæˆï¼Œåˆ™å¯ä»¥è¾“å‡ºå½“å‰èŠ‚ç‚¹ã€‚</p>
<p>å¹¶æŠŠlastVisitèŠ‚ç‚¹è®¾ç½®æˆå½“å‰èŠ‚ç‚¹ï¼Œå°†å½“å‰æ¸¸æ ‡èŠ‚ç‚¹nodeè®¾ç½®ä¸ºç©ºï¼Œä¸‹ä¸€è½®å°±å¯ä»¥è®¿é—®æ ˆé¡¶å…ƒç´ ã€‚</p>
<p><strong>å¦è€…ï¼Œéœ€è¦æ¥ç€è€ƒè™‘å³å­æ ‘ï¼Œnode = node.rightã€‚</strong></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// éé€’å½’ååºéå†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">postorderTraversal</span>(<span class="params">TreeNode root</span>)</span> &#123;</span><br><span class="line">    Stack&lt;TreeNode&gt; treeNodeStack = <span class="keyword">new</span> Stack&lt;TreeNode&gt;();</span><br><span class="line">    TreeNode node = root;</span><br><span class="line">    TreeNode lastVisit = root;</span><br><span class="line">    <span class="keyword">while</span> (node != <span class="literal">null</span> || !treeNodeStack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">while</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">            treeNodeStack.push(node);</span><br><span class="line">            node = node.left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æŸ¥çœ‹å½“å‰æ ˆé¡¶å…ƒç´ </span></span><br><span class="line">        node = treeNodeStack.peek();</span><br><span class="line">        <span class="comment">//å¦‚æœå…¶å³å­æ ‘ä¹Ÿä¸ºç©ºï¼Œæˆ–è€…å³å­æ ‘å·²ç»è®¿é—®</span></span><br><span class="line">        <span class="comment">//åˆ™å¯ä»¥ç›´æ¥è¾“å‡ºå½“å‰èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (node.right == <span class="literal">null</span> || node.right == lastVisit) &#123;</span><br><span class="line">            System.<span class="keyword">out</span>.print(node.val + <span class="string">" "</span>);</span><br><span class="line">            treeNodeStack.pop();</span><br><span class="line">            lastVisit = node;</span><br><span class="line">            node = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//å¦åˆ™ï¼Œç»§ç»­éå†å³å­æ ‘</span></span><br><span class="line">            node = node.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é€’å½’ååºéå†ï¼š 7 8 6 4 2 5 3 1<br>éé€’å½’ååºéå†ï¼š7 8 6 4 2 5 3 1</p>
</blockquote>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo g ç”Ÿæˆç©ºç™½æ–‡ä»¶é—®é¢˜</title>
    <url>/2020/08/16/hexo-g-%E7%94%9F%E6%88%90%E7%A9%BA%E7%99%BD%E6%96%87%E4%BB%B6%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æœ€è¿‘æ¢äº†æ–°ç”µè„‘ï¼Œé‡æ–°æ•´ç¯å¢ƒçš„æ—¶å€™å›¾å¿«ï¼Œä¸‹è½½<code>node</code>çš„æ—¶å€™ä¸‹è½½çš„æ˜¯æœ€æ–°ç‰ˆï¼šnodeå½“å‰ç‰ˆ14.0.0ã€‚ç„¶åå®‰è£…<code>hexo</code>ï¼Œä»githubæ‹‰å–hexoåšå®¢é¡¹ç›®ï¼Œç„¶åè·‘<code>npm install</code>ï¼Œéƒ½æ²¡å•¥é—®é¢˜ã€‚ä½†æ˜¯åœ¨é¡¹ç›®ä¸‹é¢æ‰§è¡Œä»»ä½•<code>hexo</code>çš„å‘½ä»¤çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°ä¸€ä¸ªé”™è¯¯ï¼š</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">node</span><span class="title">:62227</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'lineno' of module exports inside circular dependency</span><br><span class="line">(Use `<span class="keyword">node</span> <span class="title">--trace-warnings</span> ...` to show where the warning was created)</span><br><span class="line">(<span class="keyword">node</span><span class="title">:62227</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'column' of module exports inside circular dependency</span><br><span class="line">(<span class="keyword">node</span><span class="title">:62227</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'filename' of module exports inside circular dependency</span><br><span class="line">(<span class="keyword">node</span><span class="title">:62227</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'lineno' of module exports inside circular dependency</span><br><span class="line">(<span class="keyword">node</span><span class="title">:62227</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'column' of module exports inside circular dependency</span><br><span class="line">(<span class="keyword">node</span><span class="title">:62227</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'filename' of module exports inside circular dependency</span><br><span class="line">(<span class="keyword">node</span><span class="title">:62227</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'lineno' of module exports inside circular dependency</span><br><span class="line">(<span class="keyword">node</span><span class="title">:62227</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'column' of module exports inside circular dependency</span><br><span class="line">(<span class="keyword">node</span><span class="title">:62227</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'filename' of module exports inside circular dependency</span><br><span class="line">(<span class="keyword">node</span><span class="title">:62227</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'lineno' of module exports inside circular dependency</span><br><span class="line">(<span class="keyword">node</span><span class="title">:62227</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'column' of module exports inside circular dependency</span><br><span class="line">(<span class="keyword">node</span><span class="title">:62227</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'filename' of module exports inside circular dependency</span><br></pre></td></tr></table></figure>
<p>ç»§ç»­è·‘<code>hexo s</code>ã€<code>hexo clean</code>ã€<code>hexo g</code>éƒ½æ˜¯å¯ä»¥çš„ï¼Œä¹Ÿæ²¡æŠ¥é”™ã€‚</p>
<p>å½“æˆ‘è·‘<code>hexo s</code>çš„æ—¶å€™æ˜¯å¯ä»¥æ­£å¸¸é¢„è§ˆçš„ã€‚</p>
<p>ä½†æ˜¯å½“æˆ‘è·‘<code>hexo g</code>çš„æ—¶å€™ï¼Œå‘½ä»¤å¯ä»¥è·‘è€Œä¸”æ²¡æŠ¥é”™ï¼Œä½†æ˜¯ç”Ÿæˆçš„æ–‡ä»¶æ˜¯<code>0kb</code>çš„ï¼Œ<code>/public/index.html</code>é‡Œé¢æ²¡æœ‰ä»»ä½•å†…å®¹ã€‚</p>
<p>æ‰¾äº†å¥½ä¹…åŸå› ï¼Œå‘ç°æ˜¯nodeç‰ˆæœ¬çš„é—®é¢˜ã€‚</p>
<p>ä¸‹<code>n</code>æ¥ç®¡ç†nodeçš„ç‰ˆæœ¬ã€‚</p>
<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line">$ sudo <span class="built_in">npm</span> i -g n</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°†nodeæ›¿æ¢ä¸ºç¨³å®šç‰ˆï¼š</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>sudo n stable</span><br></pre></td></tr></table></figure>
<p>ç„¶åæŸ¥çœ‹nodeçš„ç‰ˆæœ¬ï¼š</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">$ <span class="keyword">node</span> <span class="title">-v</span></span><br><span class="line">v12.<span class="number">18.3</span></span><br></pre></td></tr></table></figure>
<p>å…ˆæ¸…ç†ï¼Œç„¶åå†ç”Ÿæˆï¼š</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>hexo clean</span><br><span class="line"><span class="variable">$ </span>hexo g</span><br></pre></td></tr></table></figure>
<p>ç„¶åäº§çœ‹ç”Ÿæˆçš„<code>public</code>æ–‡ä»¶å¤¹ä¸­<code>index.html</code>çš„å¤§å°ï¼Œæ˜¯æœ‰å†…å®¹çš„ã€‚æ­£å¸¸ç”Ÿæˆäº† -ã€‚-</p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>è¸©å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>vuexé¡µé¢åˆ·æ–°æ•°æ®ä¸¢å¤±çš„è§£å†³åŠæ³•</title>
    <url>/2020/08/15/vuex%E9%A1%B5%E9%9D%A2%E5%88%B7%E6%96%B0%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>åœ¨vueé¡¹ç›®ä¸­ç”¨vuexæ¥åšå…¨å±€çš„çŠ¶æ€ç®¡ç†ï¼Œ å‘ç°å½“åˆ·æ–°ç½‘é¡µåï¼Œä¿å­˜åœ¨vuexå®ä¾‹storeé‡Œçš„æ•°æ®ä¼šä¸¢å¤±ã€‚</p>
<p><strong>åŸå› ï¼š</strong></p>
<p>å› ä¸ºstoreé‡Œçš„æ•°æ®æ˜¯ä¿å­˜åœ¨è¿è¡Œå†…å­˜ä¸­çš„,å½“é¡µé¢åˆ·æ–°æ—¶ï¼Œé¡µé¢ä¼šé‡æ–°åŠ è½½vueå®ä¾‹ï¼Œstoreé‡Œé¢çš„æ•°æ®å°±ä¼šè¢«é‡æ–°èµ‹å€¼åˆå§‹åŒ–</p>
<a id="more"></a>
<p><strong>è§£å†³æ€è·¯ï¼š</strong></p>
<p>å°†stateçš„æ•°æ®ä¿å­˜åœ¨localstorageã€sessionstorageæˆ–cookieä¸­ï¼Œè¿™æ ·å³å¯ä¿è¯é¡µé¢åˆ·æ–°æ•°æ®ä¸ä¸¢å¤±ä¸”æ˜“äºè¯»å–ã€‚</p>
<ol>
<li>localStorage: localStorageçš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ°¸ä¹…çš„ï¼Œå…³é—­é¡µé¢æˆ–æµè§ˆå™¨ä¹‹ålocalStorageä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šæ¶ˆå¤±ã€‚localStorageé™¤éä¸»åŠ¨åˆ é™¤æ•°æ®ï¼Œå¦åˆ™æ•°æ®æ°¸è¿œä¸ä¼šæ¶ˆå¤±ã€‚</li>
<li>sessionStorage:sessionStorageçš„ç”Ÿå‘½å‘¨æœŸæ˜¯åœ¨ä»…åœ¨å½“å‰ä¼šè¯ä¸‹æœ‰æ•ˆã€‚sessionStorageå¼•å…¥äº†ä¸€ä¸ªâ€œæµè§ˆå™¨çª—å£â€çš„æ¦‚å¿µï¼ŒsessionStorageæ˜¯åœ¨åŒæºçš„çª—å£ä¸­å§‹ç»ˆå­˜åœ¨çš„æ•°æ®ã€‚åªè¦è¿™ä¸ªæµè§ˆå™¨çª—å£æ²¡æœ‰å…³é—­ï¼Œå³ä½¿åˆ·æ–°é¡µé¢æˆ–è€…è¿›å…¥åŒæºå¦ä¸€ä¸ªé¡µé¢ï¼Œæ•°æ®ä¾ç„¶å­˜åœ¨ã€‚ä½†æ˜¯sessionStorageåœ¨å…³é—­äº†æµè§ˆå™¨çª—å£åå°±ä¼šè¢«é”€æ¯ã€‚åŒæ—¶ç‹¬ç«‹çš„æ‰“å¼€åŒä¸€ä¸ªçª—å£åŒä¸€ä¸ªé¡µé¢ï¼ŒsessionStorageä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚</li>
<li>cookie:cookieç”Ÿå‘½æœŸä¸ºåªåœ¨è®¾ç½®çš„cookieè¿‡æœŸæ—¶é—´ä¹‹å‰ä¸€ç›´æœ‰æ•ˆï¼Œå³ä½¿çª—å£æˆ–æµè§ˆå™¨å…³é—­ã€‚ å­˜æ”¾æ•°æ®å¤§å°ä¸º4Kå·¦å³,æœ‰ä¸ªæ•°é™åˆ¶ï¼ˆå„æµè§ˆå™¨ä¸åŒï¼‰ï¼Œä¸€èˆ¬ä¸èƒ½è¶…è¿‡20ä¸ªã€‚ç¼ºç‚¹æ˜¯ä¸èƒ½å‚¨å­˜å¤§æ•°æ®ä¸”ä¸æ˜“è¯»å–ã€‚</li>
</ol>
<p>ç”±äºvueæ˜¯å•é¡µé¢åº”ç”¨ï¼Œæ“ä½œéƒ½æ˜¯åœ¨ä¸€ä¸ªé¡µé¢è·³è½¬è·¯ç”±ï¼Œå› æ­¤sessionStorageè¾ƒä¸ºåˆé€‚,åŸå› å¦‚ä¸‹ï¼š</p>
<ol>
<li>sessionStorageå¯ä»¥ä¿è¯æ‰“å¼€é¡µé¢æ—¶sessionStorageçš„æ•°æ®ä¸ºç©ºï¼›</li>
<li>æ¯æ¬¡æ‰“å¼€é¡µé¢localStorageå­˜å‚¨ç€ä¸Šä¸€æ¬¡æ‰“å¼€é¡µé¢çš„æ•°æ®ï¼Œå› æ­¤éœ€è¦æ¸…ç©ºä¹‹å‰çš„æ•°æ®ã€‚</li>
</ol>
<p>vuexä¸­stateæ•°æ®çš„ä¿®æ”¹å¿…é¡»é€šè¿‡mutationæ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼Œå› æ­¤mutationä¿®æ”¹stateçš„åŒæ—¶éœ€è¦ä¿®æ”¹sessionstorage,é—®é¢˜å€’æ˜¯å¯ä»¥è§£å†³ä½†æ˜¯æ„Ÿè§‰å¾ˆéº»çƒ¦ï¼Œstateä¸­æœ‰å¾ˆå¤šæ•°æ®ï¼Œå¾ˆå¤šmutationä¿®æ”¹stateå°±è¦å¾ˆå¤šæ¬¡sessionstorageè¿›è¡Œä¿®æ”¹ï¼Œæ—¢ç„¶å¦‚æ­¤ç›´æ¥ç”¨sessionstorageè§£å†³ä¸å°±è¡Œäº†ï¼Œä¸ºä½•è¿˜è¦ç”¨vuexå¤šæ­¤ä¸€ä¸¾å‘¢ï¼Ÿ vuexçš„æ•°æ®åœ¨æ¯æ¬¡é¡µé¢åˆ·æ–°æ—¶ä¸¢å¤±ï¼Œæ˜¯å¦å¯ä»¥åœ¨é¡µé¢åˆ·æ–°å‰å†å°†æ•°æ®å­˜å‚¨åˆ°sessionstorageä¸­å‘¢ï¼Œæ˜¯å¯ä»¥çš„ï¼Œ<a href="https://www.w3cschool.cn/fetch_api/fetch_api-9vhu2oq0.html" target="_blank" rel="noopener">beforeunload</a>äº‹ä»¶å¯ä»¥åœ¨é¡µé¢åˆ·æ–°å‰è§¦å‘ï¼Œä½†æ˜¯åœ¨æ¯ä¸ªé¡µé¢ä¸­ç›‘å¬beforeunloadäº‹ä»¶æ„Ÿè§‰ä¹Ÿä¸å¤ªåˆé€‚ï¼Œé‚£ä¹ˆæœ€å¥½çš„ç›‘å¬è¯¥äº‹ä»¶çš„åœ°æ–¹å°±åœ¨app.vueä¸­ã€‚</p>
<ol>
<li>åœ¨app.vueçš„createdæ–¹æ³•ä¸­è¯»å–sessionstorageä¸­çš„æ•°æ®å­˜å‚¨åœ¨storeä¸­ï¼Œæ­¤æ—¶ç”¨vuex.storeçš„<a href="https://vuex.vuejs.org/zh/api/#replacestate" target="_blank" rel="noopener">replaceState</a>æ–¹æ³•ï¼Œæ›¿æ¢storeçš„æ ¹çŠ¶æ€</li>
<li>åœ¨beforeunloadæ–¹æ³•ä¸­å°†store.stateå­˜å‚¨åˆ°sessionstorageä¸­ã€‚</li>
</ol>
<p><strong>ä»£ç å¦‚ä¸‹ï¼š</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">'App'</span>,</span><br><span class="line">  created () &#123;</span><br><span class="line">    <span class="comment">//åœ¨é¡µé¢åŠ è½½æ—¶è¯»å–sessionStorageé‡Œçš„çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span> (sessionStorage.getItem(<span class="string">"store"</span>) ) &#123;</span><br><span class="line">        <span class="keyword">this</span>.$store.replaceState(<span class="built_in">Object</span>.assign(&#123;&#125;, <span class="keyword">this</span>.$store.state,<span class="built_in">JSON</span>.parse(sessionStorage.getItem(<span class="string">"store"</span>))))</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">//åœ¨é¡µé¢åˆ·æ–°æ—¶å°†vuexé‡Œçš„ä¿¡æ¯ä¿å­˜åˆ°sessionStorageé‡Œ</span></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">"beforeunload"</span>,()=&gt;&#123;</span><br><span class="line">        sessionStorage.setItem(<span class="string">"store"</span>,<span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.$store.state))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>vuexé˜²æŠ–èŠ‚æµ</title>
    <url>/2020/08/15/vuex%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>åœ¨ä¸€ä¸ªç”µå½±é¡¹ç›®ä¸­ï¼Œæˆ‘æƒ³åœ¨ç”µå½±çš„åˆ—è¡¨ä¸­ï¼Œä¿å­˜ä¸‹æ‹‰çš„å½“å‰ä½ç½®ï¼Œé˜²æ­¢ä½ åˆ‡æ¢é¡µé¢åï¼Œå†åˆ‡æ¢å›å½“å‰çš„ç”µå½±åˆ—è¡¨é¡µï¼Œä»–å°±åˆå›åˆ°ç”µå½±çš„ç¬¬ä¸€æ¡æ•°æ®ã€‚<br>è¿™æ—¶å€™ï¼Œæˆ‘ä¸æƒ³æ¯æ¬¡åªè¦æ»‘åŠ¨ä¸€ç‚¹ï¼Œå°±ä¿å­˜å½“å‰ä½ç½®ï¼Œæˆ‘æƒ³éš”ä¸€æ®µæ—¶é—´ï¼Œä¿å­˜ä¸€æ¬¡ï¼Œè¿™æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨é˜²æŠ–å’ŒèŠ‚æµã€‚</p>
<a id="more"></a>
<p>è¯´ç™½äº†ï¼Œ<strong>é˜²æŠ–èŠ‚æµå°±æ˜¯ä½¿ç”¨å®šæ—¶å™¨</strong>æ¥å®ç°æˆ‘ä»¬çš„ç›®çš„ã€‚</p>
<p><strong>é˜²æŠ–(debounce)ï¼š</strong></p>
<p>åœ¨äº‹ä»¶è¢«è§¦å‘nç§’åå†æ‰§è¡Œå›è°ƒï¼Œå¦‚æœåœ¨è¿™nç§’å†…åˆè¢«è§¦å‘ï¼Œåˆ™é‡æ–°è®¡æ—¶ã€‚</p>
<blockquote>
<p>å…¸å‹çš„æ¡ˆä¾‹å°±æ˜¯è¾“å…¥æ¡†æœç´¢ï¼šè¾“å…¥ç»“æŸånç§’æ‰è¿›è¡Œæœç´¢è¯·æ±‚ï¼Œnç§’å†…åˆè¾“å…¥çš„å†…å®¹ï¼Œåˆ™é‡æ–°è®¡æ—¶ã€‚</p>
</blockquote>
<p><strong>èŠ‚æµ(throttle)ï¼š</strong></p>
<p>è§„å®šåœ¨ä¸€ä¸ªå•ä½æ—¶é—´å†…ï¼Œåªèƒ½è§¦å‘ä¸€æ¬¡å‡½æ•°ï¼Œå¦‚æœè¿™ä¸ªå•ä½æ—¶é—´å†…è§¦å‘å¤šæ¬¡å‡½æ•°ï¼Œåªæœ‰ä¸€æ¬¡ç”Ÿæ•ˆã€‚</p>
<blockquote>
<p>å…¸å‹çš„æ¡ˆä¾‹å°±æ˜¯é¼ æ ‡ä¸æ–­ç‚¹å‡»è§¦å‘ï¼Œè§„å®šåœ¨nç§’å†…å¤šæ¬¡ç‚¹å‡»åªç”Ÿæ•ˆä¸€æ¬¡ã€‚</p>
</blockquote>
<h2 id="é˜²æŠ–-debounce"><a href="#é˜²æŠ–-debounce" class="headerlink" title="é˜²æŠ–(debounce)"></a>é˜²æŠ–(debounce)</h2><p><strong>ä¸‹æ‹‰åˆ—è¡¨ï¼Œéš”ä¸€æ®µæ—¶é—´ä¿å­˜å½“å‰ä¸‹æ‹‰ä½ç½®ã€‚</strong></p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨<code>mounted</code>é’©å­ä¸­å®ç°æˆ‘ä»¬çš„é˜²æŠ–ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é˜²æŠ–  å®šæ—¶å™¨</span></span><br><span class="line"><span class="keyword">let</span> timer;</span><br><span class="line"></span><br><span class="line"><span class="comment">//listå°±æ˜¯ç”µå½±åˆ—è¡¨	ref="list"	$elè·å–DOMå…ƒç´ </span></span><br><span class="line"><span class="keyword">this</span>.$refs.list.$el.addEventListener(<span class="string">"scroll"</span>, e =&gt; &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"----&gt;"</span>,e.target.scrollTop)	<span class="comment">//ä¸ä½¿ç”¨é˜²æŠ–</span></span><br><span class="line">	<span class="keyword">if</span> (timer) &#123;</span><br><span class="line">		<span class="comment">//æ¸…ç©ºtimer</span></span><br><span class="line">		clearTimeout(timer);</span><br><span class="line">	&#125;</span><br><span class="line">	timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(e.target.scrollTop)	<span class="comment">//ä½¿ç”¨é˜²æŠ–</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//åœ¨sessionStorageä¸­ä¿å­˜å½“å‰ä¸‹æ‹‰ä½ç½®</span></span><br><span class="line">		<span class="comment">// sessionStorage.setItem("position", e.target.scrollTop);</span></span><br><span class="line">	&#125;, <span class="number">75</span>);		<span class="comment">//75msä¸ºæœ€ä½³</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>è¾“å…¥æ¡†æœç´¢éš”æ®µæ—¶é—´è¿›è¡Œæœç´¢è¯·æ±‚ï¼š</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> @<span class="attr">keyup</span>=<span class="string">"debounce"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="comment">//å®šä¹‰ timer</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> timer;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="actionscript">    debounce: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line">      if (timer) &#123;</span><br><span class="line">        clearTimeout(timer);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">"é˜²æŠ–..."</span>);</span></span><br><span class="line"><span class="actionscript">        timer = <span class="literal">undefined</span>;</span></span><br><span class="line">      &#125;, 2000);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="èŠ‚æµ-throttle"><a href="#èŠ‚æµ-throttle" class="headerlink" title="èŠ‚æµ(throttle)"></a>èŠ‚æµ(throttle)</h2><p><strong>åœ¨nç§’å†…ç‚¹å‡»å¤šæ¬¡ï¼Œåªæœ‰ä¸€æ¬¡ç”Ÿæ•ˆã€‚</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;button @click=<span class="string">"throttle"</span>&gt;æŒ‰é’®&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/å®šä¹‰</span></span><br><span class="line"><span class="regexp">let timer, lastTime;</span></span><br><span class="line"><span class="regexp">let now = +new Date();</span></span><br><span class="line"><span class="regexp">export default &#123;</span></span><br><span class="line"><span class="regexp">  methods: &#123;</span></span><br><span class="line"><span class="regexp">    throttle: () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      if (lastTime &amp;&amp; now - lastTime &lt; 200) &#123;</span></span><br><span class="line"><span class="regexp">        clearTimeout(timer);</span></span><br><span class="line"><span class="regexp">        console.log("....");</span></span><br><span class="line"><span class="regexp">        timer = setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          console.log("ç‚¹å‡»...");</span></span><br><span class="line"><span class="regexp">          lastTime = +new Date();</span></span><br><span class="line"><span class="regexp">        &#125;, 2000);</span></span><br><span class="line"><span class="regexp">      &#125; else &#123;</span></span><br><span class="line"><span class="regexp">        lastTime = now;</span></span><br><span class="line"><span class="regexp">        timer = setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          console.log("ç‚¹å‡»...");</span></span><br><span class="line"><span class="regexp">          lastTime = +new Date();</span></span><br><span class="line"><span class="regexp">        &#125;, 200);</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>
<h1 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h1><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å¯¹è¿™ä¸¤ä¸ªæ–¹æ³•è¿›è¡Œå°è£…ï¼Œä»¥ä¾¿åœ¨å¤šå¤„ä½¿ç”¨ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‡½æ•°é˜²æŠ– (åªæ‰§è¡Œæœ€åä¸€æ¬¡ç‚¹å‡»)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Debounce = <span class="function">(<span class="params">fn, t</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> delay = t || <span class="number">500</span>;</span><br><span class="line">    <span class="keyword">let</span> timer;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="keyword">if</span>(timer)&#123;</span><br><span class="line">            clearTimeout(timer);</span><br><span class="line">        &#125;</span><br><span class="line">        timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            timer = <span class="literal">null</span>;</span><br><span class="line">            fn.apply(<span class="keyword">this</span>, args);</span><br><span class="line">        &#125;, delay);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°èŠ‚æµ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Throttle = <span class="function">(<span class="params">fn, t</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> last;</span><br><span class="line">    <span class="keyword">let</span> timer;</span><br><span class="line">    <span class="keyword">let</span> interval = t || <span class="number">500</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="keyword">let</span> now = +<span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="keyword">if</span> (last &amp;&amp; now - last &lt; interval) &#123;</span><br><span class="line">            clearTimeout(timer);</span><br><span class="line">            timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                last = now;</span><br><span class="line">                fn.apply(<span class="keyword">this</span>, args);</span><br><span class="line">            &#125;, interval);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            last = now;</span><br><span class="line">            fn.apply(<span class="keyword">this</span>, args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>æ—¥è¯­å­¦ä¹ ç¬”è®°</title>
    <url>/2020/03/02/%E6%97%A5%E8%AF%AD%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>â€‹                åŠ¨è¯            å½¢å®¹è¯1            å½¢å®¹è¯2                åè¯</p>
<p>ä¸€èˆ¬ç°åœ¨æ—¶        ã¾ã™            ã„                ã§ã™                ã§ã™</p>
<p>è¿‡å»æ—¶            ã¾ã—ãŸ            ã‹ã£ãŸ            ã§ã—ãŸ                ã§ã—ãŸ</p>
<p>å¦å®š            ã¾ã›ã‚“            ããªã„ã§ã™        ãã‚ã‚Šã¾ã›ã‚“            ã§ã¯ã€€ã‚ã‚Šã¾ã›ã‚“</p>
<p>è¿‡å»å¦å®š            ã¾ã›ã‚“ã§ã—ãŸ        ããªã‹ã£ãŸã§ã™    ãã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ    ã§ã¯ã€€ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>
<a id="more"></a>
<p>ã¾ã™ã€€æ˜¯åŸºæœ¬ï¼Œè¿‡å»å°±å˜ã¾ã—ãŸã€€å¦å®šå°±å˜ã¾ã›ã‚“ã€€è¿‡å»å¦å®šå°±åˆèµ·æ¥ã¾ã›ã‚“ã§ã—ãŸ</p>
<p>ã„ã€€æ˜¯åŸºæœ¬ï¼Œè¿‡å»å°±æŠŠã„å˜æˆã‹ã£ãŸã§ã™ã€€ã€€å¦å®šå°±å˜ãªã„ã§ã™ã€€è¿‡å»å¦å®šå°±åˆèµ·æ¥ï¼Œãªã‹ã£ãŸã§ã™</p>
<p>ã§ã™æ˜¯åŸºæœ¬ï¼Œè¿‡å»å°±æŠŠã§ã™å˜ã§ã—ãŸã€ å¦å®šå°±å˜ã§ã¯ã€€ã‚ã‚Šã¾ã›ã‚“ã€€è¿‡å»å¦å®šå°±åˆèµ·æ¥ã§ã¯ã€€ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>
<p>ç°åœ¨        ãŸå‹        ãªã„å‹        ãªã‹ã£ãŸå‹</p>
<p>å­—å…¸å‹        ã„ã</p>
<p>è¿‡å»        ã„ã£ãŸ</p>
<p>å¦å®š        ã„ã‹ãªã„</p>
<p>è¿‡å»å¦å®š        ã„ã‹ãªã‹ã£ãŸ</p>
<p>å½¢å®¹è¯å’Œåè¯çš„ç®€ä½“å˜å‹ï¼Œæœ‰ã§ã™çš„å»æ‰ã§ã™ï¼Œã‚ã‚Šã¾ã›ã‚“å˜æˆãªã„ ã¾ã—ãŸå˜ãŸå‹</p>
]]></content>
      <categories>
        <category>æ‚ä¸ƒæ‚å…«</category>
      </categories>
      <tags>
        <tag>è¯­è¨€</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾®æœåŠ¡é€šè®¯</title>
    <url>/2020/01/13/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%80%9A%E8%AE%AF/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h4 id="ä»€ä¹ˆæ˜¯å¾®æœåŠ¡"><a href="#ä»€ä¹ˆæ˜¯å¾®æœåŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯å¾®æœåŠ¡"></a><strong>ä»€ä¹ˆæ˜¯å¾®æœåŠ¡</strong></h4><ul>
<li>å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿ, æŒ‰ç…§ä¸šåŠ¡è¿›è¡Œåˆ’åˆ†æˆä¸ºä¸åŒçš„æœåŠ¡å•å…ƒ, è§£å†³å•ä½“ç³»ç»Ÿæ€§èƒ½ç­‰ä¸è¶³ã€‚</li>
<li>å¾®æœåŠ¡æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œä¸€ä¸ªå¤§å‹è½¯ä»¶åº”ç”¨ç”±å¤šä¸ªæœåŠ¡å•å…ƒç»„æˆã€‚ç³»ç»Ÿä¸­çš„æœåŠ¡å•å…ƒå¯ä»¥å•ç‹¬éƒ¨ç½²ï¼Œå„ä¸ªæœåŠ¡å•å…ƒä¹‹é—´æ˜¯æ¾è€¦åˆçš„ã€‚</li>
</ul>
<a id="more"></a>
<h4 id="REST-HTTP-åè®®"><a href="#REST-HTTP-åè®®" class="headerlink" title="REST HTTP åè®®"></a><strong>REST HTTP åè®®</strong></h4><p>REST è¯·æ±‚åœ¨å¾®æœåŠ¡ä¸­æ˜¯æœ€ä¸ºå¸¸ç”¨çš„ä¸€ç§é€šè®¯æ–¹å¼, å®ƒä¾èµ–äº HTTP\HTTPS åè®®ã€‚RESTFUL çš„ç‰¹ç‚¹æ˜¯ï¼š</p>
<ol>
<li>æ¯ä¸€ä¸ª URI ä»£è¡¨ 1 ç§èµ„æº</li>
<li>å®¢æˆ·ç«¯ä½¿ç”¨ GETã€POSTã€PUTã€DELETE 4 ä¸ªè¡¨ç¤ºæ“ä½œæ–¹å¼çš„åŠ¨è¯å¯¹æœåŠ¡ç«¯èµ„æºè¿›è¡Œæ“ä½œ: GET ç”¨æ¥è·å–èµ„æº, POST ç”¨æ¥æ–°å»ºèµ„æº(ä¹Ÿå¯ä»¥ç”¨äºæ›´æ–°èµ„æº), PUT ç”¨æ¥æ›´æ–°èµ„æº, DELETE ç”¨æ¥åˆ é™¤èµ„æº</li>
<li>é€šè¿‡æ“ä½œèµ„æºçš„è¡¨ç°å½¢å¼æ¥æ“ä½œèµ„æº</li>
<li>èµ„æºçš„è¡¨ç°å½¢å¼æ˜¯ XML æˆ–è€… HTML</li>
<li>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„äº¤äº’åœ¨è¯·æ±‚ä¹‹é—´æ˜¯æ— çŠ¶æ€çš„,ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„æ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»åŒ…å«ç†è§£è¯·æ±‚æ‰€å¿…éœ€çš„ä¿¡æ¯</li>
</ol>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸€ä¸ªæœåŠ¡æ–¹æä¾›äº†å¦‚ä¸‹æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/communication"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestControllerDemo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">s</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ä¸€ä¸ªæœåŠ¡éœ€è¦å»è°ƒç”¨è¯¥æ¥å£ï¼Œè°ƒç”¨æ–¹åªéœ€è¦æ ¹æ® API æ–‡æ¡£å‘é€è¯·æ±‚å³å¯è·å–è¿”å›ç»“æœã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/demo"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestDemo</span></span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/hello2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">s2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String forObject = restTemplate.getForObject(<span class="string">"http://localhost:8080/communication/hello"</span>, String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">return</span> forObject;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™æ ·çš„æ–¹å¼å¯ä»¥å®ç°æœåŠ¡ä¹‹é—´çš„é€šè®¯ã€‚</p>
<h4 id="RPC-TCPåè®®"><a href="#RPC-TCPåè®®" class="headerlink" title="RPC TCPåè®®"></a>RPC TCPåè®®</h4><p>RPC(Remote Procedure Call)è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œç®€å•çš„ç†è§£æ˜¯ä¸€ä¸ªèŠ‚ç‚¹è¯·æ±‚å¦ä¸€ä¸ªèŠ‚ç‚¹æä¾›çš„æœåŠ¡ã€‚å®ƒçš„å·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li>æ‰§è¡Œå®¢æˆ·ç«¯è°ƒç”¨è¯­å¥ï¼Œä¼ é€å‚æ•°</li>
<li>è°ƒç”¨æœ¬åœ°ç³»ç»Ÿå‘é€ç½‘ç»œæ¶ˆæ¯</li>
<li>æ¶ˆæ¯ä¼ é€åˆ°è¿œç¨‹ä¸»æœº</li>
<li>æœåŠ¡å™¨å¾—åˆ°æ¶ˆæ¯å¹¶å–å¾—å‚æ•°</li>
<li>æ ¹æ®è°ƒç”¨è¯·æ±‚ä»¥åŠå‚æ•°æ‰§è¡Œè¿œç¨‹è¿‡ç¨‹ï¼ˆæœåŠ¡ï¼‰</li>
<li>æ‰§è¡Œè¿‡ç¨‹å®Œæ¯•ï¼Œå°†ç»“æœè¿”å›æœåŠ¡å™¨å¥æŸ„</li>
<li>æœåŠ¡å™¨å¥æŸ„è¿”å›ç»“æœï¼Œè°ƒç”¨è¿œç¨‹ä¸»æœºçš„ç³»ç»Ÿç½‘ç»œæœåŠ¡å‘é€ç»“æœ</li>
<li>æ¶ˆæ¯ä¼ å›æœ¬åœ°ä¸»æœº</li>
<li>å®¢æˆ·ç«¯å¥æŸ„ç”±æœ¬åœ°ä¸»æœºçš„ç½‘ç»œæœåŠ¡æ¥æ”¶æ¶ˆæ¯</li>
<li>å®¢æˆ·ç«¯æ¥æ”¶åˆ°è°ƒç”¨è¯­å¥è¿”å›çš„ç»“æœæ•°æ®</li>
</ol>
<p>ä¸¾ä¸ªä¾‹å­ã€‚</p>
<p>é¦–å…ˆéœ€è¦ä¸€ä¸ªæœåŠ¡ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RPC æœåŠ¡ç«¯ç”¨æ¥æ³¨å†Œè¿œç¨‹æ–¹æ³•çš„æ¥å£å’Œå®ç°ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RPCServer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ExecutorService executor = Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, Class&gt; serviceRegister = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨å†Œæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> service</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> impl</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Class service, Class impl)</span> </span>&#123;</span><br><span class="line">        serviceRegister.put(service.getSimpleName(), impl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯åŠ¨æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> port</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(<span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        ServerSocket socket = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            socket = <span class="keyword">new</span> ServerSocket();</span><br><span class="line">            socket.bind(<span class="keyword">new</span> InetSocketAddress(port));</span><br><span class="line">            System.out.println(<span class="string">"æœåŠ¡å¯åŠ¨"</span>);</span><br><span class="line">            System.out.println(serviceRegister);</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                executor.execute(<span class="keyword">new</span> Task(socket.accept()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (socket != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    socket.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        Socket client = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Task</span><span class="params">(Socket client)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.client = client;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            ObjectInputStream input = <span class="keyword">null</span>;</span><br><span class="line">            ObjectOutputStream output = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                input = <span class="keyword">new</span> ObjectInputStream(client.getInputStream());</span><br><span class="line">                <span class="comment">// æŒ‰ç…§é¡ºåºè¯»å–å¯¹æ–¹å†™è¿‡æ¥çš„å†…å®¹</span></span><br><span class="line">                String serviceName = input.readUTF();</span><br><span class="line">                String methodName = input.readUTF();</span><br><span class="line">                Class&lt;?&gt;[] parameterTypes = (Class&lt;?&gt;[]) input.readObject();</span><br><span class="line">                Object[] arguments = (Object[]) input.readObject();</span><br><span class="line">                Class serviceClass = serviceRegister.get(serviceName);</span><br><span class="line">                <span class="keyword">if</span> (serviceClass == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(serviceName + <span class="string">" æ²¡æœ‰æ‰¾åˆ°!"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                Method method = serviceClass.getMethod(methodName, parameterTypes);</span><br><span class="line">                Object result = method.invoke(serviceClass.newInstance(), arguments);</span><br><span class="line"></span><br><span class="line">                output = <span class="keyword">new</span> ObjectOutputStream(client.getOutputStream());</span><br><span class="line">                output.writeObject(result);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// è¿™é‡Œå°±ä¸å†™ output!=nullæ‰å…³é—­è¿™ä¸ªé€»è¾‘äº†</span></span><br><span class="line">                    output.close();</span><br><span class="line">                    input.close();</span><br><span class="line">                    client.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶æ¬¡éœ€è¦ä¸€ä¸ªå®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RPC å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RPCclient</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡åŠ¨æ€ä»£ç†å°†å‚æ•°å‘é€è¿‡å»åˆ° RPCServer ,RPCserver è¿”å›ç»“æœè¿™ä¸ªæ–¹æ³•å¤„ç†æˆä¸ºæ­£ç¡®çš„å®ä½“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getRemoteProxyObj</span><span class="params">(<span class="keyword">final</span> Class&lt;T&gt; service, <span class="keyword">final</span> InetSocketAddress addr)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(service.getClassLoader(), <span class="keyword">new</span> Class&lt;?&gt;[]&#123;service&#125;, <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">                Socket socket = <span class="keyword">null</span>;</span><br><span class="line">                ObjectOutputStream out = <span class="keyword">null</span>;</span><br><span class="line">                ObjectInputStream input = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    socket = <span class="keyword">new</span> Socket();</span><br><span class="line">                    socket.connect(addr);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// å°†å®ä½“ç±»,å‚æ•°,å‘é€ç»™è¿œç¨‹è°ƒç”¨æ–¹</span></span><br><span class="line">                    out = <span class="keyword">new</span> ObjectOutputStream(socket.getOutputStream());</span><br><span class="line">                    out.writeUTF(service.getSimpleName());</span><br><span class="line">                    out.writeUTF(method.getName());</span><br><span class="line">                    out.writeObject(method.getParameterTypes());</span><br><span class="line">                    out.writeObject(args);</span><br><span class="line"></span><br><span class="line">                    input = <span class="keyword">new</span> ObjectInputStream(socket.getInputStream());</span><br><span class="line">                    <span class="keyword">return</span> input.readObject();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    out.close();</span><br><span class="line">                    input.close();</span><br><span class="line">                    socket.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†æ¥ä¸€ä¸ªæµ‹è¯•çš„è¿œç¨‹æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Tinterface</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">send</span><span class="params">(String msg)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TinterfaceImpl</span> <span class="keyword">implements</span> <span class="title">Tinterface</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">send</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"send message "</span> + msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.huifer.admin.rpc.Tinterface;</span><br><span class="line"><span class="keyword">import</span> com.huifer.admin.rpc.TinterfaceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                RPCServer rpcServer = <span class="keyword">new</span> RPCServer();</span><br><span class="line">                rpcServer.register(Tinterface<span class="class">.<span class="keyword">class</span>, <span class="title">TinterfaceImpl</span>.<span class="title">class</span>)</span>;</span><br><span class="line">                rpcServer.start(<span class="number">9090</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        Tinterface tinterface = RPCclient.getRemoteProxyObj(Tinterface.class, new InetSocketAddress("localhost", 9090));</span><br><span class="line">        System.out.println(tinterface.send(<span class="string">"rpc æµ‹è¯•ç”¨ä¾‹"</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º send message rpc æµ‹è¯•ç”¨ä¾‹ã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>@Asyncå¼‚æ­¥è°ƒç”¨å®è·µ</title>
    <url>/2020/01/02/Async%E5%BC%82%E6%AD%A5%E8%B0%83%E7%94%A8%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>å¼‚æ­¥è°ƒç”¨å¯¹åº”çš„æ˜¯åŒæ­¥è°ƒç”¨ï¼ŒåŒæ­¥è°ƒç”¨å¯ä»¥ç†è§£ä¸ºæŒ‰ç…§å®šä¹‰çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œæœ‰åºæ€§ï¼›å¼‚æ­¥è°ƒç”¨åœ¨æ‰§è¡Œçš„æ—¶å€™ä¸éœ€è¦ç­‰å¾…ä¸Šä¸€ä¸ªæŒ‡ä»¤è°ƒç”¨ç»“æŸå°±å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</p>
<p>æˆ‘ä»¬å°†åœ¨åˆ›å»ºä¸€ä¸ª Spring Boot å·¥ç¨‹æ¥è¯´æ˜ã€‚å…·ä½“å·¥ç¨‹å¯ä»¥å‚è€ƒgithubä»£ç  <a href="https://github.com/JustDoItLee/demo/tree/master/demo/async" target="_blank" rel="noopener">github</a></p>
<a id="more"></a>
<p>pom ä¾èµ–å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.demo.async<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- logback --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-access<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨ç±»å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(AsyncApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®šä¹‰çº¿ç¨‹æ± </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.async.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@classname</span>: AsyncExecutorConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Ricardo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2020-01-02 15:22</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¼‚æ­¥çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncExecutorConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set the ThreadPoolExecutor's core pool size.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> corePoolSize = <span class="number">8</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set the ThreadPoolExecutor's maximum pool size.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxPoolSize = <span class="number">16</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set the capacity for the ThreadPoolExecutor's BlockingQueue.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> queueCapacity = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String threadNamePrefix = <span class="string">"AsyncExecutor-"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"taskExecutor"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Executor <span class="title">taskExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ThreadPoolTaskExecutor executor = <span class="keyword">new</span> ThreadPoolTaskExecutor();</span><br><span class="line">        executor.setCorePoolSize(corePoolSize);</span><br><span class="line">        executor.setMaxPoolSize(maxPoolSize);</span><br><span class="line">        executor.setQueueCapacity(queueCapacity);</span><br><span class="line">        executor.setKeepAliveSeconds(<span class="number">60</span>);</span><br><span class="line">        executor.setThreadNamePrefix(threadNamePrefix);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// rejection-policyï¼šå½“poolå·²ç»è¾¾åˆ°max sizeçš„æ—¶å€™ï¼Œå¦‚ä½•å¤„ç†æ–°ä»»åŠ¡</span></span><br><span class="line">        <span class="comment">// CALLER_RUNSï¼šä¸åœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ˜¯æœ‰è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œ</span></span><br><span class="line">        executor.setRejectedExecutionHandler(<span class="keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy());</span><br><span class="line">        executor.initialize();</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç ä¸­æˆ‘ä»¬é€šè¿‡ ThreadPoolTaskExecutor åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹æ± ã€‚å‚æ•°å«ä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>corePoolSizeï¼šçº¿ç¨‹æ± åˆ›å»ºçš„æ ¸å¿ƒçº¿ç¨‹æ•°</li>
<li>maxPoolSizeï¼šçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ± æ•°é‡ï¼Œå½“ä»»åŠ¡æ•°è¶…è¿‡corePoolSizeä»¥åŠç¼“å†²é˜Ÿåˆ—ä¹Ÿæ»¡äº†ä»¥åæ‰ä¼šç”³è¯·çš„çº¿ç¨‹æ•°é‡ã€‚</li>
<li>setKeepAliveSecondsï¼š å…è®¸çº¿ç¨‹ç©ºé—²æ—¶é—´60ç§’ï¼Œå½“maxPoolSizeçš„çº¿ç¨‹åœ¨ç©ºé—²æ—¶é—´åˆ°è¾¾çš„æ—¶å€™é”€æ¯ã€‚</li>
<li>ThreadNamePrefixï¼šçº¿ç¨‹çš„å‰ç¼€ä»»åŠ¡åå­—ã€‚</li>
<li>RejectedExecutionHandlerï¼šå½“çº¿ç¨‹æ± æ²¡æœ‰å¤„ç†èƒ½åŠ›çš„æ—¶å€™ï¼Œè¯¥ç­–ç•¥ä¼šç›´æ¥åœ¨ execute æ–¹æ³•çš„è°ƒç”¨çº¿ç¨‹ä¸­è¿è¡Œè¢«æ‹’ç»çš„ä»»åŠ¡ï¼›å¦‚æœæ‰§è¡Œç¨‹åºå·²å…³é—­ï¼Œåˆ™ä¼šä¸¢å¼ƒè¯¥ä»»åŠ¡</li>
</ul>
<p> ä½¿ç”¨å®æˆ˜</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.async.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.demo.async.task.AsyncTask;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@classname</span>: OrderService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Ricardo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2020-01-02 15:24</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AsyncTask asyncTask;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doShop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            createOrder();</span><br><span class="line">            <span class="comment">// è°ƒç”¨æœ‰ç»“æœè¿”å›çš„å¼‚æ­¥ä»»åŠ¡</span></span><br><span class="line">            Future&lt;String&gt; pay = asyncTask.pay();</span><br><span class="line">            <span class="keyword">if</span> (pay.isDone()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    String result = pay.get();</span><br><span class="line">                    log.info(<span class="string">"å¼‚æ­¥ä»»åŠ¡è¿”å›ç»“æœ&#123;&#125;"</span>, result);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                asyncTask.vip();</span><br><span class="line">                asyncTask.sendSms();</span><br><span class="line">            &#125;</span><br><span class="line">            otherJob();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            log.error(<span class="string">"å¼‚å¸¸"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"å¼€å§‹åšä»»åŠ¡1ï¼šä¸‹å•æˆåŠŸ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é”™è¯¯ä½¿ç”¨ï¼Œä¸ä¼šå¼‚æ­¥æ‰§è¡Œï¼šè°ƒç”¨æ–¹ä¸è¢«è°ƒæ–¹ä¸èƒ½åœ¨åŒä¸€ä¸ªç±»ã€‚ä¸»è¦æ˜¯ä½¿ç”¨äº†åŠ¨æ€ä»£ç†ï¼ŒåŒä¸€ä¸ªç±»çš„æ—¶å€™ç›´æ¥è°ƒç”¨ï¼Œä¸æ˜¯é€šè¿‡ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»è°ƒç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Async</span>(<span class="string">"taskExecutor"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">otherJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"å¼€å§‹åšä»»åŠ¡4ï¼šç‰©æµ"</span>);</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(random.nextInt(<span class="number">10000</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        log.info(<span class="string">"å®Œæˆä»»åŠ¡4ï¼Œè€—æ—¶ï¼š"</span> + (end - start) + <span class="string">"æ¯«ç§’"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¼‚æ­¥ä»»åŠ¡æœåŠ¡ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.async.task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.AsyncResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@classname</span>: AsyncTask</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Ricardo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2020-01-02 15:25</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncTask</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span>(<span class="string">"taskExecutor"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSms</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        log.info(<span class="string">"å¼€å§‹åšä»»åŠ¡2ï¼šå‘é€çŸ­ä¿¡"</span>);</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        Thread.sleep(random.nextInt(<span class="number">10000</span>));</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        log.info(<span class="string">"å®Œæˆä»»åŠ¡1ï¼Œè€—æ—¶ï¼š"</span> + (end - start) + <span class="string">"æ¯«ç§’"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span>(<span class="string">"taskExecutor"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Future&lt;String&gt; <span class="title">pay</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        log.info(<span class="string">"å¼€å§‹åšå¼‚æ­¥è¿”å›ç»“æœä»»åŠ¡2ï¼šæ”¯ä»˜"</span>);</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        Thread.sleep(random.nextInt(<span class="number">10000</span>));</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        log.info(<span class="string">"å®Œæˆä»»åŠ¡2ï¼Œè€—æ—¶ï¼š"</span> + (end - start) + <span class="string">"æ¯«ç§’"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&lt;&gt;(<span class="string">"ä¼šå‘˜æœåŠ¡å®Œæˆ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›ç»“æœçš„å¼‚æ­¥è°ƒç”¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Async</span>(<span class="string">"taskExecutor"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">vip</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        log.info(<span class="string">"å¼€å§‹åšä»»åŠ¡5ï¼šä¼šå‘˜"</span>);</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        Thread.sleep(random.nextInt(<span class="number">10000</span>));</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        log.info(<span class="string">"å¼€å§‹åšå¼‚æ­¥è¿”å›ç»“æœä»»åŠ¡5ï¼Œè€—æ—¶ï¼š"</span> + (end - start) + <span class="string">"æ¯«ç§’"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å•å…ƒæµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.async;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.demo.async.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span>(<span class="title">classes</span> </span>= AsyncApplication<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">AsyncApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAsync</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        orderService.doShop();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.currentThread().join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»“æœ</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">2020<span class="selector-tag">-01-02</span> 15<span class="selector-pseudo">:28</span><span class="selector-pseudo">:52.392</span>  <span class="selector-tag">INFO</span> 35807 <span class="selector-tag">---</span> <span class="selector-attr">[           main]</span> <span class="selector-tag">com</span><span class="selector-class">.demo</span><span class="selector-class">.async</span><span class="selector-class">.service</span><span class="selector-class">.OrderService</span>      : å¼€å§‹åšä»»åŠ¡1ï¼šä¸‹å•æˆåŠŸ</span><br><span class="line">2020<span class="selector-tag">-01-02</span> 15<span class="selector-pseudo">:28</span><span class="selector-pseudo">:52.399</span>  <span class="selector-tag">INFO</span> 35807 <span class="selector-tag">---</span> <span class="selector-attr">[           main]</span> <span class="selector-tag">com</span><span class="selector-class">.demo</span><span class="selector-class">.async</span><span class="selector-class">.service</span><span class="selector-class">.OrderService</span>      : å¼€å§‹åšä»»åŠ¡4ï¼šç‰©æµ</span><br><span class="line">2020<span class="selector-tag">-01-02</span> 15<span class="selector-pseudo">:28</span><span class="selector-pseudo">:52.404</span>  <span class="selector-tag">INFO</span> 35807 <span class="selector-tag">---</span> <span class="selector-attr">[AsyncExecutor-1]</span> <span class="selector-tag">com</span><span class="selector-class">.demo</span><span class="selector-class">.async</span><span class="selector-class">.task</span><span class="selector-class">.AsyncTask</span>            : å¼€å§‹åšå¼‚æ­¥è¿”å›ç»“æœä»»åŠ¡2ï¼šæ”¯ä»˜</span><br><span class="line">2020<span class="selector-tag">-01-02</span> 15<span class="selector-pseudo">:28</span><span class="selector-pseudo">:53.420</span>  <span class="selector-tag">INFO</span> 35807 <span class="selector-tag">---</span> <span class="selector-attr">[           main]</span> <span class="selector-tag">com</span><span class="selector-class">.demo</span><span class="selector-class">.async</span><span class="selector-class">.service</span><span class="selector-class">.OrderService</span>      : å®Œæˆä»»åŠ¡4ï¼Œè€—æ—¶ï¼š1020æ¯«ç§’</span><br><span class="line">2020<span class="selector-tag">-01-02</span> 15<span class="selector-pseudo">:28</span><span class="selector-pseudo">:55.495</span>  <span class="selector-tag">INFO</span> 35807 <span class="selector-tag">---</span> <span class="selector-attr">[AsyncExecutor-1]</span> <span class="selector-tag">com</span><span class="selector-class">.demo</span><span class="selector-class">.async</span><span class="selector-class">.task</span><span class="selector-class">.AsyncTask</span>            : å®Œæˆä»»åŠ¡2ï¼Œè€—æ—¶ï¼š3091æ¯«ç§’</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æœ‰çš„çº¿ç¨‹çš„åå­—å°±æ˜¯æˆ‘ä»¬çº¿ç¨‹æ± å®šä¹‰çš„å‰ç¼€ï¼Œè¯´æ˜ä½¿ç”¨äº†çº¿ç¨‹æ± å¼‚æ­¥æ‰§è¡Œã€‚å…¶ä¸­æˆ‘ä»¬ç¤ºèŒƒäº†ä¸€ä¸ªé”™è¯¯çš„ä½¿ç”¨æ¡ˆä¾‹ <strong>otherJob()</strong>ï¼Œå¹¶æ²¡æœ‰å¼‚æ­¥æ‰§è¡Œã€‚</p>
<p>åŸå› ï¼š</p>
<p><strong>spring åœ¨æ‰«æbeançš„æ—¶å€™ä¼šæ‰«ææ–¹æ³•ä¸Šæ˜¯å¦åŒ…å«@Asyncæ³¨è§£ï¼Œå¦‚æœåŒ…å«ï¼Œspringä¼šä¸ºè¿™ä¸ªbeanåŠ¨æ€åœ°ç”Ÿæˆä¸€ä¸ªå­ç±»ï¼ˆå³ä»£ç†ç±»ï¼Œproxyï¼‰ï¼Œä»£ç†ç±»æ˜¯ç»§æ‰¿åŸæ¥é‚£ä¸ªbeançš„ã€‚æ­¤æ—¶ï¼Œå½“è¿™ä¸ªæœ‰æ³¨è§£çš„æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯ç”±ä»£ç†ç±»æ¥è°ƒç”¨çš„ï¼Œä»£ç†ç±»åœ¨è°ƒç”¨æ—¶å¢åŠ å¼‚æ­¥ä½œç”¨ã€‚ç„¶è€Œï¼Œå¦‚æœè¿™ä¸ªæœ‰æ³¨è§£çš„æ–¹æ³•æ˜¯è¢«åŒä¸€ä¸ªç±»ä¸­çš„å…¶ä»–æ–¹æ³•è°ƒç”¨çš„ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•çš„è°ƒç”¨å¹¶æ²¡æœ‰é€šè¿‡ä»£ç†ç±»ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡åŸæ¥çš„é‚£ä¸ª bean ä¹Ÿå°±æ˜¯ this. methodï¼Œæ‰€ä»¥å°±æ²¡æœ‰å¢åŠ å¼‚æ­¥ä½œç”¨ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ç°è±¡å°±æ˜¯@Asyncæ³¨è§£æ— æ•ˆã€‚</strong></p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>PostgreSQLé›†ç¾¤åŠè¯»å†™åˆ†ç¦»å®è·µ</title>
    <url>/2019/12/29/PostgreSQL%E9%9B%86%E7%BE%A4%E5%8F%8A%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%96%B9%E6%A1%88/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä¸ºäº†æ–¹ä¾¿ï¼Œåªæ­å»ºä¸€ä¸»ä¸€ä»ã€‚é¦–å…ˆå‡†å¤‡ä¸¤å°æœåŠ¡å™¨ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>IP</th>
<th>è§’è‰²</th>
<th>ç«¯å£</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.0.31</td>
<td>master</td>
<td>5432</td>
</tr>
<tr>
<td></td>
<td>pgpool-II</td>
<td>9999</td>
</tr>
<tr>
<td>192.168.0.32</td>
<td>slave</td>
<td>5432</td>
</tr>
</tbody>
</table>
<a id="more"></a>
<h2 id="ä¸€ã€åŸºç¡€ç¯å¢ƒé…ç½®"><a href="#ä¸€ã€åŸºç¡€ç¯å¢ƒé…ç½®" class="headerlink" title="ä¸€ã€åŸºç¡€ç¯å¢ƒé…ç½®"></a>ä¸€ã€åŸºç¡€ç¯å¢ƒé…ç½®</h2><ol>
<li><p>hostè®¾ç½®</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"># ä¿®æ”¹vi /etc/hosts, å¢åŠ ä»¥ä¸‹å†…å®¹</span><br><span class="line"><span class="number">192.168.0.31</span> master</span><br><span class="line"><span class="number">192.168.0.32</span> slave</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®‰è£…</p>
<p>PostgreSQL</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># æ·»åŠ æº</span></span><br><span class="line">rpm -Uvh https:<span class="comment">//yum.postgresql.org/10/redhat/rhel-7-x86_64/pgdg-centos10-10-2.noarch.rpm</span></span><br><span class="line"><span class="meta"># ä¸‹è½½</span></span><br><span class="line">yum install postgresql10-server postgresql10</span><br><span class="line"><span class="meta"># å®‰è£…</span></span><br><span class="line">/usr/pgsql<span class="number">-10</span>/bin/postgresql<span class="number">-10</span>-setup initdb</span><br><span class="line"></span><br><span class="line"><span class="meta"># å¯åŠ¨</span></span><br><span class="line">systemctl enable postgresql<span class="number">-10.</span>service</span><br><span class="line">systemctl start postgresql<span class="number">-10.</span>service</span><br><span class="line"></span><br><span class="line"><span class="meta"># éªŒè¯</span></span><br><span class="line">su - postgres -c <span class="string">"psql"</span></span><br><span class="line"><span class="meta"># å‡ºç°ä»¥ä¸‹ä¿¡æ¯åˆ™æˆåŠŸ</span></span><br><span class="line">psql (<span class="number">10.0</span>)</span><br><span class="line">Type <span class="string">"help"</span> <span class="keyword">for</span> help.</span><br><span class="line">postgres=#</span><br><span class="line"></span><br><span class="line"><span class="meta"># åˆ›å»ºå¯†ç </span></span><br><span class="line">postgres=# \password postgres</span><br><span class="line"></span><br><span class="line"><span class="meta"># æŸ¥çœ‹è·¯å¾„ï¼ˆ/var/lib/pgsql/10/dataï¼‰</span></span><br><span class="line">postgres=# show data_directory;</span><br><span class="line"></span><br><span class="line"><span class="meta"># ç¼–è¾‘æ–‡ä»¶ (vi /var/lib/pgsql/10/data/pg_hba.conf)</span></span><br><span class="line"><span class="meta"># host all all 127.0.0.1/32 ident ä¿®æ”¹ä¸ºå…è®¸æ‰€æœ‰ç½‘ç»œç™»å½•ï¼Œå¹¶ä½¿ç”¨md5æ–¹å¼è¿›è¡Œè®¤è¯ï¼š</span></span><br><span class="line"><span class="meta"># host all all 0.0.0.0/0 md5</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># ç¼–è¾‘æ–‡ä»¶ (vi /var/lib/pgsql/10/data/postgresql.conf)</span></span><br><span class="line">listen_addresses = <span class="string">'*'</span> # è¡¨ç¤ºå¼€æ”¾å¤–ç½‘è®¿é—®</span><br><span class="line"></span><br><span class="line"><span class="meta"># æ‰“å¼€é˜²ç«å¢™</span></span><br><span class="line">sudo firewall-cmd --add-service=postgresql --permanent</span><br><span class="line">sudo firewall-cmd --reload</span><br><span class="line"><span class="meta"># é‡å¯</span></span><br><span class="line">systemctl restart postgresql<span class="number">-10.</span>service</span><br></pre></td></tr></table></figure>
<p>pgpool-II</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line">yum <span class="keyword">install</span> <span class="keyword">http</span>://www.pgpool.net/yum/rpms/<span class="number">3.7</span>/redhat/rhel<span class="number">-7</span>-x86_64/pgpool-II-<span class="keyword">release</span><span class="number">-3.7</span><span class="number">-1.</span>noarch.rpm</span><br><span class="line">yum <span class="keyword">install</span> pgpool-II-pg10</span><br><span class="line"><span class="comment"># å¯é€‰</span></span><br><span class="line">yum <span class="keyword">install</span> pgpool-II-pg10-debuginfo</span><br><span class="line">yum <span class="keyword">install</span> pgpool-II-pg10-devel</span><br><span class="line">yum <span class="keyword">install</span> pgpool-II-pg10-extensions</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨</span></span><br><span class="line">systemctl <span class="keyword">enable</span> pgpool.service</span><br><span class="line">systemctl <span class="keyword">start</span> pgpool.service</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="äºŒã€æµå¤åˆ¶"><a href="#äºŒã€æµå¤åˆ¶" class="headerlink" title="äºŒã€æµå¤åˆ¶"></a>äºŒã€æµå¤åˆ¶</h2><ol>
<li><p>Master</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç”¨äºå¤åˆ¶çš„ç”¨æˆ·</span></span><br><span class="line">su - postgres</span><br><span class="line">psql</span><br><span class="line">postgres=<span class="comment"># CREATE ROLE pgrepuser REPLICATION LOGIN PASSWORD 'pgreppass';</span></span><br><span class="line"><span class="comment"># ç¼–è¾‘æ–‡ä»¶ (vi /var/lib/pgsql/10/data/pg_hba.conf)</span></span><br><span class="line"><span class="comment"># host replication pgrepuser 0.0.0.0/0 md5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¾‘æ–‡ä»¶ (vi /var/lib/pgsql/10/data/postgresql.conf),ä¿®æ”¹é…ç½®(æ ¹æ®å®é™…æƒ…å†µå¡«å†™)</span></span><br><span class="line">wal_level = hot_standby</span><br><span class="line">archive_mode = on</span><br><span class="line">max_wal_sender = 4</span><br><span class="line">wal_keep_segments = 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯æ•°æ®åº“</span></span><br><span class="line">systemctl restart postgresql-10.service</span><br></pre></td></tr></table></figure>
</li>
<li><p>Slave</p>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœæ­¢æœåŠ¡</span></span><br><span class="line">systemctl stop postgresql-<span class="number">10</span>.service</span><br><span class="line"></span><br><span class="line">su - postgres</span><br><span class="line"><span class="comment"># ä½¿ç”¨ pg_basebackup ç”Ÿæˆå¤‡åº“</span></span><br><span class="line"><span class="comment">#1. æ¸…ç©º $PGDATA ç›®å½•</span></span><br><span class="line">rm -rf /var/<span class="class"><span class="keyword">lib</span>/<span class="title">pgsql</span>/10/<span class="title">data</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pg_basebackup å‘½ä»¤ç”Ÿæˆå¤‡åº“</span></span><br><span class="line">pg_basebackup -D /var/<span class="class"><span class="keyword">lib</span>/<span class="title">pgsql</span>/10/<span class="title">data</span> -<span class="title">Fp</span> -<span class="title">Xs</span> -<span class="title">v</span> -<span class="title">P</span> -<span class="title">h</span> <span class="title">master</span> -<span class="title">U</span> <span class="title">pgrepuser</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¾‘æ–‡ä»¶ (vi /var/lib/pgsql/10/data/postgresql.conf)</span></span><br><span class="line">hot_standby = on</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»ºæ–‡ä»¶ (vi /var/lib/pgsql/10/data/recovery.conf)</span></span><br><span class="line">standby_mode = <span class="string">'on'</span></span><br><span class="line">primary_conninfo = <span class="string">'host=master port=5432 user=pgrepuser password=pgreppass'</span></span><br><span class="line">trigger_file = <span class="string">'failover.now'</span></span><br><span class="line">recovery_target_timeline = <span class="string">'latest'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯æ•°æ®åº“</span></span><br><span class="line">systemctl restart postgresql-<span class="number">10</span>.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#éªŒè¯ï¼šåœ¨masteræ–°å¢æ•°æ®slaveèŠ‚ç‚¹å¯ä»¥çœ‹åˆ°æ•°æ®ã€‚</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="ä¸‰ã€è¯»å†™åˆ†ç¦»"><a href="#ä¸‰ã€è¯»å†™åˆ†ç¦»" class="headerlink" title="ä¸‰ã€è¯»å†™åˆ†ç¦»"></a>ä¸‰ã€è¯»å†™åˆ†ç¦»</h2><ol>
<li><p>pgpoolé…ç½®</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">cd /etc/pgpool-II</span><br><span class="line">cp -pv pgpool.conf.sample-stream pgpool.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ vi pgpool.conf</span></span><br><span class="line">listen_addresses = '*'<span class="comment"># å¤–ç½‘è®¿é—®</span></span><br><span class="line"><span class="comment"># 0ä¸ºä¸»åº“</span></span><br><span class="line">backend_hostname0 = '<span class="literal">master</span></span><br><span class="line">backend_port0 = <span class="number">5432</span></span><br><span class="line">backend_weight0 = <span class="number">0</span> <span class="comment"># åˆ†é…æ¯”ä¾‹</span></span><br><span class="line">backend_data_directory0 = '/var/lib/pgsql/<span class="number">10</span>/data'</span><br><span class="line">backend_flag0 = 'ALLOW_TO_FAILOVER'</span><br><span class="line">backend_hostname1 = '<span class="literal">slave</span>'</span><br><span class="line">backend_port1 = <span class="number">5432</span></span><br><span class="line">backend_weight1 = <span class="number">1</span></span><br><span class="line">backend_data_directory1 = '/var/lib/pgsql/<span class="number">10</span>/data'</span><br><span class="line">backend_flag1 = 'ALLOW_TO_FAILOVER'</span><br><span class="line"><span class="comment">#hbaè®¤è¯</span></span><br><span class="line">enable_pool_hba = on</span><br><span class="line"><span class="comment"># æ‰§è¡Œlog</span></span><br><span class="line">log_statement = on</span><br><span class="line">log_per_node_statement = on</span><br><span class="line"><span class="comment"># æµå¤åˆ¶</span></span><br><span class="line">sr_check_user = 'replicator' <span class="comment"># æµå¤åˆ¶è´¦å·</span></span><br><span class="line">sr_check_password = '<span class="number">123456</span>'  <span class="comment"># æµå¤åˆ¶å¯†ç </span></span><br><span class="line"><span class="comment"># å‡½æ•°é»˜è®¤åˆ†å‘åˆ°ä»èŠ‚ç‚¹ï¼Œè¿‡æ»¤å¦‚ä¸‹</span></span><br><span class="line">black_function_list = 'currval,lastval,nextval,setval,funcw_.*'</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ vi pool_hba.conf</span></span><br><span class="line">host    all         all         <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>          md5</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ vi pcp.conf</span></span><br><span class="line">pcp:e10adc3949ba59abbe56e057f20f883e <span class="comment"># å¯†ç ä¸º123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆpool_passwd</span></span><br><span class="line">pg_md5  <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ postgresql ç”¨æˆ·å¯†ç ä¸€è‡´</span></span><br><span class="line">pg_md5 -m -u postges postgres</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨pgpool</span></span><br><span class="line"><span class="comment"># systemctl restart pgpool.service </span></span><br><span class="line">pgpool -n -d &gt; /etc/pgpool-II/pgpool.log <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥</span></span><br><span class="line">su - postgres</span><br><span class="line">psql postgres -h <span class="keyword">master</span> <span class="title">-p</span> <span class="number">9999</span> -U postgres</span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line"><span class="attr">postgres=</span><span class="comment"># show pool_nodes;</span></span><br><span class="line">node_id | hostname | port | status | lb_weight |  <span class="keyword">role</span>   <span class="title">| select_cnt</span> | load_balance_node | replication_delay </span><br><span class="line">---------+----------+------+--------+-----------+---------+------------+-------------------+-------------------</span><br><span class="line"><span class="number">0</span>       | <span class="keyword">master</span>   <span class="title">| 5432</span> | up     | <span class="number">0.000000</span>  | primary | <span class="number">28</span>         | <span class="literal">false</span>             | <span class="number">0</span></span><br><span class="line"><span class="number">1</span>       | <span class="literal">slave</span>    | <span class="number">5432</span> | up     | <span class="number">1.000000</span>  | standby | <span class="number">6</span>          | <span class="literal">true</span>              | <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">tail -f /etc/pgpool-II/pgpool.log </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹é¢æ˜¯æµ‹è¯•æƒ…å†µï¼š</span></span><br><span class="line"><span class="comment"># select 1;</span></span><br><span class="line"><span class="number">2017</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">06</span>:<span class="number">38</span>:<span class="number">25</span>: pid <span class="number">3637</span>: LOG:  DB <span class="keyword">node</span> id:<span class="title"> 1</span> backend pid: <span class="number">3658</span> statement: select * from test where id = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># update test set name = 'test' where id = 2;</span></span><br><span class="line">DB <span class="keyword">node</span> id:<span class="title"> 0</span> backend pid: <span class="number">8032</span> statement: update test set name = 'test' where id = <span class="number">2</span>;</span><br><span class="line"><span class="comment">#/*REPLICATION*/select 1; # å¼ºåˆ¶masterèŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line">DB <span class="keyword">node</span> id:<span class="title"> 0</span> backend pid: <span class="number">8032</span> statement: 	/*REPLICATION*/select <span class="number">1</span>;</span><br><span class="line"><span class="comment"># DB node id,0è¡¨ç¤ºä¸»èŠ‚ç‚¹æ‰§è¡Œï¼Œ1è¡¨ç¤ºä»èŠ‚ç‚¹</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="å››ã€é”™è¯¯è§£å†³"><a href="#å››ã€é”™è¯¯è§£å†³" class="headerlink" title="å››ã€é”™è¯¯è§£å†³"></a>å››ã€é”™è¯¯è§£å†³</h2><ol>
<li><p>ç«¯å£å ç”¨</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="number">2017</span><span class="number">-10</span><span class="number">-30</span> <span class="number">01</span>:<span class="number">50</span>:<span class="number">21</span>: pid <span class="number">3790</span>: FATAL:  failed <span class="built_in">to</span> bind <span class="keyword">a</span> <span class="built_in">socket</span>: <span class="string">"/tmp/.s.PGSQL.9998"</span></span><br><span class="line"><span class="number">2017</span><span class="number">-10</span><span class="number">-30</span> <span class="number">01</span>:<span class="number">50</span>:<span class="number">21</span>: pid <span class="number">3790</span>: DETAIL:  bind <span class="built_in">socket</span> failed <span class="keyword">with</span> error: <span class="string">"Address already in use"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éæ­£å¸¸ç»“æŸå¯¼è‡´çš„ï¼Œåˆ é™¤ä»¥ä¸‹ç›®å½•å³å¯</span></span><br><span class="line">rm -f /tmp/.s.PGSQL<span class="number">.9999</span></span><br><span class="line">rm -f /tmp/.s.PGSQL<span class="number">.9898</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="äº”ã€åç»­ä¼˜åŒ–"><a href="#äº”ã€åç»­ä¼˜åŒ–" class="headerlink" title="äº”ã€åç»­ä¼˜åŒ–"></a>äº”ã€åç»­ä¼˜åŒ–</h2><ol>
<li><p>å®•æœºä¸»ä»åˆ‡æ¢</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ vi pgpool.conf</span></span><br><span class="line"><span class="attr">follow_master_command</span> = <span class="string">'/etc/pgpool-II/failover_stream.sh'</span></span><br></pre></td></tr></table></figure>
<p>æ–°å»ºåˆ‡æ¢è„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /bin/sh </span></span><br><span class="line"><span class="comment"># Failover command for streaming replication. </span></span><br><span class="line"><span class="comment"># Arguments: $1: new master hostname. </span></span><br><span class="line"></span><br><span class="line">new_master=<span class="variable">$1</span> </span><br><span class="line">trigger_command=<span class="string">"<span class="variable">$PGHOME</span>/bin/pg_ctl promote -D <span class="variable">$PGDATA</span>"</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># Prompte standby database. </span></span><br><span class="line">/usr/bin/ssh -T <span class="variable">$new_master</span> <span class="variable">$trigger_command</span> </span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0;</span><br></pre></td></tr></table></figure>
</li>
<li><p>pgpoolé›†ç¾¤</p>
<p>é…ç½®è™šæ‹Ÿip(delegate_IP)ï¼Œä½¿ç”¨WATCHDOGç›‘æ§ï¼ŒæœåŠ¡Aå®•æœºæ—¶ï¼ŒæœåŠ¡Bè‡ªåŠ¨æ¥ç®¡è™šæ‹ŸIPå¯¹å¤–æä¾›æœåŠ¡ã€‚</p>
</li>
</ol>
<h2 id="å…­ã€åŸºäºShardingJDBCå®ç°è¯»å†™åˆ†ç¦»"><a href="#å…­ã€åŸºäºShardingJDBCå®ç°è¯»å†™åˆ†ç¦»" class="headerlink" title="å…­ã€åŸºäºShardingJDBCå®ç°è¯»å†™åˆ†ç¦»"></a>å…­ã€åŸºäºShardingJDBCå®ç°è¯»å†™åˆ†ç¦»</h2><ol>
<li><p>æ–°å»ºä¸€ä¸ªSpring Bootå·¥ç¨‹ï¼Œæ·»åŠ å¿…è¦çš„ä¾èµ–ï¼Œå…¶pom.xmlå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">    xsi:schemaLocation=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.demo&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;shardingjdbcdemo&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;name&gt;shardingjdbcdemo&lt;/name&gt;</span><br><span class="line">    &lt;description&gt;Demo project for ShardingJDBC Demo&lt;/description&gt;</span><br><span class="line"></span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.5.7.RELEASE&lt;/version&gt;</span><br><span class="line">        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">        &lt;sharding-jdbc.version&gt;1.5.4.1&lt;/sharding-jdbc.version&gt;</span><br><span class="line">        &lt;mybatis-spring-boot-starter.version&gt;1.1.1&lt;/mybatis-spring-boot-starter.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--æ”¯æŒé¢å‘æ–¹é¢çš„ç¼–ç¨‹å³AOPï¼ŒåŒ…æ‹¬spring-aopå’ŒAspectJ--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;mybatis-spring-boot-starter.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.postgresql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;postgresql&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- å¼•å…¥sharding-jdbcæ ¸å¿ƒæ¨¡å— --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.dangdang&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;sharding-jdbc-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;sharding-jdbc.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;commons-dbcp&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-dbcp&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.4&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®šä¹‰DataSource</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.shardingjdbc.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.dangdang.ddframe.rdb.sharding.api.MasterSlaveDataSourceFactory;</span><br><span class="line"><span class="keyword">import</span> com.dangdang.ddframe.rdb.sharding.api.strategy.slave.MasterSlaveLoadBalanceStrategyType;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbcp.BasicDataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.sql.Driver;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"shardingDataSource"</span>)</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"spring.datasource"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">getDataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> buildDataSource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> DataSource <span class="title">buildDataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        BasicDataSource masterDataSource0 = createDataSource(<span class="string">"jdbc:postgresql://192.168.0.31:5432/master"</span>);</span><br><span class="line">        <span class="comment">// æ„å»ºè¯»å†™åˆ†ç¦»æ•°æ®æº, è¯»å†™åˆ†ç¦»æ•°æ®æºå®ç°äº†DataSourceæ¥å£, å¯ç›´æ¥å½“åšæ•°æ®æºå¤„ç†. masterDataSource0, slaveDataSource00, slaveDataSource01ç­‰ä¸ºä½¿ç”¨DBCPç­‰è¿æ¥æ± é…ç½®çš„çœŸå®æ•°æ®æº</span></span><br><span class="line">        Map&lt;String, DataSource&gt; slaveDataSourceMap0 = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        BasicDataSource slaveDataSource00 = createDataSource(<span class="string">"jdbc:postgresql://192.168.0.31:5432/slave"</span>);</span><br><span class="line">        slaveDataSourceMap0.put(<span class="string">"slaveDataSource00"</span>, slaveDataSource00);</span><br><span class="line">        <span class="comment">// å¯é€‰æ‹©ä¸»ä»åº“è´Ÿè½½å‡è¡¡ç­–ç•¥, é»˜è®¤æ˜¯ROUND_ROBIN, è¿˜æœ‰RANDOMå¯ä»¥é€‰æ‹©, æˆ–è€…è‡ªå®šä¹‰è´Ÿè½½ç­–ç•¥</span></span><br><span class="line">        DataSource masterSlaveDs0 = MasterSlaveDataSourceFactory.createDataSource(<span class="string">"ms_0"</span>, <span class="string">"masterDataSource0"</span>, masterDataSource0, slaveDataSourceMap0, MasterSlaveLoadBalanceStrategyType.ROUND_ROBIN);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> masterSlaveDs0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> BasicDataSource <span class="title">createDataSource</span><span class="params">(<span class="keyword">final</span> String dataSourceUrl)</span> </span>&#123;</span><br><span class="line">        BasicDataSource result = <span class="keyword">new</span> BasicDataSource();</span><br><span class="line">        result.setDriverClassName(Driver<span class="class">.<span class="keyword">class</span>.<span class="title">getName</span>())</span>;</span><br><span class="line">        result.setUrl(dataSourceUrl);</span><br><span class="line">        result.setUsername(<span class="string">"postgres"</span>);</span><br><span class="line">        result.setPassword(<span class="string">""</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>PostgreSql</tag>
      </tags>
  </entry>
  <entry>
    <title>leetcodeåŒæŒ‡é’ˆæ€»ç»“</title>
    <url>/2019/12/26/leetcode%E5%8F%8C%E6%8C%87%E9%92%88%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><ul>
<li><p><a href="#1-æœ‰åºæ•°ç»„çš„-two-sum">1. æœ‰åºæ•°ç»„çš„ Two Sum</a></p>
</li>
<li><p><a href="#2-ä¸¤æ•°å¹³æ–¹å’Œ">2. ä¸¤æ•°å¹³æ–¹å’Œ</a></p>
</li>
<li><p><a href="#3-åè½¬å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—ç¬¦">3. åè½¬å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—ç¬¦</a></p>
</li>
<li><p><a href="#4-å›æ–‡å­—ç¬¦ä¸²">4. å›æ–‡å­—ç¬¦ä¸²</a></p>
</li>
<li><p><a href="#5-å½’å¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„">5. å½’å¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</a></p>
</li>
<li><p><a href="#6-åˆ¤æ–­é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯">6. åˆ¤æ–­é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯</a></p>
</li>
<li><p><a href="#7-æœ€é•¿å­åºåˆ—">7. æœ€é•¿å­åºåˆ—</a></p>
</li>
</ul>
<p>åŒæŒ‡é’ˆä¸»è¦ç”¨äºéå†æ•°ç»„ï¼Œä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸åŒçš„å…ƒç´ ï¼Œä»è€ŒååŒå®Œæˆä»»åŠ¡ã€‚</p>
<h1 id="1-æœ‰åºæ•°ç»„çš„-Two-Sum"><a href="#1-æœ‰åºæ•°ç»„çš„-Two-Sum" class="headerlink" title="1. æœ‰åºæ•°ç»„çš„ Two Sum"></a>1. æœ‰åºæ•°ç»„çš„ Two Sum</h1><p>167. Two Sum II - Input array is sorted (Easy)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Input: numbers=&#123;2, 7, 11, 15&#125;, target=9</span><br><span class="line">Output: index1=1, index2=2</span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®æè¿°ï¼šåœ¨æœ‰åºæ•°ç»„ä¸­æ‰¾å‡ºä¸¤ä¸ªæ•°ï¼Œä½¿å®ƒä»¬çš„å’Œä¸º targetã€‚</p>
<p>ä½¿ç”¨åŒæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å€¼è¾ƒå°çš„å…ƒç´ ï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å€¼è¾ƒå¤§çš„å…ƒç´ ã€‚æŒ‡å‘è¾ƒå°å…ƒç´ çš„æŒ‡é’ˆä»å¤´å‘å°¾éå†ï¼ŒæŒ‡å‘è¾ƒå¤§å…ƒç´ çš„æŒ‡é’ˆä»å°¾å‘å¤´éå†ã€‚</p>
<ul>
<li>å¦‚æœä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘å…ƒç´ çš„å’Œ sum == targetï¼Œé‚£ä¹ˆå¾—åˆ°è¦æ±‚çš„ç»“æœï¼›</li>
<li>å¦‚æœ sum &gt; targetï¼Œç§»åŠ¨è¾ƒå¤§çš„å…ƒç´ ï¼Œä½¿ sum å˜å°ä¸€äº›ï¼›</li>
<li>å¦‚æœ sum &lt; targetï¼Œç§»åŠ¨è¾ƒå°çš„å…ƒç´ ï¼Œä½¿ sum å˜å¤§ä¸€äº›ã€‚</li>
</ul>
<p>æ•°ç»„ä¸­çš„å…ƒç´ æœ€å¤šéå†ä¸€æ¬¡ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚åªä½¿ç”¨äº†ä¸¤ä¸ªé¢å¤–å˜é‡ï¼Œç©ºé—´å¤æ‚åº¦ä¸º  O(1)ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] twoSum(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> target) &#123;</span><br><span class="line">    <span class="keyword">if</span> (numbers == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, j = numbers.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">        <span class="keyword">int</span> sum = numbers[i] + numbers[j];</span><br><span class="line">        <span class="keyword">if</span> (sum == target) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;i + <span class="number">1</span>, j + <span class="number">1</span>&#125;;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum &lt; target) &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="2-ä¸¤æ•°å¹³æ–¹å’Œ"><a href="#2-ä¸¤æ•°å¹³æ–¹å’Œ" class="headerlink" title="2. ä¸¤æ•°å¹³æ–¹å’Œ"></a>2. ä¸¤æ•°å¹³æ–¹å’Œ</h1><p>633. Sum of Square Numbers (Easy)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Input: 5</span><br><span class="line">Output: True</span><br><span class="line">Explanation: 1 * 1 + 2 * 2 = 5</span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®æè¿°ï¼šåˆ¤æ–­ä¸€ä¸ªéè´Ÿæ•´æ•°æ˜¯å¦ä¸ºä¸¤ä¸ªæ•´æ•°çš„å¹³æ–¹å’Œã€‚</p>
<p>å¯ä»¥çœ‹æˆæ˜¯åœ¨å…ƒç´ ä¸º 0~target çš„æœ‰åºæ•°ç»„ä¸­æŸ¥æ‰¾ä¸¤ä¸ªæ•°ï¼Œä½¿å¾—è¿™ä¸¤ä¸ªæ•°çš„å¹³æ–¹å’Œä¸º targetï¼Œå¦‚æœèƒ½æ‰¾åˆ°ï¼Œåˆ™è¿”å› trueï¼Œè¡¨ç¤º target æ˜¯ä¸¤ä¸ªæ•´æ•°çš„å¹³æ–¹å’Œã€‚</p>
<p>æœ¬é¢˜å’Œ 167. Two Sum II - Input array is sorted ç±»ä¼¼ï¼Œåªæœ‰ä¸€ä¸ªæ˜æ˜¾åŒºåˆ«ï¼šä¸€ä¸ªæ˜¯å’Œä¸º targetï¼Œä¸€ä¸ªæ˜¯å¹³æ–¹å’Œä¸º targetã€‚æœ¬é¢˜åŒæ ·å¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆå¾—åˆ°ä¸¤ä¸ªæ•°ï¼Œä½¿å…¶å¹³æ–¹å’Œä¸º targetã€‚</p>
<p>æœ¬é¢˜çš„å…³é”®æ˜¯å³æŒ‡é’ˆçš„åˆå§‹åŒ–ï¼Œå®ç°å‰ªæï¼Œä»è€Œé™ä½æ—¶é—´å¤æ‚åº¦ã€‚è®¾å³æŒ‡é’ˆä¸º xï¼Œå·¦æŒ‡é’ˆå›ºå®šä¸º 0ï¼Œä¸ºäº†ä½¿ 0<sup>2</sup> + x<sup>2</sup> çš„å€¼å°½å¯èƒ½æ¥è¿‘ targetï¼Œæˆ‘ä»¬å¯ä»¥å°† x å–ä¸º sqrt(target)ã€‚</p>
<p>å› ä¸ºæœ€å¤šåªéœ€è¦éå†ä¸€æ¬¡ 0~sqrt(target)ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸º O(sqrt(target))ã€‚åˆå› ä¸ºåªä½¿ç”¨äº†ä¸¤ä¸ªé¢å¤–çš„å˜é‡ï¼Œå› æ­¤ç©ºé—´å¤æ‚åº¦ä¸º O(1)ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">judgeSquareSum</span><span class="params">(<span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (target &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, j = (<span class="keyword">int</span>) Math.sqrt(target);</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= j) &#123;</span><br><span class="line">        <span class="keyword">int</span> powSum = i * i + j * j;</span><br><span class="line">        <span class="keyword">if</span> (powSum == target) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (powSum &gt; target) &#123;</span><br><span class="line">            j--;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="3-åè½¬å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—ç¬¦"><a href="#3-åè½¬å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—ç¬¦" class="headerlink" title="3. åè½¬å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—ç¬¦"></a>3. åè½¬å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—ç¬¦</h1><p>345. Reverse Vowels of a String (Easy)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Given s = "leetcode", return "leotcede".</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨åŒæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆä»å¤´å‘å°¾éå†ï¼Œä¸€ä¸ªæŒ‡é’ˆä»å°¾åˆ°å¤´éå†ï¼Œå½“ä¸¤ä¸ªæŒ‡é’ˆéƒ½éå†åˆ°å…ƒéŸ³å­—ç¬¦æ—¶ï¼Œäº¤æ¢è¿™ä¸¤ä¸ªå…ƒéŸ³å­—ç¬¦ã€‚</p>
<p>ä¸ºäº†å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯å…ƒéŸ³å­—ç¬¦ï¼Œæˆ‘ä»¬å°†å…¨éƒ¨å…ƒéŸ³å­—ç¬¦æ·»åŠ åˆ°é›†åˆ HashSet ä¸­ï¼Œä»è€Œä»¥ O(1) çš„æ—¶é—´å¤æ‚åº¦è¿›è¡Œè¯¥æ“ä½œã€‚</p>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼šåªéœ€è¦éå†æ‰€æœ‰å…ƒç´ ä¸€æ¬¡</li>
<li>ç©ºé—´å¤æ‚åº¦ O(1)ï¼šåªéœ€è¦ä½¿ç”¨ä¸¤ä¸ªé¢å¤–å˜é‡</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> HashSet&lt;Character&gt; vowels = <span class="keyword">new</span> HashSet&lt;&gt;(</span><br><span class="line">        Arrays.asList(<span class="string">'a'</span>, <span class="string">'e'</span>, <span class="string">'i'</span>, <span class="string">'o'</span>, <span class="string">'u'</span>, <span class="string">'A'</span>, <span class="string">'E'</span>, <span class="string">'I'</span>, <span class="string">'O'</span>, <span class="string">'U'</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">reverseVowels</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, j = s.length() - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span>[] result = <span class="keyword">new</span> <span class="keyword">char</span>[s.length()];</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= j) &#123;</span><br><span class="line">        <span class="keyword">char</span> ci = s.charAt(i);</span><br><span class="line">        <span class="keyword">char</span> cj = s.charAt(j);</span><br><span class="line">        <span class="keyword">if</span> (!vowels.contains(ci)) &#123;</span><br><span class="line">            result[i++] = ci;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!vowels.contains(cj)) &#123;</span><br><span class="line">            result[j--] = cj;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result[i++] = cj;</span><br><span class="line">            result[j--] = ci;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="4-å›æ–‡å­—ç¬¦ä¸²"><a href="#4-å›æ–‡å­—ç¬¦ä¸²" class="headerlink" title="4. å›æ–‡å­—ç¬¦ä¸²"></a>4. å›æ–‡å­—ç¬¦ä¸²</h1><p>680. Valid Palindrome II (Easy)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Input: "abca"</span><br><span class="line">Output: True</span><br><span class="line">Explanation: You could delete the character 'c'.</span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®æè¿°ï¼šå¯ä»¥åˆ é™¤ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ¤æ–­æ˜¯å¦èƒ½æ„æˆå›æ–‡å­—ç¬¦ä¸²ã€‚</p>
<p>æ‰€è°“çš„å›æ–‡å­—ç¬¦ä¸²ï¼Œæ˜¯æŒ‡å…·æœ‰å·¦å³å¯¹ç§°ç‰¹ç‚¹çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ â€œabcbaâ€ å°±æ˜¯ä¸€ä¸ªå›æ–‡å­—ç¬¦ä¸²ã€‚</p>
<p>ä½¿ç”¨åŒæŒ‡é’ˆå¯ä»¥å¾ˆå®¹æ˜“åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯å›æ–‡å­—ç¬¦ä¸²ï¼šä»¤ä¸€ä¸ªæŒ‡é’ˆä»å·¦åˆ°å³éå†ï¼Œä¸€ä¸ªæŒ‡é’ˆä»å³åˆ°å·¦éå†ï¼Œè¿™ä¸¤ä¸ªæŒ‡é’ˆåŒæ—¶ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œæ¯æ¬¡éƒ½åˆ¤æ–­ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦æ˜¯å¦ç›¸åŒï¼Œå¦‚æœéƒ½ç›¸åŒï¼Œå­—ç¬¦ä¸²æ‰æ˜¯å…·æœ‰å·¦å³å¯¹ç§°æ€§è´¨çš„å›æ–‡å­—ç¬¦ä¸²ã€‚</p>
<p>æœ¬é¢˜çš„å…³é”®æ˜¯å¤„ç†åˆ é™¤ä¸€ä¸ªå­—ç¬¦ã€‚åœ¨ä½¿ç”¨åŒæŒ‡é’ˆéå†å­—ç¬¦ä¸²æ—¶ï¼Œå¦‚æœå‡ºç°ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦ä¸ç›¸ç­‰çš„æƒ…å†µï¼Œæˆ‘ä»¬å°±è¯•ç€åˆ é™¤ä¸€ä¸ªå­—ç¬¦ï¼Œå†åˆ¤æ–­åˆ é™¤å®Œä¹‹åçš„å­—ç¬¦ä¸²æ˜¯å¦æ˜¯å›æ–‡å­—ç¬¦ä¸²ã€‚</p>
<p>åœ¨åˆ¤æ–­æ˜¯å¦ä¸ºå›æ–‡å­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦åˆ¤æ–­æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œå› ä¸ºå·¦æŒ‡é’ˆå·¦è¾¹å’Œå³æŒ‡é’ˆå³è¾¹çš„å­—ç¬¦ä¹‹å‰å·²ç»åˆ¤æ–­è¿‡å…·æœ‰å¯¹ç§°æ€§è´¨ï¼Œæ‰€ä»¥åªéœ€è¦åˆ¤æ–­ä¸­é—´çš„å­å­—ç¬¦ä¸²å³å¯ã€‚</p>
<p>åœ¨è¯•ç€åˆ é™¤å­—ç¬¦æ—¶ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥åˆ é™¤å·¦æŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦ï¼Œä¹Ÿå¯ä»¥åˆ é™¤å³æŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">validPalindrome</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = s.length() - <span class="number">1</span>; i &lt; j; i++, j--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s.charAt(i) != s.charAt(j)) &#123;</span><br><span class="line">            <span class="keyword">return</span> isPalindrome(s, i, j - <span class="number">1</span>) || isPalindrome(s, i + <span class="number">1</span>, j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isPalindrome</span><span class="params">(String s, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s.charAt(i++) != s.charAt(j--)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="5-å½’å¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„"><a href="#5-å½’å¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„" class="headerlink" title="5. å½’å¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„"></a>5. å½’å¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</h1><p>88. Merge Sorted Array (Easy)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">nums1 = [1,2,3,0,0,0], m = 3</span><br><span class="line">nums2 = [2,5,6],       n = 3</span><br><span class="line"></span><br><span class="line">Output: [1,2,2,3,5,6]</span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®æè¿°ï¼šæŠŠå½’å¹¶ç»“æœå­˜åˆ°ç¬¬ä¸€ä¸ªæ•°ç»„ä¸Šã€‚</p>
<p>éœ€è¦ä»å°¾å¼€å§‹éå†ï¼Œå¦åˆ™åœ¨ nums1 ä¸Šå½’å¹¶å¾—åˆ°çš„å€¼ä¼šè¦†ç›–è¿˜æœªè¿›è¡Œå½’å¹¶æ¯”è¾ƒçš„å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span> m, <span class="keyword">int</span>[] nums2, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> index1 = m - <span class="number">1</span>, index2 = n - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> indexMerge = m + n - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (index1 &gt;= <span class="number">0</span> || index2 &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (index1 &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            nums1[indexMerge--] = nums2[index2--];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index2 &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            nums1[indexMerge--] = nums1[index1--];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums1[index1] &gt; nums2[index2]) &#123;</span><br><span class="line">            nums1[indexMerge--] = nums1[index1--];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            nums1[indexMerge--] = nums2[index2--];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="6-åˆ¤æ–­é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯"><a href="#6-åˆ¤æ–­é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯" class="headerlink" title="6. åˆ¤æ–­é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯"></a>6. åˆ¤æ–­é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯</h1><p>141. Linked List Cycle (Easy)</p>
<p>ä½¿ç”¨åŒæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªæŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœå­˜åœ¨ç¯ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæŒ‡é’ˆä¸€å®šä¼šç›¸é‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasCycle</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ListNode l1 = head, l2 = head.next;</span><br><span class="line">    <span class="keyword">while</span> (l1 != <span class="keyword">null</span> &amp;&amp; l2 != <span class="keyword">null</span> &amp;&amp; l2.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (l1 == l2) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        l1 = l1.next;</span><br><span class="line">        l2 = l2.next.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="7-æœ€é•¿å­åºåˆ—"><a href="#7-æœ€é•¿å­åºåˆ—" class="headerlink" title="7. æœ€é•¿å­åºåˆ—"></a>7. æœ€é•¿å­åºåˆ—</h1><p>524. Longest Word in Dictionary through Deleting (Medium)</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">Input:</span></span><br><span class="line">s = <span class="string">"abpcplea"</span>, d = [<span class="string">"ale"</span>,<span class="string">"apple"</span>,<span class="string">"monkey"</span>,<span class="string">"plea"</span>]</span><br><span class="line"></span><br><span class="line"><span class="section">Output:</span></span><br><span class="line"><span class="string">"apple"</span></span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®æè¿°ï¼šåˆ é™¤ s ä¸­çš„ä¸€äº›å­—ç¬¦ï¼Œä½¿å¾—å®ƒæ„æˆå­—ç¬¦ä¸²åˆ—è¡¨ d ä¸­çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰¾å‡ºèƒ½æ„æˆçš„æœ€é•¿å­—ç¬¦ä¸²ã€‚å¦‚æœæœ‰å¤šä¸ªç›¸åŒé•¿åº¦çš„ç»“æœï¼Œè¿”å›å­—å…¸åºçš„æœ€å°å­—ç¬¦ä¸²ã€‚</p>
<p>é€šè¿‡åˆ é™¤å­—ç¬¦ä¸² s ä¸­çš„ä¸€ä¸ªå­—ç¬¦èƒ½å¾—åˆ°å­—ç¬¦ä¸² tï¼Œå¯ä»¥è®¤ä¸º t æ˜¯ s çš„å­åºåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆæ¥åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­åºåˆ—ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">findLongestWord</span><span class="params">(String s, List&lt;String&gt; d)</span> </span>&#123;</span><br><span class="line">    String longestWord = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (String target : d) &#123;</span><br><span class="line">        <span class="keyword">int</span> l1 = longestWord.length(), l2 = target.length();</span><br><span class="line">        <span class="keyword">if</span> (l1 &gt; l2 || (l1 == l2 &amp;&amp; longestWord.compareTo(target) &lt; <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isSubstr(s, target)) &#123;</span><br><span class="line">            longestWord = target;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> longestWord;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isSubstr</span><span class="params">(String s, String target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; s.length() &amp;&amp; j &lt; target.length()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s.charAt(i) == target.charAt(j)) &#123;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> j == target.length();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºç¡€æ•´ç†</title>
    <url>/2019/12/26/Java%E5%9F%BA%E7%A1%80%E6%95%B4%E7%90%86/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h4 id="1-0-JAVAä¸­çš„å‡ ç§åŸºæœ¬æ•°æ®ç±»å‹æ˜¯ä»€ä¹ˆï¼Œå„è‡ªå ç”¨å¤šå°‘å­—èŠ‚ã€‚"><a href="#1-0-JAVAä¸­çš„å‡ ç§åŸºæœ¬æ•°æ®ç±»å‹æ˜¯ä»€ä¹ˆï¼Œå„è‡ªå ç”¨å¤šå°‘å­—èŠ‚ã€‚" class="headerlink" title="1.0 JAVAä¸­çš„å‡ ç§åŸºæœ¬æ•°æ®ç±»å‹æ˜¯ä»€ä¹ˆï¼Œå„è‡ªå ç”¨å¤šå°‘å­—èŠ‚ã€‚"></a>1.0 JAVAä¸­çš„å‡ ç§åŸºæœ¬æ•°æ®ç±»å‹æ˜¯ä»€ä¹ˆï¼Œå„è‡ªå ç”¨å¤šå°‘å­—èŠ‚ã€‚</h4><p>Javaè¯­è¨€æä¾›äº†å…«ç§åŸºæœ¬ç±»å‹ã€‚å…­ç§æ•°å­—ç±»å‹ï¼ˆå››ä¸ªæ•´æ•°å‹ï¼Œä¸¤ä¸ªæµ®ç‚¹å‹ï¼‰ï¼Œä¸€ç§å­—ç¬¦ç±»å‹ï¼Œè¿˜æœ‰ä¸€ç§å¸ƒå°”å‹ã€‚</p>
<h5 id="byteï¼š"><a href="#byteï¼š" class="headerlink" title="byteï¼š"></a><strong>byteï¼š</strong></h5><p>byte æ•°æ®ç±»å‹æ˜¯8ä½ã€æœ‰ç¬¦å·çš„ï¼Œä»¥äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„æ•´æ•°ï¼›æœ€å°å€¼æ˜¯ -128ï¼ˆ-2^7ï¼‰ï¼›æœ€å¤§å€¼æ˜¯ 127ï¼ˆ2^7-1ï¼‰ï¼›é»˜è®¤å€¼æ˜¯ 0ï¼›byte ç±»å‹ç”¨åœ¨å¤§å‹æ•°ç»„ä¸­èŠ‚çº¦ç©ºé—´ï¼Œä¸»è¦ä»£æ›¿æ•´æ•°ï¼Œå› ä¸º byte å˜é‡å ç”¨çš„ç©ºé—´åªæœ‰ int ç±»å‹çš„å››åˆ†ä¹‹ä¸€ï¼›ä¾‹å­ï¼š<code>byte a = 100ï¼Œbyte b = -50</code>ã€‚</p>
<h5 id="shortï¼š"><a href="#shortï¼š" class="headerlink" title="shortï¼š"></a><strong>shortï¼š</strong></h5><p>short æ•°æ®ç±»å‹æ˜¯ 16 ä½ã€æœ‰ç¬¦å·çš„ä»¥äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„æ•´æ•°æœ€å°å€¼æ˜¯ -32768ï¼ˆ-2^15ï¼‰ï¼›æœ€å¤§å€¼æ˜¯ 32767ï¼ˆ2^15 - 1ï¼‰ï¼›Short æ•°æ®ç±»å‹ä¹Ÿå¯ä»¥åƒ byte é‚£æ ·èŠ‚çœç©ºé—´ã€‚ä¸€ä¸ªshortå˜é‡æ˜¯intå‹å˜é‡æ‰€å ç©ºé—´çš„äºŒåˆ†ä¹‹ä¸€ï¼›é»˜è®¤å€¼æ˜¯ 0ï¼›ä¾‹å­ï¼š<code>short s = 1000ï¼Œshort r = -20000</code>ã€‚</p>
<h5 id="intï¼š"><a href="#intï¼š" class="headerlink" title="intï¼š"></a><strong>intï¼š</strong></h5><p>int æ•°æ®ç±»å‹æ˜¯32ä½ã€æœ‰ç¬¦å·çš„ä»¥äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„æ•´æ•°ï¼›æœ€å°å€¼æ˜¯ -2,147,483,648ï¼ˆ-2^31ï¼‰ï¼›æœ€å¤§å€¼æ˜¯ 2,147,483,647ï¼ˆ2^31 - 1ï¼‰ï¼›ä¸€èˆ¬åœ°æ•´å‹å˜é‡é»˜è®¤ä¸º int ç±»å‹ï¼›é»˜è®¤å€¼æ˜¯ 0 ï¼›ä¾‹å­ï¼š<code>int a = 100000, int b = -200000</code>ã€‚</p>
<h5 id="longï¼š"><a href="#longï¼š" class="headerlink" title="longï¼š"></a><strong>longï¼š</strong></h5><p>long æ•°æ®ç±»å‹æ˜¯ 64 ä½ã€æœ‰ç¬¦å·çš„ä»¥äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„æ•´æ•°ï¼›æœ€å°å€¼æ˜¯ -9,223,372,036,854,775,808ï¼ˆ-2^63ï¼‰ï¼›æœ€å¤§å€¼æ˜¯ 9,223,372,036,854,775,807ï¼ˆ2^63 -1ï¼‰ï¼›è¿™ç§ç±»å‹ä¸»è¦ä½¿ç”¨åœ¨éœ€è¦æ¯”è¾ƒå¤§æ•´æ•°çš„ç³»ç»Ÿä¸Šï¼›é»˜è®¤å€¼æ˜¯ 0Lï¼›ä¾‹å­ï¼š<code>long a = 100000Lï¼ŒLong b = -200000L</code>ã€‚â€Lâ€ç†è®ºä¸Šä¸åˆ†å¤§å°å†™ï¼Œä½†æ˜¯è‹¥å†™æˆâ€lâ€å®¹æ˜“ä¸æ•°å­—â€1â€æ··æ·†ï¼Œä¸å®¹æ˜“åˆ†è¾©ã€‚æ‰€ä»¥æœ€å¥½å¤§å†™ã€‚</p>
<h5 id="floatï¼š"><a href="#floatï¼š" class="headerlink" title="floatï¼š"></a><strong>floatï¼š</strong></h5><p>float æ•°æ®ç±»å‹æ˜¯å•ç²¾åº¦ã€32ä½ã€ç¬¦åˆIEEE 754æ ‡å‡†çš„æµ®ç‚¹æ•°ï¼›float åœ¨å‚¨å­˜å¤§å‹æµ®ç‚¹æ•°ç»„çš„æ—¶å€™å¯èŠ‚çœå†…å­˜ç©ºé—´ï¼›é»˜è®¤å€¼æ˜¯ 0.0fï¼›æµ®ç‚¹æ•°ä¸èƒ½ç”¨æ¥è¡¨ç¤ºç²¾ç¡®çš„å€¼ï¼Œå¦‚è´§å¸ï¼›ä¾‹å­ï¼š<code>float f1 = 234.5f</code>ã€‚</p>
<h5 id="doubleï¼š"><a href="#doubleï¼š" class="headerlink" title="doubleï¼š"></a><strong>doubleï¼š</strong></h5><p>double æ•°æ®ç±»å‹æ˜¯åŒç²¾åº¦ã€64 ä½ã€ç¬¦åˆIEEE 754æ ‡å‡†çš„æµ®ç‚¹æ•°ï¼›æµ®ç‚¹æ•°çš„é»˜è®¤ç±»å‹ä¸ºdoubleç±»å‹ï¼›doubleç±»å‹åŒæ ·ä¸èƒ½è¡¨ç¤ºç²¾ç¡®çš„å€¼ï¼Œå¦‚è´§å¸ï¼›é»˜è®¤å€¼æ˜¯ 0.0dï¼›ä¾‹å­ï¼š<code>double d1 = 123.4</code>ã€‚</p>
<h5 id="booleanï¼š"><a href="#booleanï¼š" class="headerlink" title="booleanï¼š"></a><strong>booleanï¼š</strong></h5><p>booleanæ•°æ®ç±»å‹è¡¨ç¤ºä¸€ä½çš„ä¿¡æ¯ï¼›åªæœ‰ä¸¤ä¸ªå–å€¼ï¼štrue å’Œ falseï¼›è¿™ç§ç±»å‹åªä½œä¸ºä¸€ç§æ ‡å¿—æ¥è®°å½• true/false æƒ…å†µï¼›é»˜è®¤å€¼æ˜¯ falseï¼›ä¾‹å­ï¼š<code>boolean one = true</code>ã€‚</p>
<h5 id="charï¼š"><a href="#charï¼š" class="headerlink" title="charï¼š"></a><strong>charï¼š</strong></h5><p>charç±»å‹æ˜¯ä¸€ä¸ªå•ä¸€çš„ 16 ä½ Unicode å­—ç¬¦ï¼›æœ€å°å€¼æ˜¯ \u0000ï¼ˆå³ä¸º0ï¼‰ï¼›æœ€å¤§å€¼æ˜¯ \uffffï¼ˆå³ä¸º65,535ï¼‰ï¼›char æ•°æ®ç±»å‹å¯ä»¥å‚¨å­˜ä»»ä½•å­—ç¬¦ï¼›ä¾‹å­ï¼š<code>char letter = &#39;A&#39;;</code>ã€‚</p>
<a id="more"></a>
<h4 id="1-1-Stringç±»èƒ½è¢«ç»§æ‰¿å—ï¼Œä¸ºä»€ä¹ˆã€‚"><a href="#1-1-Stringç±»èƒ½è¢«ç»§æ‰¿å—ï¼Œä¸ºä»€ä¹ˆã€‚" class="headerlink" title="1.1 Stringç±»èƒ½è¢«ç»§æ‰¿å—ï¼Œä¸ºä»€ä¹ˆã€‚"></a>1.1 Stringç±»èƒ½è¢«ç»§æ‰¿å—ï¼Œä¸ºä»€ä¹ˆã€‚</h4><p>ä¸èƒ½</p>
<p>å¤§ç™½è¯è§£é‡Šå°±æ˜¯ï¼šStringå¾ˆå¤šå®ç”¨çš„ç‰¹æ€§ï¼Œæ¯”å¦‚è¯´â€œä¸å¯å˜æ€§â€ï¼Œæ˜¯å·¥ç¨‹å¸ˆç²¾å¿ƒè®¾è®¡çš„è‰ºæœ¯å“ï¼è‰ºæœ¯å“æ˜“ç¢ï¼ç”¨finalå°±æ˜¯æ‹’ç»ç»§æ‰¿ï¼Œé˜²æ­¢ä¸–ç•Œè¢«ç†Šå­©å­ç ´åï¼Œç»´æŠ¤ä¸–ç•Œå’Œå¹³ï¼</p>
<p>PSï¼šStringåŸºæœ¬çº¦å®šä¸­æœ€é‡è¦çš„ä¸€æ¡æ˜¯immutableï¼Œå£°æ˜Stringä¸ºfinal å’Œimmutableè™½ç„¶æ²¡æœ‰å¿…ç„¶å…³ç³»ï¼Œä½†æ˜¯å‡å¦‚Stringæ²¡æœ‰å£°æ˜ä¸ºfinal, é‚£ä¹ˆStringChilldå°±æœ‰å¯èƒ½æ˜¯è¢«å¤å†™ä¸ºmutableçš„ï¼Œè¿™æ ·å°±æ‰“ç ´äº†æˆä¸ºå…±è¯†çš„åŸºæœ¬çº¦å®šã€‚è¦çŸ¥é“ï¼ŒStringæ˜¯å‡ ä¹æ¯ä¸ªç±»éƒ½ä¼šä½¿ç”¨çš„ç±»ï¼Œç‰¹åˆ«æ˜¯ä½œä¸ºHashmapä¹‹ç±»çš„é›†åˆçš„keyå€¼æ—¶å€™ï¼Œmutableçš„Stringæœ‰éå¸¸å¤§çš„é£é™©ã€‚è€Œä¸”ä¸€æ—¦å‘ç”Ÿï¼Œéå¸¸éš¾å‘ç°ã€‚å£°æ˜Stringä¸ºfinalä¸€åŠ³æ°¸é€¸ã€‚</p>
<p><a href="https://javarevisited.blogspot.com/2010/10/why-string-is-immutable-or-final-in-java.html" target="_blank" rel="noopener">Why String is Immutable or Final in Java</a></p>
<h4 id="1-2-Stringï¼ŒStringbufferï¼ŒStringBuilderçš„åŒºåˆ«ã€‚"><a href="#1-2-Stringï¼ŒStringbufferï¼ŒStringBuilderçš„åŒºåˆ«ã€‚" class="headerlink" title="1.2 Stringï¼ŒStringbufferï¼ŒStringBuilderçš„åŒºåˆ«ã€‚"></a>1.2 Stringï¼ŒStringbufferï¼ŒStringBuilderçš„åŒºåˆ«ã€‚</h4><h5 id="å¯å˜æ€§"><a href="#å¯å˜æ€§" class="headerlink" title="å¯å˜æ€§"></a><strong>å¯å˜æ€§</strong></h5><p>Stringæ˜¯ä¸å¯å˜çš„ï¼Œå®ƒä½¿ç”¨finalå…³é”®è¯ä¿®é¥°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">String</span>&gt;, <span class="title">CharSequence</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** The value is used for character storage. */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</span><br><span class="line">...................</span><br></pre></td></tr></table></figure>
<p>StringBufferå’ŒStringBuilderä¸¤è€…éƒ½æ˜¯ç»§æ‰¿è‡ªAbstractStringBuilder,AbstractStringBuilderä¹Ÿæ˜¯ç”¨å­—ç¬¦æ•°ç»„ä¿å­˜char value[]ï¼Œä½†æ˜¯æ²¡æœ‰ç”¨finalä¿®é¥°ï¼Œæ‰€ä»¥è¿™ä¸¤ç§å¯¹è±¡æ˜¯å¯å˜çš„</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringBuffer</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractStringBuilder</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">abstract</span> <span class="title">class</span> <span class="title">AbstractStringBuilder</span> <span class="keyword">implements</span> <span class="title">Appendable</span>, <span class="title">CharSequence</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The value is used for character storage.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">char</span>[] value;</span><br></pre></td></tr></table></figure>
<h5 id="çº¿ç¨‹å®‰å…¨æ€§"><a href="#çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="çº¿ç¨‹å®‰å…¨æ€§"></a><strong>çº¿ç¨‹å®‰å…¨æ€§</strong></h5><p>Stringçš„å¯¹è±¡ä¸å¯å˜ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡ï¼Œæ‰€ä»¥çº¿ç¨‹å®‰å…¨</p>
<p>StringBufferé‡å†™äº†AbstractStringBuilderçš„æ–¹æ³•ï¼Œæ¯”å¦‚appendã€insertç­‰å¹¶ä¸”åŠ äº†åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">length</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">capacity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> minimumCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.ensureCapacity(minimumCapacity);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è€ŒStringBuilderå°±æ²¡åŠ åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯éçº¿ç¨‹å®‰å…¨çš„</p>
<h5 id="æ€§èƒ½"><a href="#æ€§èƒ½" class="headerlink" title="æ€§èƒ½"></a><strong>æ€§èƒ½</strong></h5><p>æ¯æ¬¡ä¿®æ”¹Stringçš„å€¼éƒ½ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ï¼Œç„¶åå†å°†æŒ‡é’ˆæŒ‡å‘æ–°çš„Stringå¯¹è±¡ï¼ŒStringBufferå’ŒStringBuilderæ¯æ¬¡éƒ½æ˜¯å¯¹è±¡æœ¬èº«è¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„å¯¹è±¡ã€‚StringBuilderçš„æ€§èƒ½ä¼šæ¯”StringBufferå¥½ä¸€ç‚¹ï¼Œä¸è¿‡å´è¦å†’å¤šçº¿ç¨‹ä¸å®‰å…¨çš„é£é™©</p>
<h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h5><ul>
<li>æ•°æ®é‡å°‘å¤šç”¨String</li>
<li>å•çº¿ç¨‹æ“ä½œå¤§é‡æ•°æ®ç”¨StringBuilder</li>
<li>å¤šçº¿ç¨‹æ“ä½œå¤§é‡æ•°æ®ç”¨StringBuffer</li>
</ul>
<h4 id="1-3-ArrayListå’ŒLinkedListæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚"><a href="#1-3-ArrayListå’ŒLinkedListæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚" class="headerlink" title="1.3 ArrayListå’ŒLinkedListæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚"></a>1.3 ArrayListå’ŒLinkedListæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</h4><p>ArrayListçš„å®ç°ç”¨çš„æ˜¯æ•°ç»„ï¼ŒLinkedListæ˜¯åŸºäºé“¾è¡¨ï¼ŒArrayListé€‚åˆæŸ¥æ‰¾ï¼ŒLinkedListé€‚åˆå¢åˆ </p>
<h5 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h5><p>ArrayListï¼šå†…éƒ¨ä½¿ç”¨æ•°ç»„çš„å½¢å¼å®ç°äº†å­˜å‚¨ï¼Œå®ç°äº†RandomAccessæ¥å£ï¼Œåˆ©ç”¨æ•°ç»„çš„ä¸‹æ ‡è¿›è¡Œå…ƒç´ çš„è®¿é—®ï¼Œå› æ­¤å¯¹å…ƒç´ çš„éšæœºè®¿é—®é€Ÿåº¦éå¸¸å¿«ã€‚</p>
<p>å› ä¸ºæ˜¯æ•°ç»„ï¼Œæ‰€ä»¥ArrayListåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæœ‰åˆå§‹å¤§å°10ï¼Œæ’å…¥æ–°å…ƒç´ çš„æ—¶å€™ï¼Œä¼šåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œæ‰©å®¹çš„æ­¥é•¿æ˜¯0.5å€åŸå®¹é‡ï¼Œæ‰©å®¹æ–¹å¼æ˜¯åˆ©ç”¨æ•°ç»„çš„å¤åˆ¶ï¼Œå› æ­¤æœ‰ä¸€å®šçš„å¼€é”€ï¼›</p>
<p>å¦å¤–ï¼ŒArrayListåœ¨è¿›è¡Œå…ƒç´ æ’å…¥çš„æ—¶å€™ï¼Œéœ€è¦ç§»åŠ¨æ’å…¥ä½ç½®ä¹‹åçš„æ‰€æœ‰å…ƒç´ ï¼Œä½ç½®è¶Šé å‰ï¼Œéœ€è¦ä½ç§»çš„å…ƒç´ è¶Šå¤šï¼Œå¼€é”€è¶Šå¤§ï¼Œç›¸åï¼Œæ’å…¥ä½ç½®è¶Šé åçš„è¯ï¼Œå¼€é”€å°±è¶Šå°äº†ï¼Œå¦‚æœåœ¨æœ€åé¢è¿›è¡Œæ’å…¥ï¼Œé‚£å°±ä¸éœ€è¦è¿›è¡Œä½ç§»ï¼›</p>
<h5 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h5><p>LinkedListï¼šå†…éƒ¨ä½¿ç”¨åŒå‘é“¾è¡¨çš„ç»“æ„å®ç°å­˜å‚¨ï¼ŒLinkedListæœ‰ä¸€ä¸ªå†…éƒ¨ç±»ä½œä¸ºå­˜æ”¾å…ƒç´ çš„å•å…ƒï¼Œé‡Œé¢æœ‰ä¸‰ä¸ªå±æ€§ï¼Œç”¨æ¥å­˜æ”¾å…ƒç´ æœ¬èº«ä»¥åŠå‰å2ä¸ªå•å…ƒçš„å¼•ç”¨ï¼Œå¦å¤–LinkedListå†…éƒ¨è¿˜æœ‰ä¸€ä¸ªheaderå±æ€§ï¼Œç”¨æ¥æ ‡è¯†èµ·å§‹ä½ç½®ï¼ŒLinkedListçš„ç¬¬ä¸€ä¸ªå•å…ƒå’Œæœ€åä¸€ä¸ªå•å…ƒéƒ½ä¼šæŒ‡å‘headerï¼Œå› æ­¤å½¢æˆäº†ä¸€ä¸ªåŒå‘çš„é“¾è¡¨ç»“æ„ã€‚</p>
<p>LinkedListæ˜¯é‡‡ç”¨åŒå‘é“¾è¡¨å®ç°çš„ã€‚æ‰€ä»¥å®ƒä¹Ÿå…·æœ‰é“¾è¡¨çš„ç‰¹ç‚¹ï¼Œæ¯ä¸€ä¸ªå…ƒç´ ï¼ˆç»“ç‚¹ï¼‰çš„åœ°å€ä¸è¿ç»­ï¼Œé€šè¿‡å¼•ç”¨æ‰¾åˆ°å½“å‰ç»“ç‚¹çš„ä¸Šä¸€ä¸ªç»“ç‚¹å’Œä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œå³æ’å…¥å’Œåˆ é™¤æ•ˆç‡è¾ƒé«˜ï¼Œåªéœ€è¦å¸¸æ•°æ—¶é—´ï¼Œè€Œgetå’Œsetåˆ™è¾ƒä¸ºä½æ•ˆã€‚</p>
<p> LinkedListçš„æ–¹æ³•å’Œä½¿ç”¨å’ŒArrayListå¤§è‡´ç›¸åŒï¼Œç”±äºLinkedListæ˜¯é“¾è¡¨å®ç°çš„ï¼Œæ‰€ä»¥é¢å¤–æä¾›äº†åœ¨å¤´éƒ¨å’Œå°¾éƒ¨æ·»åŠ /åˆ é™¤å…ƒç´ çš„æ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰ArrayListæ‰©å®¹çš„é—®é¢˜äº†ã€‚å¦å¤–ï¼ŒArrayListå’ŒLinkedListéƒ½å¯ä»¥å®ç°æ ˆã€é˜Ÿåˆ—ç­‰æ•°æ®ç»“æ„ï¼Œä½†LinkedListæœ¬èº«å®ç°äº†é˜Ÿåˆ—çš„æ¥å£ï¼Œæ‰€ä»¥æ›´æ¨èç”¨LinkedListæ¥å®ç°é˜Ÿåˆ—å’Œæ ˆã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨éœ€è¦é¢‘ç¹è¯»å–é›†åˆä¸­çš„å…ƒç´ æ—¶ï¼Œä½¿ç”¨ArrayListæ•ˆç‡è¾ƒé«˜ï¼Œè€Œåœ¨æ’å…¥å’Œåˆ é™¤æ“ä½œè¾ƒå¤šæ—¶ï¼Œä½¿ç”¨LinkedListæ•ˆç‡è¾ƒé«˜ã€‚</p>
<h4 id="1-4-è®²è®²ç±»çš„å®ä¾‹åŒ–é¡ºåºï¼Œæ¯”å¦‚çˆ¶ç±»é™æ€æ•°æ®ï¼Œæ„é€ å‡½æ•°ï¼Œå­—æ®µï¼Œå­ç±»é™æ€æ•°æ®ï¼Œæ„é€ å‡½æ•°ï¼Œå­—æ®µï¼Œå½“newçš„æ—¶å€™ï¼Œä»–ä»¬çš„æ‰§è¡Œé¡ºåºã€‚"><a href="#1-4-è®²è®²ç±»çš„å®ä¾‹åŒ–é¡ºåºï¼Œæ¯”å¦‚çˆ¶ç±»é™æ€æ•°æ®ï¼Œæ„é€ å‡½æ•°ï¼Œå­—æ®µï¼Œå­ç±»é™æ€æ•°æ®ï¼Œæ„é€ å‡½æ•°ï¼Œå­—æ®µï¼Œå½“newçš„æ—¶å€™ï¼Œä»–ä»¬çš„æ‰§è¡Œé¡ºåºã€‚" class="headerlink" title="1.4 è®²è®²ç±»çš„å®ä¾‹åŒ–é¡ºåºï¼Œæ¯”å¦‚çˆ¶ç±»é™æ€æ•°æ®ï¼Œæ„é€ å‡½æ•°ï¼Œå­—æ®µï¼Œå­ç±»é™æ€æ•°æ®ï¼Œæ„é€ å‡½æ•°ï¼Œå­—æ®µï¼Œå½“newçš„æ—¶å€™ï¼Œä»–ä»¬çš„æ‰§è¡Œé¡ºåºã€‚"></a>1.4 è®²è®²ç±»çš„å®ä¾‹åŒ–é¡ºåºï¼Œæ¯”å¦‚çˆ¶ç±»é™æ€æ•°æ®ï¼Œæ„é€ å‡½æ•°ï¼Œå­—æ®µï¼Œå­ç±»é™æ€æ•°æ®ï¼Œæ„é€ å‡½æ•°ï¼Œå­—æ®µï¼Œå½“newçš„æ—¶å€™ï¼Œä»–ä»¬çš„æ‰§è¡Œé¡ºåºã€‚</h4><p>åˆå§‹åŒ–é¡ºåºï¼šçˆ¶ç±»staticé™æ€å˜é‡ &gt; çˆ¶ç±»staticä»£ç å— &gt; å­ç±»staticé™æ€å˜é‡ &gt; å­ç±»staticä»£ç å— &gt; çˆ¶ç±»å˜é‡ &gt; çˆ¶ç±»å®ä¾‹ä»£ç å— &gt; çˆ¶ç±»æ„é€ å‡½æ•° &gt; å­ç±»å˜é‡ &gt; å­ç±»å®ä¾‹ä»£ç å— &gt; å­ç±»æ„é€ å‡½æ•°</p>
<h4 id="1-5-ç”¨è¿‡å“ªäº›Mapç±»ï¼Œéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŒHashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—-å¹¶å‘ä¸‹ä½¿ç”¨çš„Mapæ˜¯ä»€ä¹ˆï¼Œä»–ä»¬å†…éƒ¨åŸç†åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œæ¯”å¦‚å­˜å‚¨æ–¹å¼ï¼Œhashcodeï¼Œæ‰©å®¹ï¼Œé»˜è®¤å®¹é‡ç­‰ã€‚"><a href="#1-5-ç”¨è¿‡å“ªäº›Mapç±»ï¼Œéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŒHashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—-å¹¶å‘ä¸‹ä½¿ç”¨çš„Mapæ˜¯ä»€ä¹ˆï¼Œä»–ä»¬å†…éƒ¨åŸç†åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œæ¯”å¦‚å­˜å‚¨æ–¹å¼ï¼Œhashcodeï¼Œæ‰©å®¹ï¼Œé»˜è®¤å®¹é‡ç­‰ã€‚" class="headerlink" title="1.5 ç”¨è¿‡å“ªäº›Mapç±»ï¼Œéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŒHashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—,å¹¶å‘ä¸‹ä½¿ç”¨çš„Mapæ˜¯ä»€ä¹ˆï¼Œä»–ä»¬å†…éƒ¨åŸç†åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œæ¯”å¦‚å­˜å‚¨æ–¹å¼ï¼Œhashcodeï¼Œæ‰©å®¹ï¼Œé»˜è®¤å®¹é‡ç­‰ã€‚"></a>1.5 ç”¨è¿‡å“ªäº›Mapç±»ï¼Œéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŒHashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—,å¹¶å‘ä¸‹ä½¿ç”¨çš„Mapæ˜¯ä»€ä¹ˆï¼Œä»–ä»¬å†…éƒ¨åŸç†åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œæ¯”å¦‚å­˜å‚¨æ–¹å¼ï¼Œhashcodeï¼Œæ‰©å®¹ï¼Œé»˜è®¤å®¹é‡ç­‰ã€‚</h4><p>æœ€å¸¸ç”¨çš„Mapå®ç°ç±»æœ‰:HashMapï¼ŒConcurrentHashMapï¼ˆjdk1.8ï¼‰ï¼ŒLinkedHashMapï¼ŒTreeMap,HashTableï¼›</p>
<p>å…¶ä¸­æœ€é¢‘ç¹çš„æ˜¯HashMapå’ŒConcurrentHashMapï¼Œä»–ä»¬çš„ä¸»è¦åŒºåˆ«æ˜¯HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚ConcurrentHashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¹¶å‘ä¸‹å¯ä»¥ä½¿ç”¨ConcurrentHashMapå’ŒHashTable</p>
<p><strong>1.HashMap</strong></p>
<ul>
<li><p>å­˜å‚¨åŸç†å°±æ˜¯æ•£åˆ—è¡¨</p>
<p>æ•£åˆ—å‡½æ•°çš„è®¾è®¡ä¸èƒ½å¤ªå¤æ‚ï¼Œç”Ÿæˆçš„å€¼è¦å°½å¯èƒ½éšæœºå¹¶ä¸”å‡åŒ€åˆ†å¸ƒ</p>
<p>HashMapä½¿ç”¨é«˜ä½16ä½å¼‚æˆ–å¯¹æ•°ç»„é•¿åº¦å–ä½™ç¬¦åˆè¿™ä¸ªè§„åˆ™ï¼š</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> h;</span><br><span class="line">        <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ•£åˆ—å†²çª<br>HashMapä½¿ç”¨é“¾è¡¨è§£å†³Hashå†²çªï¼Œç›¸è¾ƒå¼€æ”¾å¯»å€æ³•æ›´åŠ èŠ‚çº¦å†…å­˜ï¼Œè€Œä¸”æ–¹ä¾¿é€šè¿‡å…¶å®ƒæ•°æ®ç»“æ„è¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚JDK1.8å°±æ˜¯ä½¿ç”¨çº¢é»‘æ ‘ä¼˜åŒ–ï¼Œé˜²æ­¢Hashæ”»å‡»ã€‚</li>
<li>åŠ¨æ€æ‰©å®¹<br>HashMapçš„é»˜è®¤é˜ˆå€¼æ˜¯0.75ï¼Œæ•°ç»„é•¿åº¦é»˜è®¤æ˜¯16ï¼Œä»¥2çš„å€æ•°å¢é•¿ï¼Œæ–¹ä¾¿å–ä½™ï¼Œç¾ä¸­ä¸è¶³çš„æ˜¯ï¼ŒHashMapçš„æ‰©å®¹æ˜¯ä¸€æ­¥åˆ°ä½çš„ï¼Œè™½ç„¶å‡æ‘Šæ—¶é—´å¤æ‚åº¦ä¸é«˜ï¼Œä½†æ˜¯å¯èƒ½æ‰©å®¹çš„é‚£æ¬¡putä¼šæ¯”è¾ƒæ…¢ï¼Œå¯ä»¥è€ƒè™‘é«˜æ•ˆæ‰©å®¹ï¼ˆè£…è½½å› å­è§¦è¾¾é˜ˆå€¼æ—¶ï¼Œåªç”³è¯·æ–°ç©ºé—´ï¼Œä¸æ¬è¿æ•°æ®ï¼Œä¹‹åæ¯æ’å…¥ä¸€ä¸ªæ–°æ•°æ®æˆ‘ä»¬ä»æ—§æ•£åˆ—è¡¨æ‹¿ä¸€ä¸ªæ—§æ•°æ®æ”¾åˆ°æ–°æ•£åˆ—è¡¨ï¼Œå¯ä»¥åœ¨æ–°æ•£åˆ—è¡¨åˆ°è¾¾é˜ˆå€¼å‰æ¬è¿å®Œæ¯•ï¼Œåˆ©ç”¨äº†æ‰©å®¹åè£…è½½å› å­å‡åŠçš„ç‰¹æ€§ã€‚ï¼‰ï¼›</li>
</ul>
<p><strong>2.ConcurrentHashMapå’Œhashtableçš„åŒºåˆ«</strong></p>
<ul>
<li><p>ConcurrentHashMapçš„hashè®¡ç®—å…¬å¼ï¼š(key.hascode()^ (key.hascode()&gt;&gt;&gt; 16)) &amp; 0x7FFFFFFF</p>
<p>HashTableçš„hashè®¡ç®—å…¬å¼ï¼škey.hascode()&amp; 0x7FFFFFFF</p>
</li>
<li><p>HashTableå­˜å‚¨æ–¹å¼éƒ½æ˜¯é“¾è¡¨+æ•°ç»„ï¼Œæ•°ç»„é‡Œé¢æ”¾çš„æ˜¯å½“å‰hashçš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼Œé“¾è¡¨é‡Œé¢æ”¾çš„æ˜¯hashå†²çªçš„æ•°æ®</p>
<p>ConcurrentHashMapæ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</p>
</li>
<li><p>é»˜è®¤å®¹é‡éƒ½æ˜¯16ï¼Œè´Ÿè½½å› å­æ˜¯0.75ã€‚å°±æ˜¯å½“hashmapå¡«å……äº†75%çš„busketæ˜¯å°±ä¼šæ‰©å®¹ï¼Œæœ€å°çš„å¯èƒ½æ€§æ˜¯ï¼ˆ16*0.75ï¼‰ï¼Œä¸€èˆ¬ä¸ºåŸå†…å­˜çš„2å€</p>
</li>
<li><p>çº¿ç¨‹å®‰å…¨çš„ä¿è¯ï¼šHashTableæ˜¯åœ¨æ¯ä¸ªæ“ä½œæ–¹æ³•ä¸Šé¢åŠ äº†synchronizedæ¥è¾¾åˆ°çº¿ç¨‹å®‰å…¨ï¼ŒConcurrentHashMapçº¿ç¨‹æ˜¯ä½¿ç”¨CAS(compore and swap)æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„</p>
</li>
<li><p>ConcurrentHashMapå†…éƒ¨åŸç†</p>
<p><strong>1.7ï¼š</strong> put åŠ é”</p>
<p>é€šè¿‡åˆ†æ®µåŠ é” segmentï¼Œput æ•°æ®æ—¶é€šè¿‡ hash(key) å¾—åˆ°è¯¥å…ƒç´ è¦æ·»åŠ åˆ°çš„ segmentï¼Œå¯¹ segment è¿›è¡ŒåŠ é”ï¼Œè¿›è¡Œå† hash å¾—åˆ°è¯¥å…ƒç´ è¦æ·»åŠ åˆ°çš„æ¡¶ï¼Œéå†æ¡¶ä¸­çš„é“¾è¡¨ï¼Œæ›¿æ¢æˆ–æ–°å¢èŠ‚ç‚¹åˆ°æ¡¶ä¸­ã€‚</p>
<p><strong>1.8ï¼š</strong> put CAS åŠ é”</p>
<p>1.8 ä¸­ä»ç„¶æœ‰ segment çš„å®šä¹‰ï¼Œä½†ä¸å†æœ‰ä»»ä½•ç»“æ„ä¸Šçš„ç”¨å¤„ï¼Œsegment æ•°é‡ä¸æ¡¶æ•°é‡ä¸€è‡´ï¼Œä¸ä¾èµ–äº segment åŠ é”ã€‚</p>
<p>é¦–å…ˆï¼Œåˆ¤æ–­å®¹å™¨æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™è¿›è¡Œåˆå§‹åŒ–ï¼Œå¦åˆ™é‡è¯•å¯¹ hash(key) è®¡ç®—å¾—åˆ°è¯¥ key å­˜æ”¾çš„æ¡¶ä½ç½®ï¼Œåˆ¤æ–­è¯¥æ¡¶æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™åˆ©ç”¨ CAS è®¾ç½®æ–°èŠ‚ç‚¹ï¼Œå¦åˆ™ä½¿ç”¨ synchronized åŠ é”ï¼Œéå†æ¡¶ä¸­æ•°æ®ï¼Œæ›¿æ¢æˆ–æ–°å¢åŠ èŠ‚ç‚¹åˆ°æ¡¶ä¸­ï¼Œæœ€ååˆ¤æ–­æ˜¯å¦éœ€è¦è½¬ä¸ºçº¢é»‘æ ‘ï¼Œè½¬æ¢ä¹‹å‰åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚</p>
</li>
</ul>
<p><strong>3.HashMapç»†èŠ‚</strong></p>
<p>æ„é€ å‚æ•°ä¼ è¿›çš„åˆå§‹åŒ–å®¹é‡æ˜¯æ€ä¹ˆâ€œå‘ä¸Šå–æ•´â€çš„ï¼Ÿ<br>é€šè¿‡ n |= n &gt;&gt;&gt; (1,2,4,8,16)çš„æ–¹å¼ï¼Œä½¿å¾—ä½ä½å…¨éƒ¨å¡«æ»¡1ï¼Œæœ€åå†+1å°±æ˜¯æˆ‘ä»¬è¯´çš„æ•°ç»„é•¿åº¦æ˜¯2çš„å¹‚ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a power of two size for the given target capacity.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tableSizeFor</span><span class="params">(<span class="keyword">int</span> cap)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = cap - <span class="number">1</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>JDK1.8ï¼Œå¹¶å‘ç¼–ç¨‹ä¸å†æ­»å¾ªç¯<br>æ—§çš„HashMapæ‰©å®¹çš„æ—¶å€™é“¾æ˜¯åè¿‡æ¥çš„ï¼Œæ¯”å¦‚è¯´æœ¬æ¥æ˜¯a-&gt;b-&gt;cï¼Œå…ˆå–aæ”¾åˆ°æ–°çš„æ•°ç»„ï¼Œå†å–bæ”¾è¿‡å»å°±æˆäº†b-&gt;aï¼ŒåŠ ä¸Šcå°±æ˜¯c-&gt;b-&gt;aï¼Œå¯ä»¥çœ‹è§å¼•ç”¨åè¿‡æ¥äº†ï¼Œå¹¶å‘ç¼–ç¨‹çš„æ—¶å€™ï¼Œå®¹æ˜“é€ æˆå¾ªç¯å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è€ç”Ÿå¸¸è°ˆçš„æ­»å¾ªç¯ã€‚<br>åˆ°äº†1.8å°±ä¸è¿™ä¹ˆå¹²äº†ï¼Œé€šè¿‡<code>(e.hash &amp; oldCap) == 0</code>å»åŒºåˆ†æ‰©å®¹åæ–°èŠ‚ç‚¹ä½ç½®å¯ä»¥è¯´æ˜¯éå¸¸ç²¾å¦™äº†ï¼Œæˆ‘æ˜¯æ„£äº†ä¸€ä¸‹æ‰æƒ³æ˜ç™½ï¼Œç„¶ååˆ†ä¸¤æ¡é“¾ï¼Œé¡ºåºçš„ï¼Œæ¯”å¦‚è¯´åŸæ¥æ—¶a-&gt;b-&gt;c-dï¼Œåˆ†å¼€ä¹‹åå¯èƒ½å°±å˜æˆa-&gt;cå’Œa-&gt;dï¼Œè¿™æ ·ä¾èµ–å°±ä¸å­˜åœ¨å¾ªç¯å¼•ç”¨äº†ï¼Œè€Œä¸”è¿˜æœ€å¤§ç¨‹åº¦ç»´æŠ¤äº†åŸæ¥çš„é¡ºåºã€‚<br>ä¸è¿‡è¿™ä¸ªæ­»å¾ªç¯BUGæ˜¯å› ä¸ºä¼šå¼ºå å¤ªå¤šCPUèµ„æºè¢«é‡è§†ï¼Œè€Œååˆè¢«å¦–é­”åŒ–ï¼ŒHashMapæœ¬æ¥å°±ä¸æ˜¯å¹¶å‘ç¼–ç¨‹çš„å®¹å™¨ï¼Œç”¨åœ¨å¹¶å‘ç¼–ç¨‹ä¸Šæ€»ä¼šæœ‰å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨è¿™ç‚¹ä¸Šç ”ç©¶ä»·å€¼å¤§äºå®ç”¨ä»·å€¼ï¼Œæ¯•ç«Ÿæ²¡è°ä¼šç›´æ¥åœ¨å¹¶å‘ç¼–ç¨‹ä¸‹æ€¼ä¸€ä¸ªHashMapä¸Šå»å§ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                        Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                        Node&lt;K,V&gt; next;</span><br><span class="line">                        <span class="keyword">do</span> &#123;</span><br><span class="line">                            next = e.next;</span><br><span class="line">                            <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                                    loHead = e;</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    loTail.next = e;</span><br><span class="line">                                loTail = e;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                                    hiHead = e;</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    hiTail.next = e;</span><br><span class="line">                                hiTail = e;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<p>put()æ“ä½œçš„ä¼ªä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">        <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">        <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">            tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;K,V&gt; e; K k;</span><br><span class="line">            <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">                ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                e = p;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                        <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                            treeifyBin(tab, hash);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">                V oldValue = e.value;</span><br><span class="line">                <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                    e.value = value;</span><br><span class="line">                afterNodeAccess(e);</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ++modCount;</span><br><span class="line">        <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">            resize();</span><br><span class="line">        afterNodeInsertion(evict);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å°è¯•ç”¨ä¼ªä»£ç è¡¨è¾¾å®ƒçš„é€»è¾‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ )</span><br><span class="line">              æ‰©å®¹æˆé»˜è®¤çš„åˆå§‹å¤§å°</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (å¦‚æœå¯¹åº”å‘ä½æ˜¯<span class="keyword">null</span>)</span><br><span class="line">            ç›´æ¥æ€¼ä¸Šå»;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">           </span><br><span class="line">            <span class="keyword">if</span> (å‘ä½ä¸Šçš„keyè·Ÿæˆ‘è¦åŠ è¿›å»çš„keyç›¸åŒ)</span><br><span class="line">                e=é‚£ä¸ªèŠ‚ç‚¹;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (å¦‚æœä¸‹é¢æŒ‚ç€çš„æ˜¯ä¸€ä¸ªè¯¾çº¢é»‘æ ‘)</span><br><span class="line">                e = ä¸€é¡¿æ“ä½œæŠŠä¿®æ”¹èŠ‚ç‚¹è¿”å›æ¥ï¼Œå¦‚æœæ˜¯æ–°æ’å…¥å°±è¿”å›<span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (å¾ªç¯éå†é“¾ä¸Šçš„èŠ‚ç‚¹) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (æ‰¾åˆ°æœ€åçš„ç©ºä½<span class="keyword">null</span>) &#123;</span><br><span class="line">                        æ€¼ä¸Šå»;</span><br><span class="line">                        <span class="keyword">if</span> (å¦‚æœè¾¾åˆ°çº¢é»‘æ ‘èŠ‚ç‚¹æ•°çš„ä¸´ç•Œå€¼) </span><br><span class="line">                            è½¬æ¢æˆçº¢é»‘æ ‘;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (æ²¡åˆ°<span class="keyword">null</span>ä¹‹å‰çš„æŸä¸ªèŠ‚ç‚¹keyç›¸åŒ)</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (å¦‚æœæ’å…¥èŠ‚ç‚¹æ˜¯æœ¬æ¥å°±å­˜åœ¨çš„ï¼ˆe!=<span class="keyword">null</span>ï¼‰) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">                æ¢æ–°å€¼</span><br><span class="line">                æŠŠæ—§å€¼è¿”å›å»</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        æ“ä½œæ•°+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> (æ‰©å®¹æ£€æµ‹)</span><br><span class="line">           æ‰©å®¹;</span><br><span class="line">        æ²¡æœ‰æ—§å€¼è¿”å›<span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-6-JAVA8çš„ConcurrentHashMapä¸ºä»€ä¹ˆæ”¾å¼ƒäº†åˆ†æ®µé”ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Œå¦‚æœä½ æ¥è®¾è®¡ï¼Œä½ å¦‚ä½•è®¾è®¡ã€‚"><a href="#1-6-JAVA8çš„ConcurrentHashMapä¸ºä»€ä¹ˆæ”¾å¼ƒäº†åˆ†æ®µé”ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Œå¦‚æœä½ æ¥è®¾è®¡ï¼Œä½ å¦‚ä½•è®¾è®¡ã€‚" class="headerlink" title="1.6 JAVA8çš„ConcurrentHashMapä¸ºä»€ä¹ˆæ”¾å¼ƒäº†åˆ†æ®µé”ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Œå¦‚æœä½ æ¥è®¾è®¡ï¼Œä½ å¦‚ä½•è®¾è®¡ã€‚"></a>1.6 JAVA8çš„ConcurrentHashMapä¸ºä»€ä¹ˆæ”¾å¼ƒäº†åˆ†æ®µé”ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Œå¦‚æœä½ æ¥è®¾è®¡ï¼Œä½ å¦‚ä½•è®¾è®¡ã€‚</h4><h5 id="å¼ƒç”¨åŸå› "><a href="#å¼ƒç”¨åŸå› " class="headerlink" title="å¼ƒç”¨åŸå› "></a><strong>å¼ƒç”¨åŸå› </strong></h5><p>é€šè¿‡  JDK çš„æºç å’Œå®˜æ–¹æ–‡æ¡£çœ‹æ¥ï¼Œ ä»–ä»¬è®¤ä¸ºçš„å¼ƒç”¨åˆ†æ®µé”çš„åŸå› ç”±ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>åŠ å…¥å¤šä¸ªåˆ†æ®µé”æµªè´¹å†…å­˜ç©ºé—´ã€‚</li>
<li>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œ map åœ¨æ”¾å…¥æ—¶ç«äº‰åŒä¸€ä¸ªé”çš„æ¦‚ç‡éå¸¸å°ï¼Œåˆ†æ®µé”åè€Œä¼šé€ æˆæ›´æ–°ç­‰æ“ä½œçš„é•¿æ—¶é—´ç­‰å¾…ã€‚</li>
<li>ä¸ºäº†æé«˜ GC çš„æ•ˆç‡</li>
</ol>
<p><strong>PSï¼šå…³äºSegment</strong></p>
<p>ConcurrentHashMapæœ‰3ä¸ªå‚æ•°ï¼š</p>
<ol>
<li>initialCapacityï¼šåˆå§‹æ€»å®¹é‡ï¼Œé»˜è®¤16</li>
<li>loadFactorï¼šåŠ è½½å› å­ï¼Œé»˜è®¤0.75</li>
<li>concurrencyLevelï¼šå¹¶å‘çº§åˆ«ï¼Œé»˜è®¤16</li>
</ol>
<p>å…¶ä¸­å¹¶å‘çº§åˆ«æ§åˆ¶äº†Segmentçš„ä¸ªæ•°ï¼Œåœ¨ä¸€ä¸ªConcurrentHashMapåˆ›å»ºåSegmentçš„ä¸ªæ•°æ˜¯ä¸èƒ½å˜çš„ï¼Œæ‰©å®¹è¿‡ç¨‹è¿‡æ”¹å˜çš„æ˜¯æ¯ä¸ªSegmentçš„å¤§å°ã€‚</p>
<p><strong>PS:å…³äºåˆ†æ®µé”</strong></p>
<p>æ®µSegmentç»§æ‰¿äº†é‡å…¥é”ReentrantLockï¼Œæœ‰äº†é”çš„åŠŸèƒ½ï¼Œæ¯ä¸ªé”æ§åˆ¶çš„æ˜¯ä¸€æ®µï¼Œå½“æ¯ä¸ªSegmentè¶Šæ¥è¶Šå¤§æ—¶ï¼Œé”çš„ç²’åº¦å°±å˜å¾—æœ‰äº›å¤§äº†ã€‚</p>
<ul>
<li>åˆ†æ®µé”çš„ä¼˜åŠ¿åœ¨äºä¿è¯åœ¨æ“ä½œä¸åŒæ®µ map çš„æ—¶å€™å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œæ“ä½œåŒæ®µ map çš„æ—¶å€™ï¼Œè¿›è¡Œé”çš„ç«äº‰å’Œç­‰å¾…ã€‚è¿™ç›¸å¯¹äºç›´æ¥å¯¹æ•´ä¸ªmapåŒæ­¥synchronizedæ˜¯æœ‰ä¼˜åŠ¿çš„ã€‚</li>
<li>ç¼ºç‚¹åœ¨äºåˆ†æˆå¾ˆå¤šæ®µæ—¶ä¼šæ¯”è¾ƒæµªè´¹å†…å­˜ç©ºé—´(ä¸è¿ç»­ï¼Œç¢ç‰‡åŒ–); æ“ä½œmapæ—¶ç«äº‰åŒä¸€ä¸ªåˆ†æ®µé”çš„æ¦‚ç‡éå¸¸å°æ—¶ï¼Œåˆ†æ®µé”åè€Œä¼šé€ æˆæ›´æ–°ç­‰æ“ä½œçš„é•¿æ—¶é—´ç­‰å¾…; å½“æŸä¸ªæ®µå¾ˆå¤§æ—¶ï¼Œåˆ†æ®µé”çš„æ€§èƒ½ä¼šä¸‹é™ã€‚</li>
</ul>
<h5 id="æ–°çš„åŒæ­¥æ–¹æ¡ˆ"><a href="#æ–°çš„åŒæ­¥æ–¹æ¡ˆ" class="headerlink" title="æ–°çš„åŒæ­¥æ–¹æ¡ˆ"></a><strong>æ–°çš„åŒæ­¥æ–¹æ¡ˆ</strong></h5><p>æ—¢ç„¶å¼ƒç”¨äº†åˆ†æ®µé”ï¼Œ é‚£ä¹ˆä¸€å®šç”±æ–°çš„çº¿ç¨‹å®‰å…¨æ–¹æ¡ˆï¼Œ æˆ‘ä»¬æ¥çœ‹çœ‹æºç æ˜¯æ€ä¹ˆè§£å†³çº¿ç¨‹å®‰å…¨çš„å‘¢ï¼Ÿï¼ˆæºç ä¿ç•™äº†segment ä»£ç ï¼Œ ä½†å¹¶æ²¡æœ‰ä½¿ç”¨ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹æ—§ç‰ˆæœ¬ï¼‰</p>
<p>å’Œhashmapä¸€æ ·,jdk 1.8ä¸­ConcurrentHashmapé‡‡ç”¨çš„åº•å±‚æ•°æ®ç»“æ„ä¸ºæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„å½¢å¼ã€‚æ•°ç»„å¯ä»¥æ‰©å®¹ï¼Œé“¾è¡¨å¯ä»¥è½¬åŒ–ä¸ºçº¢é»‘æ ‘ã€‚</p>
<p><strong>ä»€ä¹ˆæ—¶å€™æ‰©å®¹ï¼Ÿ</strong></p>
<ul>
<li>å½“å‰å®¹é‡è¶…è¿‡é˜ˆå€¼</li>
<li>å½“é“¾è¡¨ä¸­å…ƒç´ ä¸ªæ•°è¶…è¿‡é»˜è®¤è®¾å®šï¼ˆ8ä¸ªï¼‰ï¼Œå½“æ•°ç»„çš„å¤§å°è¿˜æœªè¶…è¿‡64çš„æ—¶å€™ï¼Œæ­¤æ—¶è¿›è¡Œæ•°ç»„çš„æ‰©å®¹ï¼Œå¦‚æœè¶…è¿‡åˆ™å°†é“¾è¡¨è½¬åŒ–æˆçº¢é»‘æ ‘</li>
</ul>
<p><strong>ä»€ä¹ˆæ—¶å€™é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Ÿ</strong></p>
<p>å½“æ•°ç»„å¤§å°å·²ç»è¶…è¿‡64å¹¶ä¸”é“¾è¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡é»˜è®¤è®¾å®šï¼ˆ8ä¸ªï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘</p>
<p><strong>put</strong></p>
<p>é¦–å…ˆé€šè¿‡ hash æ‰¾åˆ°å¯¹åº”é“¾è¡¨è¿‡åï¼Œ æŸ¥çœ‹æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ªobjectï¼Œ å¦‚æœæ˜¯ï¼Œ ç›´æ¥ç”¨casåŸåˆ™æ’å…¥ï¼Œæ— éœ€åŠ é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Node&lt;K,V&gt; f; <span class="keyword">int</span> n, i, fh; K fk; V fv;</span><br><span class="line"><span class="keyword">if</span> (tab == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">    tab = initTable(); <span class="comment">// è¿™é‡Œåœ¨æ•´ä¸ªmapç¬¬ä¸€æ¬¡æ“ä½œæ—¶ï¼Œåˆå§‹åŒ–hashæ¡¶ï¼Œ ä¹Ÿå°±æ˜¯ä¸€ä¸ªtable</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i = (n - <span class="number">1</span>) &amp; hash)) == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªobjectï¼Œ åˆ™ç›´æ¥casæ”¾å…¥ï¼Œ ä¸ç”¨é”</span></span><br><span class="line">    <span class="keyword">if</span> (casTabAt(tab, i, <span class="keyword">null</span>, <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key, value)))</span><br><span class="line">        <span class="keyword">break</span>;                   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œ å¦‚æœä¸æ˜¯é“¾è¡¨ç¬¬ä¸€ä¸ªobjectï¼Œ åˆ™ç›´æ¥ç”¨é“¾è¡¨ç¬¬ä¸€ä¸ªobjectåŠ é”ï¼Œè¿™é‡ŒåŠ çš„é”æ˜¯synchronizedï¼Œè™½ç„¶æ•ˆç‡ä¸å¦‚ ReentrantLockï¼Œ ä½†èŠ‚çº¦äº†ç©ºé—´ï¼Œè¿™é‡Œä¼šä¸€ç›´ç”¨ç¬¬ä¸€ä¸ªobjectä¸ºé”ï¼Œ ç›´åˆ°é‡æ–°è®¡ç®—mapå¤§å°ï¼Œ æ¯”å¦‚æ‰©å®¹æˆ–è€…æ“ä½œäº†ç¬¬ä¸€ä¸ªobjectä¸ºæ­¢ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (f) &#123;<span class="comment">// è¿™é‡Œçš„få³ä¸ºç¬¬ä¸€ä¸ªé“¾è¡¨çš„object</span></span><br><span class="line">    <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            binCount = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class="line">                K ek;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((ek = e.key) == key ||</span><br><span class="line">                     (ek != <span class="keyword">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">                    oldVal = e.val;</span><br><span class="line">                    <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                        e.val = value;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Node&lt;K,V&gt; pred = e;</span><br><span class="line">                <span class="keyword">if</span> ((e = e.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    pred.next = <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key, value);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123; <span class="comment">// å¤ªé•¿ä¼šç”¨çº¢é»‘æ ‘</span></span><br><span class="line">            Node&lt;K,V&gt; p;</span><br><span class="line">            binCount = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</span><br><span class="line">                                           value)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                oldVal = p.val;</span><br><span class="line">                <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                    p.val = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> ReservationNode)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Recursive update"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä¸ºä»€ä¹ˆä¸ç”¨ReentrantLockè€Œç”¨synchronized ?</strong></p>
<ul>
<li>å‡å°‘å†…å­˜å¼€é”€:å¦‚æœä½¿ç”¨ReentrantLockåˆ™éœ€è¦èŠ‚ç‚¹ç»§æ‰¿AQSæ¥è·å¾—åŒæ­¥æ”¯æŒï¼Œå¢åŠ å†…å­˜å¼€é”€ï¼Œè€Œ1.8ä¸­åªæœ‰å¤´èŠ‚ç‚¹éœ€è¦è¿›è¡ŒåŒæ­¥ã€‚</li>
<li>å†…éƒ¨ä¼˜åŒ–:synchronizedåˆ™æ˜¯JVMç›´æ¥æ”¯æŒçš„ï¼ŒJVMèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶ä½œå‡ºç›¸åº”çš„ä¼˜åŒ–æªæ–½ï¼šé”ç²—åŒ–ã€é”æ¶ˆé™¤ã€é”è‡ªæ—‹ç­‰ç­‰ã€‚</li>
</ul>
<h4 id="1-7-æœ‰æ²¡æœ‰æœ‰é¡ºåºçš„Mapå®ç°ç±»ï¼Œå¦‚æœæœ‰ï¼Œä»–ä»¬æ˜¯æ€ä¹ˆä¿è¯æœ‰åºçš„ã€‚"><a href="#1-7-æœ‰æ²¡æœ‰æœ‰é¡ºåºçš„Mapå®ç°ç±»ï¼Œå¦‚æœæœ‰ï¼Œä»–ä»¬æ˜¯æ€ä¹ˆä¿è¯æœ‰åºçš„ã€‚" class="headerlink" title="1.7 æœ‰æ²¡æœ‰æœ‰é¡ºåºçš„Mapå®ç°ç±»ï¼Œå¦‚æœæœ‰ï¼Œä»–ä»¬æ˜¯æ€ä¹ˆä¿è¯æœ‰åºçš„ã€‚"></a>1.7 æœ‰æ²¡æœ‰æœ‰é¡ºåºçš„Mapå®ç°ç±»ï¼Œå¦‚æœæœ‰ï¼Œä»–ä»¬æ˜¯æ€ä¹ˆä¿è¯æœ‰åºçš„ã€‚</h4><p>TreeMapå’ŒLinkedHashMapæ˜¯æœ‰åºçš„ï¼ˆTreeMapé»˜è®¤å‡åºï¼ŒLinkedHashMapåˆ™è®°å½•äº†æ’å…¥é¡ºåºï¼‰ã€‚</p>
<p><strong>HashMap</strong>:</p>
<p>â€‹        put -&gt; addEntry(æ–°å»ºä¸€ä¸ªEntry)</p>
<p>â€‹        get</p>
<p>â€‹        getEntry</p>
<p><strong>LinkedHashMap</strong>:</p>
<p>â€‹       put -&gt; addEntry(é‡å†™)</p>
<p>â€‹                æ–°å»ºä¸€ä¸ªEntry,ç„¶åå°†å…¶åŠ å…¥headerå‰</p>
<p>â€‹                e.addBefore(header)</p>
<p>â€‹       get -&gt; è°ƒç”¨HashMapçš„getEntry - recordAccess(é‡å†™)</p>
<p><strong>HashMapçš„getä¸getEntry</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> Entry&lt;K,V&gt; <span class="title">getEntry</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> hash = (key == <span class="keyword">null</span>) ? <span class="number">0</span> : hash(key.hashCode());</span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)];</span><br><span class="line">             e != <span class="keyword">null</span>;</span><br><span class="line">             e = e.next) &#123;</span><br><span class="line">            Object k;</span><br><span class="line">            <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                <span class="keyword">return</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> getForNullKey();</span><br><span class="line">        <span class="keyword">int</span> hash = hash(key.hashCode());</span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)];</span><br><span class="line">             e != <span class="keyword">null</span>;</span><br><span class="line">             e = e.next) &#123;</span><br><span class="line">            Object k;</span><br><span class="line">            <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k)))</span><br><span class="line">                <span class="keyword">return</span> e.value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>LinkedHashMapæ¦‚è¿°ï¼š</li>
</ol>
<p>LinkedHashMapæ˜¯HashMapçš„ä¸€ä¸ªå­ç±»ï¼Œå®ƒ<strong>ä¿ç•™æ’å…¥çš„é¡ºåº</strong>ï¼Œå¦‚æœéœ€è¦è¾“å‡ºçš„é¡ºåºå’Œè¾“å…¥æ—¶çš„ç›¸åŒï¼Œé‚£ä¹ˆå°±é€‰ç”¨LinkedHashMapã€‚</p>
<p>LinkedHashMapæ˜¯Mapæ¥å£çš„å“ˆå¸Œè¡¨å’Œé“¾æ¥åˆ—è¡¨å®ç°ï¼Œå…·æœ‰å¯é¢„çŸ¥çš„è¿­ä»£é¡ºåºã€‚æ­¤å®ç°æä¾›æ‰€æœ‰å¯é€‰çš„æ˜ å°„æ“ä½œï¼Œå¹¶<strong>å…è®¸ä½¿ç”¨nullå€¼å’Œnullé”®</strong>ã€‚æ­¤ç±»ä¸ä¿è¯æ˜ å°„çš„é¡ºåºï¼Œç‰¹åˆ«æ˜¯å®ƒ<strong>ä¸ä¿è¯è¯¥é¡ºåºæ’ä¹…ä¸å˜</strong>ã€‚<br>LinkedHashMapå®ç°ä¸HashMapçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œåè€…ç»´æŠ¤ç€ä¸€ä¸ªè¿è¡Œäºæ‰€æœ‰æ¡ç›®çš„åŒé‡é“¾æ¥åˆ—è¡¨ã€‚æ­¤é“¾æ¥åˆ—è¡¨å®šä¹‰äº†è¿­ä»£é¡ºåºï¼Œè¯¥è¿­ä»£é¡ºåºå¯ä»¥æ˜¯æ’å…¥é¡ºåºæˆ–è€…æ˜¯è®¿é—®é¡ºåºã€‚<br>æ³¨æ„ï¼Œæ­¤å®ç°ä¸æ˜¯åŒæ­¥çš„ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®é“¾æ¥çš„å“ˆå¸Œæ˜ å°„ï¼Œè€Œå…¶ä¸­è‡³å°‘ä¸€ä¸ªçº¿ç¨‹ä»ç»“æ„ä¸Šä¿®æ”¹äº†è¯¥æ˜ å°„ï¼Œåˆ™å®ƒå¿…é¡»ä¿æŒå¤–éƒ¨åŒæ­¥ã€‚</p>
<p>æ ¹æ®é“¾è¡¨ä¸­å…ƒç´ çš„é¡ºåºå¯ä»¥åˆ†ä¸ºï¼š<strong>æŒ‰æ’å…¥é¡ºåºçš„é“¾è¡¨ï¼Œå’ŒæŒ‰è®¿é—®é¡ºåº(è°ƒç”¨getæ–¹æ³•)çš„é“¾è¡¨ã€‚</strong>  </p>
<p>é»˜è®¤æ˜¯æŒ‰æ’å…¥é¡ºåºæ’åºï¼Œå¦‚æœæŒ‡å®šæŒ‰è®¿é—®é¡ºåºæ’åºï¼Œé‚£ä¹ˆè°ƒç”¨getæ–¹æ³•åï¼Œä¼šå°†è¿™æ¬¡è®¿é—®çš„å…ƒç´ ç§»è‡³é“¾è¡¨å°¾éƒ¨ï¼Œä¸æ–­è®¿é—®å¯ä»¥å½¢æˆæŒ‰è®¿é—®é¡ºåºæ’åºçš„é“¾è¡¨ã€‚  å¯ä»¥é‡å†™removeEldestEntryæ–¹æ³•è¿”å›trueå€¼æŒ‡å®šæ’å…¥å…ƒç´ æ—¶ç§»é™¤æœ€è€çš„å…ƒç´ ã€‚ </p>
<ol start="2">
<li>LinkedHashMapçš„å®ç°ï¼š</li>
</ol>
<p>å¯¹äºLinkedHashMapè€Œè¨€ï¼Œå®ƒç»§æ‰¿ä¸HashMapã€åº•å±‚ä½¿ç”¨å“ˆå¸Œè¡¨ä¸åŒå‘é“¾è¡¨æ¥ä¿å­˜æ‰€æœ‰å…ƒç´ ã€‚å…¶åŸºæœ¬æ“ä½œä¸çˆ¶ç±»HashMapç›¸ä¼¼ï¼Œå®ƒé€šè¿‡é‡å†™çˆ¶ç±»ç›¸å…³çš„æ–¹æ³•ï¼Œæ¥å®ç°è‡ªå·±çš„é“¾æ¥åˆ—è¡¨ç‰¹æ€§ã€‚ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æLinkedHashMapçš„æºä»£ç ï¼š</p>
<p><strong>ç±»ç»“æ„ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedHashMap</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">HashMap</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> 1) æˆå‘˜å˜é‡ï¼š</p>
<p>LinkedHashMapé‡‡ç”¨çš„hashç®—æ³•å’ŒHashMapç›¸åŒï¼Œä½†æ˜¯å®ƒé‡æ–°å®šä¹‰äº†æ•°ç»„ä¸­ä¿å­˜çš„å…ƒç´ Entryï¼Œè¯¥Entryé™¤äº†ä¿å­˜å½“å‰å¯¹è±¡çš„å¼•ç”¨å¤–ï¼Œè¿˜ä¿å­˜äº†å…¶ä¸Šä¸€ä¸ªå…ƒç´ beforeå’Œä¸‹ä¸€ä¸ªå…ƒç´ afterçš„å¼•ç”¨ï¼Œä»è€Œåœ¨å“ˆå¸Œè¡¨çš„åŸºç¡€ä¸Šåˆæ„æˆäº†åŒå‘é“¾æ¥åˆ—è¡¨ã€‚çœ‹æºä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//trueè¡¨ç¤ºæŒ‰ç…§è®¿é—®é¡ºåºè¿­ä»£ï¼Œfalseæ—¶è¡¨ç¤ºæŒ‰ç…§æ’å…¥é¡ºåº</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> accessOrder;</span><br><span class="line"> <span class="comment">/** </span></span><br><span class="line"><span class="comment"> * åŒå‘é“¾è¡¨çš„è¡¨å¤´å…ƒç´ ã€‚ </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Entry&lt;K,V&gt; header;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * LinkedHashMapçš„Entryå…ƒç´ ã€‚ </span></span><br><span class="line"><span class="comment"> * ç»§æ‰¿HashMapçš„Entryå…ƒç´ ï¼Œåˆä¿å­˜äº†å…¶ä¸Šä¸€ä¸ªå…ƒç´ beforeå’Œä¸‹ä¸€ä¸ªå…ƒç´ afterçš„å¼•ç”¨ã€‚ </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">HashMap</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;  </span><br><span class="line">    Entry&lt;K,V&gt; before, after;  </span><br><span class="line">    â€¦â€¦  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HashMap.Entry:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> K key;</span><br><span class="line">        V value;</span><br><span class="line">        Entry&lt;K,V&gt; next;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line"></span><br><span class="line">        Entry(<span class="keyword">int</span> h, K k, V v, Entry&lt;K,V&gt; n) &#123;</span><br><span class="line">            value = v;</span><br><span class="line">            next = n;</span><br><span class="line">            key = k;</span><br><span class="line">            hash = h;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 2) åˆå§‹åŒ–ï¼š</p>
<p>é€šè¿‡æºä»£ç å¯ä»¥çœ‹å‡ºï¼Œåœ¨LinkedHashMapçš„æ„é€ æ–¹æ³•ä¸­ï¼Œå®é™…è°ƒç”¨äº†çˆ¶ç±»HashMapçš„ç›¸å…³æ„é€ æ–¹æ³•æ¥æ„é€ ä¸€ä¸ªåº•å±‚å­˜æ”¾çš„tableæ•°ç»„ã€‚å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">super</span>(initialCapacity, loadFactor);  </span><br><span class="line">    accessOrder = <span class="keyword">false</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> HashMapä¸­çš„ç›¸å…³æ„é€ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal initial capacity: "</span> +  </span><br><span class="line">                                           initialCapacity);  </span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)  </span><br><span class="line">        initialCapacity = MAXIMUM_CAPACITY;  </span><br><span class="line">    <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor))  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal load factor: "</span> +  </span><br><span class="line">                                           loadFactor);  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Find a power of 2 &gt;= initialCapacity  </span></span><br><span class="line">    <span class="keyword">int</span> capacity = <span class="number">1</span>;  </span><br><span class="line">    <span class="keyword">while</span> (capacity &lt; initialCapacity)  </span><br><span class="line">        capacity &lt;&lt;= <span class="number">1</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">this</span>.loadFactor = loadFactor;  </span><br><span class="line">    threshold = (<span class="keyword">int</span>)(capacity * loadFactor);  </span><br><span class="line">    table = <span class="keyword">new</span> Entry[capacity];  </span><br><span class="line">    init();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å·²ç»çŸ¥é“LinkedHashMapçš„Entryå…ƒç´ ç»§æ‰¿HashMapçš„Entryï¼Œæä¾›äº†åŒå‘é“¾è¡¨çš„åŠŸèƒ½ã€‚åœ¨ä¸Šè¿°HashMapçš„æ„é€ å™¨ä¸­ï¼Œæœ€åä¼šè°ƒç”¨init()æ–¹æ³•ï¼Œè¿›è¡Œç›¸å…³çš„åˆå§‹åŒ–ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨HashMapçš„å®ç°ä¸­å¹¶æ— æ„ä¹‰ï¼Œåªæ˜¯æä¾›ç»™å­ç±»å®ç°ç›¸å…³çš„åˆå§‹åŒ–è°ƒç”¨ã€‚   </p>
<p>LinkedHashMapé‡å†™äº†init()æ–¹æ³•ï¼Œåœ¨è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•å®Œæˆæ„é€ åï¼Œè¿›ä¸€æ­¥å®ç°äº†å¯¹å…¶å…ƒç´ Entryçš„åˆå§‹åŒ–æ“ä½œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    header = <span class="keyword">new</span> Entry&lt;K,V&gt;(-<span class="number">1</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);  </span><br><span class="line">    header.before = header.after = header;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3) å­˜å‚¨ï¼š</p>
<p>LinkedHashMapå¹¶æœªé‡å†™çˆ¶ç±»HashMapçš„putæ–¹æ³•ï¼Œè€Œæ˜¯é‡å†™äº†çˆ¶ç±»HashMapçš„putæ–¹æ³•è°ƒç”¨çš„å­æ–¹æ³•void recordAccess(HashMap m)  ï¼Œvoid addEntry(int hash, K key, V value, int bucketIndex) å’Œvoid createEntry(int hash, K key, V value, int bucketIndex)ï¼Œæä¾›äº†è‡ªå·±ç‰¹æœ‰çš„åŒå‘é“¾æ¥åˆ—è¡¨çš„å®ç°ã€‚</p>
<p><strong>HashMap.put:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> putForNullKey(value);</span><br><span class="line">        <span class="keyword">int</span> hash = hash(key.hashCode());</span><br><span class="line">        <span class="keyword">int</span> i = indexFor(hash, table.length);</span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">            Object k;</span><br><span class="line">            <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;</span><br><span class="line">                V oldValue = e.value;</span><br><span class="line">                e.value = value;</span><br><span class="line">                e.recordAccess(<span class="keyword">this</span>);</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        modCount++;</span><br><span class="line">        addEntry(hash, key, value, i);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p> é‡å†™æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recordAccess</span><span class="params">(HashMap&lt;K,V&gt; m)</span> </span>&#123;</span><br><span class="line">            LinkedHashMap&lt;K,V&gt; lm = (LinkedHashMap&lt;K,V&gt;)m;</span><br><span class="line">            <span class="keyword">if</span> (lm.accessOrder) &#123;</span><br><span class="line">                lm.modCount++;</span><br><span class="line">                remove();</span><br><span class="line">                addBefore(lm.header);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> bucketIndex)</span> </span>&#123;  </span><br><span class="line">    <span class="comment">// è°ƒç”¨createæ–¹æ³•ï¼Œå°†æ–°å…ƒç´ ä»¥åŒå‘é“¾è¡¨çš„çš„å½¢å¼åŠ å…¥åˆ°æ˜ å°„ä¸­ã€‚  </span></span><br><span class="line">    createEntry(hash, key, value, bucketIndex);  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨å…ƒç´ çš„ç­–ç•¥å®šä¹‰  </span></span><br><span class="line">    Entry&lt;K,V&gt; eldest = header.after;  </span><br><span class="line">    <span class="keyword">if</span> (removeEldestEntry(eldest)) &#123;  </span><br><span class="line">        removeEntryForKey(eldest.key);  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (size &gt;= threshold)  </span><br><span class="line">            resize(<span class="number">2</span> * table.length);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">createEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> bucketIndex)</span> </span>&#123;  </span><br><span class="line">    HashMap.Entry&lt;K,V&gt; old = table[bucketIndex];  </span><br><span class="line">    Entry&lt;K,V&gt; e = <span class="keyword">new</span> Entry&lt;K,V&gt;(hash, key, value, old);  </span><br><span class="line">    table[bucketIndex] = e;  </span><br><span class="line">    <span class="comment">// è°ƒç”¨å…ƒç´ çš„addBreforeæ–¹æ³•ï¼Œå°†å…ƒç´ åŠ å…¥åˆ°å“ˆå¸Œã€åŒå‘é“¾æ¥åˆ—è¡¨ã€‚  </span></span><br><span class="line">    e.addBefore(header);  </span><br><span class="line">    size++;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addBefore</span><span class="params">(Entry&lt;K,V&gt; existingEntry)</span> </span>&#123;  </span><br><span class="line">    after  = existingEntry;  </span><br><span class="line">    before = existingEntry.before;  </span><br><span class="line">    before.after = <span class="keyword">this</span>;  </span><br><span class="line">    after.before = <span class="keyword">this</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4) è¯»å–ï¼š</p>
<p>LinkedHashMapé‡å†™äº†çˆ¶ç±»HashMapçš„getæ–¹æ³•ï¼Œå®é™…åœ¨è°ƒç”¨çˆ¶ç±»getEntry()æ–¹æ³•å–å¾—æŸ¥æ‰¾çš„å…ƒç´ åï¼Œå†åˆ¤æ–­å½“æ’åºæ¨¡å¼accessOrderä¸ºtrueæ—¶ï¼Œè®°å½•è®¿é—®é¡ºåºï¼Œå°†æœ€æ–°è®¿é—®çš„å…ƒç´ æ·»åŠ åˆ°åŒå‘é“¾è¡¨çš„è¡¨å¤´ï¼Œå¹¶ä»åŸæ¥çš„ä½ç½®åˆ é™¤ã€‚ç”±äºçš„é“¾è¡¨çš„å¢åŠ ã€åˆ é™¤æ“ä½œæ˜¯å¸¸é‡çº§çš„ï¼Œæ•…å¹¶ä¸ä¼šå¸¦æ¥æ€§èƒ½çš„æŸå¤±ã€‚</p>
<p><strong>HashMap.containsValue:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsValue</span><span class="params">(Object value)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (value == <span class="keyword">null</span>)  </span><br><span class="line">            <span class="keyword">return</span> containsNullValue();  </span><br><span class="line">  </span><br><span class="line">    Entry[] tab = table;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tab.length ; i++)  </span><br><span class="line">            <span class="keyword">for</span> (Entry e = tab[i] ; e != <span class="keyword">null</span> ; e = e.next)  </span><br><span class="line">                <span class="keyword">if</span> (value.equals(e.value))  </span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line"> <span class="comment">/*æŸ¥æ‰¾Mapä¸­æ˜¯å¦åŒ…å«ç»™å®šçš„valueï¼Œè¿˜æ˜¯è€ƒè™‘åˆ°ï¼ŒLinkedHashMapæ‹¥æœ‰çš„åŒé“¾è¡¨ï¼Œåœ¨è¿™é‡ŒOverrideæ˜¯ä¸ºäº†æé«˜è¿­ä»£çš„æ•ˆç‡ã€‚ </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsValue</span><span class="params">(Object value)</span> </span>&#123;  </span><br><span class="line">        <span class="comment">// Overridden to take advantage of faster iterator  </span></span><br><span class="line">        <span class="keyword">if</span> (value==<span class="keyword">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">for</span> (Entry e = header.after; e != header; e = e.after)  </span><br><span class="line">                <span class="keyword">if</span> (e.value==<span class="keyword">null</span>)  </span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            <span class="keyword">for</span> (Entry e = header.after; e != header; e = e.after)  </span><br><span class="line">                <span class="keyword">if</span> (value.equals(e.value))  </span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line"><span class="comment">/*è¯¥transfer()æ˜¯HashMapä¸­çš„å®ç°ï¼šéå†æ•´ä¸ªè¡¨çš„å„ä¸ªæ¡¶ä½ï¼Œç„¶åå¯¹æ¡¶è¿›è¡Œéå†å¾—åˆ°æ¯ä¸€ä¸ªEntryï¼Œé‡æ–°hashåˆ°newTableä¸­ï¼Œ </span></span><br><span class="line"><span class="comment"> //æ”¾åœ¨è¿™é‡Œæ˜¯ä¸ºäº†å’Œä¸‹é¢LinkedHashMapé‡å†™è¯¥æ³•çš„æ¯”è¾ƒï¼Œ </span></span><br><span class="line"><span class="comment"> void transfer(Entry[] newTable) &#123; </span></span><br><span class="line"><span class="comment">        Entry[] src = table; </span></span><br><span class="line"><span class="comment">        int newCapacity = newTable.length; </span></span><br><span class="line"><span class="comment">        for (int j = 0; j &lt; src.length; j++) &#123; </span></span><br><span class="line"><span class="comment">            Entry&lt;K,V&gt; e = src[j]; </span></span><br><span class="line"><span class="comment">            if (e != null) &#123; </span></span><br><span class="line"><span class="comment">                src[j] = null; </span></span><br><span class="line"><span class="comment">                do &#123; </span></span><br><span class="line"><span class="comment">                    Entry&lt;K,V&gt; next = e.next; </span></span><br><span class="line"><span class="comment">                    int i = indexFor(e.hash, newCapacity); </span></span><br><span class="line"><span class="comment">                    e.next = newTable[i]; </span></span><br><span class="line"><span class="comment">                    newTable[i] = e; </span></span><br><span class="line"><span class="comment">                    e = next; </span></span><br><span class="line"><span class="comment">                &#125; while (e != null); </span></span><br><span class="line"><span class="comment">            &#125; </span></span><br><span class="line"><span class="comment">        &#125; </span></span><br><span class="line"><span class="comment">    &#125; </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line">  </span><br><span class="line"> <span class="comment">/** </span></span><br><span class="line"><span class="comment"> *transfer()æ–¹æ³•æ˜¯å…¶çˆ¶ç±»HashMapè°ƒç”¨resize()çš„æ—¶å€™è°ƒç”¨çš„æ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯è¡¨æ‰©å®¹åï¼ŒæŠŠæ—§è¡¨ä¸­çš„keyé‡æ–°hashåˆ°æ–°çš„è¡¨ä¸­ã€‚ </span></span><br><span class="line"><span class="comment"> *è¿™é‡Œä»å†™äº†çˆ¶ç±»HashMapä¸­çš„è¯¥æ–¹æ³•ï¼Œæ˜¯å› ä¸ºè€ƒè™‘åˆ°ï¼ŒLinkedHashMapæ‹¥æœ‰çš„åŒé“¾è¡¨ï¼Œåœ¨è¿™é‡ŒOverrideæ˜¯ä¸ºäº†æé«˜è¿­ä»£çš„æ•ˆç‡ã€‚ </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(HashMap.Entry[] newTable)</span> </span>&#123;  </span><br><span class="line">   <span class="keyword">int</span> newCapacity = newTable.length;  </span><br><span class="line">   <span class="keyword">for</span> (Entry&lt;K, V&gt; e = header.after; e != header; e = e.after) &#123;  </span><br><span class="line">     <span class="keyword">int</span> index = indexFor(e.hash, newCapacity);  </span><br><span class="line">     e.next = newTable[index];  </span><br><span class="line">     newTable[index] = e;  </span><br><span class="line">   &#125;  </span><br><span class="line"> &#125;  </span><br><span class="line"> <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;  </span><br><span class="line">    <span class="comment">// è°ƒç”¨çˆ¶ç±»HashMapçš„getEntry()æ–¹æ³•ï¼Œå–å¾—è¦æŸ¥æ‰¾çš„å…ƒç´ ã€‚  </span></span><br><span class="line">    Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;)getEntry(key);  </span><br><span class="line">    <span class="keyword">if</span> (e == <span class="keyword">null</span>)  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">    <span class="comment">// è®°å½•è®¿é—®é¡ºåºã€‚  </span></span><br><span class="line">    e.recordAccess(<span class="keyword">this</span>);  </span><br><span class="line">    <span class="keyword">return</span> e.value;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recordAccess</span><span class="params">(HashMap&lt;K,V&gt; m)</span> </span>&#123;  </span><br><span class="line">    LinkedHashMap&lt;K,V&gt; lm = (LinkedHashMap&lt;K,V&gt;)m;  </span><br><span class="line">    <span class="comment">// å¦‚æœå®šä¹‰äº†LinkedHashMapçš„è¿­ä»£é¡ºåºä¸ºè®¿é—®é¡ºåºï¼Œ  </span></span><br><span class="line">    <span class="comment">// åˆ™åˆ é™¤ä»¥å‰ä½ç½®ä¸Šçš„å…ƒç´ ï¼Œå¹¶å°†æœ€æ–°è®¿é—®çš„å…ƒç´ æ·»åŠ åˆ°é“¾è¡¨è¡¨å¤´ã€‚  </span></span><br><span class="line">    <span class="keyword">if</span> (lm.accessOrder) &#123;  </span><br><span class="line">        lm.modCount++;  </span><br><span class="line">        remove();  </span><br><span class="line">        addBefore(lm.header);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * Removes this entry from the linked list. </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">     before.after = after;  </span><br><span class="line">     after.before = before;  </span><br><span class="line"> &#125;  </span><br><span class="line"><span class="comment">/**clearé“¾è¡¨ï¼Œè®¾ç½®headerä¸ºåˆå§‹çŠ¶æ€*/</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;  </span><br><span class="line"> <span class="keyword">super</span>.clear();  </span><br><span class="line"> header.before = header.after = header;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 5) æ’åºæ¨¡å¼ï¼š</p>
<p>LinkedHashMapå®šä¹‰äº†æ’åºæ¨¡å¼accessOrderï¼Œè¯¥å±æ€§ä¸ºbooleanå‹å˜é‡ï¼Œå¯¹äºè®¿é—®é¡ºåºï¼Œä¸ºtrueï¼›å¯¹äºæ’å…¥é¡ºåºï¼Œåˆ™ä¸ºfalseã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> accessOrder;</span><br></pre></td></tr></table></figure>
<p> ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å¿…æŒ‡å®šæ’åºæ¨¡å¼ï¼Œå…¶è¿­ä»£é¡ºåºå³ä¸ºé»˜è®¤ä¸ºæ’å…¥é¡ºåºã€‚çœ‹LinkedHashMapçš„æ„é€ æ–¹æ³•ï¼Œå¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">super</span>(initialCapacity, loadFactor);  </span><br><span class="line">    accessOrder = <span class="keyword">false</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™äº›æ„é€ æ–¹æ³•éƒ½ä¼šé»˜è®¤æŒ‡å®šæ’åºæ¨¡å¼ä¸ºæ’å…¥é¡ºåºã€‚å¦‚æœä½ æƒ³æ„é€ ä¸€ä¸ªLinkedHashMapï¼Œå¹¶æ‰“ç®—æŒ‰ä»è¿‘æœŸè®¿é—®æœ€å°‘åˆ°è¿‘æœŸè®¿é—®æœ€å¤šçš„é¡ºåºï¼ˆå³è®¿é—®é¡ºåºï¼‰æ¥ä¿å­˜å…ƒç´ ï¼Œé‚£ä¹ˆè¯·ä½¿ç”¨ä¸‹é¢çš„æ„é€ æ–¹æ³•æ„é€ LinkedHashMapï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity,  </span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">float</span> loadFactor,  </span></span></span><br><span class="line"><span class="function"><span class="params">                     <span class="keyword">boolean</span> accessOrder)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">super</span>(initialCapacity, loadFactor);  </span><br><span class="line">    <span class="keyword">this</span>.accessOrder = accessOrder;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥å“ˆå¸Œæ˜ å°„çš„è¿­ä»£é¡ºåºå°±æ˜¯æœ€åè®¿é—®å…¶æ¡ç›®çš„é¡ºåºï¼Œè¿™ç§æ˜ å°„å¾ˆé€‚åˆæ„å»ºLRUç¼“å­˜ã€‚LinkedHashMapæä¾›äº†removeEldestEntry(Map.Entry&lt;K,V&gt; eldest)æ–¹æ³•ã€‚è¯¥æ–¹æ³•å¯ä»¥æä¾›åœ¨æ¯æ¬¡æ·»åŠ æ–°æ¡ç›®æ—¶ç§»é™¤æœ€æ—§æ¡ç›®çš„å®ç°ç¨‹åºï¼Œé»˜è®¤è¿”å›falseï¼Œè¿™æ ·ï¼Œæ­¤æ˜ å°„çš„è¡Œä¸ºå°†ç±»ä¼¼äºæ­£å¸¸æ˜ å°„ï¼Œå³æ°¸è¿œä¸èƒ½ç§»é™¤æœ€æ—§çš„å…ƒç´ ã€‚</p>
<p>å½“æœ‰æ–°å…ƒç´ åŠ å…¥Mapçš„æ—¶å€™ä¼šè°ƒç”¨Entryçš„addEntryæ–¹æ³•ï¼Œä¼šè°ƒç”¨removeEldestEntryæ–¹æ³•ï¼Œè¿™é‡Œå°±æ˜¯å®ç°LRUå…ƒç´ è¿‡æœŸæœºåˆ¶çš„åœ°æ–¹ï¼Œé»˜è®¤çš„æƒ…å†µä¸‹removeEldestEntryæ–¹æ³•åªè¿”å›falseè¡¨ç¤ºå…ƒç´ æ°¸è¿œä¸è¿‡æœŸã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">    * This override alters behavior of superclass put method. It causes newly </span></span><br><span class="line"><span class="comment">    * allocated entry to get inserted at the end of the linked list and </span></span><br><span class="line"><span class="comment">    * removes the eldest entry if appropriate. </span></span><br><span class="line"><span class="comment">    */</span>  </span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">addEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> bucketIndex)</span> </span>&#123;  </span><br><span class="line">       createEntry(hash, key, value, bucketIndex);  </span><br><span class="line">  </span><br><span class="line">       <span class="comment">// Remove eldest entry if instructed, else grow capacity if appropriate  </span></span><br><span class="line">       Entry&lt;K,V&gt; eldest = header.after;  </span><br><span class="line">       <span class="keyword">if</span> (removeEldestEntry(eldest)) &#123;  </span><br><span class="line">           removeEntryForKey(eldest.key);  </span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">           <span class="keyword">if</span> (size &gt;= threshold)   </span><br><span class="line">               resize(<span class="number">2</span> * table.length);  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">  </span><br><span class="line">   <span class="comment">/** </span></span><br><span class="line"><span class="comment">    * This override differs from addEntry in that it doesn't resize the </span></span><br><span class="line"><span class="comment">    * table or remove the eldest entry. </span></span><br><span class="line"><span class="comment">    */</span>  </span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">createEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> bucketIndex)</span> </span>&#123;  </span><br><span class="line">       HashMap.Entry&lt;K,V&gt; old = table[bucketIndex];  </span><br><span class="line">Entry&lt;K,V&gt; e = <span class="keyword">new</span> Entry&lt;K,V&gt;(hash, key, value, old);  </span><br><span class="line">       table[bucketIndex] = e;  </span><br><span class="line">       e.addBefore(header);  </span><br><span class="line">       size++;  </span><br><span class="line">   &#125;  </span><br><span class="line">  </span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">removeEldestEntry</span><span class="params">(Map.Entry&lt;K,V&gt; eldest)</span> </span>&#123;  </span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ–¹æ³•é€šå¸¸ä¸ä»¥ä»»ä½•æ–¹å¼ä¿®æ”¹æ˜ å°„ï¼Œç›¸åå…è®¸æ˜ å°„åœ¨å…¶è¿”å›å€¼çš„æŒ‡å¼•ä¸‹è¿›è¡Œè‡ªæˆ‘ä¿®æ”¹ã€‚å¦‚æœç”¨æ­¤æ˜ å°„æ„å»ºLRUç¼“å­˜ï¼Œåˆ™éå¸¸æ–¹ä¾¿ï¼Œå®ƒå…è®¸æ˜ å°„é€šè¿‡åˆ é™¤æ—§æ¡ç›®æ¥å‡å°‘å†…å­˜æŸè€—ã€‚</p>
<p>ä¾‹å¦‚ï¼šé‡å†™æ­¤æ–¹æ³•ï¼Œç»´æŒæ­¤æ˜ å°„åªä¿å­˜100ä¸ªæ¡ç›®çš„ç¨³å®šçŠ¶æ€ï¼Œåœ¨æ¯æ¬¡æ·»åŠ æ–°æ¡ç›®æ—¶åˆ é™¤æœ€æ—§çš„æ¡ç›®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_ENTRIES = <span class="number">100</span>;  </span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">removeEldestEntry</span><span class="params">(Map.Entry eldest)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> size() &gt; MAX_ENTRIES;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://tomyz0223.iteye.com/blog/1035686" target="_blank" rel="noopener">ä½¿ç”¨LinkedHashMapæ„å»ºLRUçš„</a></p>
<p><a href="http://woming66.iteye.com/blog/1284326" target="_blank" rel="noopener">åŸºäºLinkedHashMapå®ç°LRU</a></p>
<p>å…¶å®LinkedHashMapå‡ ä¹å’ŒHashMapä¸€æ ·ï¼Œä¸åŒçš„æ˜¯å®ƒå®šä¹‰äº†ä¸€ä¸ªEntry&lt;K,V&gt; headerï¼Œè¿™ä¸ªheaderä¸æ˜¯æ”¾åœ¨Tableé‡Œï¼Œå®ƒæ˜¯é¢å¤–ç‹¬ç«‹å‡ºæ¥çš„ã€‚LinkedHashMapé€šè¿‡ç»§æ‰¿hashMapä¸­çš„Entry&lt;K,V&gt;,å¹¶æ·»åŠ ä¸¤ä¸ªå±æ€§Entry&lt;K,V&gt;  before,after,å’Œheaderç»“åˆèµ·æ¥ç»„æˆä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæ¥å®ç°æŒ‰æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºæ’åºã€‚</p>
<h4 id="1-8-æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«ï¼Œç±»å¯ä»¥ç»§æ‰¿å¤šä¸ªç±»ä¹ˆï¼Œæ¥å£å¯ä»¥ç»§æ‰¿å¤šä¸ªæ¥å£ä¹ˆ-ç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ä¹ˆã€‚"><a href="#1-8-æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«ï¼Œç±»å¯ä»¥ç»§æ‰¿å¤šä¸ªç±»ä¹ˆï¼Œæ¥å£å¯ä»¥ç»§æ‰¿å¤šä¸ªæ¥å£ä¹ˆ-ç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ä¹ˆã€‚" class="headerlink" title="1.8 æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«ï¼Œç±»å¯ä»¥ç»§æ‰¿å¤šä¸ªç±»ä¹ˆï¼Œæ¥å£å¯ä»¥ç»§æ‰¿å¤šä¸ªæ¥å£ä¹ˆ,ç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ä¹ˆã€‚"></a>1.8 æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«ï¼Œç±»å¯ä»¥ç»§æ‰¿å¤šä¸ªç±»ä¹ˆï¼Œæ¥å£å¯ä»¥ç»§æ‰¿å¤šä¸ªæ¥å£ä¹ˆ,ç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ä¹ˆã€‚</h4><p>1ã€æŠ½è±¡ç±»å’Œæ¥å£éƒ½ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼Œå¦‚æœè¦å®ä¾‹åŒ–ï¼ŒæŠ½è±¡ç±»å˜é‡å¿…é¡»æŒ‡å‘å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•çš„å­ç±»å¯¹è±¡ï¼Œæ¥å£å˜é‡å¿…é¡»æŒ‡å‘å®ç°æ‰€æœ‰æ¥å£æ–¹æ³•çš„ç±»å¯¹è±¡ã€‚</p>
<p>2ã€æŠ½è±¡ç±»è¦è¢«å­ç±»ç»§æ‰¿ï¼Œæ¥å£è¦è¢«ç±»å®ç°ã€‚</p>
<p>3ã€æ¥å£åªèƒ½åšæ–¹æ³•ç”³æ˜ï¼ŒæŠ½è±¡ç±»ä¸­å¯ä»¥åšæ–¹æ³•ç”³æ˜ï¼Œä¹Ÿå¯ä»¥åšæ–¹æ³•å®ç°</p>
<p>4ã€æ¥å£é‡Œå®šä¹‰çš„å˜é‡åªèƒ½æ˜¯å…¬å…±çš„é™æ€çš„å¸¸é‡ï¼ŒæŠ½è±¡ç±»ä¸­çš„å˜é‡æ˜¯æ™®é€šå˜é‡ã€‚</p>
<p>5ã€æŠ½è±¡ç±»é‡Œçš„æŠ½è±¡æ–¹æ³•å¿…é¡»å…¨éƒ¨è¢«å­ç±»æ‰€å®ç°ï¼Œå¦‚æœå­ç±»ä¸èƒ½å…¨éƒ¨å®ç°çˆ¶ç±»æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥å­ç±»åªèƒ½æ˜¯æŠ½è±¡ç±»ã€‚åŒæ ·ï¼Œä¸€ä¸ªå®ç°æ¥å£çš„æ—¶å€™ï¼Œå¦‚ä¸èƒ½å…¨éƒ¨å®ç°æ¥å£æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥ç±»ä¹Ÿåªèƒ½ä¸ºæŠ½è±¡ç±»ã€‚</p>
<p>6ã€æŠ½è±¡æ–¹æ³•åªèƒ½ç”³æ˜ï¼Œä¸èƒ½å®ç°ã€‚abstract void abc();ä¸èƒ½å†™æˆabstract void abc(){}ã€‚</p>
<p>7ã€æŠ½è±¡ç±»é‡Œå¯ä»¥æ²¡æœ‰æŠ½è±¡æ–¹æ³•</p>
<p>8ã€å¦‚æœä¸€ä¸ªç±»é‡Œæœ‰æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»åªèƒ½æ˜¯æŠ½è±¡ç±»</p>
<p>9ã€æŠ½è±¡æ–¹æ³•è¦è¢«å®ç°ï¼Œæ‰€ä»¥ä¸èƒ½æ˜¯é™æ€çš„ï¼Œä¹Ÿä¸èƒ½æ˜¯ç§æœ‰çš„ã€‚</p>
<p>10ã€æ¥å£å¯ç»§æ‰¿æ¥å£ï¼Œå¹¶å¯å¤šç»§æ‰¿æ¥å£ï¼Œä½†ç±»åªèƒ½å•æ ¹ç»§æ‰¿ã€‚</p>
<table>
<thead>
<tr>
<th><strong>å‚æ•°</strong></th>
<th><strong>æŠ½è±¡ç±»</strong></th>
<th><strong>æ¥å£</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>é»˜è®¤çš„æ–¹æ³•å®ç°</td>
<td>å®ƒå¯ä»¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°</td>
<td>æ¥å£å®Œå…¨æ˜¯æŠ½è±¡çš„ã€‚å®ƒæ ¹æœ¬ä¸å­˜åœ¨æ–¹æ³•çš„å®ç°</td>
</tr>
<tr>
<td>å…³é”®å­—</td>
<td>å­ç±»ä½¿ç”¨<strong>extends</strong>å…³é”®å­—æ¥ç»§æ‰¿æŠ½è±¡ç±»ã€‚å¦‚æœå­ç±»ä¸æ˜¯æŠ½è±¡ç±»çš„è¯ï¼Œå®ƒéœ€è¦æä¾›æŠ½è±¡ç±»ä¸­æ‰€æœ‰å£°æ˜çš„æ–¹æ³•çš„å®ç°ã€‚</td>
<td>å­ç±»ä½¿ç”¨å…³é”®å­—<strong>implements</strong>æ¥å®ç°æ¥å£ã€‚å®ƒéœ€è¦æä¾›æ¥å£ä¸­æ‰€æœ‰å£°æ˜çš„æ–¹æ³•çš„å®ç°</td>
</tr>
<tr>
<td>æ„é€ å™¨</td>
<td>æŠ½è±¡ç±»å¯ä»¥æœ‰æ„é€ å™¨</td>
<td>æ¥å£ä¸èƒ½æœ‰æ„é€ å™¨</td>
</tr>
<tr>
<td>ä¸æ­£å¸¸Javaç±»çš„åŒºåˆ«</td>
<td>é™¤äº†ä½ ä¸èƒ½å®ä¾‹åŒ–æŠ½è±¡ç±»ä¹‹å¤–ï¼Œå®ƒå’Œæ™®é€šJavaç±»æ²¡æœ‰ä»»ä½•åŒºåˆ«</td>
<td>æ¥å£æ˜¯å®Œå…¨ä¸åŒçš„ç±»å‹</td>
</tr>
<tr>
<td>è®¿é—®ä¿®é¥°ç¬¦</td>
<td>æŠ½è±¡æ–¹æ³•å¯ä»¥æœ‰<strong>public</strong>ã€<strong>protected</strong>å’Œ<strong>default</strong>è¿™äº›ä¿®é¥°ç¬¦</td>
<td>æ¥å£æ–¹æ³•é»˜è®¤ä¿®é¥°ç¬¦æ˜¯<strong>public</strong>ã€‚ä½ ä¸å¯ä»¥ä½¿ç”¨å…¶å®ƒä¿®é¥°ç¬¦ã€‚</td>
</tr>
<tr>
<td>mainæ–¹æ³•</td>
<td>æŠ½è±¡æ–¹æ³•å¯ä»¥æœ‰mainæ–¹æ³•å¹¶ä¸”æˆ‘ä»¬å¯ä»¥è¿è¡Œå®ƒ</td>
<td>æ¥å£æ²¡æœ‰mainæ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½è¿è¡Œå®ƒã€‚</td>
</tr>
<tr>
<td>å¤šç»§æ‰¿</td>
<td>æŠ½è±¡ç±»åªå¯ä»¥ç»§æ‰¿ä¸€ä¸ªç±»å’Œå®ç°å¤šä¸ªæ¥å£</td>
<td>æ¥å£å’Œæ¥å£ä¹‹é—´æ˜¯å¯ä»¥å¤šç»§æ‰¿æˆ–è€…å•ç»§æ‰¿å¤šå®ç°çš„ã€‚</td>
</tr>
<tr>
<td>é€Ÿåº¦</td>
<td>å®ƒæ¯”æ¥å£é€Ÿåº¦è¦å¿«</td>
<td>æ¥å£æ˜¯ç¨å¾®æœ‰ç‚¹æ…¢çš„ï¼Œå› ä¸ºå®ƒéœ€è¦æ—¶é—´å»å¯»æ‰¾åœ¨ç±»ä¸­å®ç°çš„æ–¹æ³•ã€‚</td>
</tr>
<tr>
<td>æ·»åŠ æ–°æ–¹æ³•</td>
<td>å¦‚æœä½ å¾€æŠ½è±¡ç±»ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œä½ å¯ä»¥ç»™å®ƒæä¾›é»˜è®¤çš„å®ç°ã€‚å› æ­¤ä½ ä¸éœ€è¦æ”¹å˜ä½ ç°åœ¨çš„ä»£ç ã€‚</td>
<td>å¦‚æœä½ å¾€æ¥å£ä¸­æ·»åŠ æ–¹æ³•ï¼Œé‚£ä¹ˆä½ å¿…é¡»æ”¹å˜å®ç°è¯¥æ¥å£çš„ç±»ã€‚</td>
</tr>
<tr>
<td>è®¾è®¡ç†å¿µ</td>
<td>is-açš„å…³ç³»ï¼Œä½“ç°çš„æ˜¯ä¸€ç§å…³ç³»çš„å»¶ç»­</td>
<td>like-aä½“ç°çš„æ˜¯ä¸€ç§åŠŸèƒ½çš„æ‰©å±•å…³ç³»</td>
</tr>
</tbody>
</table>
<p><strong>å…·ä½“ä½¿ç”¨çš„åœºæ™¯</strong></p>
<ul>
<li>å¦‚æœä½ æ‹¥æœ‰ä¸€äº›æ–¹æ³•å¹¶ä¸”æƒ³è®©å®ƒä»¬ä¸­çš„ä¸€äº›æœ‰é»˜è®¤å®ç°ï¼Œé‚£ä¹ˆä½¿ç”¨æŠ½è±¡ç±»å§ã€‚</li>
<li>å¦‚æœä½ æƒ³å®ç°å¤šé‡ç»§æ‰¿ï¼Œé‚£ä¹ˆä½ å¿…é¡»ä½¿ç”¨æ¥å£ã€‚ç”±äº<strong>Javaä¸æ”¯æŒå¤šç»§æ‰¿</strong>ï¼Œå­ç±»ä¸èƒ½å¤Ÿç»§æ‰¿å¤šä¸ªç±»ï¼Œä½†å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚å› æ­¤ä½ å°±å¯ä»¥ä½¿ç”¨æ¥å£æ¥è§£å†³å®ƒã€‚</li>
<li>å¦‚æœåŸºæœ¬åŠŸèƒ½åœ¨ä¸æ–­æ”¹å˜ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨æŠ½è±¡ç±»ã€‚å¦‚æœä¸æ–­æ”¹å˜åŸºæœ¬åŠŸèƒ½å¹¶ä¸”ä½¿ç”¨æ¥å£ï¼Œé‚£ä¹ˆå°±éœ€è¦æ”¹å˜æ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ç±»ã€‚</li>
<li>å¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿ã€‚</li>
</ul>
<h4 id="1-9-ç»§æ‰¿å’Œèšåˆçš„åŒºåˆ«åœ¨å“ªã€‚"><a href="#1-9-ç»§æ‰¿å’Œèšåˆçš„åŒºåˆ«åœ¨å“ªã€‚" class="headerlink" title="1.9 ç»§æ‰¿å’Œèšåˆçš„åŒºåˆ«åœ¨å“ªã€‚"></a>1.9 ç»§æ‰¿å’Œèšåˆçš„åŒºåˆ«åœ¨å“ªã€‚</h4><p>ç»§æ‰¿æŒ‡çš„æ˜¯ä¸€ä¸ªç±»ï¼ˆç§°ä¸ºå­ç±»ã€å­æ¥å£ï¼‰ç»§æ‰¿å¦å¤–çš„ä¸€ä¸ªç±»ï¼ˆç§°ä¸ºçˆ¶ç±»ã€çˆ¶æ¥å£ï¼‰çš„åŠŸèƒ½ï¼Œå¹¶å¯ä»¥å¢åŠ å®ƒè‡ªå·±çš„æ–°åŠŸèƒ½çš„èƒ½åŠ›ï¼Œç»§æ‰¿æ˜¯ç±»ä¸ç±»æˆ–è€…æ¥å£ä¸æ¥å£ä¹‹é—´æœ€å¸¸è§çš„å…³ç³»ï¼›åœ¨Javaä¸­æ­¤ç±»å…³ç³»é€šè¿‡å…³é”®å­—extendsæ˜ç¡®æ ‡è¯†ï¼Œåœ¨è®¾è®¡æ—¶ä¸€èˆ¬æ²¡æœ‰äº‰è®®æ€§ï¼›</p>
<p>èšåˆæ˜¯å…³è”å…³ç³»çš„ä¸€ç§ç‰¹ä¾‹ï¼Œä»–ä½“ç°çš„æ˜¯æ•´ä½“ä¸éƒ¨åˆ†ã€æ‹¥æœ‰çš„å…³ç³»ï¼Œå³has-açš„å…³ç³»ï¼Œæ­¤æ—¶æ•´ä½“ä¸éƒ¨åˆ†ä¹‹é—´æ˜¯å¯åˆ†ç¦»çš„ï¼Œä»–ä»¬å¯ä»¥å…·æœ‰å„è‡ªçš„ç”Ÿå‘½å‘¨æœŸï¼Œéƒ¨åˆ†å¯ä»¥å±äºå¤šä¸ªæ•´ä½“å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä¸ºå¤šä¸ªæ•´ä½“å¯¹è±¡å…±äº«ï¼›æ¯”å¦‚è®¡ç®—æœºä¸CPUã€å…¬å¸ä¸å‘˜å·¥çš„å…³ç³»ç­‰ï¼›è¡¨ç°åœ¨ä»£ç å±‚é¢ï¼Œå’Œå…³è”å…³ç³»æ˜¯ä¸€è‡´çš„ï¼Œåªèƒ½ä»è¯­ä¹‰çº§åˆ«æ¥åŒºåˆ†</p>
<p><a href="https://www.cnblogs.com/jiqing9006/p/5915023.html" target="_blank" rel="noopener">ç»§æ‰¿ã€å®ç°ã€ä¾èµ–ã€å…³è”ã€èšåˆã€ç»„åˆçš„è”ç³»ä¸åŒºåˆ«</a></p>
<h4 id="2-0-IOæ¨¡å‹æœ‰å“ªäº›ï¼Œè®²è®²ä½ ç†è§£çš„nio-ï¼Œä»–å’Œbioï¼Œaioçš„åŒºåˆ«æ˜¯å•¥ï¼Œè°ˆè°ˆreactoræ¨¡å‹ã€‚"><a href="#2-0-IOæ¨¡å‹æœ‰å“ªäº›ï¼Œè®²è®²ä½ ç†è§£çš„nio-ï¼Œä»–å’Œbioï¼Œaioçš„åŒºåˆ«æ˜¯å•¥ï¼Œè°ˆè°ˆreactoræ¨¡å‹ã€‚" class="headerlink" title="2.0 IOæ¨¡å‹æœ‰å“ªäº›ï¼Œè®²è®²ä½ ç†è§£çš„nio ï¼Œä»–å’Œbioï¼Œaioçš„åŒºåˆ«æ˜¯å•¥ï¼Œè°ˆè°ˆreactoræ¨¡å‹ã€‚"></a>2.0 IOæ¨¡å‹æœ‰å“ªäº›ï¼Œè®²è®²ä½ ç†è§£çš„nio ï¼Œä»–å’Œbioï¼Œaioçš„åŒºåˆ«æ˜¯å•¥ï¼Œè°ˆè°ˆreactoræ¨¡å‹ã€‚</h4><p>IOæ˜¯é¢å‘æµçš„ï¼ŒNIOæ˜¯é¢å‘ç¼“å†²åŒºçš„</p>
<p>NIOï¼ˆNon-blocking I/Oï¼Œåœ¨Javaé¢†åŸŸï¼Œä¹Ÿç§°ä¸ºNew I/Oï¼‰ï¼Œæ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„I/Oæ¨¡å‹ï¼Œä¹Ÿæ˜¯I/Oå¤šè·¯å¤ç”¨çš„åŸºç¡€ï¼Œå·²ç»è¢«è¶Šæ¥è¶Šå¤šåœ°åº”ç”¨åˆ°å¤§å‹åº”ç”¨æœåŠ¡å™¨ï¼Œæˆä¸ºè§£å†³é«˜å¹¶å‘ä¸å¤§é‡è¿æ¥ã€I/Oå¤„ç†é—®é¢˜çš„æœ‰æ•ˆæ–¹å¼ã€‚</p>
<p><strong>ä¼ ç»ŸBIOæ¨¡å‹åˆ†æ</strong></p>
<p>è®©æˆ‘ä»¬å…ˆå›å¿†ä¸€ä¸‹ä¼ ç»Ÿçš„æœåŠ¡å™¨ç«¯åŒæ­¥é˜»å¡I/Oå¤„ç†ï¼ˆä¹Ÿå°±æ˜¯BIOï¼ŒBlocking I/Oï¼‰çš„ç»å…¸ç¼–ç¨‹æ¨¡å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> ExecutorService executor = Excutors.newFixedThreadPollExecutor(<span class="number">100</span>);<span class="comment">//çº¿ç¨‹æ± </span></span><br><span class="line"></span><br><span class="line"> ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket();</span><br><span class="line"> serverSocket.bind(<span class="number">8088</span>);</span><br><span class="line"> <span class="keyword">while</span>(!Thread.currentThread.isInturrupted())&#123;<span class="comment">//ä¸»çº¿ç¨‹æ­»å¾ªç¯ç­‰å¾…æ–°è¿æ¥åˆ°æ¥</span></span><br><span class="line"> Socket socket = serverSocket.accept();</span><br><span class="line"> executor.submit(<span class="keyword">new</span> ConnectIOnHandler(socket));<span class="comment">//ä¸ºæ–°çš„è¿æ¥åˆ›å»ºæ–°çš„çº¿ç¨‹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConnectIOnHandler</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConnectIOnHandler</span><span class="params">(Socket socket)</span></span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.socket = socket;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">while</span>(!Thread.currentThread.isInturrupted()&amp;&amp;!socket.isClosed())&#123;æ­»å¾ªç¯å¤„ç†è¯»å†™äº‹ä»¶</span><br><span class="line">          String someThing = socket.read()....<span class="comment">//è¯»å–æ•°æ®</span></span><br><span class="line">          <span class="keyword">if</span>(someThing!=<span class="keyword">null</span>)&#123;</span><br><span class="line">             ......<span class="comment">//å¤„ç†æ•°æ®</span></span><br><span class="line">             socket.write()....<span class="comment">//å†™æ•°æ®</span></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„æ¯è¿æ¥æ¯çº¿ç¨‹çš„æ¨¡å‹ï¼Œä¹‹æ‰€ä»¥ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œä¸»è¦åŸå› åœ¨äºsocket.accept()ã€socket.read()ã€socket.write()ä¸‰ä¸ªä¸»è¦å‡½æ•°éƒ½æ˜¯åŒæ­¥é˜»å¡çš„ï¼Œå½“ä¸€ä¸ªè¿æ¥åœ¨å¤„ç†I/Oçš„æ—¶å€™ï¼Œç³»ç»Ÿæ˜¯é˜»å¡çš„ï¼Œå¦‚æœæ˜¯å•çº¿ç¨‹çš„è¯å¿…ç„¶å°±æŒ‚æ­»åœ¨é‚£é‡Œï¼›ä½†CPUæ˜¯è¢«é‡Šæ”¾å‡ºæ¥çš„ï¼Œå¼€å¯å¤šçº¿ç¨‹ï¼Œå°±å¯ä»¥è®©CPUå»å¤„ç†æ›´å¤šçš„äº‹æƒ…ã€‚å…¶å®è¿™ä¹Ÿæ˜¯æ‰€æœ‰ä½¿ç”¨å¤šçº¿ç¨‹çš„æœ¬è´¨ï¼š</p>
<ol>
<li>åˆ©ç”¨å¤šæ ¸ã€‚</li>
<li>å½“I/Oé˜»å¡ç³»ç»Ÿï¼Œä½†CPUç©ºé—²çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨å¤šçº¿ç¨‹ä½¿ç”¨CPUèµ„æºã€‚</li>
</ol>
<p>ç°åœ¨çš„å¤šçº¿ç¨‹ä¸€èˆ¬éƒ½ä½¿ç”¨çº¿ç¨‹æ± ï¼Œå¯ä»¥è®©çº¿ç¨‹çš„åˆ›å»ºå’Œå›æ”¶æˆæœ¬ç›¸å¯¹è¾ƒä½ã€‚åœ¨æ´»åŠ¨è¿æ¥æ•°ä¸æ˜¯ç‰¹åˆ«é«˜ï¼ˆå°äºå•æœº1000ï¼‰çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ¨¡å‹æ˜¯æ¯”è¾ƒä¸é”™çš„ï¼Œå¯ä»¥è®©æ¯ä¸€ä¸ªè¿æ¥ä¸“æ³¨äºè‡ªå·±çš„I/Oå¹¶ä¸”ç¼–ç¨‹æ¨¡å‹ç®€å•ï¼Œä¹Ÿä¸ç”¨è¿‡å¤šè€ƒè™‘ç³»ç»Ÿçš„è¿‡è½½ã€é™æµç­‰é—®é¢˜ã€‚çº¿ç¨‹æ± æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¤©ç„¶çš„æ¼æ–—ï¼Œå¯ä»¥ç¼“å†²ä¸€äº›ç³»ç»Ÿå¤„ç†ä¸äº†çš„è¿æ¥æˆ–è¯·æ±‚ã€‚</p>
<p>ä¸è¿‡ï¼Œè¿™ä¸ªæ¨¡å‹æœ€æœ¬è´¨çš„é—®é¢˜åœ¨äºï¼Œä¸¥é‡ä¾èµ–äºçº¿ç¨‹ã€‚ä½†çº¿ç¨‹æ˜¯å¾ˆâ€è´µâ€çš„èµ„æºï¼Œä¸»è¦è¡¨ç°åœ¨ï¼š</p>
<ol>
<li>çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯æˆæœ¬å¾ˆé«˜ï¼Œåœ¨Linuxè¿™æ ·çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚åˆ›å»ºå’Œé”€æ¯éƒ½æ˜¯é‡é‡çº§çš„ç³»ç»Ÿå‡½æ•°ã€‚</li>
<li>çº¿ç¨‹æœ¬èº«å ç”¨è¾ƒå¤§å†…å­˜ï¼ŒåƒJavaçš„çº¿ç¨‹æ ˆï¼Œä¸€èˆ¬è‡³å°‘åˆ†é…512Kï½1Mçš„ç©ºé—´ï¼Œå¦‚æœç³»ç»Ÿä¸­çš„çº¿ç¨‹æ•°è¿‡åƒï¼Œææ€•æ•´ä¸ªJVMçš„å†…å­˜éƒ½ä¼šè¢«åƒæ‰ä¸€åŠã€‚</li>
<li>çº¿ç¨‹çš„åˆ‡æ¢æˆæœ¬æ˜¯å¾ˆé«˜çš„ã€‚æ“ä½œç³»ç»Ÿå‘ç”Ÿçº¿ç¨‹åˆ‡æ¢çš„æ—¶å€™ï¼Œéœ€è¦ä¿ç•™çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œç„¶åæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ã€‚å¦‚æœçº¿ç¨‹æ•°è¿‡é«˜ï¼Œå¯èƒ½æ‰§è¡Œçº¿ç¨‹åˆ‡æ¢çš„æ—¶é—´ç”šè‡³ä¼šå¤§äºçº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´ï¼Œè¿™æ—¶å€™å¸¦æ¥çš„è¡¨ç°å¾€å¾€æ˜¯ç³»ç»Ÿloadåé«˜ã€CPU syä½¿ç”¨ç‡ç‰¹åˆ«é«˜ï¼ˆè¶…è¿‡20%ä»¥ä¸Š)ï¼Œå¯¼è‡´ç³»ç»Ÿå‡ ä¹é™·å…¥ä¸å¯ç”¨çš„çŠ¶æ€ã€‚</li>
<li>å®¹æ˜“é€ æˆé”¯é½¿çŠ¶çš„ç³»ç»Ÿè´Ÿè½½ã€‚å› ä¸ºç³»ç»Ÿè´Ÿè½½æ˜¯ç”¨æ´»åŠ¨çº¿ç¨‹æ•°æˆ–CPUæ ¸å¿ƒæ•°ï¼Œä¸€æ—¦çº¿ç¨‹æ•°é‡é«˜ä½†å¤–éƒ¨ç½‘ç»œç¯å¢ƒä¸æ˜¯å¾ˆç¨³å®šï¼Œå°±å¾ˆå®¹æ˜“é€ æˆå¤§é‡è¯·æ±‚çš„ç»“æœåŒæ—¶è¿”å›ï¼Œæ¿€æ´»å¤§é‡é˜»å¡çº¿ç¨‹ä»è€Œä½¿ç³»ç»Ÿè´Ÿè½½å‹åŠ›è¿‡å¤§ã€‚</li>
</ol>
<p>æ‰€ä»¥ï¼Œå½“é¢å¯¹åä¸‡ç”šè‡³ç™¾ä¸‡çº§è¿æ¥çš„æ—¶å€™ï¼Œä¼ ç»Ÿçš„BIOæ¨¡å‹æ˜¯æ— èƒ½ä¸ºåŠ›çš„ã€‚éšç€ç§»åŠ¨ç«¯åº”ç”¨çš„å…´èµ·å’Œå„ç§ç½‘ç»œæ¸¸æˆçš„ç››è¡Œï¼Œç™¾ä¸‡çº§é•¿è¿æ¥æ—¥è¶‹æ™®éï¼Œæ­¤æ—¶ï¼Œå¿…ç„¶éœ€è¦ä¸€ç§æ›´é«˜æ•ˆçš„I/Oå¤„ç†æ¨¡å‹ã€‚</p>
<p><strong>NIOæ˜¯æ€ä¹ˆå·¥ä½œçš„</strong></p>
<p>å¾ˆå¤šåˆšæ¥è§¦NIOçš„äººï¼Œç¬¬ä¸€çœ¼çœ‹åˆ°çš„å°±æ˜¯Javaç›¸å¯¹æ™¦æ¶©çš„APIï¼Œæ¯”å¦‚ï¼šChannelï¼ŒSelectorï¼ŒSocketä»€ä¹ˆçš„ï¼›ç„¶åå°±æ˜¯ä¸€å¨ä¸Šç™¾è¡Œçš„ä»£ç æ¥æ¼”ç¤ºNIOçš„æœåŠ¡ç«¯Demoâ€¦â€¦ç¬é—´å¤´å¤§æœ‰æ²¡æœ‰ï¼Ÿ</p>
<p>æˆ‘ä»¬ä¸ç®¡è¿™äº›ï¼ŒæŠ›å¼€ç°è±¡çœ‹æœ¬è´¨ï¼Œå…ˆåˆ†æä¸‹NIOæ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚</p>
<p><strong>å¸¸è§I/Oæ¨¡å‹å¯¹æ¯”</strong></p>
<p>æ‰€æœ‰çš„ç³»ç»ŸI/Oéƒ½åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šç­‰å¾…å°±ç»ªå’Œæ“ä½œã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œè¯»å‡½æ•°ï¼Œåˆ†ä¸ºç­‰å¾…ç³»ç»Ÿå¯è¯»å’ŒçœŸæ­£çš„è¯»ï¼›åŒç†ï¼Œå†™å‡½æ•°åˆ†ä¸ºç­‰å¾…ç½‘å¡å¯ä»¥å†™å’ŒçœŸæ­£çš„å†™ã€‚</p>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ç­‰å¾…å°±ç»ªçš„é˜»å¡æ˜¯ä¸ä½¿ç”¨CPUçš„ï¼Œæ˜¯åœ¨â€œç©ºç­‰â€ï¼›è€ŒçœŸæ­£çš„è¯»å†™æ“ä½œçš„é˜»å¡æ˜¯ä½¿ç”¨CPUçš„ï¼ŒçœŸæ­£åœ¨â€å¹²æ´»â€ï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹éå¸¸å¿«ï¼Œå±äºmemory copyï¼Œå¸¦å®½é€šå¸¸åœ¨1GB/sçº§åˆ«ä»¥ä¸Šï¼Œå¯ä»¥ç†è§£ä¸ºåŸºæœ¬ä¸è€—æ—¶ã€‚</p>
<p>ä¸‹å›¾æ˜¯å‡ ç§å¸¸è§I/Oæ¨¡å‹çš„å¯¹æ¯”ï¼š</p>
<p><img src="https://pic2.zhimg.com/80/v2-f47206d5b5e64448744b85eaf568f92d_hd.jpg" alt="img"></p>
<p>ä»¥socket.read()ä¸ºä¾‹å­ï¼š</p>
<p>ä¼ ç»Ÿçš„BIOé‡Œé¢socket.read()ï¼Œå¦‚æœTCP RecvBufferé‡Œæ²¡æœ‰æ•°æ®ï¼Œå‡½æ•°ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æ”¶åˆ°æ•°æ®ï¼Œè¿”å›è¯»åˆ°çš„æ•°æ®ã€‚</p>
<p>å¯¹äºNIOï¼Œå¦‚æœTCP RecvBufferæœ‰æ•°æ®ï¼Œå°±æŠŠæ•°æ®ä»ç½‘å¡è¯»åˆ°å†…å­˜ï¼Œå¹¶ä¸”è¿”å›ç»™ç”¨æˆ·ï¼›åä¹‹åˆ™ç›´æ¥è¿”å›0ï¼Œæ°¸è¿œä¸ä¼šé˜»å¡ã€‚</p>
<p>æœ€æ–°çš„AIO(Async I/O)é‡Œé¢ä¼šæ›´è¿›ä¸€æ­¥ï¼šä¸ä½†ç­‰å¾…å°±ç»ªæ˜¯éé˜»å¡çš„ï¼Œå°±è¿æ•°æ®ä»ç½‘å¡åˆ°å†…å­˜çš„è¿‡ç¨‹ä¹Ÿæ˜¯å¼‚æ­¥çš„ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼ŒBIOé‡Œç”¨æˆ·æœ€å…³å¿ƒâ€œæˆ‘è¦è¯»â€ï¼ŒNIOé‡Œç”¨æˆ·æœ€å…³å¿ƒâ€æˆ‘å¯ä»¥è¯»äº†â€ï¼Œåœ¨AIOæ¨¡å‹é‡Œç”¨æˆ·æ›´éœ€è¦å…³æ³¨çš„æ˜¯â€œè¯»å®Œäº†â€ã€‚</p>
<p>NIOä¸€ä¸ªé‡è¦çš„ç‰¹ç‚¹æ˜¯ï¼šsocketä¸»è¦çš„è¯»ã€å†™ã€æ³¨å†Œå’Œæ¥æ”¶å‡½æ•°ï¼Œåœ¨ç­‰å¾…å°±ç»ªé˜¶æ®µéƒ½æ˜¯éé˜»å¡çš„ï¼ŒçœŸæ­£çš„I/Oæ“ä½œæ˜¯åŒæ­¥é˜»å¡çš„ï¼ˆæ¶ˆè€—CPUä½†æ€§èƒ½éå¸¸é«˜ï¼‰ã€‚</p>
<p><strong>å¦‚ä½•ç»“åˆäº‹ä»¶æ¨¡å‹ä½¿ç”¨NIOåŒæ­¥éé˜»å¡ç‰¹æ€§</strong></p>
<p>å›å¿†BIOæ¨¡å‹ï¼Œä¹‹æ‰€ä»¥éœ€è¦å¤šçº¿ç¨‹ï¼Œæ˜¯å› ä¸ºåœ¨è¿›è¡ŒI/Oæ“ä½œçš„æ—¶å€™ï¼Œä¸€æ˜¯æ²¡æœ‰åŠæ³•çŸ¥é“åˆ°åº•èƒ½ä¸èƒ½å†™ã€èƒ½ä¸èƒ½è¯»ï¼Œåªèƒ½â€å‚»ç­‰â€ï¼Œå³ä½¿é€šè¿‡å„ç§ä¼°ç®—ï¼Œç®—å‡ºæ¥æ“ä½œç³»ç»Ÿæ²¡æœ‰èƒ½åŠ›è¿›è¡Œè¯»å†™ï¼Œä¹Ÿæ²¡æ³•åœ¨socket.read()å’Œsocket.write()å‡½æ•°ä¸­è¿”å›ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°æ— æ³•è¿›è¡Œæœ‰æ•ˆçš„ä¸­æ–­ã€‚æ‰€ä»¥é™¤äº†å¤šå¼€çº¿ç¨‹å¦èµ·ç‚‰ç¶ï¼Œæ²¡æœ‰å¥½çš„åŠæ³•åˆ©ç”¨CPUã€‚</p>
<p>NIOçš„è¯»å†™å‡½æ•°å¯ä»¥ç«‹åˆ»è¿”å›ï¼Œè¿™å°±ç»™äº†æˆ‘ä»¬ä¸å¼€çº¿ç¨‹åˆ©ç”¨CPUçš„æœ€å¥½æœºä¼šï¼šå¦‚æœä¸€ä¸ªè¿æ¥ä¸èƒ½è¯»å†™ï¼ˆsocket.read()è¿”å›0æˆ–è€…socket.write()è¿”å›0ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä»¶äº‹è®°ä¸‹æ¥ï¼Œè®°å½•çš„æ–¹å¼é€šå¸¸æ˜¯åœ¨Selectorä¸Šæ³¨å†Œæ ‡è®°ä½ï¼Œç„¶ååˆ‡æ¢åˆ°å…¶å®ƒå°±ç»ªçš„è¿æ¥ï¼ˆchannelï¼‰ç»§ç»­è¿›è¡Œè¯»å†™ã€‚</p>
<p>ä¸‹é¢å…·ä½“çœ‹ä¸‹å¦‚ä½•åˆ©ç”¨äº‹ä»¶æ¨¡å‹å•çº¿ç¨‹å¤„ç†æ‰€æœ‰I/Oè¯·æ±‚ï¼š</p>
<p>NIOçš„ä¸»è¦äº‹ä»¶æœ‰å‡ ä¸ªï¼šè¯»å°±ç»ªã€å†™å°±ç»ªã€æœ‰æ–°è¿æ¥åˆ°æ¥ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆéœ€è¦æ³¨å†Œå½“è¿™å‡ ä¸ªäº‹ä»¶åˆ°æ¥çš„æ—¶å€™æ‰€å¯¹åº”çš„å¤„ç†å™¨ã€‚ç„¶ååœ¨åˆé€‚çš„æ—¶æœºå‘Šè¯‰äº‹ä»¶é€‰æ‹©å™¨ï¼šæˆ‘å¯¹è¿™ä¸ªäº‹ä»¶æ„Ÿå…´è¶£ã€‚å¯¹äºå†™æ“ä½œï¼Œå°±æ˜¯å†™ä¸å‡ºå»çš„æ—¶å€™å¯¹å†™äº‹ä»¶æ„Ÿå…´è¶£ï¼›å¯¹äºè¯»æ“ä½œï¼Œå°±æ˜¯å®Œæˆè¿æ¥å’Œç³»ç»Ÿæ²¡æœ‰åŠæ³•æ‰¿è½½æ–°è¯»å…¥çš„æ•°æ®çš„æ—¶ï¼›å¯¹äºacceptï¼Œä¸€èˆ¬æ˜¯æœåŠ¡å™¨åˆšå¯åŠ¨çš„æ—¶å€™ï¼›è€Œå¯¹äºconnectï¼Œä¸€èˆ¬æ˜¯connectå¤±è´¥éœ€è¦é‡è¿æˆ–è€…ç›´æ¥å¼‚æ­¥è°ƒç”¨connectçš„æ—¶å€™ã€‚</p>
<p>å…¶æ¬¡ï¼Œç”¨ä¸€ä¸ªæ­»å¾ªç¯é€‰æ‹©å°±ç»ªçš„äº‹ä»¶ï¼Œä¼šæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼ˆLinux 2.6ä¹‹å‰æ˜¯selectã€pollï¼Œ2.6ä¹‹åæ˜¯epollï¼ŒWindowsæ˜¯IOCPï¼‰ï¼Œè¿˜ä¼šé˜»å¡çš„ç­‰å¾…æ–°äº‹ä»¶çš„åˆ°æ¥ã€‚æ–°äº‹ä»¶åˆ°æ¥çš„æ—¶å€™ï¼Œä¼šåœ¨selectorä¸Šæ³¨å†Œæ ‡è®°ä½ï¼Œæ ‡ç¤ºå¯è¯»ã€å¯å†™æˆ–è€…æœ‰è¿æ¥åˆ°æ¥ã€‚</p>
<p>æ³¨æ„ï¼Œselectæ˜¯é˜»å¡çš„ï¼Œæ— è®ºæ˜¯é€šè¿‡æ“ä½œç³»ç»Ÿçš„é€šçŸ¥ï¼ˆepollï¼‰è¿˜æ˜¯ä¸åœçš„è½®è¯¢(selectï¼Œpoll)ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯é˜»å¡çš„ã€‚æ‰€ä»¥ä½ å¯ä»¥æ”¾å¿ƒå¤§èƒ†åœ°åœ¨ä¸€ä¸ªwhile(true)é‡Œé¢è°ƒç”¨è¿™ä¸ªå‡½æ•°è€Œä¸ç”¨æ‹…å¿ƒCPUç©ºè½¬ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬çš„ç¨‹åºå¤§æ¦‚çš„æ¨¡æ ·æ˜¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">interface</span> <span class="title">ChannelHandler</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">channelReadable</span><span class="params">(Channel channel)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">channelWritable</span><span class="params">(Channel channel)</span></span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Channel</span></span>&#123;</span><br><span class="line">   Socket socket;</span><br><span class="line">   Event event;<span class="comment">//è¯»ï¼Œå†™æˆ–è€…è¿æ¥</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//IOçº¿ç¨‹ä¸»å¾ªç¯:</span></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">IoThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line"> Channel channel;</span><br><span class="line"> <span class="keyword">while</span>(channel=Selector.select())&#123;<span class="comment">//é€‰æ‹©å°±ç»ªçš„äº‹ä»¶å’Œå¯¹åº”çš„è¿æ¥</span></span><br><span class="line">    <span class="keyword">if</span>(channel.event==accept)&#123;</span><br><span class="line">       registerNewChannelHandler(channel);<span class="comment">//å¦‚æœæ˜¯æ–°è¿æ¥ï¼Œåˆ™æ³¨å†Œä¸€ä¸ªæ–°çš„è¯»å†™å¤„ç†å™¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(channel.event==write)&#123;</span><br><span class="line">       getChannelHandler(channel).channelWritable(channel);<span class="comment">//å¦‚æœå¯ä»¥å†™ï¼Œåˆ™æ‰§è¡Œå†™äº‹ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(channel.event==read)&#123;</span><br><span class="line">        getChannelHandler(channel).channelReadable(channel);<span class="comment">//å¦‚æœå¯ä»¥è¯»ï¼Œåˆ™æ‰§è¡Œè¯»äº‹ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> Map&lt;Channelï¼ŒChannelHandler&gt; handlerMap;<span class="comment">//æ‰€æœ‰channelçš„å¯¹åº”äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªç¨‹åºå¾ˆç®€çŸ­ï¼Œä¹Ÿæ˜¯æœ€ç®€å•çš„Reactoræ¨¡å¼ï¼šæ³¨å†Œæ‰€æœ‰æ„Ÿå…´è¶£çš„äº‹ä»¶å¤„ç†å™¨ï¼Œå•çº¿ç¨‹è½®è¯¢é€‰æ‹©å°±ç»ªäº‹ä»¶ï¼Œæ‰§è¡Œäº‹ä»¶å¤„ç†å™¨ã€‚</p>
<p><strong>ä¼˜åŒ–çº¿ç¨‹æ¨¡å‹</strong></p>
<p>ç”±ä¸Šé¢çš„ç¤ºä¾‹æˆ‘ä»¬å¤§æ¦‚å¯ä»¥æ€»ç»“å‡ºNIOæ˜¯æ€ä¹ˆè§£å†³æ‰çº¿ç¨‹çš„ç“¶é¢ˆå¹¶å¤„ç†æµ·é‡è¿æ¥çš„ï¼š</p>
<p>NIOç”±åŸæ¥çš„é˜»å¡è¯»å†™ï¼ˆå ç”¨çº¿ç¨‹ï¼‰å˜æˆäº†å•çº¿ç¨‹è½®è¯¢äº‹ä»¶ï¼Œæ‰¾åˆ°å¯ä»¥è¿›è¡Œè¯»å†™çš„ç½‘ç»œæè¿°ç¬¦è¿›è¡Œè¯»å†™ã€‚é™¤äº†äº‹ä»¶çš„è½®è¯¢æ˜¯é˜»å¡çš„ï¼ˆæ²¡æœ‰å¯å¹²çš„äº‹æƒ…å¿…é¡»è¦é˜»å¡ï¼‰ï¼Œå‰©ä½™çš„I/Oæ“ä½œéƒ½æ˜¯çº¯CPUæ“ä½œï¼Œæ²¡æœ‰å¿…è¦å¼€å¯å¤šçº¿ç¨‹ã€‚</p>
<p>å¹¶ä¸”ç”±äºçº¿ç¨‹çš„èŠ‚çº¦ï¼Œè¿æ¥æ•°å¤§çš„æ—¶å€™å› ä¸ºçº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„é—®é¢˜ä¹Ÿéšä¹‹è§£å†³ï¼Œè¿›è€Œä¸ºå¤„ç†æµ·é‡è¿æ¥æä¾›äº†å¯èƒ½ã€‚</p>
<p>å•çº¿ç¨‹å¤„ç†I/Oçš„æ•ˆç‡ç¡®å®éå¸¸é«˜ï¼Œæ²¡æœ‰çº¿ç¨‹åˆ‡æ¢ï¼Œåªæ˜¯æ‹¼å‘½çš„è¯»ã€å†™ã€é€‰æ‹©äº‹ä»¶ã€‚ä½†ç°åœ¨çš„æœåŠ¡å™¨ï¼Œä¸€èˆ¬éƒ½æ˜¯å¤šæ ¸å¤„ç†å™¨ï¼Œå¦‚æœèƒ½å¤Ÿåˆ©ç”¨å¤šæ ¸å¿ƒè¿›è¡ŒI/Oï¼Œæ— ç–‘å¯¹æ•ˆç‡ä¼šæœ‰æ›´å¤§çš„æé«˜ã€‚</p>
<p>ä»”ç»†åˆ†æä¸€ä¸‹æˆ‘ä»¬éœ€è¦çš„çº¿ç¨‹ï¼Œå…¶å®ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š</p>
<ol>
<li>äº‹ä»¶åˆ†å‘å™¨ï¼Œå•çº¿ç¨‹é€‰æ‹©å°±ç»ªçš„äº‹ä»¶ã€‚</li>
<li>I/Oå¤„ç†å™¨ï¼ŒåŒ…æ‹¬connectã€readã€writeç­‰ï¼Œè¿™ç§çº¯CPUæ“ä½œï¼Œä¸€èˆ¬å¼€å¯CPUæ ¸å¿ƒä¸ªçº¿ç¨‹å°±å¯ä»¥ã€‚</li>
<li>ä¸šåŠ¡çº¿ç¨‹ï¼Œåœ¨å¤„ç†å®ŒI/Oåï¼Œä¸šåŠ¡ä¸€èˆ¬è¿˜ä¼šæœ‰è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œæœ‰çš„è¿˜ä¼šæœ‰å…¶ä»–çš„é˜»å¡I/Oï¼Œå¦‚DBæ“ä½œï¼ŒRPCç­‰ã€‚åªè¦æœ‰é˜»å¡ï¼Œå°±éœ€è¦å•ç‹¬çš„çº¿ç¨‹ã€‚</li>
</ol>
<p>Javaçš„Selectorå¯¹äºLinuxç³»ç»Ÿæ¥è¯´ï¼Œæœ‰ä¸€ä¸ªè‡´å‘½é™åˆ¶ï¼šåŒä¸€ä¸ªchannelçš„selectä¸èƒ½è¢«å¹¶å‘çš„è°ƒç”¨ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰å¤šä¸ªI/Oçº¿ç¨‹ï¼Œå¿…é¡»ä¿è¯ï¼šä¸€ä¸ªsocketåªèƒ½å±äºä¸€ä¸ªIoThreadï¼Œè€Œä¸€ä¸ªIoThreadå¯ä»¥ç®¡ç†å¤šä¸ªsocketã€‚</p>
<p>å¦å¤–è¿æ¥çš„å¤„ç†å’Œè¯»å†™çš„å¤„ç†é€šå¸¸å¯ä»¥é€‰æ‹©åˆ†å¼€ï¼Œè¿™æ ·å¯¹äºæµ·é‡è¿æ¥çš„æ³¨å†Œå’Œè¯»å†™å°±å¯ä»¥åˆ†å‘ã€‚è™½ç„¶read()å’Œwrite()æ˜¯æ¯”è¾ƒé«˜æ•ˆæ— é˜»å¡çš„å‡½æ•°ï¼Œä½†æ¯•ç«Ÿä¼šå ç”¨CPUï¼Œå¦‚æœé¢å¯¹æ›´é«˜çš„å¹¶å‘åˆ™æ— èƒ½ä¸ºåŠ›ã€‚</p>
<p><img src="https://pic2.zhimg.com/80/v2-22efc734724d07251f8293e2f1143639_hd.png" alt="img"></p>
<p><strong>NIOåœ¨å®¢æˆ·ç«¯çš„é­”åŠ›</strong></p>
<p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥çœ‹å‡ºNIOåœ¨æœåŠ¡ç«¯å¯¹äºè§£æ”¾çº¿ç¨‹ï¼Œä¼˜åŒ–I/Oå’Œå¤„ç†æµ·é‡è¿æ¥æ–¹é¢ï¼Œç¡®å®æœ‰è‡ªå·±çš„ç”¨æ­¦ä¹‹åœ°ã€‚é‚£ä¹ˆåœ¨å®¢æˆ·ç«¯ä¸Šï¼ŒNIOåˆæœ‰ä»€ä¹ˆä½¿ç”¨åœºæ™¯å‘¢?</p>
<p>å¸¸è§çš„å®¢æˆ·ç«¯BIO+è¿æ¥æ± æ¨¡å‹ï¼Œå¯ä»¥å»ºç«‹nä¸ªè¿æ¥ï¼Œç„¶åå½“æŸä¸€ä¸ªè¿æ¥è¢«I/Oå ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–è¿æ¥æ¥æé«˜æ€§èƒ½ã€‚</p>
<p>ä½†å¤šçº¿ç¨‹çš„æ¨¡å‹é¢ä¸´å’ŒæœåŠ¡ç«¯ç›¸åŒçš„é—®é¢˜ï¼šå¦‚æœæŒ‡æœ›å¢åŠ è¿æ¥æ•°æ¥æé«˜æ€§èƒ½ï¼Œåˆ™è¿æ¥æ•°åˆå—åˆ¶äºçº¿ç¨‹æ•°ã€çº¿ç¨‹å¾ˆè´µã€æ— æ³•å»ºç«‹å¾ˆå¤šçº¿ç¨‹ï¼Œåˆ™æ€§èƒ½é‡åˆ°ç“¶é¢ˆã€‚</p>
<p><strong>æ¯è¿æ¥é¡ºåºè¯·æ±‚çš„Redis</strong></p>
<p>å¯¹äºRedisæ¥è¯´ï¼Œç”±äºæœåŠ¡ç«¯æ˜¯å…¨å±€ä¸²è¡Œçš„ï¼Œèƒ½å¤Ÿä¿è¯åŒä¸€è¿æ¥çš„æ‰€æœ‰è¯·æ±‚ä¸è¿”å›é¡ºåºä¸€è‡´ã€‚è¿™æ ·å¯ä»¥ä½¿ç”¨å•çº¿ç¨‹ï¼‹é˜Ÿåˆ—ï¼ŒæŠŠè¯·æ±‚æ•°æ®ç¼“å†²ã€‚ç„¶åpipelineå‘é€ï¼Œè¿”å›futureï¼Œç„¶åchannelå¯è¯»æ—¶ï¼Œç›´æ¥åœ¨é˜Ÿåˆ—ä¸­æŠŠfutureå–å›æ¥ï¼Œdone()å°±å¯ä»¥äº†ã€‚</p>
<p>ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisClient</span> <span class="title">Implements</span> <span class="title">ChannelHandler</span></span>&#123;</span><br><span class="line"> <span class="keyword">private</span> BlockingQueue CmdQueue;</span><br><span class="line"> <span class="keyword">private</span> EventLoop eventLoop;</span><br><span class="line"> <span class="keyword">private</span> Channel channel;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Cmd</span></span>&#123;</span><br><span class="line">  String cmd;</span><br><span class="line">  Future result;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> Future <span class="title">get</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">   Cmd cmd= <span class="keyword">new</span> Cmd(key);</span><br><span class="line">   queue.offer(cmd);</span><br><span class="line">   eventLoop.submit(<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">        List list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        queue.drainTo(list);</span><br><span class="line">        <span class="keyword">if</span>(channel.isWritable())&#123;</span><br><span class="line">         channel.writeAndFlush(list);</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ChannelReadFinish</span><span class="params">(Channel channelï¼ŒBuffer Buffer)</span></span>&#123;</span><br><span class="line">    List result = handleBuffer();<span class="comment">//å¤„ç†æ•°æ®</span></span><br><span class="line">    <span class="comment">//ä»cmdQueueå–å‡ºfutureï¼Œå¹¶è®¾å€¼ï¼Œfuture.done();</span></span><br><span class="line">&#125;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ChannelWritable</span><span class="params">(Channel channel)</span></span>&#123;</span><br><span class="line">   channel.flush();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·åšï¼Œèƒ½å¤Ÿå……åˆ†çš„åˆ©ç”¨pipelineæ¥æé«˜I/Oèƒ½åŠ›ï¼ŒåŒæ—¶è·å–å¼‚æ­¥å¤„ç†èƒ½åŠ›ã€‚</p>
<p><strong>å¤šè¿æ¥çŸ­è¿æ¥çš„HttpClient</strong></p>
<p>ç±»ä¼¼äºç«å¯¹æŠ“å–çš„é¡¹ç›®ï¼Œå¾€å¾€éœ€è¦å»ºç«‹æ— æ•°çš„HTTPçŸ­è¿æ¥ï¼Œç„¶åæŠ“å–ï¼Œç„¶åé”€æ¯ï¼Œå½“éœ€è¦å•æœºæŠ“å–ä¸Šåƒç½‘ç«™çº¿ç¨‹æ•°åˆå—åˆ¶çš„æ—¶å€™ï¼Œæ€ä¹ˆä¿è¯æ€§èƒ½å‘¢?</p>
<p>ä½•ä¸å°è¯•NIOï¼Œå•çº¿ç¨‹è¿›è¡Œè¿æ¥ã€å†™ã€è¯»æ“ä½œï¼Ÿå¦‚æœè¿æ¥ã€è¯»ã€å†™æ“ä½œç³»ç»Ÿæ²¡æœ‰èƒ½åŠ›å¤„ç†ï¼Œç®€å•çš„æ³¨å†Œä¸€ä¸ªäº‹ä»¶ï¼Œç­‰å¾…ä¸‹æ¬¡å¾ªç¯å°±å¥½äº†ã€‚</p>
<p>å¦‚ä½•å­˜å‚¨ä¸åŒçš„è¯·æ±‚/å“åº”å‘¢ï¼Ÿç”±äºhttpæ˜¯æ— çŠ¶æ€æ²¡æœ‰ç‰ˆæœ¬çš„åè®®ï¼Œåˆæ²¡æœ‰åŠæ³•ä½¿ç”¨é˜Ÿåˆ—ï¼Œå¥½åƒåŠæ³•ä¸å¤šã€‚æ¯”è¾ƒç¬¨çš„åŠæ³•æ˜¯å¯¹äºä¸åŒçš„socketï¼Œç›´æ¥å­˜å‚¨socketçš„å¼•ç”¨ä½œä¸ºmapçš„keyã€‚</p>
<p><strong>å¸¸è§çš„RPCæ¡†æ¶ï¼Œå¦‚Thriftï¼ŒDubbo</strong></p>
<p>è¿™ç§æ¡†æ¶å†…éƒ¨ä¸€èˆ¬ç»´æŠ¤äº†è¯·æ±‚çš„åè®®å’Œè¯·æ±‚å·ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªä»¥è¯·æ±‚å·ä¸ºkeyï¼Œç»“æœçš„resultä¸ºfutureçš„mapï¼Œç»“åˆNIO+é•¿è¿æ¥ï¼Œè·å–éå¸¸ä¸é”™çš„æ€§èƒ½ã€‚</p>
<p><strong>NIOé«˜çº§ä¸»é¢˜</strong></p>
<p><strong>Proactorä¸Reactor</strong></p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒI/O å¤ç”¨æœºåˆ¶éœ€è¦äº‹ä»¶åˆ†å‘å™¨ï¼ˆevent dispatcherï¼‰ã€‚ äº‹ä»¶åˆ†å‘å™¨çš„ä½œç”¨ï¼Œå³å°†é‚£äº›è¯»å†™äº‹ä»¶æºåˆ†å‘ç»™å„è¯»å†™äº‹ä»¶çš„å¤„ç†è€…ï¼Œå°±åƒé€å¿«é€’çš„åœ¨æ¥¼ä¸‹å–Š: è°è°è°çš„å¿«é€’åˆ°äº†ï¼Œ å¿«æ¥æ‹¿å§ï¼å¼€å‘äººå‘˜åœ¨å¼€å§‹çš„æ—¶å€™éœ€è¦åœ¨åˆ†å‘å™¨é‚£é‡Œæ³¨å†Œæ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œå¹¶æä¾›ç›¸åº”çš„å¤„ç†è€…ï¼ˆevent handler)ï¼Œæˆ–è€…æ˜¯å›è°ƒå‡½æ•°ï¼›äº‹ä»¶åˆ†å‘å™¨åœ¨é€‚å½“çš„æ—¶å€™ï¼Œä¼šå°†è¯·æ±‚çš„äº‹ä»¶åˆ†å‘ç»™è¿™äº›handleræˆ–è€…å›è°ƒå‡½æ•°ã€‚</p>
<p>æ¶‰åŠåˆ°äº‹ä»¶åˆ†å‘å™¨çš„ä¸¤ç§æ¨¡å¼ç§°ä¸ºï¼šReactorå’ŒProactorã€‚ Reactoræ¨¡å¼æ˜¯åŸºäºåŒæ­¥I/Oçš„ï¼Œè€ŒProactoræ¨¡å¼æ˜¯å’Œå¼‚æ­¥I/Oç›¸å…³çš„ã€‚åœ¨Reactoræ¨¡å¼ä¸­ï¼Œäº‹ä»¶åˆ†å‘å™¨ç­‰å¾…æŸä¸ªäº‹ä»¶æˆ–è€…å¯åº”ç”¨æˆ–ä¸ªæ“ä½œçš„çŠ¶æ€å‘ç”Ÿï¼ˆæ¯”å¦‚æ–‡ä»¶æè¿°ç¬¦å¯è¯»å†™ï¼Œæˆ–è€…æ˜¯socketå¯è¯»å†™ï¼‰ï¼Œäº‹ä»¶åˆ†å‘å™¨å°±æŠŠè¿™ä¸ªäº‹ä»¶ä¼ ç»™äº‹å…ˆæ³¨å†Œçš„äº‹ä»¶å¤„ç†å‡½æ•°æˆ–è€…å›è°ƒå‡½æ•°ï¼Œç”±åè€…æ¥åšå®é™…çš„è¯»å†™æ“ä½œã€‚</p>
<p>è€Œåœ¨Proactoræ¨¡å¼ä¸­ï¼Œäº‹ä»¶å¤„ç†è€…ï¼ˆæˆ–è€…ä»£ç”±äº‹ä»¶åˆ†å‘å™¨å‘èµ·ï¼‰ç›´æ¥å‘èµ·ä¸€ä¸ªå¼‚æ­¥è¯»å†™æ“ä½œï¼ˆç›¸å½“äºè¯·æ±‚ï¼‰ï¼Œè€Œå®é™…çš„å·¥ä½œæ˜¯ç”±æ“ä½œç³»ç»Ÿæ¥å®Œæˆçš„ã€‚å‘èµ·æ—¶ï¼Œéœ€è¦æä¾›çš„å‚æ•°åŒ…æ‹¬ç”¨äºå­˜æ”¾è¯»åˆ°æ•°æ®çš„ç¼“å­˜åŒºã€è¯»çš„æ•°æ®å¤§å°æˆ–ç”¨äºå­˜æ”¾å¤–å‘æ•°æ®çš„ç¼“å­˜åŒºï¼Œä»¥åŠè¿™ä¸ªè¯·æ±‚å®Œåçš„å›è°ƒå‡½æ•°ç­‰ä¿¡æ¯ã€‚äº‹ä»¶åˆ†å‘å™¨å¾—çŸ¥äº†è¿™ä¸ªè¯·æ±‚ï¼Œå®ƒé»˜é»˜ç­‰å¾…è¿™ä¸ªè¯·æ±‚çš„å®Œæˆï¼Œç„¶åè½¬å‘å®Œæˆäº‹ä»¶ç»™ç›¸åº”çš„äº‹ä»¶å¤„ç†è€…æˆ–è€…å›è°ƒã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨Windowsä¸Šäº‹ä»¶å¤„ç†è€…æŠ•é€’äº†ä¸€ä¸ªå¼‚æ­¥IOæ“ä½œï¼ˆç§°ä¸ºoverlappedæŠ€æœ¯ï¼‰ï¼Œäº‹ä»¶åˆ†å‘å™¨ç­‰IO Completeäº‹ä»¶å®Œæˆã€‚è¿™ç§å¼‚æ­¥æ¨¡å¼çš„å…¸å‹å®ç°æ˜¯åŸºäºæ“ä½œç³»ç»Ÿåº•å±‚å¼‚æ­¥APIçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ç§°ä¹‹ä¸ºâ€œç³»ç»Ÿçº§åˆ«â€çš„æˆ–è€…â€œçœŸæ­£æ„ä¹‰ä¸Šâ€çš„å¼‚æ­¥ï¼Œå› ä¸ºå…·ä½“çš„è¯»å†™æ˜¯ç”±æ“ä½œç³»ç»Ÿä»£åŠ³çš„ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå°†æœ‰åŠ©äºç†è§£Reactorä¸ProactoräºŒè€…çš„å·®å¼‚ï¼Œä»¥è¯»æ“ä½œä¸ºä¾‹ï¼ˆå†™æ“ä½œç±»ä¼¼ï¼‰ã€‚</p>
<p><strong>åœ¨Reactorä¸­å®ç°è¯»</strong></p>
<ul>
<li>æ³¨å†Œè¯»å°±ç»ªäº‹ä»¶å’Œç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ã€‚</li>
<li>äº‹ä»¶åˆ†å‘å™¨ç­‰å¾…äº‹ä»¶ã€‚</li>
<li>äº‹ä»¶åˆ°æ¥ï¼Œæ¿€æ´»åˆ†å‘å™¨ï¼Œåˆ†å‘å™¨è°ƒç”¨äº‹ä»¶å¯¹åº”çš„å¤„ç†å™¨ã€‚</li>
<li>äº‹ä»¶å¤„ç†å™¨å®Œæˆå®é™…çš„è¯»æ“ä½œï¼Œå¤„ç†è¯»åˆ°çš„æ•°æ®ï¼Œæ³¨å†Œæ–°çš„äº‹ä»¶ï¼Œç„¶åè¿”è¿˜æ§åˆ¶æƒã€‚</li>
</ul>
<p><strong>åœ¨Proactorä¸­å®ç°è¯»ï¼š</strong></p>
<ul>
<li>å¤„ç†å™¨å‘èµ·å¼‚æ­¥è¯»æ“ä½œï¼ˆæ³¨æ„ï¼šæ“ä½œç³»ç»Ÿå¿…é¡»æ”¯æŒå¼‚æ­¥IOï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤„ç†å™¨æ— è§†IOå°±ç»ªäº‹ä»¶ï¼Œå®ƒå…³æ³¨çš„æ˜¯å®Œæˆäº‹ä»¶ã€‚</li>
<li>äº‹ä»¶åˆ†å‘å™¨ç­‰å¾…æ“ä½œå®Œæˆäº‹ä»¶ã€‚</li>
<li>åœ¨åˆ†å‘å™¨ç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œæ“ä½œç³»ç»Ÿåˆ©ç”¨å¹¶è¡Œçš„å†…æ ¸çº¿ç¨‹æ‰§è¡Œå®é™…çš„è¯»æ“ä½œï¼Œå¹¶å°†ç»“æœæ•°æ®å­˜å…¥ç”¨æˆ·è‡ªå®šä¹‰ç¼“å†²åŒºï¼Œæœ€åé€šçŸ¥äº‹ä»¶åˆ†å‘å™¨è¯»æ“ä½œå®Œæˆã€‚</li>
<li>äº‹ä»¶åˆ†å‘å™¨å‘¼å”¤å¤„ç†å™¨ã€‚</li>
<li>äº‹ä»¶å¤„ç†å™¨å¤„ç†ç”¨æˆ·è‡ªå®šä¹‰ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œç„¶åå¯åŠ¨ä¸€ä¸ªæ–°çš„å¼‚æ­¥æ“ä½œï¼Œå¹¶å°†æ§åˆ¶æƒè¿”å›äº‹ä»¶åˆ†å‘å™¨ã€‚</li>
</ul>
<p>å¯ä»¥çœ‹å‡ºï¼Œä¸¤ä¸ªæ¨¡å¼çš„ç›¸åŒç‚¹ï¼Œéƒ½æ˜¯å¯¹æŸä¸ªI/Oäº‹ä»¶çš„äº‹ä»¶é€šçŸ¥ï¼ˆå³å‘Šè¯‰æŸä¸ªæ¨¡å—ï¼Œè¿™ä¸ªI/Oæ“ä½œå¯ä»¥è¿›è¡Œæˆ–å·²ç»å®Œæˆ)ã€‚åœ¨ç»“æ„ä¸Šï¼Œä¸¤è€…ä¹Ÿæœ‰ç›¸åŒç‚¹ï¼šäº‹ä»¶åˆ†å‘å™¨è´Ÿè´£æäº¤IOæ“ä½œï¼ˆå¼‚æ­¥)ã€æŸ¥è¯¢è®¾å¤‡æ˜¯å¦å¯æ“ä½œï¼ˆåŒæ­¥)ï¼Œç„¶åå½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œå°±å›è°ƒhandlerï¼›ä¸åŒç‚¹åœ¨äºï¼Œå¼‚æ­¥æƒ…å†µä¸‹ï¼ˆProactor)ï¼Œå½“å›è°ƒhandleræ—¶ï¼Œè¡¨ç¤ºI/Oæ“ä½œå·²ç»å®Œæˆï¼›åŒæ­¥æƒ…å†µä¸‹ï¼ˆReactor)ï¼Œå›è°ƒhandleræ—¶ï¼Œè¡¨ç¤ºI/Oè®¾å¤‡å¯ä»¥è¿›è¡ŒæŸä¸ªæ“ä½œï¼ˆcan read æˆ– can write)ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†å°è¯•åº”å¯¹ä¸ºProactorå’ŒReactoræ¨¡å¼å»ºç«‹å¯ç§»æ¤æ¡†æ¶çš„æŒ‘æˆ˜ã€‚åœ¨æ”¹è¿›æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬å°†ReactoråŸæ¥ä½äºäº‹ä»¶å¤„ç†å™¨å†…çš„Read/Writeæ“ä½œç§»è‡³åˆ†å‘å™¨ï¼ˆä¸å¦¨å°†è¿™ä¸ªæ€è·¯ç§°ä¸ºâ€œæ¨¡æ‹Ÿå¼‚æ­¥â€ï¼‰ï¼Œä»¥æ­¤å¯»æ±‚å°†Reactorå¤šè·¯åŒæ­¥I/Oè½¬åŒ–ä¸ºæ¨¡æ‹Ÿå¼‚æ­¥I/Oã€‚ä»¥è¯»æ“ä½œä¸ºä¾‹å­ï¼Œæ”¹è¿›è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ³¨å†Œè¯»å°±ç»ªäº‹ä»¶å’Œç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ã€‚å¹¶ä¸ºåˆ†å‘å™¨æä¾›æ•°æ®ç¼“å†²åŒºåœ°å€ï¼Œéœ€è¦è¯»å–æ•°æ®é‡ç­‰ä¿¡æ¯ã€‚</li>
<li>åˆ†å‘å™¨ç­‰å¾…äº‹ä»¶ï¼ˆå¦‚åœ¨select()ä¸Šç­‰å¾…ï¼‰ã€‚</li>
<li>äº‹ä»¶åˆ°æ¥ï¼Œæ¿€æ´»åˆ†å‘å™¨ã€‚åˆ†å‘å™¨æ‰§è¡Œä¸€ä¸ªéé˜»å¡è¯»æ“ä½œï¼ˆå®ƒæœ‰å®Œæˆè¿™ä¸ªæ“ä½œæ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯ï¼‰ï¼Œæœ€åè°ƒç”¨å¯¹åº”å¤„ç†å™¨ã€‚</li>
<li>äº‹ä»¶å¤„ç†å™¨å¤„ç†ç”¨æˆ·è‡ªå®šä¹‰ç¼“å†²åŒºçš„æ•°æ®ï¼Œæ³¨å†Œæ–°çš„äº‹ä»¶ï¼ˆå½“ç„¶åŒæ ·è¦ç»™å‡ºæ•°æ®ç¼“å†²åŒºåœ°å€ï¼Œéœ€è¦è¯»å–çš„æ•°æ®é‡ç­‰ä¿¡æ¯ï¼‰ï¼Œæœ€åå°†æ§åˆ¶æƒè¿”è¿˜åˆ†å‘å™¨ã€‚<br>å¦‚æˆ‘ä»¬æ‰€è§ï¼Œé€šè¿‡å¯¹å¤šè·¯I/Oæ¨¡å¼åŠŸèƒ½ç»“æ„çš„æ”¹é€ ï¼Œå¯å°†Reactorè½¬åŒ–ä¸ºProactoræ¨¡å¼ã€‚æ”¹é€ å‰åï¼Œæ¨¡å‹å®é™…å®Œæˆçš„å·¥ä½œé‡æ²¡æœ‰å¢åŠ ï¼Œåªä¸è¿‡å‚ä¸è€…é—´å¯¹å·¥ä½œèŒè´£ç¨åŠ è°ƒæ¢ã€‚æ²¡æœ‰å·¥ä½œé‡çš„æ”¹å˜ï¼Œè‡ªç„¶ä¸ä¼šé€ æˆæ€§èƒ½çš„å‰Šå¼±ã€‚å¯¹å¦‚ä¸‹å„æ­¥éª¤çš„æ¯”è¾ƒï¼Œå¯ä»¥è¯æ˜å·¥ä½œé‡çš„æ’å®šï¼š</li>
</ul>
<p><strong>æ ‡å‡†/å…¸å‹çš„Reactorï¼š</strong></p>
<ul>
<li>æ­¥éª¤1ï¼šç­‰å¾…äº‹ä»¶åˆ°æ¥ï¼ˆReactorè´Ÿè´£ï¼‰ã€‚</li>
<li>æ­¥éª¤2ï¼šå°†è¯»å°±ç»ªäº‹ä»¶åˆ†å‘ç»™ç”¨æˆ·å®šä¹‰çš„å¤„ç†å™¨ï¼ˆReactorè´Ÿè´£ï¼‰ã€‚</li>
<li>æ­¥éª¤3ï¼šè¯»æ•°æ®ï¼ˆç”¨æˆ·å¤„ç†å™¨è´Ÿè´£ï¼‰ã€‚</li>
<li>æ­¥éª¤4ï¼šå¤„ç†æ•°æ®ï¼ˆç”¨æˆ·å¤„ç†å™¨è´Ÿè´£ï¼‰ã€‚</li>
</ul>
<p><strong>æ”¹è¿›å®ç°çš„æ¨¡æ‹ŸProactorï¼š</strong></p>
<ul>
<li><p>æ­¥éª¤1ï¼šç­‰å¾…äº‹ä»¶åˆ°æ¥ï¼ˆProactorè´Ÿè´£ï¼‰ã€‚</p>
</li>
<li><p>æ­¥éª¤2ï¼šå¾—åˆ°è¯»å°±ç»ªäº‹ä»¶ï¼Œæ‰§è¡Œè¯»æ•°æ®ï¼ˆç°åœ¨ç”±Proactorè´Ÿè´£ï¼‰ã€‚</p>
</li>
<li><p>æ­¥éª¤3ï¼šå°†è¯»å®Œæˆäº‹ä»¶åˆ†å‘ç»™ç”¨æˆ·å¤„ç†å™¨ï¼ˆProactorè´Ÿè´£ï¼‰ã€‚</p>
</li>
<li><p>æ­¥éª¤4ï¼šå¤„ç†æ•°æ®ï¼ˆç”¨æˆ·å¤„ç†å™¨è´Ÿè´£ï¼‰ã€‚</p>
<p>å¯¹äºä¸æä¾›å¼‚æ­¥I/O APIçš„æ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œè¿™ç§åŠæ³•å¯ä»¥éšè—Socket APIçš„äº¤äº’ç»†èŠ‚ï¼Œä»è€Œå¯¹å¤–æš´éœ²ä¸€ä¸ªå®Œæ•´çš„å¼‚æ­¥æ¥å£ã€‚å€Ÿæ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›ä¸€æ­¥æ„å»ºå®Œå…¨å¯ç§»æ¤çš„ï¼Œå¹³å°æ— å…³çš„ï¼Œæœ‰é€šç”¨å¯¹å¤–æ¥å£çš„è§£å†³æ–¹æ¡ˆã€‚</p>
</li>
</ul>
<p>ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ChannelHandler</span></span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">channelReadComplate</span><span class="params">(Channel channelï¼Œ<span class="keyword">byte</span>[] data)</span></span>;</span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">channelWritable</span><span class="params">(Channel channel)</span></span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="class"><span class="keyword">class</span> <span class="title">Channel</span></span>&#123;</span><br><span class="line">     Socket socket;</span><br><span class="line">     Event event;<span class="comment">//è¯»ï¼Œå†™æˆ–è€…è¿æ¥</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//IOçº¿ç¨‹ä¸»å¾ªç¯ï¼š</span></span><br><span class="line">   <span class="class"><span class="keyword">class</span> <span class="title">IoThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">   Channel channel;</span><br><span class="line">   <span class="keyword">while</span>(channel=Selector.select())&#123;<span class="comment">//é€‰æ‹©å°±ç»ªçš„äº‹ä»¶å’Œå¯¹åº”çš„è¿æ¥</span></span><br><span class="line">      <span class="keyword">if</span>(channel.event==accept)&#123;</span><br><span class="line">         registerNewChannelHandler(channel);<span class="comment">//å¦‚æœæ˜¯æ–°è¿æ¥ï¼Œåˆ™æ³¨å†Œä¸€ä¸ªæ–°çš„è¯»å†™å¤„ç†å™¨</span></span><br><span class="line">         Selector.interested(read);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(channel.event==write)&#123;</span><br><span class="line">         getChannelHandler(channel).channelWritable(channel);<span class="comment">//å¦‚æœå¯ä»¥å†™ï¼Œåˆ™æ‰§è¡Œå†™äº‹ä»¶</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(channel.event==read)&#123;</span><br><span class="line">          <span class="keyword">byte</span>[] data = channel.read();</span><br><span class="line">          <span class="keyword">if</span>(channel.read()==<span class="number">0</span>)<span class="comment">//æ²¡æœ‰è¯»åˆ°æ•°æ®ï¼Œè¡¨ç¤ºæœ¬æ¬¡æ•°æ®è¯»å®Œäº†</span></span><br><span class="line">          &#123;</span><br><span class="line">          getChannelHandler(channel).channelReadComplate(channelï¼Œdata;<span class="comment">//å¤„ç†è¯»å®Œæˆäº‹ä»¶</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span>(è¿‡è½½ä¿æŠ¤)&#123;</span><br><span class="line">          Selector.interested(read);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   Map&lt;Channelï¼ŒChannelHandler&gt; handlerMap;<span class="comment">//æ‰€æœ‰channelçš„å¯¹åº”äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong>Selector.wakeup()</strong></p>
<p><strong>ä¸»è¦ä½œç”¨</strong></p>
<p>è§£é™¤é˜»å¡åœ¨Selector.select()/select(long)ä¸Šçš„çº¿ç¨‹ï¼Œç«‹å³è¿”å›ã€‚</p>
<p>ä¸¤æ¬¡æˆåŠŸçš„selectä¹‹é—´å¤šæ¬¡è°ƒç”¨wakeupç­‰ä»·äºä¸€æ¬¡è°ƒç”¨ã€‚</p>
<p>å¦‚æœå½“å‰æ²¡æœ‰é˜»å¡åœ¨selectä¸Šï¼Œåˆ™æœ¬æ¬¡wakeupè°ƒç”¨å°†ä½œç”¨äºä¸‹ä¸€æ¬¡selectâ€”â€”â€œè®°å¿†â€ä½œç”¨ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦å”¤é†’ï¼Ÿ</p>
<p>æ³¨å†Œäº†æ–°çš„channelæˆ–è€…äº‹ä»¶ã€‚</p>
<p>channelå…³é—­ï¼Œå–æ¶ˆæ³¨å†Œã€‚</p>
<p>ä¼˜å…ˆçº§æ›´é«˜çš„äº‹ä»¶è§¦å‘ï¼ˆå¦‚å®šæ—¶å™¨äº‹ä»¶ï¼‰ï¼Œå¸Œæœ›åŠæ—¶å¤„ç†ã€‚</p>
<p><strong>åŸç†</strong></p>
<p>Linuxä¸Šåˆ©ç”¨pipeè°ƒç”¨åˆ›å»ºä¸€ä¸ªç®¡é“ï¼ŒWindowsä¸Šåˆ™æ˜¯ä¸€ä¸ªloopbackçš„tcpè¿æ¥ã€‚è¿™æ˜¯å› ä¸ºwin32çš„ç®¡é“æ— æ³•åŠ å…¥selectçš„fd setï¼Œå°†ç®¡é“æˆ–è€…TCPè¿æ¥åŠ å…¥select fd setã€‚</p>
<p>wakeupå¾€ç®¡é“æˆ–è€…è¿æ¥å†™å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œé˜»å¡çš„selectå› ä¸ºæœ‰I/Oäº‹ä»¶å°±ç»ªï¼Œç«‹å³è¿”å›ã€‚å¯è§ï¼Œwakeupçš„è°ƒç”¨å¼€é”€ä¸å¯å¿½è§†ã€‚</p>
<p><strong>Bufferçš„é€‰æ‹©</strong></p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿçš„ä¸€æ¬¡å†™æ“ä½œåˆ†ä¸ºä¸¤æ­¥ï¼š</p>
<ol>
<li>å°†æ•°æ®ä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°ç³»ç»Ÿç©ºé—´ã€‚</li>
<li>ä»ç³»ç»Ÿç©ºé—´å¾€ç½‘å¡å†™ã€‚åŒç†ï¼Œè¯»æ“ä½œä¹Ÿåˆ†ä¸ºä¸¤æ­¥ï¼š<br>â‘  å°†æ•°æ®ä»ç½‘å¡æ‹·è´åˆ°ç³»ç»Ÿç©ºé—´ï¼›<br>â‘¡ å°†æ•°æ®ä»ç³»ç»Ÿç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚</li>
</ol>
<p>å¯¹äºNIOæ¥è¯´ï¼Œç¼“å­˜çš„ä½¿ç”¨å¯ä»¥ä½¿ç”¨DirectByteBufferå’ŒHeapByteBufferã€‚å¦‚æœä½¿ç”¨äº†DirectByteBufferï¼Œä¸€èˆ¬æ¥è¯´å¯ä»¥å‡å°‘ä¸€æ¬¡ç³»ç»Ÿç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´ã€‚ä½†Bufferåˆ›å»ºå’Œé”€æ¯çš„æˆæœ¬æ›´é«˜ï¼Œæ›´ä¸å®œç»´æŠ¤ï¼Œé€šå¸¸ä¼šç”¨å†…å­˜æ± æ¥æé«˜æ€§èƒ½ã€‚</p>
<p>å¦‚æœæ•°æ®é‡æ¯”è¾ƒå°çš„ä¸­å°åº”ç”¨æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨heapBufferï¼›åä¹‹å¯ä»¥ç”¨directBufferã€‚</p>
<p><strong>NIOå­˜åœ¨çš„é—®é¢˜</strong></p>
<p>ä½¿ç”¨NIO != é«˜æ€§èƒ½ï¼Œå½“è¿æ¥æ•°&lt;1000ï¼Œå¹¶å‘ç¨‹åº¦ä¸é«˜æˆ–è€…å±€åŸŸç½‘ç¯å¢ƒä¸‹NIOå¹¶æ²¡æœ‰æ˜¾è‘—çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p>
<p>NIOå¹¶æ²¡æœ‰å®Œå…¨å±è”½å¹³å°å·®å¼‚ï¼Œå®ƒä»ç„¶æ˜¯åŸºäºå„ä¸ªæ“ä½œç³»ç»Ÿçš„I/Oç³»ç»Ÿå®ç°çš„ï¼Œå·®å¼‚ä»ç„¶å­˜åœ¨ã€‚ä½¿ç”¨NIOåšç½‘ç»œç¼–ç¨‹æ„å»ºäº‹ä»¶é©±åŠ¨æ¨¡å‹å¹¶ä¸å®¹æ˜“ï¼Œé™·é˜±é‡é‡ã€‚</p>
<p>æ¨èå¤§å®¶ä½¿ç”¨æˆç†Ÿçš„NIOæ¡†æ¶ï¼Œå¦‚Nettyï¼ŒMINAç­‰ã€‚è§£å†³äº†å¾ˆå¤šNIOçš„é™·é˜±ï¼Œå¹¶å±è”½äº†æ“ä½œç³»ç»Ÿçš„å·®å¼‚ï¼Œæœ‰è¾ƒå¥½çš„æ€§èƒ½å’Œç¼–ç¨‹æ¨¡å‹ã€‚</p>
<p><strong>æ€»ç»“</strong></p>
<p>æœ€åæ€»ç»“ä¸€ä¸‹åˆ°åº•NIOç»™æˆ‘ä»¬å¸¦æ¥äº†äº›ä»€ä¹ˆï¼š</p>
<blockquote>
<ul>
<li>äº‹ä»¶é©±åŠ¨æ¨¡å‹</li>
<li>é¿å…å¤šçº¿ç¨‹</li>
<li>å•çº¿ç¨‹å¤„ç†å¤šä»»åŠ¡</li>
<li>éé˜»å¡I/Oï¼ŒI/Oè¯»å†™ä¸å†é˜»å¡ï¼Œè€Œæ˜¯è¿”å›0</li>
<li>åŸºäºblockçš„ä¼ è¾“ï¼Œé€šå¸¸æ¯”åŸºäºæµçš„ä¼ è¾“æ›´é«˜æ•ˆ</li>
<li>æ›´é«˜çº§çš„IOå‡½æ•°ï¼Œzero-copy</li>
<li>IOå¤šè·¯å¤ç”¨å¤§å¤§æé«˜äº†Javaç½‘ç»œåº”ç”¨çš„å¯ä¼¸ç¼©æ€§å’Œå®ç”¨æ€§</li>
</ul>
</blockquote>
<h4 id="2-1-åå°„çš„åŸç†ï¼Œåå°„åˆ›å»ºç±»å®ä¾‹çš„ä¸‰ç§æ–¹å¼æ˜¯ä»€ä¹ˆã€‚"><a href="#2-1-åå°„çš„åŸç†ï¼Œåå°„åˆ›å»ºç±»å®ä¾‹çš„ä¸‰ç§æ–¹å¼æ˜¯ä»€ä¹ˆã€‚" class="headerlink" title="2.1 åå°„çš„åŸç†ï¼Œåå°„åˆ›å»ºç±»å®ä¾‹çš„ä¸‰ç§æ–¹å¼æ˜¯ä»€ä¹ˆã€‚"></a>2.1 åå°„çš„åŸç†ï¼Œåå°„åˆ›å»ºç±»å®ä¾‹çš„ä¸‰ç§æ–¹å¼æ˜¯ä»€ä¹ˆã€‚</h4><p><strong>æ–¹æ³•åå°„å®ä¾‹</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Proxy target = <span class="keyword">new</span> Proxy();</span><br><span class="line">        Method method = Proxy.class.getDeclaredMethod("run");</span><br><span class="line">        method.invoke(target);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"run"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡Javaçš„åå°„æœºåˆ¶ï¼Œå¯ä»¥åœ¨è¿è¡ŒæœŸé—´è°ƒç”¨å¯¹è±¡çš„ä»»ä½•æ–¹æ³•ï¼Œå¦‚æœå¤§é‡ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œè°ƒç”¨ï¼Œä¼šæœ‰æ€§èƒ½æˆ–å†…å­˜éšæ‚£ä¹ˆï¼Ÿä¸ºäº†å½»åº•äº†è§£æ–¹æ³•çš„åå°„æœºåˆ¶ï¼Œåªèƒ½ä»åº•å±‚ä»£ç å…¥æ‰‹äº†ã€‚</p>
<p><strong>Methodè·å–</strong></p>
<p>è°ƒç”¨Classç±»çš„getDeclaredMethodå¯ä»¥è·å–æŒ‡å®šæ–¹æ³•åå’Œå‚æ•°çš„æ–¹æ³•å¯¹è±¡Methodã€‚</p>
<p><strong>getDeclaredMethod</strong> </p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CallerSensitive</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Method <span class="title">getDeclaredMethod</span><span class="params">(String name, Class&lt;?&gt;... parameterTypes)</span></span></span><br><span class="line"><span class="function">     <span class="keyword">throws</span> NoSuchMethodException, SecurityException </span>&#123;</span><br><span class="line">     checkMemberAccess(Member.DECLARED, Reflection.getCallerClass(), <span class="keyword">true</span>);</span><br><span class="line">     Method method = searchMethods(privateGetDeclaredMethods(<span class="keyword">false</span>), name, parameterTypes);</span><br><span class="line">     <span class="keyword">if</span> (method == <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchMethodException(getName() + <span class="string">"."</span> + name + argumentTypesToString(parameterTypes));</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> method;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­privateGetDeclaredMethodsæ–¹æ³•ä»ç¼“å­˜æˆ–JVMä¸­è·å–è¯¥Classä¸­ç”³æ˜çš„æ–¹æ³•åˆ—è¡¨ï¼ŒsearchMethodsæ–¹æ³•å°†ä»è¿”å›çš„æ–¹æ³•åˆ—è¡¨é‡Œæ‰¾åˆ°ä¸€ä¸ªåŒ¹é…åç§°å’Œå‚æ•°çš„æ–¹æ³•å¯¹è±¡ã€‚</p>
<p><strong>searchMethods</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Method <span class="title">searchMethods</span><span class="params">(Method[] methods,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        String name,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        Class&lt;?&gt;[] parameterTypes)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Method res = <span class="keyword">null</span>;</span><br><span class="line">        String internedName = name.intern();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; methods.length; i++) &#123;</span><br><span class="line">            Method m = methods[i];</span><br><span class="line">            <span class="keyword">if</span> (m.getName() == internedName</span><br><span class="line">                &amp;&amp; arrayContentsEq(parameterTypes, m.getParameterTypes())</span><br><span class="line">                &amp;&amp; (res == <span class="keyword">null</span></span><br><span class="line">                    || res.getReturnType().isAssignableFrom(m.getReturnType())))</span><br><span class="line">                res = m;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (res == <span class="keyword">null</span> ? res : getReflectionFactory().copyMethod(res));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ‰¾åˆ°ä¸€ä¸ªåŒ¹é…çš„Methodï¼Œåˆ™é‡æ–°copyä¸€ä»½è¿”å›ï¼Œå³Method.copy()æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">Method <span class="title">copy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">// This routine enables sharing of MethodAccessor objects</span></span><br><span class="line">       <span class="comment">// among Method objects which refer to the same underlying</span></span><br><span class="line">       <span class="comment">// method in the VM. (All of this contortion is only necessary</span></span><br><span class="line">       <span class="comment">// because of the "accessibility" bit in AccessibleObject,</span></span><br><span class="line">       <span class="comment">// which implicitly requires that new java.lang.reflect</span></span><br><span class="line">       <span class="comment">// objects be fabricated for each reflective call on Class</span></span><br><span class="line">       <span class="comment">// objects.)</span></span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">this</span>.root != <span class="keyword">null</span>)</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Can not copy a non-root Method"</span>);</span><br><span class="line"></span><br><span class="line">       Method res = <span class="keyword">new</span> Method(clazz, name, parameterTypes, returnType,</span><br><span class="line">                               exceptionTypes, modifiers, slot, signature,</span><br><span class="line">                               annotations, parameterAnnotations, annotationDefault);</span><br><span class="line">       res.root = <span class="keyword">this</span>;</span><br><span class="line">       <span class="comment">// Might as well eagerly propagate this if already present</span></span><br><span class="line">       res.methodAccessor = methodAccessor;</span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€æ¬¡æ¯æ¬¡è°ƒç”¨getDeclaredMethodæ–¹æ³•è¿”å›çš„Methodå¯¹è±¡å…¶å®éƒ½æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä¸”æ–°å¯¹è±¡çš„rootå±æ€§éƒ½æŒ‡å‘åŸæ¥çš„Methodå¯¹è±¡ï¼Œå¦‚æœéœ€è¦é¢‘ç¹è°ƒç”¨ï¼Œæœ€å¥½æŠŠMethodå¯¹è±¡ç¼“å­˜èµ·æ¥ã€‚</p>
<p><strong>privateGetDeclaredMethods</strong></p>
<p>ä»ç¼“å­˜æˆ–JVMä¸­è·å–è¯¥Classä¸­ç”³æ˜çš„æ–¹æ³•åˆ—è¡¨ï¼Œå®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Method[] privateGetDeclaredMethods(<span class="keyword">boolean</span> publicOnly) &#123;</span><br><span class="line">        checkInitted();</span><br><span class="line">        Method[] res;</span><br><span class="line">        ReflectionData&lt;T&gt; rd = reflectionData();</span><br><span class="line">        <span class="keyword">if</span> (rd != <span class="keyword">null</span>) &#123;</span><br><span class="line">            res = publicOnly ? rd.declaredPublicMethods : rd.declaredMethods;</span><br><span class="line">            <span class="keyword">if</span> (res != <span class="keyword">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// No cached value available; request value from VM</span></span><br><span class="line">        res = Reflection.filterMethods(<span class="keyword">this</span>, getDeclaredMethods0(publicOnly));</span><br><span class="line">        <span class="keyword">if</span> (rd != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (publicOnly) &#123;</span><br><span class="line">                rd.declaredPublicMethods = res;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                rd.declaredMethods = res;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­reflectionData()æ–¹æ³•å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ReflectionData&lt;T&gt; <span class="title">reflectionData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SoftReference&lt;ReflectionData&lt;T&gt;&gt; reflectionData = <span class="keyword">this</span>.reflectionData;</span><br><span class="line">       <span class="keyword">int</span> classRedefinedCount = <span class="keyword">this</span>.classRedefinedCount;</span><br><span class="line">       ReflectionData&lt;T&gt; rd;</span><br><span class="line">       <span class="keyword">if</span> (useCaches &amp;&amp;</span><br><span class="line">           reflectionData != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">           (rd = reflectionData.get()) != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">           rd.redefinedCount == classRedefinedCount) &#123;</span><br><span class="line">           <span class="keyword">return</span> rd;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// else no SoftReference or cleared SoftReference or stale ReflectionData</span></span><br><span class="line">       <span class="comment">// -&gt; create and replace new instance</span></span><br><span class="line">       <span class="keyword">return</span> newReflectionData(reflectionData, classRedefinedCount);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸ªæ¯”è¾ƒé‡è¦çš„æ•°æ®ç»“æ„ReflectionDataï¼Œç”¨æ¥ç¼“å­˜ä»JVMä¸­è¯»å–ç±»çš„å¦‚ä¸‹å±æ€§æ•°æ®ï¼š</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// reflection data that might get invalidated when JVM TI RedefineClasses() is called</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectionData</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">       <span class="keyword">volatile</span> Field[] declaredFields;</span><br><span class="line">       <span class="keyword">volatile</span> Field[] publicFields;</span><br><span class="line">       <span class="keyword">volatile</span> Method[] declaredMethods;</span><br><span class="line">       <span class="keyword">volatile</span> Method[] publicMethods;</span><br><span class="line">       <span class="keyword">volatile</span> Constructor&lt;T&gt;[] declaredConstructors;</span><br><span class="line">       <span class="keyword">volatile</span> Constructor&lt;T&gt;[] publicConstructors;</span><br><span class="line">       <span class="comment">// Intermediate results for getFields and getMethods</span></span><br><span class="line">       <span class="keyword">volatile</span> Field[] declaredPublicFields;</span><br><span class="line">       <span class="keyword">volatile</span> Method[] declaredPublicMethods;</span><br><span class="line">       <span class="keyword">volatile</span> Class&lt;?&gt;[] interfaces;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Value of classRedefinedCount when we created this ReflectionData instance</span></span><br><span class="line">       <span class="keyword">final</span> <span class="keyword">int</span> redefinedCount;</span><br><span class="line"></span><br><span class="line">       ReflectionData(<span class="keyword">int</span> redefinedCount) &#123;</span><br><span class="line">           <span class="keyword">this</span>.redefinedCount = redefinedCount;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>ä»reflectionData()æ–¹æ³•å®ç°å¯ä»¥çœ‹å‡ºï¼šreflectionDataå¯¹è±¡æ˜¯SoftReferenceç±»å‹çš„ï¼Œè¯´æ˜åœ¨å†…å­˜ç´§å¼ æ—¶å¯èƒ½ä¼šè¢«å›æ”¶ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥é€šè¿‡<code>-XX:SoftRefLRUPolicyMSPerMB</code>å‚æ•°æ§åˆ¶å›æ”¶çš„æ—¶æœºï¼Œåªè¦å‘ç”ŸGCå°±ä¼šå°†å…¶å›æ”¶ï¼Œå¦‚æœreflectionDataè¢«å›æ”¶ä¹‹åï¼Œåˆæ‰§è¡Œäº†åå°„æ–¹æ³•ï¼Œé‚£åªèƒ½é€šè¿‡newReflectionDataæ–¹æ³•é‡æ–°åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„å¯¹è±¡äº†ï¼ŒnewReflectionDataæ–¹æ³•å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ReflectionData&lt;T&gt; <span class="title">newReflectionData</span><span class="params">(SoftReference&lt;ReflectionData&lt;T&gt;&gt; oldReflectionData,</span></span></span><br><span class="line"><span class="function"><span class="params">                                               <span class="keyword">int</span> classRedefinedCount)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (!useCaches) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">           ReflectionData&lt;T&gt; rd = <span class="keyword">new</span> ReflectionData&lt;&gt;(classRedefinedCount);</span><br><span class="line">           <span class="comment">// try to CAS it...</span></span><br><span class="line">           <span class="keyword">if</span> (Atomic.casReflectionData(<span class="keyword">this</span>, oldReflectionData, <span class="keyword">new</span> SoftReference&lt;&gt;(rd))) &#123;</span><br><span class="line">               <span class="keyword">return</span> rd;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// else retry</span></span><br><span class="line">           oldReflectionData = <span class="keyword">this</span>.reflectionData;</span><br><span class="line">           classRedefinedCount = <span class="keyword">this</span>.classRedefinedCount;</span><br><span class="line">           <span class="keyword">if</span> (oldReflectionData != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">               (rd = oldReflectionData.get()) != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">               rd.redefinedCount == classRedefinedCount) &#123;</span><br><span class="line">               <span class="keyword">return</span> rd;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p> é€šè¿‡unsafe.compareAndSwapObjectæ–¹æ³•é‡æ–°è®¾ç½®reflectionDataå­—æ®µï¼›</p>
<p>åœ¨privateGetDeclaredMethodsæ–¹æ³•ä¸­ï¼Œå¦‚æœé€šè¿‡reflectionData()è·å¾—çš„ReflectionDataå¯¹è±¡ä¸ä¸ºç©ºï¼Œåˆ™å°è¯•ä»ReflectionDataå¯¹è±¡ä¸­è·å–declaredMethodså±æ€§ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ï¼Œæˆ–åˆ™è¢«GCå›æ”¶ä¹‹åï¼Œé‡æ–°åˆå§‹åŒ–åçš„ç±»å±æ€§ä¸ºç©ºï¼Œåˆ™éœ€è¦é‡æ–°åˆ°JVMä¸­è·å–ä¸€æ¬¡ï¼Œå¹¶èµ‹å€¼ç»™ReflectionDataï¼Œä¸‹æ¬¡è°ƒç”¨å°±å¯ä»¥ä½¿ç”¨ç¼“å­˜æ•°æ®äº†ã€‚</p>
<p><strong>Methodè°ƒç”¨</strong></p>
<p>è·å–åˆ°æŒ‡å®šçš„æ–¹æ³•å¯¹è±¡Methodä¹‹åï¼Œå°±å¯ä»¥è°ƒç”¨å®ƒçš„invokeæ–¹æ³•äº†ï¼Œinvokeå®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CallerSensitive</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object obj, Object... args)</span></span></span><br><span class="line"><span class="function">       <span class="keyword">throws</span> IllegalAccessException, IllegalArgumentException,</span></span><br><span class="line"><span class="function">          InvocationTargetException</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (!override) &#123;</span><br><span class="line">           <span class="keyword">if</span> (!Reflection.quickCheckMemberAccess(clazz, modifiers)) &#123;</span><br><span class="line">               Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">               checkAccess(caller, clazz, obj, modifiers);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       MethodAccessor ma = methodAccessor;             <span class="comment">// read volatile</span></span><br><span class="line">       <span class="keyword">if</span> (ma == <span class="keyword">null</span>) &#123;</span><br><span class="line">           ma = acquireMethodAccessor();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> ma.invoke(obj, args);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>åº”è¯¥æ³¨æ„åˆ°ï¼šè¿™é‡Œçš„MethodAccessorå¯¹è±¡æ˜¯invokeæ–¹æ³•å®ç°çš„å…³é”®ï¼Œä¸€å¼€å§‹methodAccessorä¸ºç©ºï¼Œéœ€è¦è°ƒç”¨acquireMethodAccessorç”Ÿæˆä¸€ä¸ªæ–°çš„MethodAccessorå¯¹è±¡ï¼ŒMethodAccessoræœ¬èº«å°±æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MethodAccessor</span> </span>&#123;</span><br><span class="line">    <span class="function">Object <span class="title">invoke</span><span class="params">(Object var1, Object[] var2)</span> <span class="keyword">throws</span> IllegalArgumentException, InvocationTargetException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> åœ¨acquireMethodAccessoræ–¹æ³•ä¸­ï¼Œä¼šé€šè¿‡ReflectionFactoryç±»çš„newMethodAccessoråˆ›å»ºä¸€ä¸ªå®ç°äº†MethodAccessoræ¥å£çš„å¯¹è±¡ï¼Œå®ç°å¦‚ä¸‹ï¼š</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> MethodAccessor <span class="title">newMethodAccessor</span><span class="params">(Method var1)</span> </span>&#123;</span><br><span class="line">       checkInitted();</span><br><span class="line">       <span class="keyword">if</span> (noInflation &amp;&amp; !ReflectUtil.isVMAnonymousClass(var1.getDeclaringClass())) &#123;</span><br><span class="line">           <span class="keyword">return</span> (<span class="keyword">new</span> MethodAccessorGenerator()).generateMethod(var1.getDeclaringClass(), var1.getName(), var1.getParameterTypes(), var1.getReturnType(), var1.getExceptionTypes(), var1.getModifiers());</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           NativeMethodAccessorImpl var2 = <span class="keyword">new</span> NativeMethodAccessorImpl(var1);</span><br><span class="line">           DelegatingMethodAccessorImpl var3 = <span class="keyword">new</span> DelegatingMethodAccessorImpl(var2);</span><br><span class="line">           var2.setParent(var3);</span><br><span class="line">           <span class="keyword">return</span> var3;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ReflectionFactoryç±»ä¸­ï¼Œæœ‰2ä¸ªé‡è¦çš„å­—æ®µï¼šnoInflation(é»˜è®¤false)å’ŒinflationThreshold(é»˜è®¤15)ï¼Œåœ¨checkInittedæ–¹æ³•ä¸­å¯ä»¥é€šè¿‡-Dsun.reflect.inflationThreshold=xxxå’Œ-Dsun.reflect.noInflation=trueå¯¹è¿™ä¸¤ä¸ªå­—æ®µé‡æ–°è®¾ç½®ï¼Œè€Œä¸”åªä¼šè®¾ç½®ä¸€æ¬¡ï¼›</p>
<p>å¦‚æœnoInflationä¸ºfalseï¼Œæ–¹æ³•newMethodAccessoréƒ½ä¼šè¿”å›DelegatingMethodAccessorImplå¯¹è±¡ï¼ŒDelegatingMethodAccessorImplçš„ç±»å®ç°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DelegatingMethodAccessorImpl</span> <span class="keyword">extends</span> <span class="title">MethodAccessorImpl</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MethodAccessorImpl delegate;</span><br><span class="line"></span><br><span class="line">    DelegatingMethodAccessorImpl(MethodAccessorImpl var1) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setDelegate(var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object var1, Object[] var2)</span> <span class="keyword">throws</span> IllegalArgumentException, InvocationTargetException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.delegate.invoke(var1, var2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setDelegate</span><span class="params">(MethodAccessorImpl var1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.delegate = var1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶å®ï¼ŒDelegatingMethodAccessorImplå¯¹è±¡å°±æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œè´Ÿè´£è°ƒç”¨è¢«ä»£ç†å¯¹è±¡delegateçš„invokeæ–¹æ³•ï¼Œå…¶ä¸­delegateå‚æ•°ç›®å‰æ˜¯NativeMethodAccessorImplå¯¹è±¡ï¼Œæ‰€ä»¥æœ€ç»ˆMethodçš„invokeæ–¹æ³•è°ƒç”¨çš„æ˜¯NativeMethodAccessorImplå¯¹è±¡invokeæ–¹æ³•ï¼Œå®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object var1, Object[] var2)</span> <span class="keyword">throws</span> IllegalArgumentException, InvocationTargetException </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (++<span class="keyword">this</span>.numInvocations &gt; ReflectionFactory.inflationThreshold() &amp;&amp; !ReflectUtil.isVMAnonymousClass(<span class="keyword">this</span>.method.getDeclaringClass())) &#123;</span><br><span class="line">           MethodAccessorImpl var3 = (MethodAccessorImpl)(<span class="keyword">new</span> MethodAccessorGenerator()).generateMethod(<span class="keyword">this</span>.method.getDeclaringClass(), <span class="keyword">this</span>.method.getName(), <span class="keyword">this</span>.method.getParameterTypes(), <span class="keyword">this</span>.method.getReturnType(), <span class="keyword">this</span>.method.getExceptionTypes(), <span class="keyword">this</span>.method.getModifiers());</span><br><span class="line">           <span class="keyword">this</span>.parent.setDelegate(var3);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> invoke0(<span class="keyword">this</span>.method, var1, var2);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç”¨åˆ°äº†ReflectionFactoryç±»ä¸­çš„inflationThresholdï¼Œå½“delegateè°ƒç”¨äº†15æ¬¡invokeæ–¹æ³•ä¹‹åï¼Œå¦‚æœç»§ç»­è°ƒç”¨å°±é€šè¿‡MethodAccessorGeneratorç±»çš„generateMethodæ–¹æ³•ç”ŸæˆMethodAccessorImplå¯¹è±¡ï¼Œå¹¶è®¾ç½®ä¸ºdelegateå¯¹è±¡ï¼Œè¿™æ ·ä¸‹æ¬¡æ‰§è¡ŒMethod.invokeæ—¶ï¼Œå°±è°ƒç”¨æ–°å»ºçš„MethodAccessorå¯¹è±¡çš„invoke()æ–¹æ³•äº†ã€‚</p>
<p><strong>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š</strong><br> generateMethodæ–¹æ³•åœ¨ç”ŸæˆMethodAccessorImplå¯¹è±¡æ—¶ï¼Œä¼šåœ¨å†…å­˜ä¸­ç”Ÿæˆå¯¹åº”çš„å­—èŠ‚ç ï¼Œå¹¶è°ƒç”¨ClassDefiner.defineClassåˆ›å»ºå¯¹åº”çš„classå¯¹è±¡ï¼Œå®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> (MagicAccessorImpl)AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;MagicAccessorImpl&gt;() &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> MagicAccessorImpl <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> (MagicAccessorImpl)ClassDefiner.defineClass(var13, var17, <span class="number">0</span>, var17.length, var1.getClassLoader()).newInstance();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IllegalAccessException | InstantiationException var2) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(var2);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure>
<p>åœ¨ClassDefiner.defineClassæ–¹æ³•å®ç°ä¸­ï¼Œæ¯è¢«è°ƒç”¨ä¸€æ¬¡éƒ½ä¼šç”Ÿæˆä¸€ä¸ªDelegatingClassLoaderç±»åŠ è½½å™¨å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> Class&lt;?&gt; defineClass(String var0, <span class="keyword">byte</span>[] var1, <span class="keyword">int</span> var2, <span class="keyword">int</span> var3, <span class="keyword">final</span> ClassLoader var4) &#123;</span><br><span class="line">        ClassLoader var5 = (ClassLoader)AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;ClassLoader&gt;() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> ClassLoader <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> DelegatingClassLoader(var4);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> unsafe.defineClass(var0, var1, var2, var3, var5, (ProtectionDomain)<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ¯æ¬¡éƒ½ç”Ÿæˆæ–°çš„ç±»åŠ è½½å™¨ï¼Œæ˜¯ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥å¸è½½è¿™äº›ç”Ÿæˆçš„ç±»ï¼Œå› ä¸ºç±»çš„å¸è½½æ˜¯åªæœ‰åœ¨ç±»åŠ è½½å™¨å¯ä»¥è¢«å›æ”¶çš„æƒ…å†µä¸‹æ‰ä¼šè¢«å›æ”¶çš„ï¼Œå¦‚æœç”¨äº†åŸæ¥çš„ç±»åŠ è½½å™¨ï¼Œé‚£å¯èƒ½å¯¼è‡´è¿™äº›æ–°åˆ›å»ºçš„ç±»ä¸€ç›´æ— æ³•è¢«å¸è½½ï¼Œä»å…¶è®¾è®¡æ¥çœ‹æœ¬èº«å°±ä¸å¸Œæœ›è¿™äº›ç±»ä¸€ç›´å­˜åœ¨å†…å­˜é‡Œçš„ï¼Œåœ¨éœ€è¦çš„æ—¶å€™æœ‰å°±è¡Œäº†ã€‚</p>
<p><strong>è·å–class</strong></p>
<p>Class ç±»çš„å®ä¾‹è¡¨ç¤ºæ­£åœ¨è¿è¡Œçš„ Java åº”ç”¨ç¨‹åºä¸­çš„ç±»å’Œæ¥å£ã€‚è·å–ç±»çš„Classå¯¹è±¡æœ‰å¤šç§æ–¹å¼ï¼š</p>
<ul>
<li>è°ƒç”¨getClass    </li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Boolean var1 = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">Class&lt;?&gt; classType2 = var1.getClass();</span><br><span class="line"></span><br><span class="line">System.out.println(classType2);</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š<span class="class"><span class="keyword">class</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Boolean</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>è¿ç”¨.class è¯­æ³•    </li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt; classType4 = Boolean<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line"></span><br><span class="line">System.out.println(classType4);</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š<span class="class"><span class="keyword">class</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Boolean</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>è¿ç”¨static method Class.forName()    </li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt; classType5 = Class.forName(<span class="string">"java.lang.Boolean"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(classType5);</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š<span class="class"><span class="keyword">class</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Boolean</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>è¿ç”¨primitive wrapper classesçš„TYPE è¯­æ³•</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">è¿™é‡Œè¿”å›çš„æ˜¯åŸç”Ÿç±»å‹ï¼Œå’ŒBoolean<span class="class">.<span class="keyword">class</span>è¿”å›çš„ä¸åŒ</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">Class</span>&lt;?&gt; <span class="title">classType3</span> </span>= Boolean.TYPE;</span><br><span class="line"></span><br><span class="line">System.out.println(classType3);Â Â Â Â Â Â   </span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š<span class="keyword">boolean</span></span><br></pre></td></tr></table></figure>
<p><strong>å®ä¾‹åŒ–ç±»å¯¹è±¡</strong></p>
<ul>
<li>é€šè¿‡ Class å¯¹è±¡çš„ newInstance() æ–¹æ³•ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class clz = Person<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">Person person = (Person)clz.newInstance();</span><br></pre></td></tr></table></figure>
<ul>
<li>é€šè¿‡ Constructor å¯¹è±¡çš„ newInstance() æ–¹æ³•</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class clz = Person<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">Constructor constructor = clz.getConstructor();</span><br><span class="line">Person person = (Person)constructor.newInstance();</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ Constructor å¯¹è±¡åˆ›å»ºç±»å¯¹è±¡å¯ä»¥é€‰æ‹©ç‰¹å®šæ„é€ æ–¹æ³•ï¼Œè€Œé€šè¿‡ Class å¯¹è±¡åˆ™åªèƒ½ä½¿ç”¨é»˜è®¤çš„æ— å‚æ•°æ„é€ æ–¹æ³•ã€‚ä¸‹é¢çš„ä»£ç å°±è°ƒç”¨äº†ä¸€ä¸ªæœ‰å‚æ•°çš„æ„é€ æ–¹æ³•è¿›è¡Œäº†ç±»å¯¹è±¡çš„åˆå§‹åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class clz = Person<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">Constructor constructor = clz.getConstructor(String<span class="class">.<span class="keyword">class</span>, <span class="title">int</span>.<span class="title">class</span>)</span>;</span><br><span class="line">Person person = (Person)constructor.newInstance(<span class="string">"jack"</span>,<span class="number">21</span>);</span><br></pre></td></tr></table></figure>
<h4 id="2-2-åå°„ä¸­ï¼ŒClass-forNameå’ŒClassLoaderåŒºåˆ«-ã€‚"><a href="#2-2-åå°„ä¸­ï¼ŒClass-forNameå’ŒClassLoaderåŒºåˆ«-ã€‚" class="headerlink" title="2.2 åå°„ä¸­ï¼ŒClass.forNameå’ŒClassLoaderåŒºåˆ« ã€‚"></a>2.2 åå°„ä¸­ï¼ŒClass.forNameå’ŒClassLoaderåŒºåˆ« ã€‚</h4><p><strong>ClassLoader.loadClass()</strong>ä¸<strong>Class.forName()</strong>å¤§å®¶éƒ½çŸ¥é“æ˜¯åå°„ç”¨æ¥æ„é€ ç±»çš„æ–¹æ³•ï¼Œä½†æ˜¯ä»–ä»¬çš„ç”¨æ³•è¿˜æ˜¯æœ‰ä¸€å®šåŒºåˆ«çš„ã€‚</p>
<p>åœ¨è®²åŒºåˆ«ä¹‹å‰ï¼Œæˆ‘è§‰å¾—å¾ˆæœ‰ä¸è¦æŠŠç±»çš„åŠ è½½è¿‡ç¨‹åœ¨æ­¤æ•´ç†ä¸€ä¸‹ã€‚</p>
<p>åœ¨Javaä¸­ï¼Œç±»è£…è½½å™¨æŠŠä¸€ä¸ªç±»è£…å…¥Javaè™šæ‹Ÿæœºä¸­ï¼Œè¦ç»è¿‡ä¸‰ä¸ªæ­¥éª¤æ¥å®Œæˆï¼šè£…è½½ã€é“¾æ¥å’Œåˆå§‹åŒ–ï¼Œå…¶ä¸­é“¾æ¥åˆå¯ä»¥åˆ†æˆæ ¡éªŒã€å‡†å¤‡å’Œè§£æä¸‰æ­¥ï¼Œé™¤äº†è§£æå¤–ï¼Œå…¶å®ƒæ­¥éª¤æ˜¯ä¸¥æ ¼æŒ‰ç…§é¡ºåºå®Œæˆçš„ï¼Œå„ä¸ªæ­¥éª¤çš„ä¸»è¦å·¥ä½œå¦‚ä¸‹ï¼š</p>
<ul>
<li><p><strong>è£…è½½</strong>ï¼šæŸ¥æ‰¾å’Œå¯¼å…¥ç±»æˆ–æ¥å£çš„äºŒè¿›åˆ¶æ•°æ®ï¼› </p>
</li>
<li><p><strong>é“¾æ¥</strong>ï¼šæ‰§è¡Œä¸‹é¢çš„æ ¡éªŒã€å‡†å¤‡å’Œè§£ææ­¥éª¤ï¼Œå…¶ä¸­è§£ææ­¥éª¤æ˜¯å¯ä»¥é€‰æ‹©çš„ï¼› </p>
</li>
<li><p><strong>æ ¡éªŒ</strong>ï¼šæ£€æŸ¥å¯¼å…¥ç±»æˆ–æ¥å£çš„äºŒè¿›åˆ¶æ•°æ®çš„æ­£ç¡®æ€§ï¼› </p>
</li>
<li><p><strong>å‡†å¤‡</strong>ï¼šç»™ç±»çš„é™æ€å˜é‡åˆ†é…å¹¶åˆå§‹åŒ–å­˜å‚¨ç©ºé—´ï¼› </p>
</li>
<li><p><strong>è§£æ</strong>ï¼šå°†ç¬¦å·å¼•ç”¨è½¬æˆç›´æ¥å¼•ç”¨ï¼› </p>
</li>
<li><p><strong>åˆå§‹åŒ–</strong>ï¼šæ¿€æ´»ç±»çš„é™æ€å˜é‡çš„åˆå§‹åŒ–Javaä»£ç å’Œé™æ€Javaä»£ç å—ã€‚</p>
<p>äºæ˜¯ä¹æˆ‘ä»¬å¯ä»¥å¼€å§‹çœ‹2è€…çš„åŒºåˆ«äº†ã€‚</p>
</li>
</ul>
<p>Class.forName(className)æ–¹æ³•ï¼Œå…¶å®è°ƒç”¨çš„æ–¹æ³•æ˜¯<strong>Class.forName(className,true,classloader)</strong>;æ³¨æ„çœ‹ç¬¬2ä¸ªbooleanå‚æ•°ï¼Œå®ƒè¡¨ç¤ºçš„æ„æ€ï¼Œ<strong>åœ¨loadClassåå¿…é¡»åˆå§‹åŒ–</strong>ã€‚æ¯”è¾ƒä¸‹jvmåŠ è½½ç±»çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°åœ¨æ‰§è¡Œè¿‡æ­¤æ–¹æ³•åï¼Œç›®æ ‡å¯¹è±¡çš„ staticå—ä»£ç å·²ç»è¢«æ‰§è¡Œï¼Œstaticå‚æ•°ä¹Ÿå·²ç»è¢«åˆå§‹åŒ–ã€‚</p>
<p>å†çœ‹ClassLoader.loadClass(className)æ–¹æ³•ï¼Œå…¶å®ä»–è°ƒç”¨çš„æ–¹æ³•æ˜¯<strong>ClassLoader.loadClass(className,false)</strong>;è¿˜æ˜¯æ³¨æ„çœ‹ç¬¬2ä¸ª booleanå‚æ•°ï¼Œè¯¥å‚æ•°è¡¨ç¤º<strong>ç›®æ ‡å¯¹è±¡è¢«è£…è½½åä¸è¿›è¡Œé“¾æ¥</strong>ï¼Œè¿™å°±æ„å‘³è¿™<strong>ä¸ä¼šå»æ‰§è¡Œè¯¥ç±»é™æ€å—ä¸­é—´çš„å†…</strong>å®¹ã€‚å› æ­¤2è€…çš„åŒºåˆ«å°±æ˜¾è€Œæ˜“è§äº†ã€‚</p>
<p>æœ€åè¿˜æœ‰å¿…è¦åœ¨æ­¤æä¸€ä¸‹newæ–¹æ³•å’ŒnewInstanceæ–¹æ³•çš„åŒºåˆ«</p>
<p><strong>newInstance</strong>: å¼±ç±»å‹ã€‚<strong>ä½æ•ˆç‡</strong>ã€‚<strong>åªèƒ½è°ƒç”¨æ— å‚æ„é€ </strong>ã€‚</p>
<p><strong>new</strong>: å¼ºç±»å‹ã€‚ç›¸å¯¹é«˜æ•ˆã€‚<strong>èƒ½è°ƒç”¨ä»»ä½•publicæ„é€ </strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨JDBCç¼–ç¨‹ä¸­ï¼Œå¸¸çœ‹åˆ°è¿™æ ·çš„ç”¨æ³•ï¼ŒClass.forName(â€œcom.mysql.jdbc.Driverâ€)ï¼Œå¦‚æœæ¢æˆäº† getClass().getClassLoader().loadClass(â€œcom.mysql.jdbc.Driverâ€)ï¼Œå°±ä¸è¡Œã€‚</p>
<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ‰“å¼€com.mysql.jdbc.Driverçš„æºä»£ç çœ‹çœ‹ï¼Œ</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Register ourselves with the DriverManager</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        java.sql.DriverManager.registerDriver(<span class="keyword">new</span> Driver());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException E) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Can't register driver!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Driveråœ¨staticå—ä¸­ä¼šæ³¨å†Œè‡ªå·±åˆ°java.sql.DriverManagerã€‚è€Œstaticå—å°±æ˜¯åœ¨Classçš„åˆå§‹åŒ–ä¸­è¢«æ‰§è¡Œã€‚æ‰€ä»¥è¿™ä¸ªåœ°æ–¹å°±åªèƒ½ç”¨Class.forName(className)ã€‚</p>
<h4 id="2-3-æè¿°åŠ¨æ€ä»£ç†çš„å‡ ç§å®ç°æ–¹å¼ï¼Œåˆ†åˆ«è¯´å‡ºç›¸åº”çš„ä¼˜ç¼ºç‚¹ã€‚"><a href="#2-3-æè¿°åŠ¨æ€ä»£ç†çš„å‡ ç§å®ç°æ–¹å¼ï¼Œåˆ†åˆ«è¯´å‡ºç›¸åº”çš„ä¼˜ç¼ºç‚¹ã€‚" class="headerlink" title="2.3 æè¿°åŠ¨æ€ä»£ç†çš„å‡ ç§å®ç°æ–¹å¼ï¼Œåˆ†åˆ«è¯´å‡ºç›¸åº”çš„ä¼˜ç¼ºç‚¹ã€‚"></a>2.3 æè¿°åŠ¨æ€ä»£ç†çš„å‡ ç§å®ç°æ–¹å¼ï¼Œåˆ†åˆ«è¯´å‡ºç›¸åº”çš„ä¼˜ç¼ºç‚¹ã€‚</h4><p>ä»£ç†å¯ä»¥åˆ†ä¸º â€œé™æ€ä»£ç†â€ å’Œ â€œåŠ¨æ€ä»£ç†â€ï¼ŒåŠ¨æ€ä»£ç†åˆåˆ†ä¸º â€œJDKåŠ¨æ€ä»£ç†â€ å’Œ â€œCGLIBåŠ¨æ€ä»£ç†â€ å®ç°ã€‚</p>
<p><strong>é™æ€ä»£ç†</strong>ï¼šä»£ç†å¯¹è±¡å’Œå®é™…å¯¹è±¡éƒ½ç»§æ‰¿äº†åŒä¸€ä¸ªæ¥å£ï¼Œåœ¨ä»£ç†å¯¹è±¡ä¸­æŒ‡å‘çš„æ˜¯å®é™…å¯¹è±¡çš„å®ä¾‹ï¼Œè¿™æ ·å¯¹å¤–æš´éœ²çš„æ˜¯ä»£ç†å¯¹è±¡è€ŒçœŸæ­£è°ƒç”¨çš„æ˜¯ Real Object</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå¯ä»¥å¾ˆå¥½çš„ä¿æŠ¤å®é™…å¯¹è±¡çš„ä¸šåŠ¡é€»è¾‘å¯¹å¤–æš´éœ²ï¼Œä»è€Œæé«˜å®‰å…¨æ€§ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šä¸åŒçš„æ¥å£è¦æœ‰ä¸åŒçš„ä»£ç†ç±»å®ç°ï¼Œä¼šå¾ˆå†—ä½™</li>
</ul>
<p><strong>JDK åŠ¨æ€ä»£ç†</strong>ï¼š</p>
<ul>
<li>ä¸ºäº†è§£å†³é™æ€ä»£ç†ä¸­ï¼Œç”Ÿæˆå¤§é‡çš„ä»£ç†ç±»é€ æˆçš„å†—ä½™ï¼›</li>
<li>JDK åŠ¨æ€ä»£ç†åªéœ€è¦å®ç° InvocationHandler æ¥å£ï¼Œé‡å†™ invoke æ–¹æ³•ä¾¿å¯ä»¥å®Œæˆä»£ç†çš„å®ç°ï¼Œ</li>
<li>jdkçš„ä»£ç†æ˜¯åˆ©ç”¨åå°„ç”Ÿæˆä»£ç†ç±» Proxyxx.class ä»£ç†ç±»å­—èŠ‚ç ï¼Œå¹¶ç”Ÿæˆå¯¹è±¡</li>
<li>jdkåŠ¨æ€ä»£ç†ä¹‹æ‰€ä»¥<strong>åªèƒ½ä»£ç†æ¥å£</strong>æ˜¯å› ä¸º<strong>ä»£ç†ç±»æœ¬èº«å·²ç»extendsäº†Proxyï¼Œè€Œjavaæ˜¯ä¸å…è®¸å¤šé‡ç»§æ‰¿çš„</strong>ï¼Œä½†æ˜¯å…è®¸å®ç°å¤šä¸ªæ¥å£</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šè§£å†³äº†é™æ€ä»£ç†ä¸­å†—ä½™çš„ä»£ç†å®ç°ç±»é—®é¢˜ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šJDK åŠ¨æ€ä»£ç†æ˜¯åŸºäºæ¥å£è®¾è®¡å®ç°çš„ï¼Œå¦‚æœæ²¡æœ‰æ¥å£ï¼Œä¼šæŠ›å¼‚å¸¸ã€‚</li>
</ul>
<p><strong>CGLIB ä»£ç†</strong>ï¼š</p>
<ul>
<li>ç”±äº JDK åŠ¨æ€ä»£ç†é™åˆ¶äº†åªèƒ½åŸºäºæ¥å£è®¾è®¡ï¼Œè€Œå¯¹äºæ²¡æœ‰æ¥å£çš„æƒ…å†µï¼ŒJDKæ–¹å¼è§£å†³ä¸äº†ï¼›</li>
<li>CGLib é‡‡ç”¨äº†éå¸¸åº•å±‚çš„å­—èŠ‚ç æŠ€æœ¯ï¼Œå…¶åŸç†æ˜¯é€šè¿‡å­—èŠ‚ç æŠ€æœ¯ä¸ºä¸€ä¸ªç±»åˆ›å»ºå­ç±»ï¼Œå¹¶åœ¨å­ç±»ä¸­é‡‡ç”¨æ–¹æ³•æ‹¦æˆªçš„æŠ€æœ¯æ‹¦æˆªæ‰€æœ‰çˆ¶ç±»æ–¹æ³•çš„è°ƒç”¨ï¼Œé¡ºåŠ¿ç»‡å…¥æ¨ªåˆ‡é€»è¾‘ï¼Œæ¥å®ŒæˆåŠ¨æ€ä»£ç†çš„å®ç°ã€‚</li>
<li>å®ç°æ–¹å¼å®ç° MethodInterceptor æ¥å£ï¼Œé‡å†™ intercept æ–¹æ³•ï¼Œé€šè¿‡ Enhancer ç±»çš„å›è°ƒæ–¹æ³•æ¥å®ç°ã€‚</li>
<li>ä½†æ˜¯CGLibåœ¨åˆ›å»ºä»£ç†å¯¹è±¡æ—¶æ‰€èŠ±è´¹çš„æ—¶é—´å´æ¯”JDKå¤šå¾—å¤šï¼Œæ‰€ä»¥å¯¹äºå•ä¾‹çš„å¯¹è±¡ï¼Œå› ä¸ºæ— éœ€é¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼Œç”¨CGLibåˆé€‚ï¼Œåä¹‹ï¼Œä½¿ç”¨JDKæ–¹å¼è¦æ›´ä¸ºåˆé€‚ä¸€äº›ã€‚</li>
<li>åŒæ—¶ï¼Œç”±äºCGLibç”±äºæ˜¯é‡‡ç”¨åŠ¨æ€åˆ›å»ºå­ç±»çš„æ–¹æ³•ï¼Œå¯¹äºfinalæ–¹æ³•ï¼Œæ— æ³•è¿›è¡Œä»£ç†ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæ²¡æœ‰æ¥å£ä¹Ÿèƒ½å®ç°åŠ¨æ€ä»£ç†ï¼Œè€Œä¸”é‡‡ç”¨å­—èŠ‚ç å¢å¼ºæŠ€æœ¯ï¼Œæ€§èƒ½ä¹Ÿä¸é”™ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šæŠ€æœ¯å®ç°ç›¸å¯¹éš¾ç†è§£äº›ã€‚</li>
</ul>
<h4 id="2-4-åŠ¨æ€ä»£ç†ä¸cglibå®ç°çš„åŒºåˆ«ã€‚"><a href="#2-4-åŠ¨æ€ä»£ç†ä¸cglibå®ç°çš„åŒºåˆ«ã€‚" class="headerlink" title="2.4 åŠ¨æ€ä»£ç†ä¸cglibå®ç°çš„åŒºåˆ«ã€‚"></a>2.4 åŠ¨æ€ä»£ç†ä¸cglibå®ç°çš„åŒºåˆ«ã€‚</h4><p><strong>JDKåŠ¨æ€ä»£ç†ä¸CGLIBåŠ¨æ€ä»£ç†å¯¹æ¯”</strong></p>
<p>JDKåŠ¨æ€ä»£ç†ï¼šåŸºäºJavaåå°„æœºåˆ¶å®ç°ï¼Œå¿…é¡»è¦å®ç°äº†æ¥å£çš„ä¸šåŠ¡ç±»æ‰èƒ½ç”¨è¿™ç§åŠæ³•ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚</p>
<p>cglibåŠ¨æ€ä»£ç†ï¼šåŸºäºASMæœºåˆ¶å®ç°ï¼Œé€šè¿‡ç”Ÿæˆä¸šåŠ¡ç±»çš„å­ç±»ä½œä¸ºä»£ç†ç±»ã€‚</p>
<p>JDK Proxy çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æœ€å°åŒ–ä¾èµ–å…³ç³»ï¼Œå‡å°‘ä¾èµ–æ„å‘³ç€ç®€åŒ–å¼€å‘å’Œç»´æŠ¤ï¼ŒJDK æœ¬èº«çš„æ”¯æŒï¼Œå¯èƒ½æ¯” cglib æ›´åŠ å¯é ã€‚</li>
<li>å¹³æ»‘è¿›è¡Œ JDK ç‰ˆæœ¬å‡çº§ï¼Œè€Œå­—èŠ‚ç ç±»åº“é€šå¸¸éœ€è¦è¿›è¡Œæ›´æ–°ä»¥ä¿è¯åœ¨æ–°ç‰ˆ Java ä¸Šèƒ½å¤Ÿä½¿ç”¨ã€‚</li>
<li>ä»£ç å®ç°ç®€å•ã€‚</li>
</ul>
<p>åŸºäºç±»ä¼¼ cglib æ¡†æ¶çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ— éœ€å®ç°æ¥å£ï¼Œè¾¾åˆ°ä»£ç†ç±»æ— ä¾µå…¥</li>
<li>åªæ“ä½œæˆ‘ä»¬å…³å¿ƒçš„ç±»ï¼Œè€Œä¸å¿…ä¸ºå…¶ä»–ç›¸å…³ç±»å¢åŠ å·¥ä½œé‡ã€‚</li>
<li>é«˜æ€§èƒ½</li>
</ul>
<h4 id="2-5-ä¸ºä»€ä¹ˆCGlibæ–¹å¼å¯ä»¥å¯¹æ¥å£å®ç°ä»£ç†ã€‚"><a href="#2-5-ä¸ºä»€ä¹ˆCGlibæ–¹å¼å¯ä»¥å¯¹æ¥å£å®ç°ä»£ç†ã€‚" class="headerlink" title="2.5 ä¸ºä»€ä¹ˆCGlibæ–¹å¼å¯ä»¥å¯¹æ¥å£å®ç°ä»£ç†ã€‚"></a>2.5 ä¸ºä»€ä¹ˆCGlibæ–¹å¼å¯ä»¥å¯¹æ¥å£å®ç°ä»£ç†ã€‚</h4><p>å‚è€ƒ2.3</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"><span class="keyword">import</span> proxy.UserService;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºä»£ç†ç±»çš„å·¥å‚ è¯¥ç±»è¦å®ç° MethodInterceptor æ¥å£ã€‚</span></span><br><span class="line"><span class="comment"> * è¯¥ç±»ä¸­å®Œæˆä¸‰æ ·å·¥ä½œï¼š</span></span><br><span class="line"><span class="comment"> * ï¼ˆ1ï¼‰å£°æ˜ç›®æ ‡ç±»çš„æˆå‘˜å˜é‡ï¼Œå¹¶åˆ›å»ºä»¥ç›®æ ‡ç±»å¯¹è±¡ä¸ºå‚æ•°çš„æ„é€ å™¨ã€‚ç”¨äºæ¥æ”¶ç›®æ ‡å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * ï¼ˆ2ï¼‰å®šä¹‰ä»£ç†çš„ç”Ÿæˆæ–¹æ³•ï¼Œç”¨äºåˆ›å»ºä»£ç†å¯¹è±¡ã€‚æ–¹æ³•åæ˜¯ä»»æ„çš„ã€‚ä»£ç†å¯¹è±¡å³ç›®æ ‡ç±»çš„å­ç±»</span></span><br><span class="line"><span class="comment"> * ï¼ˆ3ï¼‰å®šä¹‰å›è°ƒæ¥å£æ–¹æ³•ã€‚å¯¹ç›®æ ‡ç±»çš„å¢å¼ºè¿™åœ¨è¿™é‡Œå®Œæˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CGLibFactory</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å£°æ˜ç›®æ ‡ç±»çš„æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="keyword">private</span> UserService target;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CGLibFactory</span><span class="params">(UserService target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å®šä¹‰ä»£ç†çš„ç”Ÿæˆæ–¹æ³•,ç”¨äºåˆ›å»ºä»£ç†å¯¹è±¡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserService <span class="title">myCGLibCreator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">        <span class="comment">// ä¸ºä»£ç†å¯¹è±¡è®¾ç½®çˆ¶ç±»ï¼Œå³æŒ‡å®šç›®æ ‡ç±»</span></span><br><span class="line">        enhancer.setSuperclass(UserService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è®¾ç½®å›è°ƒæ¥å£å¯¹è±¡ æ³¨æ„ï¼Œåªæ‰€ä»¥åœ¨setCallback()æ–¹æ³•ä¸­å¯ä»¥å†™ä¸Šthisï¼Œ</span></span><br><span class="line"><span class="comment">         * æ˜¯å› ä¸ºMethodIntecepteræ¥å£ç»§æ‰¿è‡ªCallbackï¼Œæ˜¯å…¶å­æ¥å£</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        enhancer.setCallback(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">return</span> (UserService) enhancer.create();<span class="comment">// createç”¨ä»¥ç”ŸæˆCGLibä»£ç†å¯¹è±¡</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"start invoke "</span> + method.getName());</span><br><span class="line">        Object result = method.invoke(target, args);</span><br><span class="line">        System.out.println(<span class="string">"end invoke "</span> + method.getName());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-6-finalçš„ç”¨é€”ã€‚"><a href="#2-6-finalçš„ç”¨é€”ã€‚" class="headerlink" title="2.6 finalçš„ç”¨é€”ã€‚"></a>2.6 finalçš„ç”¨é€”ã€‚</h4><ol>
<li><p>Javaä¸­finalä¿®é¥°ç¬¦æ—¢å¯ä»¥ä¿®é¥°ç±»ã€æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä¿®é¥°å˜é‡.</p>
<p><strong>åŸºæœ¬è§„åˆ™</strong></p>
<ol>
<li>ç”¨finalä¿®é¥°çš„ç±»ä¸èƒ½è¢«æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å¯èƒ½æœ‰å­ç±»ï¼›</li>
<li>ç”¨finalä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«æ›¿æ¢æˆ–éšè—ï¼š</li>
</ol>
<ul>
<li>ä½¿ç”¨finalä¿®é¥°çš„å®ä¾‹æ–¹æ³•åœ¨å…¶æ‰€å±ç±»çš„å­ç±»ä¸­ä¸èƒ½è¢«æ›¿æ¢ï¼ˆoverriddenï¼‰ï¼›</li>
<li>ä½¿ç”¨finalä¿®é¥°çš„é™æ€æ–¹æ³•åœ¨å…¶æ‰€å±ç±»çš„å­ç±»ä¸­ä¸èƒ½è¢«é‡å®šä¹‰ï¼ˆredefinedï¼‰è€Œéšè—ï¼ˆhiddenï¼‰ï¼›</li>
</ul>
<ol>
<li>ç”¨finalä¿®é¥°çš„å˜é‡æœ€å¤šåªèƒ½èµ‹å€¼ä¸€æ¬¡ï¼Œåœ¨èµ‹å€¼æ–¹å¼ä¸Šä¸åŒç±»å‹çš„å˜é‡æˆ–ç¨æœ‰ä¸åŒï¼š</li>
</ol>
<ul>
<li>é™æ€å˜é‡å¿…é¡»æ˜ç¡®èµ‹å€¼ä¸€æ¬¡ï¼ˆä¸èƒ½åªä½¿ç”¨ç±»å‹ç¼ºçœå€¼ï¼‰ï¼›ä½œä¸ºç±»æˆå‘˜çš„é™æ€å˜é‡ï¼Œèµ‹å€¼å¯ä»¥åœ¨å…¶å£°æ˜ä¸­é€šè¿‡åˆå§‹åŒ–è¡¨è¾¾å¼å®Œæˆï¼Œä¹Ÿå¯ä»¥åœ¨é™æ€åˆå§‹åŒ–å—ä¸­è¿›è¡Œï¼›ä½œä¸ºæ¥å£æˆå‘˜çš„é™æ€å˜é‡ï¼Œèµ‹å€¼åªèƒ½åœ¨å…¶å£°æ˜ä¸­é€šè¿‡åˆå§‹åŒ–è¡¨è¾¾å¼å®Œæˆï¼›</li>
<li>å®ä¾‹å˜é‡åŒæ ·å¿…é¡»æ˜ç¡®èµ‹å€¼ä¸€æ¬¡ï¼ˆä¸èƒ½åªä½¿ç”¨ç±»å‹ç¼ºçœå€¼ï¼‰ï¼›èµ‹å€¼å¯ä»¥åœ¨å…¶å£°æ˜ä¸­é€šè¿‡åˆå§‹åŒ–è¡¨è¾¾å¼å®Œæˆï¼Œä¹Ÿå¯ä»¥åœ¨å®ä¾‹åˆå§‹åŒ–å—æˆ–æ„é€ å™¨ä¸­è¿›è¡Œï¼›</li>
<li>æ–¹æ³•å‚æ•°å˜é‡åœ¨æ–¹æ³•è¢«è°ƒç”¨æ—¶åˆ›å»ºï¼ŒåŒæ—¶è¢«åˆå§‹åŒ–ä¸ºå¯¹åº”å®å‚å€¼ï¼Œç»ˆæ­¢äºæ–¹æ³•ä½“ï¼ˆbodyï¼‰ç»“æŸï¼Œåœ¨æ­¤æœŸé—´å…¶å€¼ä¸èƒ½æ”¹å˜ï¼›</li>
<li>æ„é€ å™¨å‚æ•°å˜é‡åœ¨æ„é€ å™¨è¢«è°ƒç”¨ï¼ˆé€šè¿‡å®ä¾‹åˆ›å»ºè¡¨è¾¾å¼æˆ–æ˜¾ç¤ºçš„æ„é€ å™¨è°ƒç”¨ï¼‰æ—¶åˆ›å»ºï¼ŒåŒæ—¶è¢«åˆå§‹åŒ–ä¸ºå¯¹åº”å®å‚å€¼ï¼Œç»ˆæ­¢äºæ„é€ å™¨ä½“ç»“æŸï¼Œåœ¨æ­¤æœŸé—´å…¶å€¼ä¸èƒ½æ”¹å˜ï¼›</li>
<li>å¼‚å¸¸å¤„ç†å™¨å‚æ•°å˜é‡åœ¨æœ‰å¼‚å¸¸è¢«tryè¯­å¥çš„catchå­å¥æ•æ‰åˆ°æ—¶åˆ›å»ºï¼ŒåŒæ—¶è¢«åˆå§‹åŒ–ä¸ºå®é™…çš„å¼‚å¸¸å¯¹è±¡ï¼Œç»ˆæ­¢äºcatchè¯­å¥å—ç»“æŸï¼Œåœ¨æ­¤æœŸé—´å…¶å€¼ä¸èƒ½æ”¹å˜ï¼›</li>
<li>å±€éƒ¨å˜é‡åœ¨å…¶å€¼è¢«è®¿é—®ä¹‹å‰å¿…é¡»è¢«æ˜ç¡®èµ‹å€¼ï¼›</li>
</ul>
<p><strong>å…³äºfinalå˜é‡çš„è¿›ä¸€æ­¥è¯´æ˜ï¼š</strong></p>
<ol>
<li>å®šä¹‰ï¼šblank finalå˜é‡æ˜¯å…¶å£°æ˜ä¸­ä¸åŒ…å«åˆå§‹åŒ–è¡¨è¾¾å¼çš„finalå˜é‡ã€‚</li>
<li>å¯¹äºå¼•ç”¨ç±»å‹å˜é‡ï¼Œfinalä¿®é¥°ç¬¦è¡¨ç¤ºä¸€æ—¦èµ‹å€¼è¯¥å˜é‡å°±å§‹ç»ˆæŒ‡å‘å †ä¸­åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¸å¯æ”¹å˜ï¼Œä½†æ˜¯å…¶æ‰€æŒ‡å¯¹è±¡æœ¬èº«ï¼ˆå…¶çŠ¶æ€ï¼‰æ˜¯å¯ä»¥æ”¹å˜çš„ï¼›ä¸è±¡C++ä¸­çš„constï¼Œåœ¨Javaä¸­æ²¡æœ‰åŠæ³•ä»…é€šè¿‡ä¸€ä¸ªfinalå°±å¯å£°æ˜ä¸€ä¸ªå¯¹è±¡çš„ä¸å˜æ€§ï¼ˆimmutabilityï¼‰ã€‚</li>
<li>å¸¸å˜é‡ï¼ˆconstant variableï¼‰ï¼š</li>
</ol>
<ul>
<li>å®šä¹‰ï¼šå¸¸å˜é‡æ˜¯ç”¨ç¼–è¯‘æ—¶å¸¸é‡è¡¨è¾¾å¼åˆå§‹åŒ–çš„å¸¦æœ‰finalä¿®é¥°ç¬¦çš„åŸºæœ¬ç±»å‹æˆ–å­—ç¬¦ä¸²ç±»å‹å˜é‡ï¼›</li>
<li>æ— è®ºé™æ€å˜é‡è¿˜æ˜¯å®ä¾‹å˜é‡ï¼Œå¦‚æœå®ƒæ˜¯å¸¸å˜é‡ï¼Œåˆ™å…¶å¼•ç”¨åœ¨ç¼–è¯‘æ—¶ä¼šè¢«è§£ææˆè¯¥å¸¸å˜é‡æ‰€è¡¨ç¤ºçš„å€¼ï¼Œåœ¨classæ–‡ä»¶ä¸­å¹¶ä¸å­˜åœ¨ä»»ä½•å¯¹å¸¸å˜é‡åŸŸçš„å¼•ç”¨ï¼›ä¹Ÿæ­£æ˜¯åŸºäºæ­¤ï¼Œå½“åœ¨æºä»£ç ä¸­ä¿®æ”¹æŸä¸ªå¸¸å˜é‡åŸŸçš„åˆå§‹å€¼å¹¶é‡æ–°ç¼–è¯‘åï¼Œè¯¥æ”¹åŠ¨å¹¶ä¸ä¸ºå…¶ä»–classæ–‡ä»¶å¯è§ï¼Œé™¤éå¯¹ä»–ä»¬ä¹Ÿé‡æ–°ç¼–è¯‘ã€‚</li>
</ul>
<p><strong>finalå˜é‡çš„åˆå§‹åŒ–</strong></p>
<p><strong>å…±æ€§ï¼š</strong></p>
<ol>
<li>finalåœ¨åˆå§‹åŒ–ä¹‹åï¼Œå°±ä¸èƒ½å†èµ‹å€¼äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬åªèƒ½è¢«èµ‹å€¼ä¸€æ¬¡</li>
<li>ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯å®šä¹‰æ—¶ç›´æ¥åˆå§‹åŒ–å¦‚ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> i=<span class="number">3</span>;</span><br></pre></td></tr></table></figure>
<p>ä½†ä¹Ÿå¯ä»¥å®šä¹‰æ—¶ä¸åˆå§‹åŒ–ï¼Œå«blank final,å¦‚:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> bi;</span><br></pre></td></tr></table></figure>
<p>ç„¶åç•™å¾…åé¢è¿›è¡Œèµ‹å€¼ã€‚</p>
<p><strong>ä½†è¿™å› ä¸‰ç§æƒ…å†µè€Œä¸åŒï¼š</strong></p>
<p>1.æ™®é€šautoå˜é‡(å°±æ˜¯å¦‚æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡)ï¼šå¯ä»¥åœ¨å…¶åçš„ä»£ç ä¸­èµ‹å€¼ï¼Œä½†ä¹Ÿå¯ä»¥ä¸èµ‹å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> i;<span class="comment">//blank final</span></span><br><span class="line">anything();</span><br><span class="line">i=<span class="number">1</span>;<span class="comment">//åœ¨å…¶åèµ‹å€¼ã€‚</span></span><br><span class="line">i=<span class="number">3</span>; <span class="comment">//error!ä¸å¯å†æ¬¡èµ‹å€¼</span></span><br></pre></td></tr></table></figure>
<p>è€Œæˆå‘˜å˜é‡å¿…é¡»è¢«èµ‹å€¼ï¼Œåªæ˜¯èµ‹å€¼çš„åœ°æ–¹ä¸åŒï¼š</p>
<ol>
<li>é™æ€æˆå‘˜å˜é‡ï¼š<br> é™æ€æˆå‘˜å˜é‡å¿…é¡»åœ¨é™æ€æ„é€ ä»£ç ä¸­åˆå§‹åŒ–ï¼Œ</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> s;</span><br><span class="line"><span class="keyword">static</span> &#123; s=<span class="number">3</span>;&#125;<span class="comment">//é™æ€æ„é€ å—</span></span><br></pre></td></tr></table></figure>
<ol>
<li>éé™æ€æˆå‘˜å˜é‡ï¼š<br> å¿…é¡»åœ¨æ„é€ å‡½æ•°ä¸­è¢«èµ‹å€¼ã€‚å¦‚ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> ai;</span><br><span class="line">&#123; ai = <span class="number">3</span>; &#125;<span class="comment">//instance initializer</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Contructor</span><span class="params">()</span></span>&#123;ai=<span class="number">3</span>;&#125;<span class="comment">//æ„é€ å‡½æ•°ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Contructor</span><span class="params">(<span class="keyword">int</span> in)</span></span>&#123;ai=in;&#125;<span class="comment">//æ„é€ å‡½æ•°ä¸­</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„æ„é€ å‡½æ•°å¯ä»¥ä¼šæœ‰äº’ç›¸è°ƒç”¨ï¼Œæ³¨æ„åœ¨è¿™è¿‡ç¨‹ä¸­ä¸è¦ä½¿å˜é‡è¢«é‡å¤çš„èµ‹å€¼ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœå˜é‡æ˜¯å¯¹è±¡æˆ–æ•°ç»„è¿™æ ·çš„å¼•ç”¨ç±»å‹ã€‚åˆ™å¯ä»¥æ“ä½œå…¶å¯¹è±¡æˆ–æ•°ç»„ï¼Œä½†ä¸å¯ä»¥æ”¹å˜å¼•ç”¨æœ¬èº«ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> [] array=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;<span class="comment">//ä¸€ä¸ªç”±ä¸‰ä¸ªæ•°å­—ç»„æˆçš„æ•°ç»„ã€‚</span></span><br><span class="line">array[<span class="number">1</span>]=<span class="number">9</span>;<span class="comment">//array == &#123;1,9,3&#125;</span></span><br><span class="line"><span class="comment">// array=new int[6]; error!</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="2-7-å†™å‡ºä¸‰ç§å•ä¾‹æ¨¡å¼å®ç°-ã€‚"><a href="#2-7-å†™å‡ºä¸‰ç§å•ä¾‹æ¨¡å¼å®ç°-ã€‚" class="headerlink" title="2.7 å†™å‡ºä¸‰ç§å•ä¾‹æ¨¡å¼å®ç° ã€‚"></a>2.7 å†™å‡ºä¸‰ç§å•ä¾‹æ¨¡å¼å®ç° ã€‚</h4><p>â€‹    <strong>å•ä¾‹æ¨¡å¼çš„å®šä¹‰ï¼šä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ï¼</strong></p>
<ol>
<li><p>æ‡’æ±‰ï¼Œçº¿ç¨‹ä¸å®‰å…¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span> <span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">	    instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§å†™æ³•èƒ½å¤Ÿåœ¨å¤šçº¿ç¨‹ä¸­å¾ˆå¥½çš„å·¥ä½œï¼Œè€Œä¸”çœ‹èµ·æ¥å®ƒä¹Ÿå…·å¤‡å¾ˆå¥½çš„lazy loadingï¼Œä½†æ˜¯ï¼Œé—æ†¾çš„æ˜¯ï¼Œæ•ˆç‡å¾ˆä½ï¼Œ99%æƒ…å†µä¸‹ä¸éœ€è¦åŒæ­¥ã€‚</p>
</li>
<li><p>é¥¿æ±‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">new</span> Singleton();  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span> <span class="params">()</span></span>&#123;&#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> instance;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹å¼åŸºäºclassloderæœºåˆ¶é¿å…äº†å¤šçº¿ç¨‹çš„åŒæ­¥é—®é¢˜ï¼Œinstanceåœ¨ç±»è£…è½½æ—¶å°±å®ä¾‹åŒ–ã€‚ç›®å‰javaå•ä¾‹æ˜¯æŒ‡ä¸€ä¸ªè™šæ‹Ÿæœºçš„èŒƒå›´ï¼Œå› ä¸ºè£…è½½ç±»çš„åŠŸèƒ½æ˜¯è™šæ‹Ÿæœºçš„ï¼Œæ‰€ä»¥ä¸€ä¸ªè™šæ‹Ÿæœºåœ¨é€šè¿‡è‡ªå·±çš„ClassLoaderè£…è½½é¥¿æ±‰å¼å®ç°å•ä¾‹ç±»çš„æ—¶å€™å°±ä¼šåˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹ã€‚è¿™å°±æ„å‘³ç€ä¸€ä¸ªè™šæ‹Ÿæœºé‡Œé¢æœ‰å¾ˆå¤šClassLoaderï¼Œè€Œè¿™äº›classloaderéƒ½èƒ½è£…è½½æŸä¸ªç±»çš„è¯ï¼Œå°±ç®—è¿™ä¸ªç±»æ˜¯å•ä¾‹ï¼Œä¹Ÿèƒ½äº§ç”Ÿå¾ˆå¤šå®ä¾‹ã€‚å½“ç„¶å¦‚æœä¸€å°æœºå™¨ä¸Šæœ‰å¾ˆå¤šè™šæ‹Ÿæœºï¼Œé‚£ä¹ˆæ¯ä¸ªè™šæ‹Ÿæœºä¸­éƒ½æœ‰è‡³å°‘ä¸€ä¸ªè¿™ä¸ªç±»çš„å®ä¾‹çš„è¯ï¼Œé‚£è¿™æ · å°±æ›´ä¸ä¼šæ˜¯å•ä¾‹äº†ã€‚(è¿™é‡Œè®¨è®ºçš„å•ä¾‹ä¸é€‚åˆé›†ç¾¤ï¼)</p>
</li>
<li><p>é™æ€å†…éƒ¨ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span> <span class="params">()</span></span>&#123;&#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> SingletonHolder.INSTANCE;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>â€‹      è¿™ç§æ–¹å¼åŒæ ·åˆ©ç”¨äº†classloderçš„æœºåˆ¶æ¥ä¿è¯åˆå§‹åŒ–instanceæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ç§æ–¹å¼æ˜¯Singletonç±»è¢«è£…è½½äº†ï¼Œinstanceä¸ä¸€å®šè¢«åˆå§‹åŒ–ã€‚å› ä¸ºSingletonHolderç±»æ²¡æœ‰è¢«ä¸»åŠ¨ä½¿ç”¨ï¼Œåªæœ‰æ˜¾ç¤ºé€šè¿‡è°ƒç”¨getInstanceæ–¹æ³•æ—¶ï¼Œæ‰ä¼šæ˜¾ç¤ºè£…è½½SingletonHolderç±»ï¼Œä»è€Œå®ä¾‹åŒ–instanceã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœå®ä¾‹åŒ–instanceå¾ˆæ¶ˆè€—èµ„æºï¼Œæˆ‘æƒ³è®©ä»–å»¶è¿ŸåŠ è½½ï¼è¿™ä¸ªæ—¶å€™ï¼Œè¿™ç§æ–¹å¼ç›¸æ¯”ç¬¬2ç§æ–¹å¼å°±æ˜¾å¾—å¾ˆåˆç†ã€‚</p>
<p> 4.æšä¸¾ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Singleton &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whateverMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> è¿™ç§æ–¹å¼æ˜¯Effective Javaä½œè€…Josh Bloch æå€¡çš„æ–¹å¼ï¼Œå®ƒä¸ä»…èƒ½é¿å…å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œè€Œä¸”è¿˜èƒ½é˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œå¯è°“æ˜¯å¾ˆåšå¼ºçš„å£å’å•Šï¼Œä¸è¿‡ï¼Œä¸ªäººè®¤ä¸ºç”±äº1.5ä¸­æ‰åŠ å…¥enumç‰¹æ€§ï¼Œç”¨è¿™ç§æ–¹å¼å†™ä¸å…è®©äººæ„Ÿè§‰ç”Ÿç–ï¼Œåœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä¹Ÿå¾ˆå°‘çœ‹è§æœ‰äººè¿™ä¹ˆå†™è¿‡ã€‚</p>
<p>5.åŒé‡æ ¡éªŒé”(jdk1.5)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton singleton;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span> <span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (singleton == <span class="keyword">null</span>) &#123;</span><br><span class="line">	    <span class="keyword">synchronized</span> (Singleton<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (singleton == <span class="keyword">null</span>) &#123;</span><br><span class="line">		    singleton = <span class="keyword">new</span> Singleton();</span><br><span class="line">		&#125;</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> singleton;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æ–¹å¼å®ç°çº¿ç¨‹å®‰å…¨åœ°åˆ›å»ºå®ä¾‹ï¼Œè€Œåˆä¸ä¼šå¯¹æ€§èƒ½é€ æˆå¤ªå¤§å½±å“ã€‚å®ƒåªæ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºå®ä¾‹çš„æ—¶å€™åŒæ­¥ï¼Œä»¥åå°±ä¸éœ€è¦åŒæ­¥äº†ã€‚</p>
<p>ç”±äºvolatileå…³é”®å­—å±è”½äº†è™šæ‹Ÿæœºä¸­ä¸€äº›å¿…è¦çš„ä»£ç ä¼˜åŒ–ï¼Œæ‰€ä»¥è¿è¡Œæ•ˆç‡å¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œå› æ­¤å»ºè®®æ²¡æœ‰ç‰¹åˆ«çš„éœ€è¦ä¸è¦ä½¿ç”¨ã€‚åŒé‡æ£€éªŒé”æ–¹å¼çš„å•ä¾‹ä¸å»ºè®®å¤§é‡ä½¿ç”¨ï¼Œæ ¹æ®æƒ…å†µå†³å®šã€‚</p>
<p><strong>æ€»ç»“</strong></p>
<p>æœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼š</p>
<p>1.å¦‚æœå•ä¾‹ç”±ä¸åŒçš„ç±»è£…è½½å™¨è£…å…¥ï¼Œé‚£ä¾¿æœ‰å¯èƒ½å­˜åœ¨å¤šä¸ªå•ä¾‹ç±»çš„å®ä¾‹ã€‚å‡å®šä¸æ˜¯è¿œç«¯å­˜å–ï¼Œä¾‹å¦‚ä¸€äº›servletå®¹å™¨å¯¹æ¯ä¸ªservletä½¿ç”¨å®Œå…¨ä¸åŒçš„ç±»è£…è½½å™¨ï¼Œè¿™æ ·çš„è¯å¦‚æœæœ‰ä¸¤ä¸ªservletè®¿é—®ä¸€ä¸ªå•ä¾‹ç±»ï¼Œå®ƒä»¬å°±éƒ½ä¼šæœ‰å„è‡ªçš„å®ä¾‹ã€‚</p>
<p>2.å¦‚æœSingletonå®ç°äº†java.io.Serializableæ¥å£ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»çš„å®ä¾‹å°±å¯èƒ½è¢«åºåˆ—åŒ–å’Œå¤åŸã€‚ä¸ç®¡æ€æ ·ï¼Œå¦‚æœä½ åºåˆ—åŒ–ä¸€ä¸ªå•ä¾‹ç±»çš„å¯¹è±¡ï¼Œæ¥ä¸‹æ¥å¤åŸå¤šä¸ªé‚£ä¸ªå¯¹è±¡ï¼Œé‚£ä½ å°±ä¼šæœ‰å¤šä¸ªå•ä¾‹ç±»çš„å®ä¾‹ã€‚</p>
<p>å¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ä¿®å¤çš„åŠæ³•æ˜¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Class <span class="title">getClass</span><span class="params">(String classname)</span>    </span></span><br><span class="line"><span class="function">                                         <span class="keyword">throws</span> ClassNotFoundException </span>&#123;   </span><br><span class="line">      ClassLoader classLoader = Thread.currentThread().getContextClassLoader();   </span><br><span class="line">    </span><br><span class="line">      <span class="keyword">if</span>(classLoader == <span class="keyword">null</span>)   </span><br><span class="line">         classLoader = Singleton<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>()</span>;   </span><br><span class="line">    </span><br><span class="line">      <span class="keyword">return</span> (classLoader.loadClass(classname));   </span><br><span class="line">   &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹ç¬¬äºŒä¸ªé—®é¢˜ä¿®å¤çš„åŠæ³•æ˜¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;   </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();   </span><br><span class="line">    </span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;   </span><br><span class="line">      </span><br><span class="line">   &#125;   </span><br><span class="line">   <span class="function"><span class="keyword">private</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123;   </span><br><span class="line">            <span class="keyword">return</span> INSTANCE;   </span><br><span class="line">      &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-8-å¦‚ä½•åœ¨çˆ¶ç±»ä¸­ä¸ºå­ç±»è‡ªåŠ¨å®Œæˆæ‰€æœ‰çš„hashcodeå’Œequalså®ç°ï¼Ÿè¿™ä¹ˆåšæœ‰ä½•ä¼˜åŠ£ã€‚"><a href="#2-8-å¦‚ä½•åœ¨çˆ¶ç±»ä¸­ä¸ºå­ç±»è‡ªåŠ¨å®Œæˆæ‰€æœ‰çš„hashcodeå’Œequalså®ç°ï¼Ÿè¿™ä¹ˆåšæœ‰ä½•ä¼˜åŠ£ã€‚" class="headerlink" title="2.8 å¦‚ä½•åœ¨çˆ¶ç±»ä¸­ä¸ºå­ç±»è‡ªåŠ¨å®Œæˆæ‰€æœ‰çš„hashcodeå’Œequalså®ç°ï¼Ÿè¿™ä¹ˆåšæœ‰ä½•ä¼˜åŠ£ã€‚"></a>2.8 å¦‚ä½•åœ¨çˆ¶ç±»ä¸­ä¸ºå­ç±»è‡ªåŠ¨å®Œæˆæ‰€æœ‰çš„hashcodeå’Œequalså®ç°ï¼Ÿè¿™ä¹ˆåšæœ‰ä½•ä¼˜åŠ£ã€‚</h4><p><strong>è¦†ç›–equalsæ—¶éœ€è¦éµå®ˆçš„é€šç”¨çº¦å®šï¼š</strong><br>è¦†ç›–equalsæ–¹æ³•çœ‹èµ·æ¥ä¼¼ä¹å¾ˆç®€å•ï¼Œä½†æ˜¯å¦‚æœè¦†ç›–ä¸å½“ä¼šå¯¼è‡´é”™è¯¯ï¼Œå¹¶ä¸”åæœç›¸å½“ä¸¥é‡ã€‚ã€ŠEffective Javaã€‹ä¸€ä¹¦ä¸­æåˆ°â€œæœ€å®¹æ˜“é¿å…è¿™ç±»é—®é¢˜çš„åŠæ³•å°±æ˜¯ä¸è¦†ç›–equalsæ–¹æ³•â€ï¼Œè¿™å¥è¯è²Œä¼¼å¾ˆæç¬‘ï¼Œå…¶å®æƒ³æƒ³ä¹Ÿä¸æ— é“ç†ï¼Œå…¶å®åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç±»çš„æ¯ä¸ªå®ä¾‹éƒ½åªä¸å®ƒè‡ªèº«ç›¸ç­‰ã€‚å¦‚æœæ»¡è¶³äº†ä»¥ä¸‹ä»»ä½•ä¸€ä¸ªæ¡ä»¶ï¼Œè¿™å°±æ­£æ˜¯æ‰€æœŸæœ›çš„ç»“æœï¼š</p>
<ul>
<li><strong>ç±»çš„æ¯ä¸ªå®ä¾‹æœ¬è´¨ä¸Šéƒ½æ˜¯å”¯ä¸€çš„</strong>ã€‚å¯¹äºä»£è¡¨æ´»åŠ¨å®ä½“è€Œä¸æ˜¯å€¼çš„ç±»æ¥è¯´å´æ˜¯å¦‚æ­¤ï¼Œä¾‹å¦‚Threadã€‚Objectæä¾›çš„equalså®ç°å¯¹äºè¿™äº›ç±»æ¥è¯´æ­£æ˜¯æ­£ç¡®çš„è¡Œä¸ºã€‚</li>
<li><strong>ä¸å…³å¿ƒç±»æ˜¯å¦æä¾›äº†â€œé€»è¾‘ç›¸ç­‰â€çš„æµ‹è¯•åŠŸèƒ½ã€‚</strong>å‡å¦‚Randomè¦†ç›–äº†equalsï¼Œä»¥æ£€æŸ¥ä¸¤ä¸ªRandomå®ä¾‹æ˜¯å¦äº§ç”Ÿç›¸åŒçš„éšæœºæ•°åºåˆ—ï¼Œä½†æ˜¯è®¾è®¡è€…å¹¶ä¸è®¤ä¸ºå®¢æˆ·éœ€è¦æˆ–è€…æœŸæœ›è¿™æ ·çš„åŠŸèƒ½ã€‚åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œä»Objectç»§æ‰¿å¾—åˆ°çš„equalså®ç°å·²ç»è¶³å¤Ÿäº†ã€‚</li>
<li><strong>è¶…ç±»å·²ç»è¦†ç›–äº†equalsï¼Œä»è¶…ç±»ç»§æ‰¿è¿‡æ¥çš„è¡Œä¸ºå¯¹äºå­ç±»ä¹Ÿæ˜¯åˆé€‚çš„</strong>ã€‚å¤§å¤šæ•°çš„Setå®ç°éƒ½ä»AbstractSetç»§æ‰¿equalså®ç°ï¼ŒListå®ç°ä»AbstractListç»§æ‰¿equalså®ç°ï¼ŒMapå®ç°ä»AbstractMapç»§æ‰¿equalså®ç°ã€‚</li>
<li><strong>ç±»æ˜¯ç§æœ‰çš„æˆ–è€…æ˜¯åŒ…çº§ç§æœ‰çš„ï¼Œå¯ä»¥ç¡®å®šå®ƒçš„equalsæ–¹æ³•æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨</strong>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ— ç–‘æ˜¯åº”è¯¥è¦†ç›–equalsæ–¹æ³•çš„ï¼Œä»¥é˜²æ­¢å®ƒè¢«æ„å¤–è°ƒç”¨ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(); <span class="comment">//Method is never called</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¦†ç›–equalsæ–¹æ³•çš„æ—¶å€™ï¼Œä½ å¿…é¡»è¦éµå®ˆå®ƒçš„é€šç”¨çº¦å®šã€‚ä¸‹é¢æ˜¯çº¦å®šçš„å†…å®¹ï¼Œæ¥è‡ªObjectçš„è§„èŒƒ[JavaSE6]</p>
<ul>
<li><p><strong>è‡ªåæ€§</strong>ã€‚å¯¹äºä»»ä½•énullçš„å¼•ç”¨å€¼xï¼Œx.equals(x)å¿…é¡»è¿”å›trueã€‚</p>
</li>
<li><p><strong>å¯¹ç§°æ€§</strong>ã€‚å¯¹äºä»»ä½•énullçš„å¼•ç”¨å€¼xå’Œyï¼Œå½“ä¸”ä»…å½“y.equals(x)è¿”å›trueæ—¶ï¼Œx.equals(y)å¿…é¡»è¿”å›true</p>
</li>
<li><strong>ä¼ é€’æ€§</strong>ã€‚å¯¹äºä»»ä½•énullçš„å¼•ç”¨å€¼xã€yå’Œzï¼Œå¦‚æœx.equals(y)è¿”å›trueï¼Œå¹¶ä¸”y.equals(z)ä¹Ÿè¿”å›trueï¼Œé‚£ä¹ˆx.equals(z)ä¹Ÿå¿…é¡»è¿”å›trueã€‚</li>
<li><strong>ä¸€è‡´æ€§</strong>ã€‚å¯¹äºä»»ä½•énullçš„å¼•ç”¨å€¼xå’Œyï¼Œåªè¦equalsçš„æ¯”è¾ƒæ“ä½œåœ¨å¯¹è±¡ä¸­æ‰€ç”¨çš„ä¿¡æ¯æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œå¤šæ¬¡è°ƒç”¨è¯¥x.equals(y)å°±ä¼šä¸€ç›´åœ°è¿”å›trueï¼Œæˆ–è€…ä¸€è‡´åœ°è¿”å›falseã€‚</li>
<li>å¯¹äºä»»ä½•énullçš„å¼•ç”¨å€¼xï¼Œx.equals(null)å¿…é¡»è¿”å›falseã€‚</li>
</ul>
<p><strong>ç»“åˆä»¥ä¸Šè¦æ±‚ï¼Œå¾—å‡ºäº†ä»¥ä¸‹å®ç°é«˜è´¨é‡equalsæ–¹æ³•çš„è¯€çªï¼š</strong></p>
<ul>
<li><p><strong>ä½¿ç”¨==ç¬¦å·æ£€æŸ¥â€œå‚æ•°æ˜¯å¦ä¸ºè¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨â€</strong>ã€‚å¦‚æœæ˜¯ï¼Œåˆ™è¿”å›trueã€‚è¿™åªä¸è¿‡æ˜¯ä¸€ç§æ€§èƒ½ä¼˜åŒ–ï¼Œå¦‚æœæ¯”è¾ƒæ“ä½œæœ‰å¯èƒ½å¾ˆæ˜‚è´µï¼Œå°±å€¼å¾—è¿™ä¹ˆåšã€‚</p>
</li>
<li><p><strong>ä½¿ç”¨instanceofæ“ä½œç¬¦æ£€æŸ¥â€œå‚æ•°æ˜¯å¦ä¸ºæ­£ç¡®çš„ç±»å‹â€</strong>ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™è¿”å›falseã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ‰€è°“â€œæ­£ç¡®çš„ç±»å‹â€æ˜¯æŒ‡equalsæ–¹æ³•æ‰€åœ¨çš„é‚£ä¸ªç±»ã€‚</p>
</li>
<li>æŠŠå‚æ•°è½¬æ¢æˆæ­£ç¡®çš„ç±»å‹ã€‚å› ä¸ºè½¬æ¢ä¹‹å‰è¿›è¡Œè¿‡instanceofæµ‹è¯•ï¼Œæ‰€ä»¥ç¡®ä¿ä¼šæˆåŠŸã€‚</li>
<li><strong>å¯¹äºè¯¥ç±»ä¸­çš„æ¯ä¸ªâ€œå…³é”®â€åŸŸï¼Œæ£€æŸ¥å‚æ•°ä¸­çš„åŸŸæ˜¯å¦ä¸è¯¥å¯¹è±¡ä¸­å¯¹åº”çš„åŸŸç›¸åŒ¹é…</strong>ã€‚å¦‚æœè¿™äº›æµ‹è¯•å…¨éƒ¨æˆåŠŸï¼Œåˆ™è¿”å›true;å¦åˆ™è¿”å›falseã€‚</li>
<li><strong>å½“ç¼–å†™å®Œæˆäº†equalsæ–¹æ³•ä¹‹åï¼Œæ£€æŸ¥â€œå¯¹ç§°æ€§â€ã€â€œä¼ é€’æ€§â€ã€â€œä¸€è‡´æ€§â€</strong>ã€‚</li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>è¦†ç›–equalsæ—¶æ€»è¦è¦†ç›–hashCode ã€ŠEffective Javaã€‹ä½œè€…è¯´çš„</li>
<li>ä¸è¦ä¼å›¾è®©equalsæ–¹æ³•è¿‡äºåªèƒ½ã€‚</li>
<li>ä¸è¦å°†equalså£°æ˜ä¸­çš„Objectå¯¹è±¡æ›¿æ¢ä¸ºå…¶ä»–çš„ç±»å‹ï¼ˆå› ä¸ºè¿™æ ·æˆ‘ä»¬å¹¶æ²¡æœ‰è¦†ç›–Objectä¸­çš„equalsæ–¹æ³•å“¦ï¼‰</li>
</ul>
<p><strong>è¦†ç›–equalsæ—¶æ€»è¦è¦†ç›–hashCode</strong><br>  ä¸€ä¸ªå¾ˆå¸¸è§çš„é”™è¯¯æ ¹æºåœ¨äºæ²¡æœ‰è¦†ç›–hashCodeæ–¹æ³•ã€‚åœ¨æ¯ä¸ªè¦†ç›–äº†equalsæ–¹æ³•çš„ç±»ä¸­ï¼Œä¹Ÿå¿…é¡»è¦†ç›–hashCodeæ–¹æ³•ã€‚å¦‚æœä¸è¿™æ ·åšçš„è¯ï¼Œå°±ä¼šè¿åObject.hashCodeçš„é€šç”¨çº¦å®šï¼Œä»è€Œå¯¼è‡´è¯¥ç±»æ— æ³•ç»“åˆæ‰€æœ‰åŸºäºæ•£åˆ—çš„é›†åˆä¸€èµ·æ­£å¸¸è¿ä½œï¼Œè¿™æ ·çš„é›†åˆåŒ…æ‹¬HashMapã€HashSetå’ŒHashtableã€‚</p>
<ul>
<li>åœ¨åº”ç”¨ç¨‹åºçš„æ‰§è¡ŒæœŸé—´ï¼Œåªè¦å¯¹è±¡çš„equalsæ–¹æ³•çš„æ¯”è¾ƒæ“ä½œæ‰€ç”¨åˆ°çš„ä¿¡æ¯æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆå¯¹è¿™åŒä¸€ä¸ªå¯¹è±¡è°ƒç”¨å¤šæ¬¡ï¼ŒhashCodeæ–¹æ³•éƒ½å¿…é¡»å§‹ç»ˆå¦‚ä¸€åœ°è¿”å›åŒä¸€ä¸ªæ•´æ•°ã€‚åœ¨åŒä¸€ä¸ªåº”ç”¨ç¨‹åºçš„å¤šæ¬¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡æ‰§è¡Œæ‰€è¿”å›çš„æ•´æ•°å¯ä»¥ä¸ä¸€è‡´ã€‚</li>
<li>å¦‚æœä¸¤ä¸ªå¯¹è±¡æ ¹æ®equals()æ–¹æ³•æ¯”è¾ƒæ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆè°ƒç”¨è¿™ä¸¤ä¸ªå¯¹è±¡ä¸­ä»»æ„ä¸€ä¸ªå¯¹è±¡çš„hashCodeæ–¹æ³•éƒ½å¿…é¡»äº§ç”ŸåŒæ ·çš„æ•´æ•°ç»“æœã€‚</li>
<li>å¦‚æœä¸¤ä¸ªå¯¹è±¡æ ¹æ®equals()æ–¹æ³•æ¯”è¾ƒæ˜¯ä¸ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆè°ƒç”¨è¿™ä¸¤ä¸ªå¯¹è±¡ä¸­ä»»æ„ä¸€ä¸ªå¯¹è±¡çš„hashCodeæ–¹æ³•ï¼Œåˆ™ä¸ä¸€å®šè¦äº§ç”Ÿç›¸åŒçš„æ•´æ•°ç»“æœã€‚ä½†æ˜¯ç¨‹åºå‘˜åº”è¯¥çŸ¥é“ï¼Œç»™ä¸ç›¸ç­‰çš„å¯¹è±¡äº§ç”Ÿæˆªç„¶ä¸åŒçš„æ•´æ•°ç»“æœï¼Œæœ‰å¯èƒ½æé«˜æ•£åˆ—è¡¨çš„æ€§èƒ½ã€‚</li>
</ul>
<h4 id="2-9-è¯·ç»“åˆOOè®¾è®¡ç†å¿µï¼Œè°ˆè°ˆè®¿é—®ä¿®é¥°ç¬¦publicã€privateã€protectedã€defaultåœ¨åº”ç”¨è®¾è®¡ä¸­çš„ä½œç”¨ã€‚"><a href="#2-9-è¯·ç»“åˆOOè®¾è®¡ç†å¿µï¼Œè°ˆè°ˆè®¿é—®ä¿®é¥°ç¬¦publicã€privateã€protectedã€defaultåœ¨åº”ç”¨è®¾è®¡ä¸­çš„ä½œç”¨ã€‚" class="headerlink" title="2.9 è¯·ç»“åˆOOè®¾è®¡ç†å¿µï¼Œè°ˆè°ˆè®¿é—®ä¿®é¥°ç¬¦publicã€privateã€protectedã€defaultåœ¨åº”ç”¨è®¾è®¡ä¸­çš„ä½œç”¨ã€‚"></a>2.9 è¯·ç»“åˆOOè®¾è®¡ç†å¿µï¼Œè°ˆè°ˆè®¿é—®ä¿®é¥°ç¬¦publicã€privateã€protectedã€defaultåœ¨åº”ç”¨è®¾è®¡ä¸­çš„ä½œç”¨ã€‚</h4><p>è®¿é—®ä¿®é¥°ç¬¦ï¼Œä¸»è¦æ ‡ç¤ºä¿®é¥°å—çš„ä½œç”¨åŸŸï¼Œæ–¹ä¾¿éš”ç¦»é˜²æŠ¤</p>
<p>ä½œç”¨åŸŸ   ç±»å†…éƒ¨   åŒåŒ…   å­ç±»    å…¶ä»–åŒ…</p>
<p>public       âˆš          âˆš           âˆš            âˆš<br>protected âˆš         âˆš            âˆš            Ã—<br>friendly     âˆš         âˆš            Ã—            Ã—<br>private      âˆš         Ã—            Ã—            Ã—</p>
<p>publicï¼š Javaè¯­è¨€ä¸­è®¿é—®é™åˆ¶æœ€å®½çš„ä¿®é¥°ç¬¦ï¼Œä¸€èˆ¬ç§°ä¹‹ä¸ºâ€œå…¬å…±çš„â€ã€‚è¢«å…¶ä¿®é¥°çš„ç±»ã€å±æ€§ä»¥åŠæ–¹æ³•ä¸</p>
<p>ä»…å¯ä»¥è·¨ç±»è®¿é—®ï¼Œè€Œä¸”å…è®¸è·¨åŒ…ï¼ˆpackageï¼‰è®¿é—®ã€‚</p>
<p>private: Javaè¯­è¨€ä¸­å¯¹è®¿é—®æƒé™é™åˆ¶çš„æœ€çª„çš„ä¿®é¥°ç¬¦ï¼Œä¸€èˆ¬ç§°ä¹‹ä¸ºâ€œç§æœ‰çš„â€ã€‚è¢«å…¶ä¿®é¥°çš„ç±»ã€å±æ€§ä»¥</p>
<p>åŠæ–¹æ³•åªèƒ½è¢«è¯¥ç±»çš„å¯¹è±¡è®¿é—®ï¼Œå…¶å­ç±»ä¸èƒ½è®¿é—®ï¼Œæ›´ä¸èƒ½å…è®¸è·¨åŒ…è®¿é—®ã€‚</p>
<p>protect: ä»‹äºpublic å’Œ private ä¹‹é—´çš„ä¸€ç§è®¿é—®ä¿®é¥°ç¬¦ï¼Œä¸€èˆ¬ç§°ä¹‹ä¸ºâ€œä¿æŠ¤å½¢â€ã€‚è¢«å…¶ä¿®é¥°çš„ç±»ã€</p>
<p>å±æ€§ä»¥åŠæ–¹æ³•åªèƒ½è¢«ç±»æœ¬èº«çš„æ–¹æ³•åŠå­ç±»è®¿é—®ï¼Œå³ä½¿å­ç±»åœ¨ä¸åŒçš„åŒ…ä¸­ä¹Ÿå¯ä»¥è®¿é—®ã€‚</p>
<p>defaultï¼šå³ä¸åŠ ä»»ä½•è®¿é—®ä¿®é¥°ç¬¦ï¼Œé€šå¸¸ç§°ä¸ºâ€œé»˜è®¤è®¿é—®æ¨¡å¼â€œã€‚è¯¥æ¨¡å¼ä¸‹ï¼Œåªå…è®¸åœ¨åŒä¸€ä¸ªåŒ…ä¸­è¿›è¡Œè®¿</p>
<p>é—®ã€‚</p>
<h4 id="3-0-æ·±æ‹·è´å’Œæµ…æ‹·è´åŒºåˆ«ã€‚"><a href="#3-0-æ·±æ‹·è´å’Œæµ…æ‹·è´åŒºåˆ«ã€‚" class="headerlink" title="3.0 æ·±æ‹·è´å’Œæµ…æ‹·è´åŒºåˆ«ã€‚"></a>3.0 æ·±æ‹·è´å’Œæµ…æ‹·è´åŒºåˆ«ã€‚</h4><p><strong>ä»€ä¹ˆæ˜¯æ‹·è´?</strong></p>
<p>å¼€å§‹ä¹‹å‰ï¼Œæˆ‘è¦å…ˆå¼ºè°ƒä¸€ä¸‹ Java ä¸­çš„æ‹·è´æ˜¯ä»€ä¹ˆã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬å¯¹å¼•ç”¨æ‹·è´å’Œå¯¹è±¡æ‹·è´è¿›è¡Œä¸€ä¸‹åŒºåˆ†ã€‚ </p>
<p><strong>å¼•ç”¨æ‹·è´</strong>, æ­£å¦‚å®ƒçš„åç§°æ‰€è¡¨è¿°çš„æ„æ€, å°±æ˜¯åˆ›å»ºä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„å¼•ç”¨å˜é‡çš„æ‹·è´ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ª Car å¯¹è±¡ï¼Œè€Œä¸”è®© <em>myCar</em> å˜é‡æŒ‡å‘è¿™ä¸ªå˜é‡ï¼Œè¿™æ—¶å€™å½“æˆ‘ä»¬åšå¼•ç”¨æ‹·è´ï¼Œé‚£ä¹ˆç°åœ¨å°±ä¼šæœ‰ä¸¤ä¸ª myCar å˜é‡ï¼Œä½†æ˜¯å¯¹è±¡ä»ç„¶åªå­˜åœ¨ä¸€ä¸ªã€‚</p>
<p><img src="http://static.oschina.net/uploads/space/2016/1102/110619_NSfb_2903254.jpg" alt="img"></p>
<p><strong>å¯¹è±¡æ‹·è´</strong>ä¼šåˆ›å»ºå¯¹è±¡æœ¬èº«çš„ä¸€ä¸ªå‰¯æœ¬ã€‚å› æ­¤å¦‚æœæˆ‘ä»¬å†ä¸€æ¬¡æœåŠ¡æˆ‘ä»¬ car å¯¹è±¡ï¼Œå°±ä¼šåˆ›å»ºè¿™ä¸ªå¯¹è±¡æœ¬èº«çš„ä¸€ä¸ªå‰¯æœ¬, åŒæ—¶è¿˜ä¼šæœ‰ç¬¬äºŒä¸ªå¼•ç”¨å˜é‡æŒ‡å‘è¿™ä¸ªè¢«å¤åˆ¶å‡ºæ¥çš„å¯¹è±¡ã€‚</p>
<p><img src="http://static.oschina.net/uploads/space/2016/1102/110634_VqLp_2903254.jpg" alt="img"></p>
<p><strong>ä»€ä¹ˆæ˜¯å¯¹è±¡?</strong> </p>
<p>æ·±æ‹·è´å’Œæµ…æ‹·è´éƒ½æ˜¯å¯¹è±¡æ‹·è´, ä½†ä¸€ä¸ªå¯¹è±¡å®é™…æ˜¯ä»€ä¹ˆå‘¢? å½“æˆ‘ä»¬è°ˆè®ºåˆ°å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šè¯´å®ƒå°±åƒä¸€ç²’æµ‘åœ†çš„å’–å•¡è±†ï¼Œå·²ç»æ˜¯ä¸€ä¸ªä¸èƒ½å¤Ÿè¢«è¿›ä¸€æ­¥åˆ†è§£çš„å•ä½äº†ï¼Œä½†è¿™ç§è¯´æ³•å¤ªè¿‡äºç®€åŒ–äº†ã€‚</p>
<p><img src="http://static.oschina.net/uploads/space/2016/1102/110649_3o2i_2903254.jpg" alt="img"></p>
<p>æ¯”æ–¹è¯´æˆ‘ä»¬æœ‰ä¸€ä¸ª Person å¯¹è±¡ã€‚è¿™ä¸ª Person å¯¹è±¡å®é™…ä¸Šæ˜¯ç”±å…¶å®ƒçš„å¯¹è±¡ç»„åˆè€Œæˆçš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ Person å¯¹è±¡åŒ…å«äº†ä¸€ä¸ª Name å¯¹è±¡å’Œä¸€ä¸ª Address å¯¹è±¡ã€‚<em>Name å¯¹è±¡åˆåŒ…å«äº†</em>ä¸€ä¸ª <em>FirstName</em> å¯¹è±¡å’Œä¸€ä¸ª <em>LastName</em> å¯¹è±¡ï¼›Address å¯¹è±¡åˆæ˜¯ç”±ä¸€ä¸ª <em>Street</em> å¯¹è±¡ä»¥åŠä¸€ä¸ª <em>City</em> å¯¹è±¡ç»„åˆè€Œæˆçš„ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬è®¨è®ºæœ¬æ–‡ä¸­çš„è¿™ä¸ª Person æ—¶ï¼Œå®é™…ä¸Šæˆ‘æ˜¯åœ¨è®¨è®ºè¿™äº›ä¸ªå¯¹è±¡æ‰€ç»„æˆçš„æ•´ä¸ªçš„å¯¹è±¡è”ç³»ç½‘ç»œã€‚</p>
<p><img src="http://static.oschina.net/uploads/space/2016/1102/110706_c4aV_2903254.jpg" alt="img"></p>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä¼šè¦å¯¹è¿™ä¸ª Person å¯¹è±¡è¿›è¡Œæ‹·è´å‘¢? å¯¹è±¡å¤åˆ¶ï¼Œç»å¸¸ä¹Ÿä¼šè¢«ç§°ä½œå…‹éš†ï¼Œå®ƒæ˜¯åœ¨æˆ‘ä»¬æƒ³è¦ä¿®æ”¹æˆ–è€…ç§»é™¤æŸä¸ªå¯¹è±¡ï¼Œä½†ä»ç„¶æƒ³è¦ä¿ç•™åŸæ¥çš„é‚£ä¸ªå¯¹è±¡æ—¶æ‰€è¦è¿›è¡Œçš„æ“ä½œã€‚</p>
<p><strong>æµ…æ‹·è´</strong> </p>
<p>é¦–å…ˆè®©æˆ‘ä»¬æ¥è¯´è¯´æµ…æ‹·è´ã€‚å¯¹è±¡çš„æµ…æ‹·è´ä¼šå¯¹â€œä¸»â€å¯¹è±¡è¿›è¡Œæ‹·è´ï¼Œä½†ä¸ä¼šå¤åˆ¶ä¸»å¯¹è±¡é‡Œé¢çš„å¯¹è±¡ã€‚â€é‡Œé¢çš„å¯¹è±¡â€œä¼šåœ¨åŸæ¥çš„å¯¹è±¡å’Œå®ƒçš„å‰¯æœ¬ä¹‹é—´å…±äº«ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¼šä¸ºä¸€ä¸ª Personå¯¹è±¡åˆ›å»ºç¬¬äºŒä¸ª <em>Person å¯¹è±¡</em>, è€Œä¸¤ä¸ª <em>Person</em> ä¼šå…±äº«ç›¸åŒçš„ Name å’Œ Address å¯¹è±¡ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç ç¤ºä¾‹ã€‚å¦‚ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç±» Personï¼Œç±»é‡Œé¢åŒ…å«äº†ä¸€ä¸ª Name å’Œ Address å¯¹è±¡ã€‚æ‹·è´æ„é€ å™¨ä¼šæ‹¿åˆ° originalPerson å¯¹è±¡ï¼Œç„¶åå¯¹å…¶åº”ç”¨å˜é‡è¿›è¡Œå¤åˆ¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Name name;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(Person originalPerson)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.name = originalPerson.name;</span><br><span class="line">         <span class="keyword">this</span>.address = originalPerson.address;</span><br><span class="line">    &#125;</span><br><span class="line">[â€¦]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ…æ‹·è´çš„é—®é¢˜å°±æ˜¯ä¸¤ä¸ªå¯¹è±¡å¹¶éç‹¬ç«‹çš„ã€‚å¦‚æœä½ ä¿®æ”¹äº†å…¶ä¸­ä¸€ä¸ª Person å¯¹è±¡çš„ Name å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™æ¬¡ä¿®æ”¹ä¹Ÿä¼šå½±å“å¥¥å¦å¤–ä¸€ä¸ª Person å¯¹è±¡ã€‚</p>
<p>è®©æˆ‘ä»¬åœ¨ç¤ºä¾‹ä¸­çœ‹çœ‹è¿™ä¸ªé—®é¢˜ã€‚å‡å¦‚è¯´æˆ‘ä»¬æœ‰ä¸€ä¸ª Person å¯¹è±¡ï¼Œç„¶åä¹Ÿä¼šæœ‰ä¸€ä¸ªå¼•ç”¨å˜é‡ monther æ¥æŒ‡å‘å®ƒï¼›ç„¶åå½“æˆ‘ä»¬å¯¹ mother è¿›è¡Œæ‹·è´æ—¶ï¼Œåˆ›å»ºç¬¬äºŒä¸ª Person å¯¹è±¡ sonã€‚å¦‚æœåœ¨æ­¤åçš„ä»£ç ä¸­ï¼Œ son å°è¯•ç”¨ <em>moveOut()</em> æ¥ä¿®æ”¹ä»–çš„ <em>Address</em> å¯¹è±¡, é‚£ä¹ˆ mother ä¹Ÿä¼šè·Ÿç€ä»–ä¸€èµ·æ¬èµ°!</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Person mother = <span class="keyword">new</span> Person(<span class="keyword">new</span> Name(â€¦), <span class="keyword">new</span> Address(â€¦));</span><br><span class="line">[â€¦]</span><br><span class="line">Person son  = <span class="keyword">new</span> Person(mother);</span><br><span class="line">[â€¦]</span><br><span class="line">son.moveOut(<span class="keyword">new</span> Street(â€¦), <span class="keyword">new</span> City(â€¦));</span><br></pre></td></tr></table></figure>
<p>è¿™ç§ç°è±¡ä¹‹æ‰€ä»¥ä¼šå‘ç”Ÿï¼Œæ˜¯å› ä¸º mother å’Œson å¯¹è±¡å…±äº«äº†ç›¸åŒçš„ Address å¯¹è±¡ï¼Œå¦‚ä½ åœ¨ç¤ºä¾‹ 7 ä¸­æ‰€çœ‹åˆ°çš„æè¿°ã€‚å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ä¿®æ”¹äº† Address å¯¹è±¡ï¼Œé‚£ä¹ˆä¹Ÿå°±è¡¨ç¤ºä¸¤ä¸ªå¯¹è±¡æ€»çš„ Address éƒ½è¢«ä¿®æ”¹äº†ã€‚</p>
<p><img src="http://static.oschina.net/uploads/space/2016/1102/110725_sZVi_2903254.jpg" alt="img"></p>
<p><strong>æ·±æ‹·è´</strong> </p>
<p>ä¸åŒäºæµ…æ‹·è´ï¼Œæ·±æ‹·è´æ˜¯ä¸€ä¸ª<strong>æ•´ä¸ªç‹¬ç«‹çš„å¯¹è±¡æ‹·è´ã€‚</strong>å¦‚æœæˆ‘ä»¬å¯¹æ•´ä¸ª Personå¯¹è±¡è¿›è¡Œæ·±æ‹·è´ï¼Œæˆ‘ä»¬ä¼šå¯¹æ•´ä¸ªå¯¹è±¡çš„ç»“æ„éƒ½è¿›è¡Œæ‹·è´ã€‚</p>
<p><img src="http://static.oschina.net/uploads/space/2016/1102/110737_JstE_2903254.jpg" alt="img"></p>
<p>å¦‚ä½ åœ¨ä¸Šå›¾ä¸­æ‰€è§ï¼Œå¯¹ä¸€ä¸ª Person çš„Addresså¯¹è±¡è¿›è¡Œäº†ä¿®æ”¹å¹¶ä¸ä¼šå¯¹å¦å¤–ä¸€ä¸ªå¯¹è±¡é€ æˆå½±å“ã€‚å½“æˆ‘ä»¬è§‚å¯Ÿç¤ºä¸‹é¢çš„ä»£ç ï¼Œä¼šå‘ç°æˆ‘ä»¬ä¸å•å•å¯¹ Person å¯¹è±¡ä½¿ç”¨äº†æ‹·è´æ„é€ å™¨ï¼ŒåŒæ—¶ä¹Ÿä¼šå¯¹é‡Œé¢çš„å¯¹è±¡ä½¿ç”¨æ‹·è´æ„é€ å™¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Name name;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(Person otherPerson)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.name    =  <span class="keyword">new</span> Name(otherPerson.name);</span><br><span class="line">         <span class="keyword">this</span>.address =  <span class="keyword">new</span> Address(otherPerson.address);</span><br><span class="line">    &#125;</span><br><span class="line">[â€¦]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨è¿™ç§æ·±æ‹·è´ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°å°è¯•ç¤ºä¸Šé¢çš„ mother-son è¿™ä¸ªç”¨ä¾‹ã€‚ç°åœ¨ son å¯ä»¥æˆåŠŸçš„æ¬èµ°äº†ï¼</p>
<p>ä¸è¿‡ï¼Œæ•…äº‹åˆ°è¿™å„¿å¹¶æ²¡æœ‰ç»“æŸã€‚è¦åˆ›å»ºä¸€ä¸ªçœŸæ­£çš„æ·±æ‹·è´ï¼Œå°±éœ€è¦æˆ‘ä»¬ä¸€ç›´è¿™æ ·æ‹·è´ä¸‹å»ï¼Œä¸€ç›´è¦†ç›–åˆ° Person å¯¹è±¡æ‰€æœ‰çš„å†…éƒ¨å…ƒç´ , æœ€ååªå‰©ä¸‹åŸå§‹çš„ç±»å‹ä»¥åŠâ€œä¸å¯å˜å¯¹è±¡ï¼ˆ<strong>Immutablesï¼‰</strong>â€ã€‚è®©æˆ‘ä»¬è§‚å¯Ÿä¸‹å¦‚ä¸‹è¿™ä¸ª Street ç±»ä»¥è·å¾—æ›´å¥½çš„ç†è§£:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Street</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Street</span><span class="params">(Street otherStreet)</span></span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.name = otherStreet.name;</span><br><span class="line">         <span class="keyword">this</span>.number = otherStreet.number;</span><br><span class="line">    &#125;</span><br><span class="line">[â€¦]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Street å¯¹è±¡æœ‰ä¸¤ä¸ªå®ä½“å˜é‡ç»„æˆ â€“ <em>String ç±»å‹çš„ name</em> ä»¥åŠ <em>int ç±»å‹çš„ number</em>ã€‚<em>int  ç±»å‹çš„ number</em> æ˜¯ä¸€ä¸ªåŸå§‹ç±»å‹ï¼Œå¹¶éå¯¹è±¡ã€‚å®ƒåªæ˜¯ä¸€ä¸ªç®€å•çš„å€¼ï¼Œä¸èƒ½å…±äº«, å› æ­¤åœ¨åˆ›å»ºç¬¬äºŒä¸ªå®ä½“å˜é‡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æ‹·è´ã€‚<em>String</em> æ˜¯ä¸€ä¸ªä¸å¯å˜å¯¹è±¡ï¼ˆImmutableï¼‰ã€‚ç®€è¨€ä¹‹ï¼Œä¸å¯å˜å¯¹è±¡ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå¯ä¸€æ—¦åˆ›å»ºå¥½äº†ä»¥åå°±å†ä¹Ÿä¸èƒ½è¢«ä¿®æ”¹äº†ã€‚å› æ­¤ï¼Œä½ å¯ä»¥ä¸ç”¨ä¸ºå…¶åˆ›å»ºæ·±æ‹·è´å°±èƒ½å¯¹å…¶è¿›è¡Œå…±äº«ã€‚</p>
<p><strong>æ€»ç»“</strong> </p>
<p>ä½œä¸ºæ€»ç»“ï¼Œæˆ‘è¦è¯´è¯´ä¸Šé¢åœ¨ mother-son ç¤ºä¾‹ä¸­æ‰€ç”¨åˆ°çš„ä¸€äº›ç¼–ç æŠ€æœ¯ã€‚åªæ˜¯å› ä¸ºæ·±æ‹·è´å¯ä»¥è®©ä½ ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡é‡Œé¢çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚ Address å¯¹è±¡ï¼Œè¿™å¹¶ä¸æ„å‘³ç€ä½ å°±è¯¥è¿™æ ·åšã€‚è¿™æ ·åš<strong>ä¼šæé«˜ä»£ç çš„è´¨é‡</strong>, å› ä¸ºå®ƒå¯ä»¥ä½¿å¾— Person æ›´å®¹æ˜“ä¿®æ”¹ â€“ ä¸ç®¡ <em>Address ç±»ä»€ä¹ˆæ—¶å€™è¢«ä¿®æ”¹äº†ï¼Œä½ ä¹Ÿéƒ½ä¼šè¦</em>ä¿®æ”¹åº”ç”¨åˆ° Person ç±»ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ Address ç±»å‹ä¸å†åŒ…å« Street å¯¹è±¡äº†ï¼Œæˆ‘ä»¬å°±å¾—æ ¹æ®å·²ç»å¯¹ Address ç±»åšå‡ºçš„ä¿®æ”¹æ¥å¯¹Person ç±»ä¸­çš„ <em>moveOut()</em>  æ–¹æ³•è¿›è¡Œä¿®æ”¹ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘åªé€‰æ‹©ä½¿ç”¨äº†ä¸€ä¸ªæ–°çš„ Street å’Œ City å¯¹è±¡ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„å¯¹æµ…æ‹·è´å’Œæ·±æ‹·è´çš„ä¸åŒä¹‹å¤„è¿›è¡Œæè¿°ã€‚ä¸è¿‡ï¼Œæˆ‘ä¼šå»ºè®®ä½ ç»™æ–¹æ³•åˆ†é…ä¸€ä¸ªæ–°çš„ Address å¯¹è±¡ï¼Œè¿™æ ·èƒ½æœ‰æ•ˆçš„å°†å…¶è½¬æ¢æˆä¸€ä¸ªæµ…æ‹·è´å’Œæ·±æ‹·è´çš„<strong>æ··åˆä½“</strong>:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Person mother = <span class="keyword">new</span> Person(<span class="keyword">new</span> Name(â€¦), <span class="keyword">new</span> Address(â€¦));</span><br><span class="line">[â€¦]</span><br><span class="line">Person son  = <span class="keyword">new</span> Person(mother);</span><br><span class="line">[â€¦]</span><br><span class="line">son.moveOut(<span class="keyword">new</span> Address(...));</span><br></pre></td></tr></table></figure>
<p>åœ¨é¢å‘å¯¹è±¡é¢†åŸŸï¼Œè¿™æ ·åšè¿èƒŒäº†å°è£…çš„åŸåˆ™ï¼Œå› æ­¤åº”è¯¥è¢«é¿å…ã€‚å°è£…<strong>æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ä¸€ä¸ªæœ€é‡è¦çš„æ–¹é¢ã€‚</strong>åœ¨è¿™é‡Œï¼Œæˆ‘å·²ç»è¿èƒŒå°è£…çš„åŸåˆ™ï¼Œå¯¹ Person ç±»ä¸­ Address å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚è¿›è¡Œäº†è®¿é—®ã€‚è¿™æ ·åšå¯¹æˆ‘ä»¬çš„ä»£ç é€ æˆäº†ä¼¤å®³ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨è·Ÿ Person ç±»ä¸­çš„ Address ç±»çº ç¼ åœ¨ä¸€èµ·ï¼Œå¦‚æœå¯¹ Address ç±»è¿›è¡Œäº†ä¿®æ”¹ï¼Œå°±ä¼šå¦‚æˆ‘ä¸Šé¢æ‰€è§£é‡Šçš„å¯¹ä»£ç é€ æˆä¼¤å®³ã€‚ä¸è¿‡æ˜¯ä½ æ˜¾ç„¶æ˜¯ä¼šéœ€è¦å°†ä½ å®šä¹‰çš„å„ç§ç±»äº’ç›¸è”ç³»åœ¨ä¸€èµ·ä»¥æ„æˆä»£ç å·¥ç¨‹çš„ï¼Œä½†åœ¨ä½ è¦å°†ä¸¤ä¸ªç±»è”ç³»åœ¨ä¸€èµ·æ—¶ï¼Œéœ€è¦å¥½å¥½åˆ†æä¸€ä¸‹æˆæœ¬å’Œæ”¶ç›Šã€‚</p>
<h4 id="3-1-æ•°ç»„å’Œé“¾è¡¨æ•°æ®ç»“æ„æè¿°ï¼Œå„è‡ªçš„æ—¶é—´å¤æ‚åº¦ã€‚"><a href="#3-1-æ•°ç»„å’Œé“¾è¡¨æ•°æ®ç»“æ„æè¿°ï¼Œå„è‡ªçš„æ—¶é—´å¤æ‚åº¦ã€‚" class="headerlink" title="3.1 æ•°ç»„å’Œé“¾è¡¨æ•°æ®ç»“æ„æè¿°ï¼Œå„è‡ªçš„æ—¶é—´å¤æ‚åº¦ã€‚"></a>3.1 æ•°ç»„å’Œé“¾è¡¨æ•°æ®ç»“æ„æè¿°ï¼Œå„è‡ªçš„æ—¶é—´å¤æ‚åº¦ã€‚</h4><h5 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a><strong>æ¦‚è¿°</strong></h5><p><strong>æ•°ç»„</strong>ã€€</p>
<p>æ˜¯å°†å…ƒç´ åœ¨å†…å­˜ä¸­<strong>è¿ç»­å­˜æ”¾</strong>ï¼Œç”±äºæ¯ä¸ªå…ƒç´ å ç”¨å†…å­˜ç›¸åŒï¼Œå¯ä»¥é€šè¿‡ä¸‹æ ‡è¿…é€Ÿè®¿é—®æ•°ç»„ä¸­ä»»ä½•å…ƒç´ ã€‚ä½†æ˜¯å¦‚æœè¦åœ¨æ•°ç»„ä¸­å¢åŠ ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦ç§»åŠ¨å¤§é‡å…ƒç´ ï¼Œåœ¨å†…å­˜ä¸­ç©ºå‡ºä¸€ä¸ªå…ƒç´ çš„ç©ºé—´ï¼Œç„¶åå°†è¦å¢åŠ çš„å…ƒç´ æ”¾åœ¨å…¶ä¸­ã€‚åŒæ ·çš„é“ç†ï¼Œå¦‚æœæƒ³åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼ŒåŒæ ·éœ€è¦ç§»åŠ¨å¤§é‡å…ƒç´ å»å¡«æ‰è¢«ç§»åŠ¨çš„å…ƒç´ ã€‚å¦‚æœåº”ç”¨éœ€è¦<strong>å¿«é€Ÿè®¿é—®æ•°æ®ï¼Œå¾ˆå°‘æ’å…¥å’Œåˆ é™¤å…ƒç´ ï¼Œå°±åº”è¯¥ç”¨æ•°ç»„ã€‚</strong></p>
<p><strong>é“¾è¡¨</strong>ã€€</p>
<p>å…ƒç´ åœ¨å†…å­˜ä¸­ä¸æ˜¯é¡ºåºå­˜å‚¨çš„ï¼Œè€Œæ˜¯é€šè¿‡å­˜åœ¨å…ƒç´ ä¸­çš„æŒ‡é’ˆè”ç³»åˆ°ä¸€èµ·ï¼Œæ¯ä¸ªç»“ç‚¹åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼šä¸€ä¸ªæ˜¯å­˜å‚¨æ•°æ®å…ƒç´ çš„æ•°æ®åŸŸï¼Œå¦ä¸€ä¸ªæ˜¯å­˜å‚¨ä¸‹ä¸€ä¸ªç»“ç‚¹åœ°å€çš„ æŒ‡é’ˆã€‚<br>å¦‚æœè¦è®¿é—®é“¾è¡¨ä¸­ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œä¸€ç›´æ‰¾åˆ°éœ€è¦çš„å…ƒç´ ä½ç½®ã€‚ä½†æ˜¯å¢åŠ å’Œåˆ é™¤ä¸€ä¸ªå…ƒç´ å¯¹äºé“¾è¡¨æ•°æ®ç»“æ„å°±éå¸¸ç®€å•äº†ï¼Œåªè¦ä¿®æ”¹å…ƒç´ ä¸­çš„æŒ‡é’ˆå°±å¯ä»¥äº†ã€‚å¦‚æœåº”ç”¨éœ€è¦<strong>ç»å¸¸æ’å…¥å’Œåˆ é™¤å…ƒç´ ä½ å°±éœ€è¦ç”¨é“¾è¡¨</strong>ã€‚</p>
<p><strong>å†…å­˜å­˜å‚¨åŒºåˆ«</strong></p>
<p>æ•°ç»„ä»<strong>æ ˆ</strong>ä¸­åˆ†é…ç©ºé—´, å¯¹äºç¨‹åºå‘˜æ–¹ä¾¿å¿«é€Ÿ,ä½†è‡ªç”±åº¦å°ã€‚</p>
<p>é“¾è¡¨ä»<strong>å †</strong>ä¸­åˆ†é…ç©ºé—´, è‡ªç”±åº¦å¤§ä½†ç”³è¯·ç®¡ç†æ¯”è¾ƒéº»çƒ¦.ã€€</p>
<p><strong>é€»è¾‘ç»“æ„åŒºåˆ«</strong></p>
<p>æ•°ç»„å¿…é¡»äº‹å…ˆå®šä¹‰<strong>å›ºå®šçš„é•¿åº¦</strong>ï¼ˆå…ƒç´ ä¸ªæ•°ï¼‰ï¼Œä¸èƒ½é€‚åº”æ•°æ®åŠ¨æ€åœ°å¢å‡çš„æƒ…å†µã€‚å½“æ•°æ®å¢åŠ æ—¶ï¼Œå¯èƒ½è¶…å‡ºåŸå…ˆå®šä¹‰çš„å…ƒç´ ä¸ªæ•°ï¼›å½“æ•°æ®å‡å°‘æ—¶ï¼Œé€ æˆå†…å­˜æµªè´¹ã€‚ã€€</p>
<p>é“¾è¡¨åŠ¨æ€åœ°è¿›è¡Œå­˜å‚¨åˆ†é…ï¼Œå¯ä»¥é€‚åº”æ•°æ®åŠ¨æ€åœ°å¢å‡çš„æƒ…å†µï¼Œä¸”å¯ä»¥æ–¹ä¾¿åœ°æ’å…¥ã€åˆ é™¤æ•°æ®é¡¹ã€‚ï¼ˆæ•°ç»„ä¸­æ’å…¥ã€åˆ é™¤æ•°æ®é¡¹æ—¶ï¼Œéœ€è¦ç§»åŠ¨å…¶å®ƒæ•°æ®é¡¹ï¼‰ã€€</p>
<p><strong>æ€»ç»“</strong></p>
<p>1ã€å­˜å–æ–¹å¼ä¸Šï¼Œæ•°ç»„å¯ä»¥é¡ºåºå­˜å–æˆ–è€…éšæœºå­˜å–ï¼Œè€Œé“¾è¡¨åªèƒ½é¡ºåºå­˜å–ï¼›ã€€</p>
<p>2ã€å­˜å‚¨ä½ç½®ä¸Šï¼Œæ•°ç»„é€»è¾‘ä¸Šç›¸é‚»çš„å…ƒç´ åœ¨ç‰©ç†å­˜å‚¨ä½ç½®ä¸Šä¹Ÿç›¸é‚»ï¼Œè€Œé“¾è¡¨ä¸ä¸€å®šï¼›ã€€</p>
<p>3ã€å­˜å‚¨ç©ºé—´ä¸Šï¼Œé“¾è¡¨ç”±äºå¸¦æœ‰æŒ‡é’ˆåŸŸï¼Œå­˜å‚¨å¯†åº¦ä¸å¦‚æ•°ç»„å¤§ï¼›ã€€</p>
<p>4ã€æŒ‰åºå·æŸ¥æ‰¾æ—¶ï¼Œæ•°ç»„å¯ä»¥éšæœºè®¿é—®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œè€Œé“¾è¡¨ä¸æ”¯æŒéšæœºè®¿é—®ï¼Œå¹³å‡éœ€è¦O(n)ï¼›ã€€</p>
<p>5ã€æŒ‰å€¼æŸ¥æ‰¾æ—¶ï¼Œè‹¥æ•°ç»„æ— åºï¼Œæ•°ç»„å’Œé“¾è¡¨æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(1)ï¼Œä½†æ˜¯å½“æ•°ç»„æœ‰åºæ—¶ï¼Œå¯ä»¥é‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾å°†æ—¶é—´å¤æ‚åº¦é™ä¸ºO(logn)ï¼›ã€€</p>
<p>6ã€æ’å…¥å’Œåˆ é™¤æ—¶ï¼Œæ•°ç»„å¹³å‡éœ€è¦ç§»åŠ¨n/2ä¸ªå…ƒç´ ï¼Œè€Œé“¾è¡¨åªéœ€ä¿®æ”¹æŒ‡é’ˆå³å¯ï¼›ã€€</p>
<p>7ã€ç©ºé—´åˆ†é…æ–¹é¢ï¼š<br>æ•°ç»„åœ¨é™æ€å­˜å‚¨åˆ†é…æƒ…å½¢ä¸‹ï¼Œå­˜å‚¨å…ƒç´ æ•°é‡å—é™åˆ¶ï¼ŒåŠ¨æ€å­˜å‚¨åˆ†é…æƒ…å½¢ä¸‹ï¼Œè™½ç„¶å­˜å‚¨ç©ºé—´å¯ä»¥æ‰©å……ï¼Œä½†éœ€è¦ç§»                                             åŠ¨å¤§é‡å…ƒç´ ï¼Œå¯¼è‡´æ“ä½œæ•ˆç‡é™ä½ï¼Œè€Œä¸”å¦‚æœå†…å­˜ä¸­æ²¡æœ‰æ›´å¤§å—è¿ç»­å­˜å‚¨ç©ºé—´å°†å¯¼è‡´åˆ†é…å¤±è´¥ï¼›<br>é“¾è¡¨å­˜å‚¨çš„èŠ‚ç‚¹ç©ºé—´åªåœ¨éœ€è¦çš„æ—¶å€™ç”³è¯·åˆ†é…ï¼Œåªè¦å†…å­˜ä¸­æœ‰ç©ºé—´å°±å¯ä»¥åˆ†é…ï¼Œæ“ä½œæ¯”è¾ƒçµæ´»é«˜æ•ˆï¼›</p>
<h4 id="3-2-errorå’Œexceptionçš„åŒºåˆ«ï¼ŒCheckedExceptionï¼ŒRuntimeExceptionçš„åŒºåˆ«ã€‚"><a href="#3-2-errorå’Œexceptionçš„åŒºåˆ«ï¼ŒCheckedExceptionï¼ŒRuntimeExceptionçš„åŒºåˆ«ã€‚" class="headerlink" title="3.2 errorå’Œexceptionçš„åŒºåˆ«ï¼ŒCheckedExceptionï¼ŒRuntimeExceptionçš„åŒºåˆ«ã€‚"></a>3.2 errorå’Œexceptionçš„åŒºåˆ«ï¼ŒCheckedExceptionï¼ŒRuntimeExceptionçš„åŒºåˆ«ã€‚</h4><p><strong>Exception</strong><br>ä¸€èˆ¬åˆ†ä¸ºCheckedå¼‚å¸¸å’ŒRuntimeå¼‚å¸¸ï¼Œæ‰€æœ‰RuntimeExceptionç±»åŠå…¶å­ç±»çš„å®ä¾‹è¢«ç§°ä¸ºRuntimeå¼‚å¸¸ï¼Œä¸å±äºè¯¥èŒƒç•´çš„å¼‚å¸¸åˆ™è¢«ç§°ä¸ºCheckedExceptionã€‚</p>
<p><strong>Checkedå¼‚å¸¸</strong><br>åªæœ‰javaè¯­è¨€æä¾›äº†Checkedå¼‚å¸¸ï¼ŒJavaè®¤ä¸ºCheckedå¼‚å¸¸éƒ½æ˜¯å¯ä»¥è¢«å¤„ç†çš„å¼‚å¸¸ï¼Œæ‰€ä»¥Javaç¨‹åºå¿…é¡»æ˜¾ç¤ºå¤„ç†Checkedå¼‚å¸¸ã€‚å¦‚æœç¨‹åºæ²¡æœ‰å¤„ç†Checkedå¼‚å¸¸ï¼Œè¯¥ç¨‹åºåœ¨ç¼–è¯‘æ—¶å°±ä¼šå‘ç”Ÿé”™è¯¯æ— æ³•ç¼–è¯‘ã€‚è¿™ä½“ç°äº†Javaçš„è®¾è®¡å“²å­¦ï¼šæ²¡æœ‰å®Œå–„é”™è¯¯å¤„ç†çš„ä»£ç æ ¹æœ¬æ²¡æœ‰æœºä¼šè¢«æ‰§è¡Œã€‚å¯¹Checkedå¼‚å¸¸å¤„ç†æ–¹æ³•æœ‰ä¸¤ç§</p>
<p>1 å½“å‰æ–¹æ³•çŸ¥é“å¦‚ä½•å¤„ç†è¯¥å¼‚å¸¸ï¼Œåˆ™ç”¨tryâ€¦catchå—æ¥å¤„ç†è¯¥å¼‚å¸¸ã€‚<br>2 å½“å‰æ–¹æ³•ä¸çŸ¥é“å¦‚ä½•å¤„ç†ï¼Œåˆ™åœ¨å®šä¹‰è¯¥æ–¹æ³•æ˜¯å£°æ˜æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</p>
<p>æˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„Checkedå¼‚å¸¸æœ‰</p>
<p>Java.lang.ClassNotFoundException<br>Java.lang.NoSuchMetodException<br>java.io.IOException</p>
<p><strong>RuntimeException</strong><br>Runtimeå¦‚é™¤æ•°æ˜¯0å’Œæ•°ç»„ä¸‹æ ‡è¶Šç•Œç­‰ï¼Œå…¶äº§ç”Ÿé¢‘ç¹ï¼Œå¤„ç†éº»çƒ¦ï¼Œè‹¥æ˜¾ç¤ºç”³æ˜æˆ–è€…æ•è·å°†ä¼šå¯¹ç¨‹åºçš„å¯è¯»æ€§å’Œè¿è¡Œæ•ˆç‡å½±å“å¾ˆå¤§ã€‚æ‰€ä»¥ç”±ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å¹¶å°†å®ƒä»¬äº¤ç»™ç¼ºçœçš„å¼‚å¸¸å¤„ç†ç¨‹åºã€‚å½“ç„¶å¦‚æœä½ æœ‰å¤„ç†è¦æ±‚ä¹Ÿå¯ä»¥æ˜¾ç¤ºæ•è·å®ƒä»¬ã€‚</p>
<p>æˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„RumtimeExceptionå­ç±»ï¼š</p>
<p>Java.lang.ArithmeticException<br>Java.lang.ArrayStoreExcetpion<br>Java.lang.ClassCastException<br>Java.lang.IndexOutOfBoundsException<br>Java.lang.NullPointerException</p>
<p><strong>Error</strong><br>å½“ç¨‹åºå‘ç”Ÿä¸å¯æ§çš„é”™è¯¯æ—¶ï¼Œé€šå¸¸åšæ³•æ˜¯é€šçŸ¥ç”¨æˆ·å¹¶ä¸­æ­¢ç¨‹åºçš„æ‰§è¡Œã€‚ä¸å¼‚å¸¸ä¸åŒçš„æ˜¯ErroråŠå…¶å­ç±»çš„å¯¹è±¡ä¸åº”è¢«æŠ›å‡ºã€‚</p>
<p>Erroræ˜¯throwableçš„å­ç±»ï¼Œä»£è¡¨ç¼–è¯‘æ—¶é—´å’Œç³»ç»Ÿé”™è¯¯ï¼Œç”¨äºæŒ‡ç¤ºåˆç†çš„åº”ç”¨ç¨‹åºä¸åº”è¯¥è¯•å›¾æ•è·çš„ä¸¥é‡é—®é¢˜ã€‚</p>
<p>Errorç”±Javaè™šæ‹Ÿæœºç”Ÿæˆå¹¶æŠ›å‡ºï¼ŒåŒ…æ‹¬åŠ¨æ€é“¾æ¥å¤±è´¥ï¼Œè™šæ‹Ÿæœºé”™è¯¯ç­‰ã€‚ç¨‹åºå¯¹å…¶ä¸åšå¤„ç†ã€‚</p>
<h4 id="3-3-è¯·åˆ—å‡º5ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ã€‚"><a href="#3-3-è¯·åˆ—å‡º5ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ã€‚" class="headerlink" title="3.3 è¯·åˆ—å‡º5ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ã€‚"></a>3.3 è¯·åˆ—å‡º5ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ã€‚</h4><p>Java.lang.ArithmeticException<br>Java.lang.ArrayStoreExcetpion<br>Java.lang.ClassCastException<br>Java.lang.IndexOutOfBoundsException<br>Java.lang.NullPointerException</p>
<h4 id="3-4-åœ¨è‡ªå·±çš„ä»£ç ä¸­ï¼Œå¦‚æœåˆ›å»ºä¸€ä¸ªjava-lang-Stringç±»ï¼Œè¿™ä¸ªç±»æ˜¯å¦å¯ä»¥è¢«ç±»åŠ è½½å™¨åŠ è½½ï¼Ÿä¸ºä»€ä¹ˆã€‚"><a href="#3-4-åœ¨è‡ªå·±çš„ä»£ç ä¸­ï¼Œå¦‚æœåˆ›å»ºä¸€ä¸ªjava-lang-Stringç±»ï¼Œè¿™ä¸ªç±»æ˜¯å¦å¯ä»¥è¢«ç±»åŠ è½½å™¨åŠ è½½ï¼Ÿä¸ºä»€ä¹ˆã€‚" class="headerlink" title="3.4 åœ¨è‡ªå·±çš„ä»£ç ä¸­ï¼Œå¦‚æœåˆ›å»ºä¸€ä¸ªjava.lang.Stringç±»ï¼Œè¿™ä¸ªç±»æ˜¯å¦å¯ä»¥è¢«ç±»åŠ è½½å™¨åŠ è½½ï¼Ÿä¸ºä»€ä¹ˆã€‚"></a>3.4 åœ¨è‡ªå·±çš„ä»£ç ä¸­ï¼Œå¦‚æœåˆ›å»ºä¸€ä¸ªjava.lang.Stringç±»ï¼Œè¿™ä¸ªç±»æ˜¯å¦å¯ä»¥è¢«ç±»åŠ è½½å™¨åŠ è½½ï¼Ÿä¸ºä»€ä¹ˆã€‚</h4><p><strong>åŒäº²å§”æ´¾æ¨¡å‹</strong><br>ç±»åŠ è½½å™¨å¯åˆ†ä¸ºä¸¤ç±»ï¼šä¸€æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨(Bootstrap ClassLoader)ï¼Œæ˜¯C++å®ç°çš„ï¼Œæ˜¯JVMçš„ä¸€éƒ¨åˆ†ï¼›å¦ä¸€ç§æ˜¯å…¶å®ƒçš„ç±»åŠ è½½å™¨ï¼Œæ˜¯Javaå®ç°çš„ï¼Œç‹¬ç«‹äºJVMï¼Œå…¨éƒ¨éƒ½ç»§æ‰¿è‡ªæŠ½è±¡ç±»java.lang.ClassLoaderã€‚jdkè‡ªå¸¦äº†ä¸‰ç§ç±»åŠ è½½å™¨ï¼Œåˆ†åˆ«æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼Œæ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ã€‚åä¸¤ç§åŠ è½½å™¨æ˜¯ç»§æ‰¿è‡ªæŠ½è±¡ç±»java.lang.ClassLoaderã€‚</p>
<p>ä¸€èˆ¬æ˜¯ï¼š è‡ªå®šä¹‰ç±»åŠ è½½å™¨ &gt;&gt; åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ &gt;&gt; æ‰©å±•ç±»åŠ è½½å™¨ &gt;&gt; å¯åŠ¨ç±»åŠ è½½å™¨</p>
<p>ä¸Šé¢çš„å±‚æ¬¡å…³ç³»è¢«ç§°ä¸ºåŒäº²å§”æ´¾æ¨¡å‹(Parents Delegation Model)ã€‚é™¤äº†æœ€é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½æœ‰å¯¹åº”çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</p>
<p>ç®€å•è¯´ä¸‹åŒäº²å§”æ‰˜æœºåˆ¶ï¼šå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å°è¯•å»åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡çš„ç±»åŠ è½½å™¨éƒ½æ˜¯åŠ æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆåˆ°è¾¾é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œåªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚æ—¶ï¼ˆæŒ‡å®ƒçš„æœç´¢èŒƒå›´æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰ï¼Œå­ç±»åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚</p>
<p>å„ä¸ªç±»åŠ è½½å™¨ä¹‹é—´æ˜¯ç»„åˆå…³ç³»ï¼Œå¹¶éç»§æ‰¿å…³ç³»ã€‚</p>
<p>åŒäº²å§”æ´¾æ¨¡å‹å¯ä»¥ç¡®ä¿å®‰å…¨æ€§ï¼Œå¯ä»¥ä¿è¯æ‰€æœ‰çš„Javaç±»åº“éƒ½æ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ã€‚å¦‚ç”¨æˆ·ç¼–å†™çš„java.lang.Objectï¼ŒåŠ è½½è¯·æ±‚ä¼ é€’åˆ°å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå¯åŠ¨ç±»åŠ è½½çš„æ˜¯ç³»ç»Ÿä¸­çš„Objectå¯¹è±¡ï¼Œè€Œç”¨æˆ·ç¼–å†™çš„java.lang.Objectä¸ä¼šè¢«åŠ è½½ã€‚å¦‚ç”¨æˆ·ç¼–å†™çš„java.lang.virusç±»ï¼ŒåŠ è½½è¯·æ±‚ä¼ é€’åˆ°å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨å‘ç°virusç±»å¹¶ä¸æ˜¯æ ¸å¿ƒJavaç±»ï¼Œæ— æ³•è¿›è¡ŒåŠ è½½ï¼Œå°†ä¼šç”±å…·ä½“çš„å­ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œè€Œç»è¿‡ä¸åŒåŠ è½½å™¨è¿›è¡ŒåŠ è½½çš„ç±»æ˜¯æ— æ³•è®¿é—®å½¼æ­¤çš„ã€‚ç”±ä¸åŒåŠ è½½å™¨åŠ è½½çš„ç±»å¤„äºä¸åŒçš„è¿è¡Œæ—¶åŒ…ã€‚æ‰€æœ‰çš„è®¿é—®æƒé™éƒ½æ˜¯åŸºäºåŒä¸€ä¸ªè¿è¡Œæ—¶åŒ…è€Œè¨€çš„ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è¿™ç§åŒäº²å§”æ‰˜æ¨¡å¼å‘¢ï¼Ÿ</strong><br>å› ä¸ºè¿™æ ·å¯ä»¥é¿å…é‡å¤åŠ è½½ï¼Œå½“çˆ¶äº²å·²ç»åŠ è½½äº†è¯¥ç±»çš„æ—¶å€™ï¼Œå°±æ²¡æœ‰å¿…è¦å­ClassLoaderå†åŠ è½½ä¸€æ¬¡ã€‚</p>
<p>è€ƒè™‘åˆ°å®‰å…¨å› ç´ ï¼Œæˆ‘ä»¬è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸ä½¿ç”¨è¿™ç§å§”æ‰˜æ¨¡å¼ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥éšæ—¶ä½¿ç”¨è‡ªå®šä¹‰çš„Stringæ¥åŠ¨æ€æ›¿ä»£javaæ ¸å¿ƒapiä¸­å®šä¹‰ç±»å‹ï¼Œè¿™æ ·ä¼šå­˜åœ¨éå¸¸å¤§çš„å®‰å…¨éšæ‚£ï¼Œè€ŒåŒäº²å§”æ‰˜çš„æ–¹å¼ï¼Œå°±å¯ä»¥é¿å…è¿™ç§æƒ…å†µï¼Œå› ä¸ºStringå·²ç»åœ¨å¯åŠ¨æ—¶è¢«åŠ è½½ï¼Œæ‰€ä»¥ç”¨æˆ·è‡ªå®šä¹‰ç±»æ˜¯æ— æ³•åŠ è½½ä¸€ä¸ªè‡ªå®šä¹‰çš„ClassLoaderã€‚</p>
<p>æ€è€ƒï¼šå‡å¦‚æˆ‘ä»¬è‡ªå·±å†™äº†ä¸€ä¸ªjava.lang.Stringçš„ç±»ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥æ›¿æ¢è°ƒJDKæœ¬èº«çš„ç±»ï¼Ÿ<br>ç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚æˆ‘ä»¬ä¸èƒ½å®ç°ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘çœ‹å¾ˆå¤šç½‘ä¸Šè§£é‡Šæ˜¯è¯´åŒäº²å§”æ‰˜æœºåˆ¶è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®ä¸æ˜¯éå¸¸çš„å‡†ç¡®ã€‚å› ä¸ºåŒäº²å§”æ‰˜æœºåˆ¶æ˜¯å¯ä»¥æ‰“ç ´çš„ï¼Œä½ å®Œå…¨å¯ä»¥è‡ªå·±å†™ä¸€ä¸ªclassLoaderæ¥åŠ è½½è‡ªå·±å†™çš„java.lang.Stringç±»ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°ä¹Ÿä¸ä¼šåŠ è½½æˆåŠŸï¼Œå…·ä½“å°±æ˜¯å› ä¸ºé’ˆå¯¹java.*å¼€å¤´çš„ç±»ï¼Œjvmçš„å®ç°ä¸­å·²ç»ä¿è¯äº†å¿…é¡»ç”±bootstrpæ¥åŠ è½½ã€‚</p>
<p>å› åŠ è½½æŸä¸ªç±»æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨çˆ¶ç±»åŠ è½½å™¨åŠ è½½éœ€è¦ä½¿ç”¨çš„ç±»ã€‚å¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰äº†java.lang.Stringè¿™ä¸ªç±»ï¼Œ åŠ è½½è¯¥è‡ªå®šä¹‰çš„Stringç±»ï¼Œè¯¥è‡ªå®šä¹‰Stringç±»ä½¿ç”¨çš„åŠ è½½å™¨æ˜¯AppClassLoaderï¼Œæ ¹æ®ä¼˜å…ˆä½¿ç”¨çˆ¶ç±»åŠ è½½å™¨åŸç†ï¼Œ AppClassLoaderåŠ è½½å™¨çš„çˆ¶ç±»ä¸ºExtClassLoaderï¼Œæ‰€ä»¥è¿™æ—¶åŠ è½½Stringä½¿ç”¨çš„ç±»åŠ è½½å™¨æ˜¯ExtClassLoaderï¼Œ ä½†æ˜¯ç±»åŠ è½½å™¨ExtClassLoaderåœ¨jre/lib/extç›®å½•ä¸‹æ²¡æœ‰æ‰¾åˆ°String.classç±»ã€‚ç„¶åä½¿ç”¨ExtClassLoaderçˆ¶ç±»çš„åŠ è½½å™¨BootStrapï¼Œ çˆ¶ç±»åŠ è½½å™¨BootStrapåœ¨JRE/libç›®å½•çš„rt.jaræ‰¾åˆ°äº†String.classï¼Œå°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™å°±æ˜¯ç±»åŠ è½½å™¨çš„å§”æ‰˜æœºåˆ¶ã€‚</p>
<p><strong>å®šä¹‰è‡ªå·²çš„ClassLoader</strong><br>æ—¢ç„¶JVMå·²ç»æä¾›äº†é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å®šä¹‰è‡ªå·²çš„ç±»åŠ è½½å™¨å‘¢ï¼Ÿ</p>
<p>å› ä¸ºJavaä¸­æä¾›çš„é»˜è®¤ClassLoaderï¼ŒåªåŠ è½½æŒ‡å®šç›®å½•ä¸‹çš„jarå’Œclassï¼Œå¦‚æœæˆ‘ä»¬æƒ³åŠ è½½å…¶å®ƒä½ç½®çš„ç±»æˆ–jaræ—¶ï¼Œæ¯”å¦‚ï¼šæˆ‘è¦åŠ è½½ç½‘ç»œä¸Šçš„ä¸€ä¸ªclassæ–‡ä»¶ï¼Œé€šè¿‡åŠ¨æ€åŠ è½½åˆ°å†…å­˜ä¹‹åï¼Œè¦è°ƒç”¨è¿™ä¸ªç±»ä¸­çš„æ–¹æ³•å®ç°æˆ‘çš„ä¸šåŠ¡é€»è¾‘ã€‚åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„ClassLoaderå°±ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚äº†ï¼Œæ‰€ä»¥éœ€è¦å®šä¹‰è‡ªå·±çš„ClassLoaderã€‚</p>
<p>å®šä¹‰è‡ªå·²çš„ç±»åŠ è½½å™¨åˆ†ä¸ºä¸¤æ­¥ï¼š</p>
<p>1ã€ç»§æ‰¿java.lang.ClassLoader</p>
<p>2ã€é‡å†™çˆ¶ç±»çš„findClassæ–¹æ³•</p>
<p>å¯èƒ½åœ¨è¿™é‡Œæœ‰ç–‘é—®ï¼Œçˆ¶ç±»æœ‰é‚£ä¹ˆå¤šæ–¹æ³•ï¼Œä¸ºä»€ä¹ˆåååªé‡å†™findClassæ–¹æ³•ï¼Ÿ</p>
<p>å› ä¸ºJDKå·²ç»åœ¨loadClassæ–¹æ³•ä¸­å¸®æˆ‘ä»¬å®ç°äº†ClassLoaderæœç´¢ç±»çš„ç®—æ³•ï¼Œå½“åœ¨loadClassæ–¹æ³•ä¸­æœç´¢ä¸åˆ°ç±»æ—¶ï¼ŒloadClassæ–¹æ³•å°±ä¼šè°ƒç”¨findClassæ–¹æ³•æ¥æœç´¢ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€é‡å†™è¯¥æ–¹æ³•å³å¯ã€‚å¦‚æ²¡æœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œä¸€èˆ¬ä¸å»ºè®®é‡å†™loadClassæœç´¢ç±»çš„ç®—æ³•ã€‚</p>
<h4 id="3-5-è¯´ä¸€è¯´ä½ å¯¹java-lang-Objectå¯¹è±¡ä¸­hashCodeå’Œequalsæ–¹æ³•çš„ç†è§£ã€‚åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦é‡æ–°å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚"><a href="#3-5-è¯´ä¸€è¯´ä½ å¯¹java-lang-Objectå¯¹è±¡ä¸­hashCodeå’Œequalsæ–¹æ³•çš„ç†è§£ã€‚åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦é‡æ–°å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚" class="headerlink" title="3.5 è¯´ä¸€è¯´ä½ å¯¹java.lang.Objectå¯¹è±¡ä¸­hashCodeå’Œequalsæ–¹æ³•çš„ç†è§£ã€‚åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦é‡æ–°å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚"></a>3.5 è¯´ä¸€è¯´ä½ å¯¹java.lang.Objectå¯¹è±¡ä¸­hashCodeå’Œequalsæ–¹æ³•çš„ç†è§£ã€‚åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦é‡æ–°å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</h4><p><strong>hashcode</strong></p>
<p>hashcodeï¼ˆï¼‰æ–¹æ³•æä¾›äº†å¯¹è±¡çš„hashCodeå€¼ï¼Œæ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œè¿”å›çš„é»˜è®¤å€¼ä¸System.identityHashCode(obj)ä¸€è‡´ã€‚</p>
<p>é€šå¸¸è¿™ä¸ªå€¼æ˜¯å¯¹è±¡å¤´éƒ¨çš„ä¸€éƒ¨åˆ†äºŒè¿›åˆ¶ä½ç»„æˆçš„æ•°å­—ï¼Œå…·æœ‰ä¸€å®šçš„æ ‡è¯†å¯¹è±¡çš„æ„ä¹‰å­˜åœ¨ï¼Œä½†ç»ä¸å®šäºåœ°å€ã€‚</p>
<p>ä½œç”¨æ˜¯ï¼šç”¨ä¸€ä¸ªæ•°å­—æ¥æ ‡è¯†å¯¹è±¡ã€‚æ¯”å¦‚åœ¨HashMapã€HashSetç­‰ç±»ä¼¼çš„é›†åˆç±»ä¸­ï¼Œå¦‚æœç”¨æŸä¸ªå¯¹è±¡æœ¬èº«ä½œä¸ºKeyï¼Œå³è¦åŸºäºè¿™ä¸ªå¯¹è±¡å®ç°Hashçš„å†™å…¥å’ŒæŸ¥æ‰¾ï¼Œé‚£ä¹ˆå¯¹è±¡æœ¬èº«å¦‚ä½•å®ç°è¿™ä¸ªå‘¢ï¼Ÿå°±æ˜¯åŸºäºhashcodeè¿™æ ·ä¸€ä¸ªæ•°å­—æ¥å®Œæˆçš„ï¼Œåªæœ‰æ•°å­—æ‰èƒ½å®Œæˆè®¡ç®—å’Œå¯¹æ¯”æ“ä½œã€‚</p>
<p><strong>hashcodeæ˜¯å¦å”¯ä¸€</strong></p>
<p>hashcodeåªèƒ½è¯´æ˜¯æ ‡è¯†å¯¹è±¡ï¼Œåœ¨hashç®—æ³•ä¸­å¯ä»¥å°†å¯¹è±¡ç›¸å¯¹ç¦»æ•£å¼€ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æŸ¥æ‰¾æ•°æ®çš„æ—¶å€™æ ¹æ®è¿™ä¸ªkeyå¿«é€Ÿç¼©å°æ•°æ®çš„èŒƒå›´ï¼Œä½†<strong>hashcodeä¸ä¸€å®šæ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥hashç®—æ³•ä¸­å®šä½åˆ°å…·ä½“çš„é“¾è¡¨åï¼Œéœ€è¦å¾ªç¯é“¾è¡¨ï¼Œç„¶åé€šè¿‡equalsæ–¹æ³•æ¥å¯¹æ¯”Keyæ˜¯å¦æ˜¯ä¸€æ ·çš„</strong>ã€‚</p>
<p><strong>equalsä¸hashcodeçš„å…³ç³»</strong></p>
<p>equalsç›¸ç­‰ä¸¤ä¸ªå¯¹è±¡ï¼Œåˆ™hashcodeä¸€å®šè¦ç›¸ç­‰ã€‚ä½†æ˜¯hashcodeç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šequalsç›¸ç­‰ã€‚</p>
<p><strong>å°ç»“</strong></p>
<p>hashcodeæ˜¯ä¸ºäº†ç®—æ³•å¿«é€Ÿå®šä½æ•°æ®è€Œå­˜åœ¨çš„ï¼Œè€Œequalsæ˜¯ä¸ºäº†å¯¹æ¯”çœŸå®å€¼è€Œå­˜åœ¨çš„ã€‚</p>
<h4 id="3-6-åœ¨jdk1-5ä¸­ï¼Œå¼•å…¥äº†æ³›å‹ï¼Œæ³›å‹çš„å­˜åœ¨æ˜¯ç”¨æ¥è§£å†³ä»€ä¹ˆé—®é¢˜ã€‚"><a href="#3-6-åœ¨jdk1-5ä¸­ï¼Œå¼•å…¥äº†æ³›å‹ï¼Œæ³›å‹çš„å­˜åœ¨æ˜¯ç”¨æ¥è§£å†³ä»€ä¹ˆé—®é¢˜ã€‚" class="headerlink" title="3.6 åœ¨jdk1.5ä¸­ï¼Œå¼•å…¥äº†æ³›å‹ï¼Œæ³›å‹çš„å­˜åœ¨æ˜¯ç”¨æ¥è§£å†³ä»€ä¹ˆé—®é¢˜ã€‚"></a>3.6 åœ¨jdk1.5ä¸­ï¼Œå¼•å…¥äº†æ³›å‹ï¼Œæ³›å‹çš„å­˜åœ¨æ˜¯ç”¨æ¥è§£å†³ä»€ä¹ˆé—®é¢˜ã€‚</h4><p>æ³›å‹çš„æœ¬è´¨æ˜¯å‚æ•°åŒ–ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æ“ä½œçš„æ•°æ®ç±»å‹è¢«æŒ‡å®šä¸ºä¸€ä¸ªå‚æ•°ï¼Œæ³›å‹çš„å¥½å¤„æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™æ£€æŸ¥ç±»å‹å®‰å…¨ï¼Œå¹¶ä¸”æ‰€æœ‰çš„å¼ºåˆ¶è½¬æ¢éƒ½æ˜¯è‡ªåŠ¨å’Œéšå¼çš„ï¼Œä»¥æé«˜ä»£ç çš„é‡ç”¨ç‡ã€‚</p>
<p><strong>ç¬¬ä¸€æ˜¯æ³›åŒ–ã€‚</strong>å¯ä»¥ç”¨Tä»£è¡¨ä»»æ„ç±»å‹Javaè¯­è¨€ä¸­å¼•å…¥æ³›å‹æ˜¯ä¸€ä¸ªè¾ƒå¤§çš„åŠŸèƒ½å¢å¼ºä¸ä»…è¯­è¨€ã€ç±»å‹ç³»ç»Ÿå’Œç¼–è¯‘å™¨æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œä»¥æ”¯æŒæ³›å‹ï¼Œè€Œä¸”ç±»åº“ä¹Ÿè¿›è¡Œäº†å¤§ç¿»ä¿®ï¼Œæ‰€ä»¥è®¸å¤šé‡è¦çš„ç±»ï¼Œæ¯”å¦‚é›†åˆæ¡†æ¶ï¼Œéƒ½å·²ç»æˆä¸ºæ³›å‹åŒ–çš„äº†ï¼Œè¿™å¸¦æ¥äº†å¾ˆå¤šå¥½å¤„ã€‚</p>
<p><strong>ç¬¬äºŒæ˜¯ç±»å‹å®‰å…¨ã€‚</strong>æ³›å‹çš„ä¸€ä¸ªä¸»è¦ç›®æ ‡å°±æ˜¯æé«˜avaç¨‹åºçš„ç±»å‹å®‰å…¨ï¼Œä½¿ç”¨æ³›å‹å¯ä»¥ä½¿ç¼–è¯‘å™¨çŸ¥é“å˜é‡çš„ç±»å‹é™åˆ¶ï¼Œè¿›è€Œå¯ä»¥åœ¨æ›´é«˜ç¨‹åº¦ä¸ŠéªŒè¯ç±»å‹å‡è®¾ã€‚å¦‚æœä¸ç”¨æ³›å‹ï¼Œåˆ™å¿…é¡»ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œè€Œå¼ºåˆ¶ç±»å‹è½¬æ¢ä¸å®‰å…¨ï¼Œåœ¨è¿è¡ŒæœŸå¯èƒ½å‘ç”ŸClassCast Exceptionå¼‚å¸¸ï¼Œå¦‚æœä½¿ç”¨æ³›å‹ï¼Œåˆ™ä¼šåœ¨ç¼–è¯‘æœŸå°±èƒ½å‘ç°è¯¥é”™è¯¯ã€‚</p>
<p><strong>ç¬¬ä¸‰æ˜¯æ¶ˆé™¤å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</strong>æ³›å‹å¯ä»¥æ¶ˆé™¤æºä»£ç ä¸­çš„è®¸å¤šå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œè¿™æ ·å¯ä»¥ä½¿ä»£ç æ›´åŠ å¯è¯»ï¼Œå¹¶å‡å°‘å‡ºé”™çš„æœºä¼šã€‚</p>
<p><strong>ç¬¬å››æ˜¯å‘åå…¼å®¹ã€‚</strong>æ”¯æŒæ³›å‹çš„Javaç¼–è¯‘å™¨ï¼ˆä¾‹å¦‚JDK1.5ä¸­çš„<a href="https://baike.baidu.com/item/Javac/5156702" target="_blank" rel="noopener">Javac</a>ï¼‰å¯ä»¥ç”¨æ¥ç¼–è¯‘ç»è¿‡æ³›å‹æ‰©å……çš„Javaç¨‹åºï¼ˆGenerics Javaç¨‹åºï¼‰ï¼Œä½†æ˜¯ç°æœ‰çš„æ²¡æœ‰ä½¿ç”¨æ³›å‹æ‰©å……çš„Javaç¨‹åºä»ç„¶å¯ä»¥ç”¨è¿™äº›ç¼–è¯‘å™¨æ¥ç¼–è¯‘ã€‚</p>
<h4 id="3-7-è¿™æ ·çš„a-hashcode-æœ‰ä»€ä¹ˆç”¨ï¼Œä¸a-equals-b-æœ‰ä»€ä¹ˆå…³ç³»ã€‚"><a href="#3-7-è¿™æ ·çš„a-hashcode-æœ‰ä»€ä¹ˆç”¨ï¼Œä¸a-equals-b-æœ‰ä»€ä¹ˆå…³ç³»ã€‚" class="headerlink" title="3.7 è¿™æ ·çš„a.hashcode() æœ‰ä»€ä¹ˆç”¨ï¼Œä¸a.equals(b)æœ‰ä»€ä¹ˆå…³ç³»ã€‚"></a>3.7 è¿™æ ·çš„a.hashcode() æœ‰ä»€ä¹ˆç”¨ï¼Œä¸a.equals(b)æœ‰ä»€ä¹ˆå…³ç³»ã€‚</h4><p>equalsç›¸ç­‰ä¸¤ä¸ªå¯¹è±¡ï¼Œåˆ™hashcodeä¸€å®šè¦ç›¸ç­‰ã€‚ä½†æ˜¯hashcodeç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šequalsç›¸ç­‰ã€‚</p>
<h4 id="3-8-æœ‰æ²¡æœ‰å¯èƒ½2ä¸ªä¸ç›¸ç­‰çš„å¯¹è±¡æœ‰ç›¸åŒçš„hashcodeã€‚"><a href="#3-8-æœ‰æ²¡æœ‰å¯èƒ½2ä¸ªä¸ç›¸ç­‰çš„å¯¹è±¡æœ‰ç›¸åŒçš„hashcodeã€‚" class="headerlink" title="3.8 æœ‰æ²¡æœ‰å¯èƒ½2ä¸ªä¸ç›¸ç­‰çš„å¯¹è±¡æœ‰ç›¸åŒçš„hashcodeã€‚"></a>3.8 æœ‰æ²¡æœ‰å¯èƒ½2ä¸ªä¸ç›¸ç­‰çš„å¯¹è±¡æœ‰ç›¸åŒçš„hashcodeã€‚</h4><p>æœ‰</p>
<h4 id="3-9-Javaä¸­çš„HashSetå†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚"><a href="#3-9-Javaä¸­çš„HashSetå†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚" class="headerlink" title="3.9 Javaä¸­çš„HashSetå†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚"></a>3.9 Javaä¸­çš„HashSetå†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</h4><p>å¯¹äº HashSet è€Œè¨€ï¼Œå®ƒæ˜¯åŸºäº HashMap å®ç°çš„ï¼Œåº•å±‚é‡‡ç”¨ HashMap æ¥ä¿å­˜å…ƒç´ </p>
<p>æˆ‘ä»¬å…ˆé€šè¿‡ HashSet æœ€ç®€å•çš„æ„é€ å‡½æ•°å’Œå‡ ä¸ªæˆå‘˜å˜é‡æ¥çœ‹ä¸€ä¸‹ï¼Œè¯æ˜å’±ä»¬ä¸Šè¾¹è¯´çš„ï¼Œå…¶åº•å±‚æ˜¯ HashMapï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> HashMap&lt;E,Object&gt; map;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Dummy value to associate with an Object in the backing Map</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object PRESENT = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs a new, empty set; the backing &lt;tt&gt;HashMap&lt;/tt&gt; instance has</span></span><br><span class="line"><span class="comment"> * default initial capacity (16) and load factor (0.75).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶å®åœ¨è‹±æ–‡æ³¨é‡Šä¸­å·²ç»è¯´çš„æ¯”è¾ƒæ˜ç¡®äº†ã€‚é¦–å…ˆæœ‰ä¸€ä¸ªHashMapçš„æˆå‘˜å˜é‡ï¼Œæˆ‘ä»¬åœ¨ HashSet çš„æ„é€ å‡½æ•°ä¸­å°†å…¶åˆå§‹åŒ–ï¼Œé»˜è®¤æƒ…å†µä¸‹é‡‡ç”¨çš„æ˜¯ initial capacityä¸º16ï¼Œload factor ä¸º 0.75ã€‚</p>
<p><strong>HashSet çš„å®ç°</strong></p>
<p>å¯¹äº HashSet è€Œè¨€ï¼Œå®ƒæ˜¯åŸºäº HashMap å®ç°çš„ï¼ŒHashSet åº•å±‚ä½¿ç”¨ HashMap æ¥ä¿å­˜æ‰€æœ‰å…ƒç´ ï¼Œå› æ­¤ HashSet çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œç›¸å…³ HashSet çš„æ“ä½œï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ç›´æ¥è°ƒç”¨åº•å±‚ HashMap çš„ç›¸å…³æ–¹æ³•æ¥å®Œæˆï¼Œæˆ‘ä»¬åº”è¯¥ä¸ºä¿å­˜åˆ° HashSet ä¸­çš„å¯¹è±¡è¦†ç›– hashCode() å’Œ equals()</p>
<p><strong>æ„é€ æ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é»˜è®¤çš„æ— å‚æ„é€ å™¨ï¼Œæ„é€ ä¸€ä¸ªç©ºçš„HashSetã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å®é™…åº•å±‚ä¼šåˆå§‹åŒ–ä¸€ä¸ªç©ºçš„HashMapï¼Œå¹¶ä½¿ç”¨é»˜è®¤åˆå§‹å®¹é‡ä¸º16å’ŒåŠ è½½å› å­0.75ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;E,Object&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šcollectionä¸­çš„å…ƒç´ çš„æ–°setã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å®é™…åº•å±‚ä½¿ç”¨é»˜è®¤çš„åŠ è½½å› å­0.75å’Œè¶³ä»¥åŒ…å«æŒ‡å®šcollectionä¸­æ‰€æœ‰å…ƒç´ çš„åˆå§‹å®¹é‡æ¥åˆ›å»ºä¸€ä¸ªHashMapã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> c å…¶ä¸­çš„å…ƒç´ å°†å­˜æ”¾åœ¨æ­¤setä¸­çš„collectionã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;E,Object&gt;(Math.max((<span class="keyword">int</span>) (c.size()/.<span class="number">75f</span>) + <span class="number">1</span>, <span class="number">16</span>));</span><br><span class="line">    addAll(c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»¥æŒ‡å®šçš„initialCapacityå’ŒloadFactoræ„é€ ä¸€ä¸ªç©ºçš„HashSetã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å®é™…åº•å±‚ä»¥ç›¸åº”çš„å‚æ•°æ„é€ ä¸€ä¸ªç©ºçš„HashMapã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> initialCapacity åˆå§‹å®¹é‡ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> loadFactor åŠ è½½å› å­ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;E,Object&gt;(initialCapacity, loadFactor);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»¥æŒ‡å®šçš„initialCapacityæ„é€ ä¸€ä¸ªç©ºçš„HashSetã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å®é™…åº•å±‚ä»¥ç›¸åº”çš„å‚æ•°åŠåŠ è½½å› å­loadFactorä¸º0.75æ„é€ ä¸€ä¸ªç©ºçš„HashMapã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> initialCapacity åˆå§‹å®¹é‡ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;E,Object&gt;(initialCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»¥æŒ‡å®šçš„initialCapacityå’ŒloadFactoræ„é€ ä¸€ä¸ªæ–°çš„ç©ºé“¾æ¥å“ˆå¸Œé›†åˆã€‚æ­¤æ„é€ å‡½æ•°ä¸ºåŒ…è®¿é—®æƒé™ï¼Œä¸å¯¹å¤–å…¬å¼€ï¼Œ</span></span><br><span class="line"><span class="comment"> * å®é™…åªæ˜¯æ˜¯å¯¹LinkedHashSetçš„æ”¯æŒã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å®é™…åº•å±‚ä¼šä»¥æŒ‡å®šçš„å‚æ•°æ„é€ ä¸€ä¸ªç©ºLinkedHashMapå®ä¾‹æ¥å®ç°ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> initialCapacity åˆå§‹å®¹é‡ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> loadFactor åŠ è½½å› å­ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dummy æ ‡è®°ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">HashSet(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor, <span class="keyword">boolean</span> dummy) &#123;</span><br><span class="line">    map = <span class="keyword">new</span> LinkedHashMap&lt;E,Object&gt;(initialCapacity, loadFactor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>add æ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> e å°†æ·»åŠ åˆ°æ­¤setä¸­çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> å¦‚æœæ­¤setå°šæœªåŒ…å«æŒ‡å®šå…ƒç´ ï¼Œåˆ™è¿”å›trueã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.put(e, PRESENT)==<span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ­¤ set ä¸­å°šæœªåŒ…å«æŒ‡å®šå…ƒç´ ï¼Œåˆ™æ·»åŠ æŒ‡å®šå…ƒç´ ã€‚æ›´ç¡®åˆ‡åœ°è®²ï¼Œå¦‚æœæ­¤ set æ²¡æœ‰åŒ…å«æ»¡è¶³(e==null ? e2==null : e.equals(e2)) çš„å…ƒç´  e2ï¼Œåˆ™å‘æ­¤ set æ·»åŠ æŒ‡å®šçš„å…ƒç´  eã€‚å¦‚æœæ­¤ set å·²åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¯¥è°ƒç”¨ä¸æ›´æ”¹ set å¹¶è¿”å› falseã€‚ä½†åº•å±‚å®é™…å°†å°†è¯¥å…ƒç´ ä½œä¸º key æ”¾å…¥ HashMapã€‚æ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>ç”±äº HashMap çš„ put() æ–¹æ³•æ·»åŠ  key-value å¯¹æ—¶ï¼Œå½“æ–°æ”¾å…¥ HashMap çš„ Entry ä¸­ key ä¸é›†åˆä¸­åŸæœ‰ Entry çš„ key ç›¸åŒï¼ˆhashCode()è¿”å›å€¼ç›¸ç­‰ï¼Œé€šè¿‡ equals æ¯”è¾ƒä¹Ÿè¿”å› trueï¼‰ï¼Œæ–°æ·»åŠ çš„ Entry çš„ value ä¼šå°†è¦†ç›–åŸæ¥ Entry çš„ valueï¼ˆHashSet ä¸­çš„ value éƒ½æ˜¯<code>PRESENT</code>ï¼‰ï¼Œä½† key ä¸ä¼šæœ‰ä»»ä½•æ”¹å˜ï¼Œå› æ­¤å¦‚æœå‘ HashSet ä¸­æ·»åŠ ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å…ƒç´ æ—¶ï¼Œæ–°æ·»åŠ çš„é›†åˆå…ƒç´ å°†ä¸ä¼šè¢«æ”¾å…¥ HashMapä¸­ï¼ŒåŸæ¥çš„å…ƒç´ ä¹Ÿä¸ä¼šæœ‰ä»»ä½•æ”¹å˜ï¼Œè¿™ä¹Ÿå°±æ»¡è¶³äº† Set ä¸­å…ƒç´ ä¸é‡å¤çš„ç‰¹æ€§ã€‚</p>
<p>è¯¥æ–¹æ³•å¦‚æœæ·»åŠ çš„æ˜¯åœ¨ HashSet ä¸­ä¸å­˜åœ¨çš„ï¼Œåˆ™è¿”å› trueï¼›å¦‚æœæ·»åŠ çš„å…ƒç´ å·²ç»å­˜åœ¨ï¼Œè¿”å› falseã€‚å…¶åŸå› åœ¨äºæˆ‘ä»¬ä¹‹å‰æåˆ°çš„å…³äº HashMap çš„ put æ–¹æ³•ã€‚è¯¥æ–¹æ³•åœ¨æ·»åŠ  key ä¸é‡å¤çš„é”®å€¼å¯¹çš„æ—¶å€™ï¼Œä¼šè¿”å› nullã€‚</p>
<p><strong>å…¶ä½™æ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¦‚æœæ­¤setåŒ…å«æŒ‡å®šå…ƒç´ ï¼Œåˆ™è¿”å›trueã€‚</span></span><br><span class="line"><span class="comment">     * æ›´ç¡®åˆ‡åœ°è®²ï¼Œå½“ä¸”ä»…å½“æ­¤setåŒ…å«ä¸€ä¸ªæ»¡è¶³(o==null ? e==null : o.equals(e))çš„eå…ƒç´ æ—¶ï¼Œè¿”å›trueã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * åº•å±‚å®é™…è°ƒç”¨HashMapçš„containsKeyåˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®škeyã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o åœ¨æ­¤setä¸­çš„å­˜åœ¨å·²å¾—åˆ°æµ‹è¯•çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœæ­¤setåŒ…å«æŒ‡å®šå…ƒç´ ï¼Œåˆ™è¿”å›trueã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.containsKey(o);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¦‚æœæŒ‡å®šå…ƒç´ å­˜åœ¨äºæ­¤setä¸­ï¼Œåˆ™å°†å…¶ç§»é™¤ã€‚æ›´ç¡®åˆ‡åœ°è®²ï¼Œå¦‚æœæ­¤setåŒ…å«ä¸€ä¸ªæ»¡è¶³(o==null ? e==null : o.equals(e))çš„å…ƒç´ eï¼Œ</span></span><br><span class="line"><span class="comment">     * åˆ™å°†å…¶ç§»é™¤ã€‚å¦‚æœæ­¤setå·²åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¿”å›true</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * åº•å±‚å®é™…è°ƒç”¨HashMapçš„removeæ–¹æ³•åˆ é™¤æŒ‡å®šEntryã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o å¦‚æœå­˜åœ¨äºæ­¤setä¸­åˆ™éœ€è¦å°†å…¶ç§»é™¤çš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœsetåŒ…å«æŒ‡å®šå…ƒç´ ï¼Œåˆ™è¿”å›trueã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.remove(o)==PRESENT;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›æ­¤HashSetå®ä¾‹çš„æµ…è¡¨å‰¯æœ¬ï¼šå¹¶æ²¡æœ‰å¤åˆ¶è¿™äº›å…ƒç´ æœ¬èº«ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * åº•å±‚å®é™…è°ƒç”¨HashMapçš„clone()æ–¹æ³•ï¼Œè·å–HashMapçš„æµ…è¡¨å‰¯æœ¬ï¼Œå¹¶è®¾ç½®åˆ°HashSetä¸­ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            HashSet&lt;E&gt; newSet = (HashSet&lt;E&gt;) <span class="keyword">super</span>.clone();</span><br><span class="line">            newSet.map = (HashMap&lt;E, Object&gt;) map.clone();</span><br><span class="line">            <span class="keyword">return</span> newSet;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InternalError();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç›¸å…³è¯´æ˜</strong></p>
<ol>
<li>ç›¸å…³ HashMap çš„å®ç°åŸç†ï¼Œè¯·å‚è€ƒä¸Šé¢çš„ç‚¹</li>
<li>å¯¹äº HashSet ä¸­ä¿å­˜çš„å¯¹è±¡ï¼Œè¯·æ³¨æ„æ­£ç¡®é‡å†™å…¶ equals å’Œ hashCode æ–¹æ³•ï¼Œä»¥ä¿è¯æ”¾å…¥çš„å¯¹è±¡çš„å”¯ä¸€æ€§ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œå¸Œæœ›å¤§å®¶åœ¨ä»¥åçš„å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚</li>
</ol>
<h4 id="4-0-ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Œæ€ä¹ˆåºåˆ—åŒ–ï¼Œä¸ºä»€ä¹ˆåºåˆ—åŒ–ï¼Œååºåˆ—åŒ–ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³ã€‚"><a href="#4-0-ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Œæ€ä¹ˆåºåˆ—åŒ–ï¼Œä¸ºä»€ä¹ˆåºåˆ—åŒ–ï¼Œååºåˆ—åŒ–ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³ã€‚" class="headerlink" title="4.0 ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Œæ€ä¹ˆåºåˆ—åŒ–ï¼Œä¸ºä»€ä¹ˆåºåˆ—åŒ–ï¼Œååºåˆ—åŒ–ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³ã€‚"></a>4.0 ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Œæ€ä¹ˆåºåˆ—åŒ–ï¼Œä¸ºä»€ä¹ˆåºåˆ—åŒ–ï¼Œååºåˆ—åŒ–ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³ã€‚</h4><p>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ˜¯å¼€å‘è¿‡ç¨‹ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€æ­¥ï¼Œç®€å•æ¥è¯´ï¼Œåºåˆ—åŒ–æ˜¯å°†å¯¹è±¡è½¬æ¢æˆå­—èŠ‚æµçš„è¿‡ç¨‹ï¼Œè€Œååºåˆ—åŒ–çš„æ˜¯å°†å­—èŠ‚æµæ¢å¤æˆå¯¹è±¡çš„è¿‡ç¨‹ã€‚åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ˜¯ä¸€ä¸ªæ ‡å‡†ï¼ˆå…·ä½“å‚è€ƒ<a href>XDR:å¤–éƒ¨æ•°æ®è¡¨ç¤ºæ ‡å‡† RFC 1014</a>ï¼‰ï¼Œå®ƒæ˜¯ç¼–ç¨‹è¯­è¨€çš„ä¸€ç§å…±æ€§ï¼Œåªæ˜¯æœ‰äº›ç¼–ç¨‹è¯­è¨€æ˜¯å†…ç½®çš„ï¼ˆå¦‚Javaï¼ŒPHPç­‰ï¼‰ï¼Œæœ‰äº›è¯­è¨€æ˜¯é€šè¿‡ç¬¬ä¸‰æ–¹åº“æ¥å®ç°çš„ï¼ˆå¦‚C/C++ï¼‰ã€‚</p>
<p> ä½¿ç”¨åœºæ™¯</p>
<ul>
<li>å¯¹è±¡çš„æŒä¹…åŒ–ï¼ˆå°†å¯¹è±¡å†…å®¹ä¿å­˜åˆ°æ•°æ®åº“æˆ–æ–‡ä»¶ä¸­ï¼‰</li>
<li>è¿œç¨‹æ•°æ®ä¼ è¾“ï¼ˆå°†å¯¹è±¡å‘é€ç»™å…¶ä»–è®¡ç®—æœºç³»ç»Ÿï¼‰</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦åºåˆ—åŒ–ä¸åºåˆ—åŒ–ï¼Ÿ</strong></p>
<p>åºåˆ—åŒ–ä¸åºåˆ—åŒ–ä¸»è¦è§£å†³çš„æ˜¯æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è¾“å…¥æ•°æ®ä¸è¾“å‡ºæ•°æ®æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>å¯¹äºæ•°æ®çš„æœ¬åœ°æŒä¹…åŒ–ï¼Œåªéœ€è¦å°†æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œä¿å­˜å³å¯æ˜¯å®ç°ï¼Œä½†å¯¹äºè¿œç¨‹çš„æ•°æ®ä¼ è¾“ï¼Œç”±äºæ“ä½œç³»ç»Ÿï¼Œç¡¬ä»¶ç­‰å·®å¼‚ï¼Œä¼šå‡ºç°å†…å­˜å¤§å°ç«¯ï¼Œå†…å­˜å¯¹é½ç­‰é—®é¢˜ï¼Œå¯¼è‡´æ¥æ”¶ç«¯æ— æ³•æ­£ç¡®è§£ææ•°æ®ï¼Œä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼ŒSun Microsystemsåœ¨20ä¸–çºª80å¹´ä»£æå‡ºäº†XDRè§„èŒƒï¼Œäº1995å¹´æ­£å¼æˆä¸ºIETFæ ‡å‡†ã€‚</p>
<p><strong>Javaä¸­çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</strong></p>
<p>Javaè¯­è¨€å†…ç½®äº†åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œé€šè¿‡Serializableæ¥å£å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> birthday;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>åºåˆ—åŒ–å…¼å®¹æ€§</strong></p>
<p>åºåˆ—åŒ–çš„å…¼å®¹æ€§æŒ‡çš„æ˜¯å¯¹è±¡çš„ç»“æ„å˜åŒ–ï¼ˆå¦‚å¢åˆ å­—æ®µï¼Œä¿®æ”¹å­—æ®µï¼Œå­—æ®µä¿®é¥°ç¬¦çš„æ”¹å˜ç­‰ï¼‰å¯¹åºåˆ—åŒ–çš„å½±å“ã€‚ä¸ºäº†èƒ½å¤Ÿè¯†åˆ«å¯¹è±¡ç»“æ„çš„å˜åŒ–ï¼ŒSerializableä½¿ç”¨serialVersionUIDå­—æ®µæ¥æ ‡è¯†å¯¹è±¡çš„ç»“æ„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šæ ¹æ®å¯¹è±¡çš„æ•°æ®ç»“æ„è‡ªåŠ¨ç”Ÿæˆï¼Œç»“æ„å‘ç”Ÿå˜åŒ–åï¼Œå®ƒçš„å€¼ä¹Ÿä¼šè·Ÿéšå˜åŒ–ã€‚è™šæ‹Ÿæœºåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šæ£€æŸ¥serialVersionUIDçš„å€¼ï¼Œå¦‚æœå­—èŠ‚ç ä¸­çš„serialVersionUIDå’Œè¦è¢«è½¬æ¢çš„ç±»å‹çš„serialVersionUIDä¸ä¸€è‡´ï¼Œå°±æ— æ³•è¿›è¡Œæ­£å¸¸çš„ååºåˆ—åŒ–ã€‚</p>
<p>ç¤ºä¾‹ï¼šå°†Accountå¯¹è±¡ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨Accountç±»ä¸­æ·»åŠ addresså­—æ®µï¼Œå†ä»æ–‡ä»¶ä¸­è¯»å–ä¹‹å‰ä¿å­˜çš„å†…å®¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°†Accountå¯¹è±¡ä¿å­˜åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line">FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(fos);</span><br><span class="line">oos.writeObject(account);</span><br><span class="line">oos.flush();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®æ”¹Accountå¯¹è±¡çš„ç»“æ„</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> birthday;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String address;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">(<span class="keyword">int</span> age, String name)</span> </span>&#123;</span><br><span class="line">	    <span class="keyword">this</span>.age = age;</span><br><span class="line">	    <span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–Accountçš„å†…å®¹</span></span><br><span class="line">FileInputStream fis = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(fis);</span><br><span class="line">Account account2 = (Account)ois.readObject();</span><br></pre></td></tr></table></figure>
<p>ç”±äºåœ¨ä¿å­˜Accountå¯¹è±¡åä¿®æ”¹äº†Accountçš„ç»“æ„ï¼Œä¼šå¯¼è‡´serialVersionUIDçš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œåœ¨è¯»æ–‡ä»¶ï¼ˆååºåˆ—åŒ–ï¼‰çš„æ—¶å€™å°±ä¼šå‡ºé”™ã€‚æ‰€ä»¥ä¸ºäº†æ›´å¥½çš„å…¼å®¹æ€§ï¼Œåœ¨åºåˆ—åŒ–çš„æ—¶å€™ï¼Œæœ€å¥½å°†serialVersionUIDçš„å€¼è®¾ç½®ä¸ºå›ºå®šçš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> birthday;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>åºåˆ—åŒ–çš„å­˜å‚¨è§„åˆ™</strong></p>
<p>Javaä¸­çš„åºåˆ—åŒ–åœ¨å°†å¯¹è±¡æŒä¹…åŒ–ï¼ˆåºåˆ—åŒ–ï¼‰çš„æ—¶å€™ï¼Œä¸ºäº†èŠ‚çœç£ç›˜ç©ºé—´ï¼Œå¯¹äºç›¸åŒçš„å¯¹è±¡ä¼šè¿›è¡Œä¼˜åŒ–ã€‚å½“å¤šæ¬¡ä¿å­˜ç›¸åŒçš„å¯¹è±¡æ—¶ï¼Œå…¶å®ä¿å­˜çš„åªæ˜¯ç¬¬ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°†accountå¯¹è±¡ä¿å­˜ä¸¤æ¬¡ï¼Œç¬¬äºŒæ¬¡ä¿å­˜æ—¶ä¿®æ”¹å…¶ç”¨æˆ·å</span></span><br><span class="line">Account account = <span class="keyword">new</span> Account(<span class="string">"Freeman"</span>);</span><br><span class="line">FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(fos);</span><br><span class="line">oos.writeObject(account);</span><br><span class="line">System.out.println(<span class="string">"fileSize="</span> +file.length());</span><br><span class="line">account.setUserName(<span class="string">"Tom"</span>);</span><br><span class="line">oos.writeObject(account);</span><br><span class="line">System.out.println(<span class="string">"fileSize="</span> +file.length());</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–ä¸¤æ¬¡ä¿å­˜çš„accountå¯¹è±¡</span></span><br><span class="line">FileInputStream fis = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(fis);</span><br><span class="line">Account account2 = (Account)ois.readObject();</span><br><span class="line">Account account3 = (Account)ois.readObject();</span><br><span class="line">System.out.println(<span class="string">"account2.name="</span> + account2.getUserName() + <span class="string">"\n  account3.name="</span> + account3.getUserName() + <span class="string">"\naccount2==account3 -&gt; "</span> + account2.equals(account3));</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">account2.name=Freeman  </span><br><span class="line">account3.name=Freeman </span><br><span class="line">account2==account3 -&gt; <span class="keyword">true</span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥åœ¨å¯¹åŒä¸€ä¸ªå¯¹è±¡è¿›è¡Œå¤šæ¬¡åºåˆ—åŒ–çš„æ—¶å€™ï¼Œæœ€å¥½é€šè¿‡cloneä¸€ä¸ªæ–°çš„å¯¹è±¡å†è¿›è¡Œåºåˆ—åŒ–ã€‚</p>
<p><strong>åºåˆ—åŒ–å¯¹å•ä¾‹çš„å½±å“</strong></p>
<p>ååºåˆ—åŒ–çš„æ—¶å€™ï¼ŒJVMä¼šæ ¹æ®åºåˆ—åŒ–ç”Ÿæˆçš„å†…å®¹æ„é€ æ–°çš„å¯¹è±¡ï¼Œå¯¹äºå®ç°äº†Serializableçš„å•ä¾‹ç±»æ¥è¯´ï¼Œè¿™ç›¸å½“äºå¼€æ”¾äº†æ„é€ æ–¹æ³•ã€‚ä¸ºäº†ä¿è¯å•ä¾‹ç±»å®ä¾‹çš„å”¯ä¸€æ€§ï¼Œæˆ‘ä»¬éœ€è¦é‡å†™resolveObjectæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åœ¨ååºåˆ—åŒ–çš„æ—¶å€™è¢«è°ƒç”¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> è¿”å›æ ¹æ®å­—èŠ‚ç åˆ›å»ºçš„æ–°å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ObjectStreamException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">readResolve</span><span class="params">()</span><span class="keyword">throws</span> ObjectStreamException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ§åˆ¶åºåˆ—åŒ–è¿‡ç¨‹</strong></p>
<p>è™½ç„¶ç›´æ¥ä½¿ç”¨Serializableå¾ˆæ–¹ä¾¿ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬å¹¶ä¸æƒ³åºåˆ—åŒ–æ‰€æœ‰çš„å­—æ®µï¼Œå¦‚æ ‡è¯†é€‰ä¸­çŠ¶æ€çš„isSelectedå­—æ®µï¼Œæ¶‰åŠå®‰å…¨é—®é¢˜çš„passwordå­—æ®µç­‰ã€‚æ­¤æ—¶å¯é€šè¿‡é€šè¿‡ä»¥ä¸‹æ–¹æ³•å®ç°ï¼š</p>
<ol>
<li>ç»™ä¸æƒ³åºåˆ—åŒ–çš„å­—æ®µæ·»åŠ staticæˆ–transientä¿®é¥°è¯ï¼š</li>
</ol>
<p>Javaä¸­çš„åºåˆ—åŒ–ä¿å­˜çš„åªæ˜¯å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œæ—¢ä¸åŒ…æ‹¬staticæˆå‘˜ï¼ˆstaticæˆå‘˜å±äºç±»ï¼‰ï¼Œä¹Ÿä¸åŒ…æ‹¬æˆå‘˜æ–¹æ³•ã€‚åŒæ—¶Javaä¸ºäº†è®©åºåˆ—åŒ–æ›´çµæ´»ï¼Œæä¾›äº†transientå…³é”®å­—ï¼Œç”¨æ¥å…³é—­å­—æ®µçš„åºåˆ—åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String idcard;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>ç›´æ¥ä½¿ç”¨Externalizableæ¥å£æ§åˆ¶åºåˆ—åŒ–è¿‡ç¨‹ï¼š</li>
</ol>
<p>Externalizableä¹Ÿæ˜¯Javaæä¾›çš„åºåˆ—åŒ–æ¥å£ï¼Œä¸Serializableä¸åŒçš„æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¸ä¼šåºåˆ—åŒ–ä»»ä½•æˆå‘˜å˜é‡ï¼Œæ‰€æœ‰çš„åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–å·¥ä½œéƒ½éœ€è¦æ‰‹åŠ¨å®Œæˆã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Externalizable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">private</span> String userName;</span><br><span class="line">	<span class="keyword">private</span> String idcard;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeExternal</span><span class="params">(ObjectOutput out)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		out.writeObject(userName);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readExternal</span><span class="params">(ObjectInput in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">		userName = (String) in.readObject();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>è‡ªå·±å®ç°åºåˆ—åŒ–/ååºåˆ—åŒ–è¿‡ç¨‹</p>
<p>public class Account implements Serializable {</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String userName;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> String idcard;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(ObjectOutputStream oos)</span><span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	<span class="comment">// è°ƒç”¨é»˜è®¤çš„åºåˆ—åŒ–æ–¹æ³•ï¼Œåºåˆ—åŒ–étransient/staticå­—æ®µ</span></span><br><span class="line">	oos.defaultWriteObject();</span><br><span class="line">	oos.writeObject(idcard);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(ObjectInputStream ois)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">	<span class="comment">// è°ƒç”¨é»˜è®¤çš„ååºåˆ—åŒ–æ–¹æ³•ï¼Œå‘åºåˆ—åŒ–étransient/staticå­—æ®µ</span></span><br><span class="line">	ois.defaultReadObject();</span><br><span class="line">	idcard = (String)ois.readObject();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>}</p>
</li>
</ol>
<p>å…³äºJavaåºåˆ—åŒ–ç®—æ³•çš„è¯¦ç»†ä»‹ç»å¯å‚è€ƒï¼š<a href="https://longdick.iteye.com/blog/458557" target="_blank" rel="noopener">Javaåºåˆ—åŒ–ç®—æ³•é€æ</a></p>
<p><strong>Javaåºåˆ—åŒ–æ³¨æ„äº‹é¡¹</strong></p>
<ol>
<li>é€šè¿‡Serializableåºåˆ—åŒ–çš„å¯¹è±¡ï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œç›´æ¥æ ¹æ®å­—èŠ‚ç æ„é€ å¯¹è±¡ï¼Œå¹¶ä¸ä¼šè°ƒç”¨å¯¹è±¡çš„æ„é€ æ–¹æ³•ï¼›</li>
<li>é€šè¿‡Serializableåºåˆ—åŒ–å­ç±»æ—¶ï¼Œå¦‚æœçˆ¶ç±»æ²¡æœ‰å®ç°Serializableæ¥å£ï¼Œé‚£ä¹ˆçˆ¶ç±»éœ€è¦æä¾›é»˜è®¤çš„æ„é€ æ–¹æ³•ï¼Œå¦åˆ™åœ¨ååºåˆ—åŒ–çš„æ—¶å€™æŠ›å‡ºjava.io.NotSerializableExceptionå¼‚å¸¸ï¼›</li>
<li>é€šè¿‡Externalizaleå®ç°åºåˆ—åŒ–æ—¶ï¼Œååºåˆ—åŒ–çš„æ—¶å€™éœ€è¦è°ƒç”¨å¯¹è±¡çš„é»˜è®¤æ„é€ æ–¹æ³•ï¼›</li>
<li>ç”±äºExternalizaleé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šå¯¹ä»»ä½•æˆå‘˜å˜é‡è¿›è¡Œåºåˆ—åŒ–ï¼Œæ‰€ä»¥transientå…³é”®å­—åªèƒ½åœ¨Serializableåºåˆ—åŒ–æ–¹å¼ä¸­ä½¿ç”¨ï¼›</li>
</ol>
<p><strong>æ•°æ®äº¤æ¢åè®®</strong></p>
<p>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ä¸ºæ•°æ®äº¤æ¢æä¾›äº†å¯èƒ½ï¼Œä½†æ˜¯å› ä¸ºä¼ é€’çš„æ˜¯å­—èŠ‚ç ï¼Œå¯è¯»æ€§å·®ã€‚åœ¨åº”ç”¨å±‚å¼€å‘è¿‡ç¨‹ä¸­ä¸æ˜“è°ƒè¯•ï¼Œä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œæœ€ç›´æ¥çš„æƒ³æ³•å°±æ˜¯å°†å¯¹è±¡çš„å†…å®¹è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„å½¢å¼è¿›è¡Œä¼ é€’ã€‚å…·ä½“çš„ä¼ è¾“æ ¼å¼å¯è‡ªè¡Œå®šä¹‰ï¼Œä½†è‡ªå®šä¹‰æ ¼å¼æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜â€”â€”å…¼å®¹æ€§ï¼Œå¦‚æœå¼•å…¥å…¶ä»–ç³»ç»Ÿçš„æ¨¡å—ï¼Œå°±éœ€è¦å¯¹æ•°æ®æ ¼å¼è¿›è¡Œè½¬æ¢ï¼Œç»´æŠ¤å…¶ä»–çš„ç³»ç»Ÿæ—¶ï¼Œè¿˜è¦å…ˆäº†è§£ä¸€ä¸‹å®ƒçš„åºåˆ—åŒ–æ–¹å¼ã€‚ä¸ºäº†ç»Ÿä¸€æ•°æ®ä¼ è¾“çš„æ ¼å¼ï¼Œå‡ºç°äº†å‡ ç§æ•°æ®äº¤æ¢åè®®ï¼Œå¦‚ï¼šJSON, Protobufï¼ŒXMLã€‚è¿™äº›æ•°æ®äº¤æ¢åè®®å¯è§†ä¸ºæ˜¯åº”ç”¨å±‚é¢çš„åºåˆ—åŒ–/ååºåˆ—åŒ–ã€‚</p>
<p><strong>JSON</strong></p>
<p>JSONï¼ˆJavaScript Object Notationï¼‰æ˜¯ä¸€ç§è½»é‡çº§ï¼Œå®Œå…¨ç‹¬ç«‹äºè¯­è¨€çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚ç›®å‰è¢«å¹¿æ³›åº”ç”¨åœ¨å‰åç«¯çš„æ•°æ®äº¤äº’ä¸­ã€‚</p>
<h5 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h5><p>JSONä¸­çš„å…ƒç´ éƒ½æ˜¯é”®å€¼å¯¹â€”â€”key:valueå½¢å¼ï¼Œé”®å€¼å¯¹ä¹‹é—´ä»¥â€:â€åˆ†éš”ï¼Œæ¯ä¸ªé”®éœ€ç”¨åŒå¼•å·å¼•èµ·æ¥ï¼Œå€¼çš„ç±»å‹ä¸ºStringæ—¶ä¹Ÿéœ€è¦åŒå¼•å·ã€‚å…¶ä¸­valueçš„ç±»å‹åŒ…æ‹¬ï¼šå¯¹è±¡ï¼Œæ•°ç»„ï¼Œå€¼ï¼Œæ¯ç§ç±»å‹å…·æœ‰ä¸åŒçš„è¯­æ³•è¡¨ç¤ºã€‚</p>
<h6 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h6><p>å¯¹è±¡æ˜¯ä¸€ä¸ªæ— åºçš„é”®å€¼å¯¹é›†åˆã€‚ä»¥â€{â€œå¼€å§‹ï¼Œä»¥â€}â€ç»“æŸï¼Œ æ¯ä¸ªæˆå‘˜ä»¥â€,â€åˆ†éš”ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"value" : &#123;</span><br><span class="line">    "name": "Freeman",</span><br><span class="line">    "gender": 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h6><p>æ•°ç»„æ˜¯ä¸€ä¸ªæœ‰åºçš„é›†åˆï¼Œä»¥â€[â€œå¼€å§‹ï¼Œä»¥â€]â€ç»“æŸï¼Œæˆå‘˜ä¹‹é—´ä»¥â€,â€åˆ†éš”ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"value" : [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"zhangsan"</span>,</span><br><span class="line">        <span class="attr">"gender"</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"lisi"</span>,</span><br><span class="line">        <span class="attr">"gender"</span>: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h6 id="å€¼"><a href="#å€¼" class="headerlink" title="å€¼"></a>å€¼</h6><p>å€¼ç±»å‹è¡¨ç¤ºJSONä¸­çš„åŸºæœ¬ç±»å‹ï¼ŒåŒ…æ‹¬Stringï¼ŒNumber(byte, short, int, long, float, double), booleanã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"name": "Freeman"</span><br><span class="line">"gender": 1</span><br><span class="line">"registered": false</span><br><span class="line">"article": null</span><br></pre></td></tr></table></figure>
<p>==æ³¨æ„==ï¼šå¯¹è±¡ï¼Œæ•°ç»„ï¼Œå€¼è¿™ä¸‰ç§å…ƒç´ å¯äº’ç›¸åµŒå¥—ï¼</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"msg"</span>: <span class="string">"success"</span>,</span><br><span class="line">    <span class="attr">"data"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"zhangsan"</span>,</span><br><span class="line">            <span class="attr">"gender"</span>: <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"lisi"</span>,</span><br><span class="line">            <span class="attr">"gender"</span>: <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºJSONï¼Œç›®å‰æµè¡Œçš„ç¬¬ä¸‰æ–¹åº“æœ‰<a href="https://github.com/google/gson" target="_blank" rel="noopener">Gson</a>, <a href="https://github.com/alibaba/fastjson" target="_blank" rel="noopener">fastjson</a>ï¼šå…³äºGsonçš„è¯¦ç»†ä»‹ç»ï¼Œå‚è€ƒ<a href="https://juejin.im/post/5c46fb376fb9a049ca37af33" target="_blank" rel="noopener">Gsonä½¿ç”¨æ•™ç¨‹</a></p>
<p><strong>Protobuf</strong></p>
<p><a href="https://github.com/protocolbuffers/protobuf" target="_blank" rel="noopener">Protobuf</a>æ˜¯Googleå®ç°çš„ä¸€ç§ä¸è¯­è¨€æ— å…³ï¼Œä¸å¹³å°æ— å…³ï¼Œå¯æ‰©å±•çš„åºåˆ—åŒ–æ–¹å¼ï¼Œæ¯”XMLæ›´å°ï¼Œæ›´å¿«ï¼Œä½¿ç”¨æ›´ç®€å•ã€‚</p>
<p>Protobufå…·æœ‰å¾ˆé«˜çš„æ•ˆç‡ï¼Œå¹¶ä¸”å‡ ä¹ä¸ºä¸»æµçš„å¼€å‘è¯­è¨€éƒ½æä¾›äº†æ”¯æŒï¼Œå…·ä½“å‚è€ƒ<a href="https://developers.google.com/protocol-buffers/docs/overview" target="_blank" rel="noopener">Protobufå¼€å‘æ–‡æ¡£</a>ã€‚</p>
<p>åœ¨Androidä¸­ä½¿ç”¨Protobufï¼Œéœ€è¦<a href="https://github.com/google/protobuf-gradle-plugin" target="_blank" rel="noopener">protobuf-gradle-plugin</a>æ’ä»¶ï¼Œå…·ä½“ä½¿ç”¨æŸ¥çœ‹å…¶é¡¹ç›®è¯´æ˜ã€‚</p>
<p><strong>XML</strong></p>
<p>XMLï¼ˆExtensible Markup Languageï¼‰å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼Œé€šè¿‡æ ‡ç­¾æè¿°æ•°æ®ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Freeman<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gender</span>&gt;</span>1<span class="tag">&lt;/<span class="name">gender</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">person</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨è¿™ç§æ–¹å¼ä¼ è¾“æ•°æ®æ—¶ï¼Œåªéœ€è¦å°†å¯¹è±¡è½¬æ¢æˆè¿™ç§æ ‡ç­¾å½¢å¼ï¼Œåœ¨æ¥æ”¶åˆ°æ•°æ®åï¼Œå°†å…¶è½¬æ¢æˆç›¸åº”çš„å¯¹è±¡ã€‚</p>
<p>å…³äºJAVAå¼€å‘ä¸­å¯¹XMLçš„è§£æå¯å‚è€ƒ<a href="http://www.cnblogs.com/lanxuezaipiao/archive/2013/05/17/3082949.html" target="_blank" rel="noopener">å››ç§ç”Ÿæˆå’Œè§£æXMLæ–‡æ¡£çš„æ–¹æ³•è¯¦è§£</a></p>
<p><strong>æ•°æ®äº¤æ¢åè®®å¦‚ä½•é€‰æ‹©</strong></p>
<p>ä»æ€§èƒ½ï¼Œæ•°æ®å¤§å°ï¼Œå¯è¯»æ€§ä¸‰æ–¹é¢è¿›è¡Œæ¯”è¾ƒï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>åè®®</th>
<th>æ€§èƒ½</th>
<th>æ•°æ®å¤§å°</th>
<th>å¯è¯»æ€§</th>
</tr>
</thead>
<tbody>
<tr>
<td>JSON</td>
<td>è‰¯</td>
<td>è‰¯</td>
<td>ä¼˜</td>
</tr>
<tr>
<td>Protobuf</td>
<td>ä¼˜</td>
<td>ä¼˜</td>
<td>å·®</td>
</tr>
<tr>
<td>XML</td>
<td>ä¸­</td>
<td>ä¸­</td>
<td>ä¸­</td>
</tr>
</tbody>
</table>
<p>å¯¹äºæ•°æ®é‡ä¸æ˜¯å¾ˆå¤§ï¼Œå®æ—¶æ€§ä¸æ˜¯ç‰¹åˆ«é«˜çš„äº¤äº’ï¼ŒJSONå®Œå…¨å¯ä»¥æ»¡è¶³è¦æ±‚ï¼Œæ¯•ç«Ÿå®ƒçš„å¯è¯»æ€§é«˜ï¼Œå‡ºç°é—®é¢˜å®¹æ˜“å®šä½ï¼ˆæ³¨ï¼šå®ƒæ˜¯ç›®å‰å‰ç«¯ï¼Œappå’Œåç«¯äº¤æ¢æ•°æ®ä½¿ç”¨çš„ä¸»æµåè®®ï¼‰ã€‚è€Œå¯¹äºå®æ—¶æ€§è¦æ±‚å¾ˆé«˜ï¼Œæˆ–æ•°æ®é‡å¤§çš„åœºæ™¯ï¼Œå¯ä½¿ç”¨Protobufåè®®ã€‚å…·ä½“æ•°æ®äº¤æ¢åè®®çš„æ¯”è¾ƒå¯å‚è€ƒ<a href="https://note.youdao.com/" target="_blank" rel="noopener">github.com/eishay/jvm-â€¦</a></p>
<h4 id="4-1-java8çš„æ–°ç‰¹æ€§ã€‚"><a href="#4-1-java8çš„æ–°ç‰¹æ€§ã€‚" class="headerlink" title="4.1 java8çš„æ–°ç‰¹æ€§ã€‚"></a>4.1 java8çš„æ–°ç‰¹æ€§ã€‚</h4><p><a href="/2017/02/18/Java-8-æœ€ä½³æŠ€å·§/">Java 8-æœ€ä½³æŠ€å·§</a></p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>äºŒåˆ†æ³•æ±‚sqrt (2)ç²¾ç¡®åˆ°å°æ•°ç‚¹å 10 ä½</title>
    <url>/2019/12/26/%E4%BA%8C%E5%88%86%E6%B3%95%E6%B1%82sqrt-2-%E7%B2%BE%E7%A1%AE%E5%88%B0%E5%B0%8F%E6%95%B0%E7%82%B9%E5%90%8E-10-%E4%BD%8D/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h5 id="å› ä¸º-sqrt-2-çº¦ç­‰äº-1-4ï¼Œæ‰€ä»¥å¯ä»¥åœ¨-1-4-1-5-åŒºé—´åšäºŒåˆ†"><a href="#å› ä¸º-sqrt-2-çº¦ç­‰äº-1-4ï¼Œæ‰€ä»¥å¯ä»¥åœ¨-1-4-1-5-åŒºé—´åšäºŒåˆ†" class="headerlink" title="å› ä¸º sqrt(2)çº¦ç­‰äº 1.4ï¼Œæ‰€ä»¥å¯ä»¥åœ¨(1.4, 1.5)åŒºé—´åšäºŒåˆ†"></a>å› ä¸º sqrt(2)çº¦ç­‰äº 1.4ï¼Œæ‰€ä»¥å¯ä»¥åœ¨(1.4, 1.5)åŒºé—´åšäºŒåˆ†</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> TEN = <span class="number">0.0000000001</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">sqrt2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> low = <span class="number">1.4</span>;</span><br><span class="line">        <span class="keyword">double</span> high = <span class="number">1.5</span>;</span><br><span class="line">        <span class="keyword">double</span> mid = (low + high) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">while</span> ((high - low) &gt; TEN) &#123;</span><br><span class="line">            <span class="keyword">if</span> (high * high &gt; <span class="number">2</span>) &#123;</span><br><span class="line">                high = mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                low = mid;</span><br><span class="line">            &#125;</span><br><span class="line">            mid = (low + high) / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mid;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>å•å‘é“¾è¡¨é€†åºè¾“å‡º</title>
    <url>/2019/12/25/%E5%8D%95%E5%90%91%E9%93%BE%E8%A1%A8%E9%80%86%E5%BA%8F%E8%BE%93%E5%87%BA/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h5 id="å®ç°é“¾è¡¨é€†åºè¾“å‡º"><a href="#å®ç°é“¾è¡¨é€†åºè¾“å‡º" class="headerlink" title="å®ç°é“¾è¡¨é€†åºè¾“å‡º"></a>å®ç°é“¾è¡¨é€†åºè¾“å‡º</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reverse</span><span class="params">(ListNode&lt;T&gt; head)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (head == <span class="keyword">null</span> || head.next == <span class="keyword">null</span>) &#123;</span><br><span class="line">    	   <span class="keyword">return</span> ;</span><br><span class="line">       &#125;</span><br><span class="line">       ListNode&lt;T&gt; currentNode = head;</span><br><span class="line">       Stack&lt;ListNode&lt;T&gt;&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">       <span class="keyword">while</span> (currentNode != <span class="keyword">null</span>) &#123;</span><br><span class="line">    	   stack.push(currentNode);</span><br><span class="line">    	   ListNode&lt;T&gt; tempNode = currentNode.next;</span><br><span class="line">           <span class="comment">// æ–­å¼€è¿æ¥</span></span><br><span class="line">    	   currentNode.next = <span class="keyword">null</span>; </span><br><span class="line">    	   currentNode = tempNode;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       head = stack.pop();</span><br><span class="line">       currentNode = head;</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">    	   currentNode.next = stack.pop();</span><br><span class="line">    	   currentNode = currentNode.next;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListNode</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">	T val;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ListNode</span><span class="params">(T val)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.val = val;</span><br><span class="line">	&#125;</span><br><span class="line">	ListNode&lt;T&gt; next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>Githubå»ºç«‹åˆ†æ”¯å¤‡ä»½Hexo</title>
    <url>/2019/01/12/Github%E5%BB%BA%E7%AB%8B%E5%88%86%E6%94%AF%E5%A4%87%E4%BB%BDHexo/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç”±äºä¹‹å‰å¿˜è®°å¤‡ä»½Hexoåšå®¢çš„markdownæ–‡ä»¶ï¼Œåœ¨é‡åšç³»ç»Ÿæ—¶å€™è¿˜å¿˜è®°å¤‡ä»½åšå®¢äº†ï¼Œå¯¼è‡´ç°åœ¨ä¸å¾—ä¸é‡æ–°ä»ç½‘é¡µä¸Šæ‰’ä¸‹æ¥ä¹‹å‰çš„æ–‡ç« é‡æ–°å†™ä¸€éï¼Œååˆ†è€—è´¹ç²¾åŠ›ã€‚å› æ­¤åœ¨ç½‘ä¸Šæ‰¾äº†ä¸‹å¦‚ä½•å¤‡ä»½Hexoåšå®¢ï¼Œåœ¨æ­¤è®°å½•ä¸‹ã€‚</p>
<h1 id="å¤‡ä»½åšå®¢"><a href="#å¤‡ä»½åšå®¢" class="headerlink" title="å¤‡ä»½åšå®¢"></a>å¤‡ä»½åšå®¢</h1><p>å…ˆå°†æœ¬åœ°Hexoåšå®¢å·²ç»åˆå§‹åŒ–</p>
<h2 id="åˆ›å»ºæ–°åˆ†æ”¯"><a href="#åˆ›å»ºæ–°åˆ†æ”¯" class="headerlink" title="åˆ›å»ºæ–°åˆ†æ”¯"></a>åˆ›å»ºæ–°åˆ†æ”¯</h2><p>åœ¨Github.ioä¸Šå»ºç«‹åšå®¢æ—¶å·²ç»å¼€äº†ä¸€ä¸ªæ–°ä»“åº“äº†ï¼Œå¦‚æœå†å¼€å¦ä¸€ä¸ªä»“åº“å­˜æ”¾æºä»£ç æœ‰ç‚¹æµªè´¹ï¼Œå› æ­¤é‡‡ç”¨å»ºç«‹æ–°åˆ†æ”¯çš„æ–¹æ³•å¤‡ä»½åšå®¢ã€‚</p>
<p>è™½ç„¶ç†è®ºä¸Šä»€ä¹ˆæ—¶å€™åˆ›å»ºæ–°åˆ†æ”¯æ¥å¤‡ä»½éƒ½å¯ä»¥ï¼Œä½†æ˜¯è¿˜æ˜¯å»ºè®®åœ¨å»ºç«‹åšå®¢çš„æ—¶å€™å°±åˆ›å»ºå¤‡ä»½åˆ†æ”¯ã€‚ï¼ˆç„¶è€Œæˆ‘ä¸­é€”æ‰æƒ³èµ·æ¥-.-ï¼‰</p>
<p>ä¸è¿‡åœ¨å»ºç«‹æ–°åˆ†æ”¯å‰è¯·ç¡®ä¿ä»“åº“å†…å·²æœ‰<code>master</code>åˆ†æ”¯ï¼ˆHexoæœ¬åœ°å»ºç«™åç¬¬ä¸€æ¬¡ä¸Šä¼ æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆï¼‰ï¼Œå¦åˆ™åæœŸå†æ·»åŠ <code>master</code>åˆ†æ”¯æ¯”è¾ƒéº»çƒ¦ï¼ˆè¯·è‡ªè¡Œæœç´¢<code>git</code>å‘½ä»¤ï¼‰ã€‚</p>
<p>æœ¬åœ°Gitå»ºç«‹æ–°åˆ†æ”¯å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line">$ git checkout -<span class="keyword">b </span><span class="keyword">BRANCHNAME</span></span><br></pre></td></tr></table></figure>
<p><code>BRANCHNAME</code>æ˜¯è‡ªå®šä¹‰çš„æ–°åˆ†æ”¯çš„åå­—ï¼Œå»ºè®®èµ·ä¸º<code>hexo</code>ã€‚</p>
<a id="more"></a>
<h2 id="å»ºç«‹-gitignore"><a href="#å»ºç«‹-gitignore" class="headerlink" title="å»ºç«‹.gitignore"></a>å»ºç«‹.gitignore</h2><p>å»ºç«‹<code>.gitignore</code>æ–‡ä»¶å°†ä¸éœ€è¦å¤‡ä»½çš„æ–‡ä»¶å±è”½ã€‚ä¸ªäººçš„<code>.gitignore</code>æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="meta">.DS_Store</span></span><br><span class="line">Thumbs<span class="number">.</span><span class="built_in">db</span></span><br><span class="line"><span class="built_in">db</span><span class="number">.</span>json</span><br><span class="line">*.log</span><br><span class="line">node_modules/</span><br><span class="line"><span class="meta">public</span>/</span><br><span class="line"><span class="meta">.deploy</span>*/</span><br></pre></td></tr></table></figure>
<h2 id="åœ¨Githubä¸Šå¤‡ä»½"><a href="#åœ¨Githubä¸Šå¤‡ä»½" class="headerlink" title="åœ¨Githubä¸Šå¤‡ä»½"></a>åœ¨Githubä¸Šå¤‡ä»½</h2><p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤å°†æœ¬åœ°æ–‡ä»¶å¤‡ä»½åˆ°Githubä¸Šã€‚</p>
<p>å‡è®¾ç›®å‰åœ¨hexoåšå®¢çš„æ ¹ç›®å½•ä¸‹ã€‚</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>git add .</span><br><span class="line"><span class="variable">$ </span>git commit -m <span class="string">"Backup"</span></span><br><span class="line"><span class="variable">$ </span>git push origin hexo</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¤‡ä»½å®Œåšå®¢äº†ä¸”åœ¨Githubä¸Šèƒ½çœ‹åˆ°ä¸¤ä¸ªåˆ†æ”¯(<code>master</code>å’Œ<code>hexo</code>)ã€‚</p>
<h2 id="è®¾ç½®é»˜è®¤åˆ†æ”¯"><a href="#è®¾ç½®é»˜è®¤åˆ†æ”¯" class="headerlink" title="è®¾ç½®é»˜è®¤åˆ†æ”¯"></a>è®¾ç½®é»˜è®¤åˆ†æ”¯</h2><p>åœ¨Githubä¸Šä½ çš„github.ioä»“åº“ä¸­è®¾ç½®é»˜è®¤åˆ†æ”¯ä¸º<code>hexo</code>ã€‚è¿™æ ·æœ‰åŠ©äºä¹‹åæ¢å¤åšå®¢ã€‚<code>master</code>åˆ†æ”¯æ—¶é»˜è®¤çš„åšå®¢é™æ€é¡µé¢åˆ†æ”¯ï¼Œåœ¨ä¹‹åæ¢å¤åšå®¢çš„æ—¶å€™å¹¶ä¸éœ€è¦ã€‚</p>
<h2 id="ä¸ªäººå¤‡ä»½ä¹ æƒ¯"><a href="#ä¸ªäººå¤‡ä»½ä¹ æƒ¯" class="headerlink" title="ä¸ªäººå¤‡ä»½ä¹ æƒ¯"></a>ä¸ªäººå¤‡ä»½ä¹ æƒ¯</h2><p>ä¸ªäººè€Œè¨€ä¹ æƒ¯äºå…ˆå¤‡ä»½æ–‡ä»¶å†ç”Ÿæˆåšå®¢ã€‚å³å…ˆæ‰§è¡Œ<code>git add .</code>,<code>git commit -m &quot;Backup&quot;</code>,<code>git push origin hexo</code>å°†åšå®¢å¤‡ä»½å®Œæˆï¼Œç„¶åæ‰§è¡Œ<code>hexo g -d</code>å‘å¸ƒåšå®¢ã€‚</p>
<h1 id="æ¢å¤åšå®¢"><a href="#æ¢å¤åšå®¢" class="headerlink" title="æ¢å¤åšå®¢"></a>æ¢å¤åšå®¢</h1><p>å…ˆæŠŠæœ¬åœ°Hexoåšå®¢åŸºç¡€ç¯å¢ƒå·²ç»æ­å¥½</p>
<h2 id="å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°"><a href="#å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°" class="headerlink" title="å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°"></a>å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°</h2><p>è¾“å…¥ä¸‹åˆ—å‘½ä»¤å…‹éš†åšå®¢å¿…é¡»æ–‡ä»¶(<code>hexo</code>åˆ†æ”¯)ï¼š</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">$ git <span class="keyword">clone</span> <span class="title">https</span>://github.com/yourgithubname/yourgithubname.github.io</span><br></pre></td></tr></table></figure>
<h2 id="æ¢å¤åšå®¢-1"><a href="#æ¢å¤åšå®¢-1" class="headerlink" title="æ¢å¤åšå®¢"></a>æ¢å¤åšå®¢</h2><p>åœ¨å…‹éš†çš„é‚£ä¸ªæ–‡ä»¶å¤¹ä¸‹è¾“å…¥å¦‚ä¸‹å‘½ä»¤æ¢å¤åšå®¢ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">$ npm <span class="keyword">install</span> hexo-cli</span><br><span class="line">$ npm <span class="keyword">install</span></span><br><span class="line">$ npm <span class="keyword">install</span> hexo-deployer-git</span><br></pre></td></tr></table></figure>
<p>åœ¨æ­¤ä¸éœ€è¦æ‰§è¡Œ<code>hexo init</code>è¿™æ¡æŒ‡ä»¤ï¼Œå› ä¸ºä¸æ˜¯ä»é›¶æ­å»ºèµ·æ–°åšå®¢ã€‚</p>
<h2 id="æäº¤å‡†å¤‡"><a href="#æäº¤å‡†å¤‡" class="headerlink" title="æäº¤å‡†å¤‡"></a>æäº¤å‡†å¤‡</h2><p>ï¼ˆ1ï¼‰æ‰“å¼€git bashï¼Œåœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹è¿è¡Œï¼šssh-keygen -t rsa -C â€œ<a href="mailto:youremail@example.com" target="_blank" rel="noopener">youremail@example.com</a>â€œ æŠŠå…¶ä¸­çš„é‚®ä»¶åœ°å€æ¢æˆè‡ªå·±çš„é‚®ä»¶åœ°å€ï¼Œç„¶åä¸€è·¯å›è½¦</p>
<p>ï¼ˆ2ï¼‰æœ€åå®Œæˆåï¼Œä¼šåœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹ç”Ÿæˆ.sshç›®å½•ï¼Œé‡Œé¢æœ‰id_rsaå’Œid_rsa.pubä¸¤ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªå°±æ˜¯SSH keyå¯†é’¥å¯¹ï¼Œid_rsaæ˜¯ç§é’¥ï¼Œåƒä¸‡ä¸èƒ½æ³„éœ²å‡ºå»ï¼Œid_rsa.pubæ˜¯å…¬é’¥ï¼Œå¯ä»¥æ”¾å¿ƒåœ°å‘Šè¯‰ä»»ä½•äººã€‚</p>
<p>ï¼ˆ3ï¼‰ç™»é™†GitHubï¼Œæ‰“å¼€ã€ŒSettingsã€-&gt;ã€ŒSSH and GPG keysã€ï¼Œç„¶åç‚¹å‡»ã€Œnew SSH keyã€ï¼Œå¡«ä¸Šä»»æ„Titleï¼Œåœ¨Keyæ–‡æœ¬æ¡†é‡Œç²˜è´´å…¬é’¥id_rsa.pubæ–‡ä»¶çš„å†…å®¹ï¼ˆåƒä¸‡ä¸è¦ç²˜è´´æˆç§é’¥äº†ï¼ï¼‰ï¼Œæœ€åç‚¹å‡»ã€ŒAdd SSH Keyã€ï¼Œä½ å°±åº”è¯¥çœ‹åˆ°å·²ç»æ·»åŠ çš„Keyã€‚æ³¨æ„ï¼šä¸è¦åœ¨gitç‰ˆæœ¬åº“ä¸­è¿è¡Œsshï¼Œç„¶ååˆå°†å®ƒæäº¤ï¼Œè¿™æ ·å°±æŠŠå¯†ç æ³„éœ²å‡ºå»äº†ã€‚</p>
<p>å®Œæˆï½</p>
]]></content>
      <categories>
        <category>æ‚ä¸ƒæ‚å…«</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>å¤‡ä»½</tag>
      </tags>
  </entry>
  <entry>
    <title>é¡¹ç›®æ‰˜ç®¡è‡³Github</title>
    <url>/2018/01/02/%E9%A1%B9%E7%9B%AE%E6%89%98%E7%AE%A1%E8%87%B3Github/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æœ¬åœ°æ–°å»ºé¡¹ç›®åï¼Œå¦‚ä½•åŒæ­¥åˆ° github ä¸Šå‘¢ï¼Ÿ</p>
<ol>
<li>åœ¨GitHubä¸Šæ–°å»ºé¡¹ç›®</li>
<li>è¿›å…¥æœ¬åœ°é¡¹ç›®ç›®å½•ï¼Œä¾æ¬¡æ‰§è¡Œ</li>
</ol>
<blockquote>
<p>git init<br>git add .<br>git commit -m â€œå¤‡æ³¨â€<br>git remote add origin ä»“åº“åœ°å€<br>git push -u origin master</p>
</blockquote>
<a id="more"></a>
<h3 id="å‘½ä»¤è¯´æ˜ï¼š"><a href="#å‘½ä»¤è¯´æ˜ï¼š" class="headerlink" title="å‘½ä»¤è¯´æ˜ï¼š"></a>å‘½ä»¤è¯´æ˜ï¼š</h3><h4 id="git-init"><a href="#git-init" class="headerlink" title="git init"></a>git init</h4><blockquote>
<p>åˆå§‹åŒ–æœ¬åœ°ä»“åº“</p>
</blockquote>
<h4 id="git-add"><a href="#git-add" class="headerlink" title="git add ."></a>git add .</h4><blockquote>
<p>æ·»åŠ å…¨éƒ¨å·²ç»ä¿®æ”¹çš„æ–‡ä»¶ï¼Œå‡†å¤‡commit æäº¤ è¯¥å‘½ä»¤æ•ˆæœç­‰åŒäº git add -A</p>
</blockquote>
<h4 id="git-commit-m-â€˜æäº¤è¯´æ˜â€™"><a href="#git-commit-m-â€˜æäº¤è¯´æ˜â€™" class="headerlink" title="git commit -m â€˜æäº¤è¯´æ˜â€™"></a>git commit -m â€˜æäº¤è¯´æ˜â€™</h4><blockquote>
<p>å°†ä¿®æ”¹åçš„æ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œå¦‚ï¼šgit commit -m â€˜å¢åŠ README.mdè¯´æ˜æ–‡æ¡£â€™</p>
</blockquote>
<h4 id="git-remote-add-origin-è¿œç¨‹ä»“åº“åœ°å€"><a href="#git-remote-add-origin-è¿œç¨‹ä»“åº“åœ°å€" class="headerlink" title="git remote add origin è¿œç¨‹ä»“åº“åœ°å€"></a>git remote add origin è¿œç¨‹ä»“åº“åœ°å€</h4><blockquote>
<p>è¿æ¥åˆ°è¿œç¨‹ä»“åº“å¹¶ä¸ºè¯¥ä»“åº“åˆ›å»ºåˆ«å , åˆ«åä¸ºorigin . è¿™ä¸ªåˆ«åæ˜¯è‡ªå®šä¹‰çš„ï¼Œé€šå¸¸ç”¨origin ; è¿œç¨‹ä»“åº“åœ°å€ï¼Œå°±æ˜¯ä½ è‡ªå·±æ–°å»ºçš„é‚£ä¸ªä»“åº“çš„åœ°å€ï¼Œå¤åˆ¶åœ°å€çš„æ–¹æ³•å‚è€ƒ ç¬¬äºŒå¼ å›¾ã€‚<br>å¦‚ï¼šgit remote add origin <a href="https://github.com/JustDoItLee/xxxxxx.git" target="_blank" rel="noopener">https://github.com/JustDoItLee/xxxxxx.git</a> è¿™æ®µä»£ç çš„å«ä¹‰æ˜¯ï¼š è¿æ¥åˆ°githubä¸Š<a href="https://github.com/JustDoItLee/xxxxxx.git" target="_blank" rel="noopener">https://github.com/JustDoItLee/xxxxxx.git</a> è¿™ä¸ªä»“åº“ï¼Œå¹¶åˆ›å»ºåˆ«åä¸ºorigin . ï¼ˆä¹‹åpush æˆ–è€…pull çš„æ—¶å€™å°±éœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ª origin åˆ«åï¼‰</p>
</blockquote>
<h4 id="git-push-u-origin-master"><a href="#git-push-u-origin-master" class="headerlink" title="git push -u origin master"></a>git push -u origin master</h4><blockquote>
<p>åˆ›å»ºä¸€ä¸ª upStream ï¼ˆä¸Šä¼ æµï¼‰ï¼Œå¹¶å°†æœ¬åœ°ä»£ç é€šè¿‡è¿™ä¸ª upStream æ¨é€åˆ° åˆ«åä¸º origin çš„ä»“åº“ä¸­çš„ master åˆ†æ”¯ä¸Š</p>
<p>-u ï¼Œå°±æ˜¯åˆ›å»º upStream ä¸Šä¼ æµï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªä¸Šä¼ æµå°±æ— æ³•å°†ä»£ç æ¨é€åˆ° githubï¼›åŒæ—¶ï¼Œè¿™ä¸ª upStream åªéœ€è¦åœ¨åˆæ¬¡æ¨é€ä»£ç çš„æ—¶å€™åˆ›å»ºï¼Œä»¥åå°±ä¸ç”¨åˆ›å»ºäº†</p>
<p>å¦å¤–ï¼Œåœ¨åˆæ¬¡ push ä»£ç çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå› ä¸ºç½‘ç»œç­‰åŸå› å¯¼è‡´å‘½ä»¤è¡Œç»ˆç«¯ä¸Šçš„å†…å®¹ä¸€ç›´æ²¡æœ‰å˜åŒ–ï¼Œè€å¿ƒç­‰å¾…ä¸€ä¼šå°±å¥½ã€‚</p>
</blockquote>
<h3 id="æ’é”™"><a href="#æ’é”™" class="headerlink" title="æ’é”™"></a>æ’é”™</h3><p>å¦‚æœæ‰§è¡Œ <code>git push -u origin master</code> æŠ¥é”™ï¼Œæ˜¯å› ä¸ºåœ¨ github ä¸Šé¡¹ç›®ä¸æ˜¯ç©ºçš„ï¼Œå¤§éƒ¨åˆ†æƒ…å†µæ˜¯å› ä¸ºæœ‰ä¸€ä¸ª <code>README.md</code> æ–‡ä»¶</p>
<blockquote>
<p>error: failed to push some refs to <a href="mailto:&#39;git@github.com" target="_blank" rel="noopener">&#39;git@github.com</a>:xxxxxx.gitâ€™<br>hint: Updates were rejected because the remote contains work that you do<br>hint: not have locally. This is usually caused by another repository pushing<br>hint: to the same ref. You may want to first integrate the remote changes<br>hint: (e.g., â€˜git pull â€¦â€™) before pushing again.<br>hint: See the â€˜Note about fast-forwardsâ€™ in â€˜git push â€“helpâ€™ for details.</p>
</blockquote>
<p>æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼ŒæŠŠgithubä¸Šæ²¡æœ‰æ‹‰ä¸‹æ¥çš„ä»£ç æˆ–æ–‡ä»¶æ‹‰ä¸‹æ¥</p>
<blockquote>
<p>git pull â€“rebase origin master</p>
</blockquote>
<p>ç„¶åå†æ‰§è¡Œ</p>
<blockquote>
<p> git push -u origin master</p>
</blockquote>
<p>æäº¤ä»£ç å³å¯ã€‚</p>
<h3 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h3><p>æ‰€ä»¥å¦‚æœåœ¨<code>github</code> ä¸Šæ–°å»ºé¡¹ç›®æ—¶åˆå§‹åŒ–äº† <code>README</code> æ–‡ä»¶ï¼ŒæŒ‰ä¸‹é¢çš„é¡ºåºæ‰§è¡Œå‘½ä»¤å°±å¯ä»¥</p>
<blockquote>
<p>git init git add . git commit -m â€œå¤‡æ³¨â€ git remote add origin ä»“åº“åœ°å€ git pull â€“rebase origin master git push -u origin master</p>
</blockquote>
]]></content>
      <categories>
        <category>é¡¹ç›®ç®¡ç†</category>
      </categories>
      <tags>
        <tag>github</tag>
        <tag>ç‰ˆæœ¬æ§åˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>ç³»ç»Ÿå­¦ä¹ Spring(ä¸‰)â€”â€”Beançš„é«˜çº§è£…é…</title>
    <url>/2017/05/15/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0Spring-%E4%B8%89-%E2%80%94%E2%80%94Bean%E7%9A%84%E9%AB%98%E7%BA%A7%E8%A3%85%E9%85%8D/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå¸¸å¸¸è®¾ç½®ä¸åŒçš„è¿è¡Œç¯å¢ƒï¼šå¼€å‘ç¯å¢ƒã€é¢„å‘ç¯å¢ƒã€æ€§èƒ½æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒç­‰ç­‰ã€‚</p>
<p>ä¸åŒçš„ç¯å¢ƒä¸‹ï¼Œåº”ç”¨ç¨‹åºçš„é…ç½®é¡¹ä¹Ÿä¸åŒï¼Œä¾‹å¦‚æ•°æ®åº“é…ç½®ã€è¿œç¨‹æœåŠ¡åœ°å€ç­‰ã€‚<a id="more"></a>ä»¥æ•°æ®åº“é…ç½®ä¸ºä¾‹å­ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸­ä½ å¯èƒ½ä½¿ç”¨ä¸€ä¸ªåµŒå…¥å¼çš„å†…å­˜æ•°æ®åº“ï¼Œå¹¶å°†æµ‹è¯•æ•°æ®æ”¾åœ¨ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ä¸­ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªSpringçš„é…ç½®ç±»ä¸­ï¼Œå¯èƒ½éœ€è¦å®šä¹‰å¦‚ä¸‹çš„beanï¼š</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span>(destroyMethod = <span class="string">"shutdown"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="function">DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder()</span><br><span class="line">            .addScript(<span class="string">"classpath:schema.sql"</span>)</span><br><span class="line">            .addScript(<span class="string">"classpath:test-data.sql"</span>)</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨EmbeddedDatabaseBuilderè¿™ä¸ªæ„å»ºå™¨å¯ä»¥å»ºç«‹ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œé€šè¿‡æŒ‡å®šè·¯å¾„ä¸‹çš„schema.sqlæ–‡ä»¶ä¸­çš„å†…å®¹å¯ä»¥å»ºç«‹æ•°æ®åº“çš„è¡¨å®šä¹‰ï¼Œé€šè¿‡test-data.sqlå¯ä»¥å‡†å¤‡å¥½æµ‹è¯•æ•°æ®ã€‚</p>
<p>å¼€å‘ç¯å¢ƒä¸‹å¯ä»¥è¿™ä¹ˆç”¨ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä¸å¯ä»¥ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä½ å¯èƒ½éœ€è¦ä»å®¹å™¨ä¸­ä½¿ç”¨JNDIè·å–DataSourceå¯¹è±¡ï¼Œè¿™ä¸­æƒ…å†µä¸‹ï¼Œå¯¹åº”çš„åˆ›å»ºä»£ç æ˜¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    JndiObjectFactoryBean jndiObjectFactoryBean =</span><br><span class="line">             <span class="keyword">new</span> JndiObjectFactoryBean();</span><br><span class="line">    jndiObjectFactoryBean.setJndiName(<span class="string">"jdbc/myDS"</span>);</span><br><span class="line">    jndiObjectFactoryBean.setResourceRef(<span class="keyword">true</span>);</span><br><span class="line">    jndiObjectFactoryBean.setProxyInterface(javax.sql.DataSource<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="keyword">return</span> (DataSource) jndiObjectFactoryBean.getObject();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨JNDIç®¡ç†DataSourceå¯¹è±¡ï¼Œå¾ˆé€‚åˆç”Ÿäº§ç¯å¢ƒï¼Œä½†æ˜¯å¯¹äºæ—¥å¸¸å¼€å‘ç¯å¢ƒæ¥è¯´å¤ªå¤æ‚äº†ã€‚</p>
<p>å¦å¤–ï¼Œåœ¨QAç¯å¢ƒä¸‹ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å¦å¤–ä¸€ç§DataSourceé…ç½®ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨æ™®é€šçš„DBCPè¿æ¥æ± ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">@Bean(destroyMethod = <span class="string">"close"</span>)</span><br><span class="line">public DataSource dataSource() &#123;</span><br><span class="line">    BasicDataSource dataSource = new BasicDataSource();</span><br><span class="line">    dataSource.<span class="built_in">set</span>Url(<span class="string">"jdbc:h2:tcp://dbserver/~/test"</span>);</span><br><span class="line">    dataSource.<span class="built_in">set</span>DriverClassName(<span class="string">"org.h2.Driver"</span>);</span><br><span class="line">    dataSource.<span class="built_in">set</span>Username(<span class="string">"sa"</span>);</span><br><span class="line">    dataSource.<span class="built_in">set</span>Password(<span class="string">"password"</span>);</span><br><span class="line">    dataSource.<span class="built_in">set</span>InitialSize(<span class="number">20</span>);</span><br><span class="line">    dataSource.<span class="built_in">set</span>MaxActive(<span class="number">30</span>);</span><br><span class="line">    return dataSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä¸‰ç§åŠæ³•å¯ä»¥ä¸ºä¸åŒç¯å¢ƒåˆ›å»ºå„è‡ªéœ€è¦çš„javax.sql.DataSourceå®ä¾‹ï¼Œè¿™ä¸ªä¾‹å­å¾ˆé€‚åˆä»‹ç»ä¸åŒç¯å¢ƒä¸‹åˆ›å»ºbeanï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ï¼šåªéœ€è¦æ‰“åŒ…åº”ç”¨ä¸€æ¬¡ï¼Œç„¶åéƒ¨ç½²åˆ°ä¸åŒçš„å¼€å‘ç¯å¢ƒä¸‹å°±ä¼šè‡ªåŠ¨é€‰æ‹©ä¸åŒçš„beanåˆ›å»ºç­–ç•¥ã€‚ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºä¸‰ä¸ªç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ï¼Œç„¶ååˆ©ç”¨Maven profilesçš„é¢„ç¼–è¯‘å‘½ä»¤å¤„ç†åœ¨ç‰¹å®šçš„ç¯å¢ƒä¸‹æ‰“åŒ…å“ªä¸ªé…ç½®æ–‡ä»¶åˆ°æœ€ç»ˆçš„åº”ç”¨ä¸­ã€‚è¿™ç§è§£å†³æ–¹æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå³åœ¨åˆ‡æ¢åˆ°ä¸åŒç¯å¢ƒæ—¶ï¼Œéœ€è¦é‡æ–°æ„å»ºåº”ç”¨â€”â€”ä»å¼€å‘ç¯å¢ƒåˆ°æµ‹è¯•ç¯å¢ƒæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ä»æµ‹è¯•ç¯å¢ƒåˆ°ç”Ÿäº§ç¯å¢ƒä¹Ÿéœ€è¦é‡æ–°æ„å»ºåˆ™å¯èƒ½å¼•å…¥ä¸€å®šé£é™©ã€‚</p>
<p>Springæä¾›äº†å¯¹åº”çš„æ–¹æ³•ï¼Œä½¿å¾—åœ¨ç¯å¢ƒåˆ‡æ¢æ—¶ä¸éœ€è¦é‡æ–°æ„å»ºæ•´ä¸ªåº”ç”¨ã€‚</p>
<p></p><h2>é…ç½®profile beans</h2><br>Springæä¾›çš„æ–¹æ³•ä¸æ˜¯åœ¨æ„ä»¶æ—¶é’ˆå¯¹ä¸åŒçš„ç¯å¢ƒå†³ç­–ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶ï¼Œè¿™æ ·ï¼Œä¸€ä¸ªåº”ç”¨åªéœ€è¦æ„å»ºä¸€æ¬¡ï¼Œå°±å¯ä»¥åœ¨å¼€å‘ã€QAå’Œç”Ÿäº§ç¯å¢ƒè¿è¡Œã€‚<p></p>
<p>åœ¨Spring 3.1ä¹‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨@Profileæ³¨è§£æ¥ä¿®é¥°JavaConfigç±»ï¼Œå½“æŸä¸ªç¯å¢ƒå¯¹åº”çš„profileè¢«æ¿€æ´»æ—¶ï¼Œå°±ä½¿ç”¨å¯¹åº”ç¯å¢ƒä¸‹çš„é…ç½®ç±»ã€‚</p>
<p>åœ¨Spring3.2ä¹‹åï¼Œåˆ™å¯ä»¥åœ¨å‡½æ•°çº§åˆ«ä½¿ç”¨@Profileæ³¨è§£ï¼ˆæ˜¯çš„ï¼Œè·Ÿ@Beanæ³¨è§£åŒæ—¶ä½œç”¨åœ¨å‡½æ•°ä¸Šï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥å°†å„ä¸ªç¯å¢ƒçš„ä¸‹çš„beanå®šä¹‰éƒ½æ”¾åœ¨åŒä¸€ä¸ªé…ç½®ç±»ä¸­ï¼Œè¿˜æ˜¯ä»¥ä¹‹å‰çš„ä¾‹å­ï¼š</p>
<p>åˆ©ç”¨æ³¨è§£é…ç½®</p>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">package com.spring.sample.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.<span class="keyword">annotation</span>.<span class="title">Bean</span>;</span><br><span class="line">import org.springframework.context.<span class="keyword">annotation</span>.<span class="title">Configuration</span>;</span><br><span class="line">import org.springframework.context.<span class="keyword">annotation</span>.<span class="title">Profile</span>;</span><br><span class="line">import org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseBuilder;</span><br><span class="line">import org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType;</span><br><span class="line">import org.springframework.jndi.JndiObjectFactoryBean;</span><br><span class="line">import javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> &#123;</span></span><br><span class="line">    @Bean(destroyMethod = <span class="string">"shutdown"</span>)</span><br><span class="line">    @Profile(<span class="string">"dev"</span>)</span><br><span class="line">    public DataSource embeddedDataSource() &#123;</span><br><span class="line">        <span class="keyword">return</span> new EmbeddedDatabaseBuilder()</span><br><span class="line">                .setType(EmbeddedDatabaseType.H2)</span><br><span class="line">                .addScript(<span class="string">"classpath:schema.sql"</span>)</span><br><span class="line">                .addScript(<span class="string">"classpath:test-data.sql"</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean</span><br><span class="line">    @Profile(<span class="string">"prod"</span>)</span><br><span class="line">    public DataSource dataSource() &#123;</span><br><span class="line">        JndiObjectFactoryBean jndiObjectFactoryBean =</span><br><span class="line">                new JndiObjectFactoryBean();</span><br><span class="line">        jndiObjectFactoryBean.setJndiName(<span class="string">"jdbc/myDS"</span>);</span><br><span class="line">        jndiObjectFactoryBean.setResourceRef(<span class="literal">true</span>); </span><br><span class="line">        jndiObjectFactoryBean.setProxyInterface(javax.sql.DataSource<span class="class">.<span class="keyword">class</span>);</span></span><br><span class="line">        <span class="keyword">return</span> (DataSource) jndiObjectFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é™¤äº†è¢«@Profileä¿®é¥°çš„å…¶ä»–beanï¼Œæ— è®ºåœ¨ä»€ä¹ˆå¼€å‘ç¯å¢ƒä¸‹éƒ½ä¼šè¢«åˆ›å»ºã€‚</p>
<p>åˆ©ç”¨XMLæ–‡ä»¶é…ç½®</p>
<p>å’Œåœ¨JavaConfigçš„ç”¨æ³•ä¸€æ ·ï¼Œå¯ä»¥ä»æ–‡ä»¶çº§åˆ«å®šä¹‰ç¯å¢ƒä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥å°†å„ä¸ªç¯å¢ƒçš„beanæ”¾åœ¨ä¸€ä¸ªXMLé…ç½®æ–‡ä»¶ä¸­ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jdbc</span>=<span class="string">"http://www.springframework.org/schema/jdbc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jee</span>=<span class="string">"http://www.springframework.org/schema/jee"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">"dev"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">jdbc:embedded-database</span> <span class="attr">id</span>=<span class="string">"dataSource"</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">"classpath:schema.sql"</span>/&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">"classpath:test-data.sql"</span>/&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">jdbc:embedded-database</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">"qa"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">destroy-method</span>=<span class="string">"close"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">p:url</span>=<span class="string">"jdbc:h2:tcp://dbserver/~/test"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">p:driverClassName</span>=<span class="string">"org.h2.Driver"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">p:username</span>=<span class="string">"sa"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">p:password</span>=<span class="string">"password"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">p:initialSize</span>=<span class="string">"20"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">p:maxActive</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">"prod"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">jee:jndi-lookup</span> <span class="attr">id</span>=<span class="string">"dataSource"</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">jndi-name</span>=<span class="string">"jdbc/MyDatabase"</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">resource-ref</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">proxy-interface</span>=<span class="string">"javax.sql.DataSource"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä¸‰ä¸ªjavax.sql.DataSourceçš„beanï¼ŒIDéƒ½æ˜¯dataSourceï¼Œä½†æ˜¯åœ¨è¿è¡Œçš„æ—¶å€™åªä¼šåˆ›å»ºä¸€ä¸ªbeanã€‚</p>
<p></p><h2>æ¿€æ´»profiles</h2><br>Springæä¾›äº†spring.profiles.activeå’Œspring.profiles.defaultè¿™ä¸¤ä¸ªé…ç½®é¡¹å®šä¹‰æ¿€æ´»å“ªä¸ªprofileã€‚å¦‚æœåº”ç”¨ä¸­è®¾ç½®äº†spring.profiles.activeé€‰é¡¹ï¼Œåˆ™Springæ ¹æ®è¯¥é…ç½®é¡¹çš„å€¼æ¿€æ´»å¯¹åº”çš„profileï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®spring.profiles.activeï¼Œåˆ™Springä¼šå†æŸ¥çœ‹spring.profiles.defaultè¿™ä¸ªé…ç½®é¡¹çš„å€¼ï¼Œå¦‚æœè¿™ä¸¤ä¸ªå˜é‡éƒ½æ²¡æœ‰è®¾ç½®ï¼Œåˆ™Springåªä¼šåˆ›å»ºæ²¡æœ‰è¢«profileä¿®é¥°çš„beanã€‚<p></p>
<p>æœ‰ä¸‹åˆ—å‡ ç§æ–¹æ³•è®¾ç½®ä¸Šè¿°ä¸¤ä¸ªå˜é‡çš„å€¼ï¼š</p>
<p><li>DispatcherServletçš„åˆå§‹åŒ–å‚æ•°</li></p>
<p><li>webåº”ç”¨çš„ä¸Šä¸‹æ–‡å‚æ•°(context parameters)</li></p>
<p><li>JNDIé¡¹</li></p>
<p><li>ç¯å¢ƒå˜é‡</li></p>
<p><li>JVMç³»ç»Ÿå±æ€§<br></li><li>åœ¨é›†æˆæµ‹è¯•ç±»ä¸Šä½¿ç”¨@ActiveProfilesæ³¨è§£</li></p>
<p>å¼€å‘äººå‘˜å¯ä»¥æŒ‰è‡ªå·±çš„éœ€æ±‚è®¾ç½®spring.profiles.activeå’Œspring.profiles.defaultè¿™ä¸¤ä¸ªå±æ€§çš„ç»„åˆã€‚</p>
<p>æˆ‘æ¨èåœ¨webåº”ç”¨çš„web.xmlæ–‡ä»¶ä¸­è®¾ç½®spring.profiles.defaultå±æ€§â€”â€”é€šè¿‡è®¾ç½®DispatcherServletçš„åˆå§‹å‚æ•°å’Œ<context-param>æ ‡ç­¾ã€‚</context-param></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath*:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>spring.profiles.default<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>appServletName<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span>        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>spring.profiles.default<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>appServletName<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§ä¸Šè¿°æ–¹æ³•è®¾ç½®spring.profiles.defaultå±æ€§ï¼Œä»»ä½•å¼€å‘äººå‘˜åªéœ€è¦ä¸‹è½½æºç å°±å¯ä»¥åœ¨å¼€å‘ç¯å¢ƒä¸­è¿è¡Œç¨‹åºä»¥åŠæµ‹è¯•ã€‚</p>
<p>ç„¶åï¼Œå½“åº”ç”¨éœ€è¦è¿›å…¥QAã€ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œè´Ÿè´£éƒ¨ç½²çš„å¼€å‘è€…åªéœ€è¦é€šè¿‡ç³»ç»Ÿå±æ€§ã€ç¯å¢ƒå˜é‡æˆ–è€…JNDIç­‰æ–¹æ³•è®¾ç½®spring.profiles.activeå±æ€§å³å¯ï¼Œå› ä¸ºspring.profiles.activeä¼˜å…ˆçº§æ›´é«˜ã€‚</p>
<p>å¦å¤–ï¼Œåœ¨è¿è¡Œé›†æˆæµ‹è¯•æ—¶ï¼Œå¯èƒ½å¸Œæœ›è¿è¡Œè·Ÿç”Ÿäº§ç¯å¢ƒä¸‹ç›¸åŒçš„é…ç½®ï¼›ä½†æ˜¯ï¼Œå¦‚æœé…ç½®é‡éœ€è¦çš„beansè¢«profilesä¿®é¥°çš„ï¼Œåˆ™éœ€è¦åœ¨è·‘å•å…ƒæµ‹è¯•ä¹‹å‰æ¿€æ´»å¯¹åº”çš„profilesã€‚</p>
<p>Springæä¾›äº†@ActiveProfilesæ³¨è§£æ¥æ¿€æ´»æŒ‡å®šçš„profilesï¼Œç”¨æ³•å¦‚ä¸‹ï¼š</p>
<p></p><h2>Conditional beans</h2><br>å‡è®¾ä½ å¸Œæœ›åªæœ‰åœ¨é¡¹ç›®ä¸­å¼•å…¥ç‰¹å®šçš„ä¾èµ–åº“æ—¶ã€æˆ–è€…åªæœ‰å½“ç‰¹å®šçš„beanå·²ç»è¢«åˆ›å»ºæ—¶ã€æˆ–è€…æ˜¯è®¾ç½®äº†æŸä¸ªç¯å¢ƒå˜é‡æ—¶ï¼ŒæŸä¸ªbeanæ‰è¢«åˆ›å»ºã€‚<p></p>
<p>Spring 4ä¹‹å‰å¾ˆéš¾å®ç°è¿™ç§éœ€æ±‚ï¼Œä¸è¿‡åœ¨Spring 4ä¸­æå‡ºäº†ä¸€ä¸ªæ–°çš„æ³¨è§£â€”â€”@Conditionalï¼Œè¯¥æ³¨è§£ä½œç”¨äº@Beanæ³¨è§£ä¿®é¥°çš„æ–¹æ³•ä¸Šï¼Œé€šè¿‡åˆ¤æ–­æŒ‡å®šçš„æ¡ä»¶æ˜¯å¦æ»¡è¶³æ¥å†³å®šæ˜¯å¦åˆ›å»ºè¯¥beanã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå·¥ç¨‹ä¸­æœ‰ä¸€ä¸ªMagicBeanï¼Œä½ å¸Œæœ›åªæœ‰å½“magicç¯å¢ƒå˜é‡è¢«èµ‹å€¼æ—¶æ‰åˆ›å»ºMagicBeanï¼Œå¦åˆ™è¯¥Beançš„åˆ›å»ºå‡½æ•°è¢«å¿½ç•¥ã€‚</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Bean</span></span><br><span class="line"><span class="variable">@Conditional</span>(MagicExistsCondition.class)</span><br><span class="line">public MagicBean magicBean() &#123;</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">new</span> <span class="selector-tag">MagicBean</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¾‹å­è¡¨ç¤ºï¼šåªæœ‰å½“MagicExistsConditionç±»å·²ç»å­˜åœ¨æ—¶ï¼Œæ‰ä¼šåˆ›å»ºMagicBeanã€‚</p>
<p>@Conditionalæ³¨è§£çš„æºç åˆ—ä¸¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">package org.springframework.context.<span class="keyword">annotation</span>;</span><br><span class="line"></span><br><span class="line">import java.lang.<span class="keyword">annotation</span>.<span class="title">ElementType</span>;</span><br><span class="line">import java.lang.<span class="keyword">annotation</span>.<span class="title">Retention</span>;</span><br><span class="line">import java.lang.<span class="keyword">annotation</span>.<span class="title">RetentionPolicy</span>;</span><br><span class="line">import java.lang.<span class="keyword">annotation</span>.<span class="title">Target</span>;</span><br><span class="line">import org.springframework.context.<span class="keyword">annotation</span>.<span class="title">Condition</span>;</span><br><span class="line"></span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span><br><span class="line">public @interface Conditional &#123;</span><br><span class="line">    Class&lt;? extends Condition&gt;[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œä¼ å…¥@Conditionalæ³¨è§£çš„ç±»ä¸€å®šè¦å®ç°Conditionæ¥å£ï¼Œè¯¥æ¥å£æä¾›matchs()æ–¹æ³•â€”â€”å¦‚æœmatches()æ–¹æ³•è¿”å›trueï¼Œåˆ™è¢«@Conditionalæ³¨è§£ä¿®é¥°çš„beanå°±ä¼šåˆ›å»ºï¼Œå¦åˆ™å¯¹åº”çš„beanä¸ä¼šåˆ›å»ºã€‚</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒMagicExistsConditionç±»åº”è¯¥å®ç°Conditionæ¥å£ï¼Œå¹¶åœ¨matches()æ–¹æ³•ä¸­å®ç°å…·ä½“çš„åˆ¤æ–­æ¡ä»¶ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">package com.spring.sample.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.<span class="keyword">annotation</span>.<span class="title">Condition</span>;</span><br><span class="line">import org.springframework.context.<span class="keyword">annotation</span>.<span class="title">ConditionContext</span>;</span><br><span class="line">import org.springframework.core.env.Environment;</span><br><span class="line">import org.springframework.core.<span class="keyword">type</span>.AnnotatedTypeMetadata;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MagicExistsCondition</span> <span class="title">implements</span> <span class="title">Condition</span> &#123;</span></span><br><span class="line">    public boolean matches(ConditionContext conditionContext, AnnotatedTypeMetadata annotatedTypeMetadata) &#123;</span><br><span class="line">        Environment env = conditionContext.getEnvironment();</span><br><span class="line">        <span class="keyword">return</span> env.containsProperty(<span class="string">"magic"</span>); <span class="regexp">//</span>æ£€æŸ¥magicç¯å¢ƒå˜é‡æ˜¯å¦è¢«è®¾ç½®</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç ä¸­çš„matchs()æ–¹æ³•ç®€å•ä¸”æœ‰æ•ˆï¼šå®ƒé¦–å…ˆè·å–ç¯å¢ƒå˜é‡ï¼Œç„¶åå†åˆ¤æ–­ç¯å¢ƒå˜é‡ä¸­æ˜¯å¦å­˜åœ¨magicå±æ€§ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œmagicçš„å€¼æ˜¯å¤šå°‘å¹¶ä¸é‡è¦ï¼Œå®ƒåªè¦å­˜åœ¨å°±å¥½ã€‚</p>
<p>MagicExistsConditionçš„matchs()æ–¹æ³•æ˜¯é€šè¿‡ConditionContextè·å–äº†ç¯å¢ƒå®ä¾‹ã€‚matchs()æ–¹æ³•çš„å‚æ•°æœ‰ä¸¤ä¸ªï¼šConditionContextå’ŒAnnotatedTypeMetadataï¼Œåˆ†åˆ«çœ‹ä¸‹è¿™ä¸¤ä¸ªæ¥å£çš„æºç ï¼š</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ConditionContext</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ConditionContext</span> &#123;</span><br><span class="line">    <span class="function">BeanDefinitionRegistry <span class="title">getRegistry</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function">ConfigurableListableBeanFactory <span class="title">getBeanFactory</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function">Environment <span class="title">getEnvironment</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function">ResourceLoader <span class="title">getResourceLoader</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function">ClassLoader <span class="title">getClassLoader</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨ConditionContextæ¥å£å¯åšçš„äº‹æƒ…å¾ˆå¤šï¼Œåˆ—ä¸¾å¦‚ä¸‹ï¼š</p>
<p><li>é€šè¿‡getRegistry()æ–¹æ³•è¿”å›çš„BeanDefinitionRegistryå®ä¾‹ï¼Œå¯ä»¥æ£€æŸ¥beançš„å®šä¹‰ï¼›</li></p>
<p><li>é€šè¿‡getBeanFactory()æ–¹æ³•è¿”å›çš„ConfigurableListableBeanFactoryå®ä¾‹ï¼Œå¯ä»¥æ£€æŸ¥æŸä¸ªbeanæ˜¯å¦å­˜åœ¨äºåº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿˜å¯ä»¥è·å¾—è¯¥beançš„å±æ€§ï¼›</li></p>
<p><li>é€šè¿‡getEnvironment()æ–¹æ³•è¿”å›çš„Environmentå®ä¾‹ï¼Œå¯ä»¥æ£€æŸ¥æŒ‡å®šç¯å¢ƒå˜é‡æ˜¯å¦è¢«è®¾ç½®ï¼Œè¿˜å¯ä»¥è·å¾—è¯¥ç¯å¢ƒå˜é‡çš„å€¼ï¼›</li></p>
<p><li>é€šè¿‡getResourceLoader()æ–¹æ³•è¿”å›çš„ResourceLoaderå®ä¾‹ï¼Œå¯ä»¥å¾—åˆ°åº”ç”¨åŠ è½½çš„èµ„æºåŒ…å«çš„å†…å®¹ï¼›</li></p>
<p><li>é€šè¿‡getClassLoader()æ–¹æ³•è¿”å›çš„ClassLoaderå®ä¾‹ï¼Œå¯ä»¥æ£€æŸ¥æŸä¸ªç±»æ˜¯å¦å­˜åœ¨ã€‚</li></p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//AnnotatedTypeMetadata</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> AnnotatedTypeMetadata &#123;</span><br><span class="line">    <span class="built_in">boolean</span> isAnnotated(<span class="built_in">String</span> var1);</span><br><span class="line">    Map&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; getAnnotationAttributes(<span class="built_in">String</span> var1);</span><br><span class="line">    Map&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; getAnnotationAttributes(<span class="built_in">String</span> var1, <span class="built_in">boolean</span> var2);</span><br><span class="line">    MultiValueMap&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; getAllAnnotationAttributes(<span class="built_in">String</span> var1);</span><br><span class="line">    MultiValueMap&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; getAllAnnotationAttributes(<span class="built_in">String</span> var1, <span class="built_in">boolean</span> var2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡isAnnotated()æ–¹æ³•å¯ä»¥æ£€æŸ¥@Beanæ–¹æ³•æ˜¯å¦è¢«æŒ‡å®šçš„æ³¨è§£ç±»å‹ä¿®é¥°ï¼›é€šè¿‡å…¶ä»–æ–¹æ³•å¯ä»¥è·å¾—ä¿®é¥°@Beanæ–¹æ³•çš„æ³¨è§£çš„å±æ€§ã€‚</p>
<p>ä»Spring 4å¼€å§‹ï¼Œ@Profileæ³¨è§£ä¹Ÿåˆ©ç”¨@Conditionalæ³¨è§£å’ŒConditionæ¥å£è¿›è¡Œäº†é‡æ„ã€‚ä½œä¸ºåˆ†æ@Conditionalæ³¨è§£å’ŒConditionæ¥å£çš„å¦ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹åœ¨Spring 4ä¸­@Profileæ³¨è§£çš„å®ç°ã€‚</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="variable">@Target</span>(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span><br><span class="line"><span class="variable">@Documented</span></span><br><span class="line"><span class="variable">@Conditional</span>(&#123;ProfileCondition.class&#125;)</span><br><span class="line">public <span class="variable">@interface</span> Profile &#123;</span><br><span class="line">    <span class="selector-tag">String</span><span class="selector-attr">[]</span> <span class="selector-tag">value</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œ@Profileæ³¨è§£çš„å®ç°è¢«@Conditionalæ³¨è§£ä¿®é¥°ï¼Œå¹¶ä¸”ä¾èµ–äºProfileConditionç±»â€”â€”è¯¥ç±»æ˜¯Conditionæ¥å£çš„å®ç°ã€‚å¦‚ä¸‹åˆ—ä»£ç æ‰€ç¤ºï¼ŒProfileConditionåˆ©ç”¨ConditionContextå’ŒAnnotatedTypeMetadataä¸¤ä¸ªæ¥å£æä¾›çš„æ–¹æ³•è¿›è¡Œå†³ç­–ã€‚</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProfileCondition</span> <span class="keyword">implements</span> <span class="title">Condition</span> </span>&#123;</span><br><span class="line">    ProfileCondition() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) &#123;</span><br><span class="line">        <span class="keyword">if</span>(context.getEnvironment() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            MultiValueMap attrs = metadata.getAllAnnotationAttributes(Profile<span class="class">.<span class="keyword">class</span>.<span class="title">getName</span>());</span></span><br><span class="line"><span class="class">            <span class="title">if</span>(<span class="title">attrs</span> != <span class="title">null</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">Iterator</span> var4 = ((<span class="built_in">List</span>)attrs.<span class="keyword">get</span>(<span class="string">"value"</span>)).iterator();</span><br><span class="line"></span><br><span class="line">                <span class="built_in">Object</span> value;</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(!var4.hasNext()) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    value = var4.next();</span><br><span class="line">                &#125; <span class="keyword">while</span>(!context.getEnvironment().acceptsProfiles((<span class="built_in">String</span>[])((<span class="built_in">String</span>[])value)));</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;<span class="comment">//ä¼ ç»™@Profileæ³¨è§£çš„å‚æ•°å¯¹åº”çš„ç¯å¢ƒprofileså·²æ¿€æ´»</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">//é»˜è®¤ä¸ºtrue</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œè¿™ä»£ç å†™å¾—ä¸å¤ªå¥½ç†è§£:ProfileConditioné€šè¿‡AnnotatedTypeMetadataå®ä¾‹è·å–ä¸@Profileæ³¨è§£ç›¸å…³çš„æ‰€æœ‰æ³¨è§£å±æ€§ï¼›ç„¶åæ£€æŸ¥æ¯ä¸ªå±æ€§çš„å€¼ï¼ˆå­˜æ”¾åœ¨valueå®ä¾‹ä¸­ï¼‰ï¼Œå¯¹åº”çš„profilesåˆ«æ¿€æ´»â€”â€”å³context.getEnvironment().acceptsProfiles(((String[]) value))çš„è¿”å›å€¼æ˜¯trueï¼Œåˆ™matchs()æ–¹æ³•è¿”å›trueã€‚</p>
<p>Environmentç±»æä¾›äº†å¯ä»¥æ£€æŸ¥profilesçš„ç›¸å…³æ–¹æ³•ï¼Œç”¨äºæ£€æŸ¥å“ªä¸ªprofileè¢«æ¿€æ´»ï¼š</p>
<p><li>String[] getActiveProfiles()â€”â€”è¿”å›è¢«æ¿€æ´»çš„profilesæ•°ç»„ï¼›</li></p>
<p><li>String[] getDefaultProfiles()â€”â€”è¿”å›é»˜è®¤çš„profilesæ•°ç»„ï¼›</li></p>
<p><li>boolean acceptsProfiles(Stringâ€¦ profiles)â€”â€”å¦‚æœæŸä¸ªprofilesè¢«æ¿€æ´»ï¼Œåˆ™è¿”å›trueã€‚</li></p>
<p></p><h2>å¤„ç†è‡ªåŠ¨è£…é…çš„æ­§ä¹‰</h2><br>åœ¨ä¸€æ–‡ä¸­ä»‹ç»äº†å¦‚ä½•é€šè¿‡è‡ªåŠ¨è£…é…è®©Springè‡ªåŠ¨ç®€å†beanä¹‹é—´çš„ä¾èµ–å…³ç³»â€”â€”è‡ªåŠ¨è£…é…éå¸¸æœ‰ç”¨ï¼Œé€šè¿‡è‡ªåŠ¨è£…é…å¯ä»¥å‡å°‘å¤§é‡æ˜¾å¼é…ç½®ä»£ç ã€‚ä¸è¿‡ï¼Œè‡ªåŠ¨è£…é…ï¼ˆautowiringï¼‰è¦æ±‚beançš„åŒ¹é…å…·å¤‡å”¯ä¸€æ€§ï¼Œå¦åˆ™å°±ä¼šäº§ç”Ÿæ­§ä¹‰ï¼Œä»è€ŒæŠ›å‡ºå¼‚å¸¸ã€‚<p></p>
<p>ä¸¾ä¸ªä¾‹å­è¯´æ˜è‡ªåŠ¨è£…é…çš„æ­§ä¹‰æ€§ï¼Œå‡è®¾ä½ æœ‰å¦‚ä¸‹è‡ªåŠ¨è£…é…çš„ä»£ç ï¼š</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setDessert</span><span class="params">(Dessert dessert)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.dessert = dessert;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Dessertæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ‰ä¸‰ä¸ªå¯¹åº”çš„å®ç°ï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Component</span></span><br><span class="line">public class Cake implements Dessert &#123; ... &#125;</span><br><span class="line"><span class="variable">@Component</span></span><br><span class="line">public class Cookies implements Dessert &#123; ... &#125;</span><br><span class="line"><span class="variable">@Component</span></span><br><span class="line">public class IceCream implements Dessert &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºä¸Šè¿°ä¸‰ä¸ªç±»éƒ½è¢«@Componentæ³¨è§£ä¿®é¥°ï¼Œå› æ­¤éƒ½ä¼šè¢«component-scanningå‘ç°å¹¶åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºç±»å‹ä¸ºDessertçš„beanï¼›ç„¶åï¼Œå½“Springè¯•å›¾ä¸ºsetDessert()æ–¹æ³•è£…é…å¯¹åº”çš„Dessertå‚æ•°æ—¶ï¼Œå°±ä¼šé¢ä¸´å¤šä¸ªé€‰æ‹©ï¼›ç„¶åSpringå°±ä¼šæŠ›å‡ºå¼‚å¸¸â€”â€”NoUniqueBeanDefinitionExceptionã€‚</p>
<p>è™½ç„¶åœ¨å®é™…å¼€å‘ä¸­å¹¶ä¸ä¼šç»å¸¸é‡åˆ°è¿™ç§æ­§ä¹‰æ€§ï¼Œä½†æ˜¯å®ƒç¡®å®æ˜¯ä¸ªé—®é¢˜ï¼Œå¹¸è¿çš„æ˜¯Springä¹Ÿæä¾›äº†å¯¹åº”çš„è§£å†³åŠæ³•ã€‚</p>
<p></p><h3> @PrimaryæŒ‡å®šä¼˜å…ˆbean</h3><br>åœ¨å®šä¹‰beanæ—¶ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šä¸€ä¸ªä¼˜å…ˆçº§é«˜çš„beanæ¥æ¶ˆé™¤è‡ªåŠ¨è£…é…è¿‡ç¨‹ä¸­é‡åˆ°çš„æ­§ä¹‰é—®é¢˜ã€‚<p></p>
<p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå¯ä»¥é€‰æ‹©ä¸€ä¸ªæœ€é‡è¦çš„Beanï¼Œç”¨@Primaryæ³¨è§£ä¿®é¥°ï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Component</span></span><br><span class="line"><span class="variable">@Primary</span></span><br><span class="line">public class IceCream implements Dessert &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨è‡ªåŠ¨æ‰«æï¼Œè€Œæ˜¯ä½¿ç”¨åŸºäºJavaçš„æ˜¾å¼é…ç½®æ–‡ä»¶ï¼Œåˆ™å¦‚ä¸‹å®šä¹‰@Beanæ–¹æ³•ï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Bean</span></span><br><span class="line"><span class="variable">@Primary</span></span><br><span class="line">public Dessert iceCream() &#123;</span><br><span class="line">  <span class="selector-tag">return</span> <span class="selector-tag">new</span> <span class="selector-tag">IceCream</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½¿ç”¨åŸºäºXMLæ–‡ä»¶çš„æ˜¾å¼é…ç½®ï¼Œåˆ™å¦‚ä¸‹å®šä¹‰ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">"iceCream"</span></span><br><span class="line">             <span class="attribute">class</span>=<span class="string">"com.dasserteater.IceCream"</span></span><br><span class="line">             <span class="attribute">primary</span>=<span class="string">"true"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>ä¸è®ºå“ªç§å½¢å¼ï¼Œæ•ˆæœéƒ½ä¸€æ ·ï¼šå‘Šè¯‰Springé€‰æ‹©primary beanæ¥æ¶ˆé™¤æ­§ä¹‰ã€‚ä¸è¿‡ï¼Œå½“åº”ç”¨ä¸­æŒ‡å®šå¤šä¸ªPrimary beanæ—¶ï¼ŒSpringåˆä¸ä¼šé€‰æ‹©äº†ï¼Œå†æ¬¡é‡åˆ°æ­§ä¹‰ã€‚Springè¿˜æä¾›äº†åŠŸèƒ½æ›´å¼ºå¤§çš„æ­§ä¹‰æ¶ˆé™¤æœºåˆ¶â€”â€”@Qualifiersæ³¨è§£ã€‚</p>
<p></p><h3>@QualifieræŒ‡å®šbeançš„ID</h3><br>@Qualifieræ³¨è§£å¯ä»¥è·Ÿ@Autowiredæˆ–@Injectä¸€èµ·ä½¿ç”¨ï¼ŒæŒ‡å®šéœ€è¦å¯¼å…¥çš„beançš„IDï¼Œä¾‹å¦‚ï¼Œä¸Šé¢ä¾‹å­ä¸­çš„setDessert()æ–¹æ³•å¯ä»¥è¿™ä¹ˆå†™ï¼š<p></p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier</span>(<span class="string">"iceCream"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setDessert</span><span class="params">(Dessert dessert)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.dessert = dessert;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ªbeanéƒ½å…·å¤‡å”¯ä¸€çš„IDï¼Œå› æ­¤æ­¤å¤„å½»åº•æ¶ˆé™¤äº†æ­§ä¹‰ã€‚</p>
<p>å¦‚æœè¿›ä¸€æ­¥æ·±ç©¶ï¼Œ@Qualifier(â€œiceCreamâ€)è¡¨ç¤ºä»¥â€iceCreamâ€å­—ç¬¦ä¸²ä½œä¸ºqualifierçš„beanã€‚æ¯ä¸ªbeanéƒ½æœ‰ä¸€ä¸ªqualifierï¼Œå†…å®¹ä¸è¯¥beançš„IDç›¸åŒã€‚å› æ­¤ï¼Œä¸Šè¿°è£…é…çš„å®é™…å«ä¹‰æ˜¯ï¼šsetDessert()æ–¹æ³•ä¼šè£…é…ä¸€ä¸ªä»¥â€iceCreamâ€ä¸ºqualifierçš„beanï¼Œåªä¸è¿‡ç¢°å·§æ˜¯è¯¥beançš„IDä¹Ÿæ˜¯iceCreamã€‚</p>
<p>ä»¥é»˜è®¤çš„beançš„IDä½œä¸ºqualifieréå¸¸ç®€å•ï¼Œä½†æ˜¯ä¹Ÿä¼šå¼•å‘æ–°çš„é—®é¢˜ï¼šå¦‚æœå°†æ¥å¯¹IceCreamç±»è¿›è¡Œé‡æ„ï¼Œå®ƒçš„ç±»åå‘ç”Ÿæ”¹å˜ï¼ˆä¾‹å¦‚Gelatoï¼‰æ€ä¹ˆåŠï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥beanå¯¹åº”çš„IDå’Œé»˜è®¤çš„qualifierå°†å˜ä¸ºâ€gelatoâ€ï¼Œç„¶åè‡ªåŠ¨è£…é…å°±ä¼šå¤±è´¥ã€‚</p>
<p>é—®é¢˜çš„å…³é”®åœ¨äºï¼šä½ éœ€è¦æŒ‡å®šä¸€ä¸ªqualifierï¼Œè¯¥å†…å®¹ä¸ä¼šå—ç›®æ ‡ç±»çš„ç±»åçš„é™åˆ¶å’Œå½±å“ã€‚</p>
<p><strong>å¼€å‘è€…å¯ä»¥ç»™æŸä¸ªbeanè®¾å®šè‡ªå®šä¹‰çš„qualifier</strong>ï¼Œå½¢å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Component</span></span><br><span class="line"><span class="variable">@Qualifier</span>(<span class="string">"cold"</span>)</span><br><span class="line">public class IceCream implements Dessert &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œåœ¨è¦æ³¨å…¥çš„åœ°æ–¹ä¹Ÿä½¿ç”¨â€coldâ€ä½œä¸ºqualifieræ¥è·å¾—è¯¥beanï¼š</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier</span>(<span class="string">"cold"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setDessert</span><span class="params">(Dessert dessert)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.dessert = dessert;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å³ä½¿åœ¨JavaConfigä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨@QualifieræŒ‡å®šæŸä¸ªbeançš„qualifierï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Bean</span></span><br><span class="line"><span class="variable">@Qualifier</span>(<span class="string">"cold"</span>)</span><br><span class="line">public Dessert iceCream() &#123;</span><br><span class="line">  <span class="selector-tag">return</span> <span class="selector-tag">new</span> <span class="selector-tag">IceCream</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä½¿ç”¨è‡ªå®šä¹‰çš„@Qualifierå€¼æ—¶ï¼Œæœ€å¥½é€‰æ‹©ä¸€ä¸ªå«ä¹‰å‡†ç¡®çš„åè¯ï¼Œä¸è¦éšæ„ä½¿ç”¨åè¯ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æè¿°IceCreamä¸ºâ€coldâ€beanï¼Œåœ¨è£…é…æ—¶ï¼Œå¯ä»¥è¯»ä½œï¼šç»™æˆ‘æ¥ä¸€ä»½cold dessertï¼Œæ°å¥½æŒ‡å®šä¸ºIceCreamã€‚ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬æŠŠCakeå«ä½œâ€softâ€ï¼ŒæŠŠCookies*å«ä½œâ€crispyâ€ã€‚</p>
<p><strong>ä½¿ç”¨è‡ªå®šä¹‰çš„qualifiersä¼˜äºä½¿ç”¨åŸºäºbeançš„IDçš„é»˜è®¤qualifier</strong>ï¼Œä½†æ˜¯å½“ä½ æœ‰å¤šä¸ªbeanå…±äº«åŒä¸€ä¸ªqualifieræ—¶ï¼Œè¿˜æ˜¯ä¼šæœ‰æ­§ä¹‰ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ å®šä¹‰ä¸€ä¸ªæ–°çš„Dessertbeanï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Component</span></span><br><span class="line"><span class="variable">@Qualifier</span>(<span class="string">"cold"</span>)</span><br><span class="line">public class Popsicle implements Dessert &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ä½ åˆæœ‰ä¸¤ä¸ªâ€coldâ€ä¸ºqualifierçš„beanäº†ï¼Œå†æ¬¡é‡åˆ°æ­§ä¹‰ï¼šæœ€ç›´ç™½çš„æƒ³æ³•æ˜¯å¤šå¢åŠ ä¸€ä¸ªé™åˆ¶æ¡ä»¶ï¼Œä¾‹å¦‚IceCreamä¼šæˆä¸ºä¸‹é¢çš„å®šä¹‰ï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Component</span></span><br><span class="line"><span class="variable">@Qualifier</span>(<span class="string">"cold"</span>)</span><br><span class="line"><span class="variable">@Qualifier</span>(<span class="string">"creamy"</span>)</span><br><span class="line">public class IceCream implements Dessert &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>è€ŒPosicleç±»åˆ™å¦‚ä¸‹å®šä¹‰ï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Component</span></span><br><span class="line"><span class="variable">@Qualifier</span>(<span class="string">"cold"</span>)</span><br><span class="line"><span class="variable">@Qualifier</span>(<span class="string">"fruity"</span>)</span><br><span class="line">public class Popsicle implements Dessert &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è£…é…beançš„æ—¶å€™ï¼Œåˆ™éœ€è¦ä½¿ç”¨ä¸¤ä¸ªé™åˆ¶æ¡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Bean</span></span><br><span class="line"><span class="variable">@Qualifier</span>(<span class="string">"cold"</span>)</span><br><span class="line"><span class="variable">@Qualifier</span>(<span class="string">"creamy"</span>)</span><br><span class="line">public Dessert iceCream() &#123;</span><br><span class="line">  <span class="selector-tag">return</span> <span class="selector-tag">new</span> <span class="selector-tag">IceCream</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸ªå°é—®é¢˜ï¼šJava ä¸å…è®¸åœ¨åŒä¸€ä¸ªitemä¸ŠåŠ å¤šä¸ªç›¸åŒç±»å‹çš„æ³¨è§£ï¼ˆJava 8å·²ç»æ”¯æŒï¼‰ï¼Œä½†æ˜¯è¿™ç§å†™æ³•æ˜¾ç„¶å¾ˆå•°å—¦ã€‚</p>
<p>è§£å†³åŠæ³•æ˜¯ï¼šé€šè¿‡å®šä¹‰è‡ªå·±çš„qualifieræ³¨è§£ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª@Coldæ³¨è§£æ¥ä»£æ›¿@Qualifier(â€œcoldâ€)ï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Target</span>(&#123;ElementType.CONSTRUCTOR, ElementType.FIELD,</span><br><span class="line">                  ElementType.METHOD, ElementType.TYPE&#125;)</span><br><span class="line"><span class="variable">@Rentention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="variable">@Qualifier</span></span><br><span class="line">public <span class="variable">@interface</span> Cold &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥åˆ›å»ºä¸€ä¸ª@Creamyæ³¨è§£æ¥ä»£æ›¿@Qualifier(â€œcreamyâ€)ï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Target</span>(&#123;ElementType.CONSTRUCTOR, ElementType.FIELD,</span><br><span class="line">                  ElementType.METHOD, ElementType.TYPE&#125;)</span><br><span class="line"><span class="variable">@Rentention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="variable">@Qualifier</span></span><br><span class="line">public <span class="variable">@interface</span> Creamy &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œå°±å¯ä»¥ä½¿ç”¨@Coldå’Œ@Creamyä¿®é¥°IceCreamç±»ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Component</span></span><br><span class="line"><span class="variable">@Cold</span></span><br><span class="line"><span class="variable">@Creamy</span></span><br><span class="line">public class IceCream implements Dessert &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>ç±»ä¼¼çš„ï¼Œå¯ä»¥ä½¿ç”¨@Coldå’Œ@Fruityä¿®é¥°Popsicleç±»ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Component</span></span><br><span class="line"><span class="variable">@Cold</span></span><br><span class="line"><span class="variable">@Fruity</span></span><br><span class="line">public class Popsicle implements Dessert &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œåœ¨è£…é…çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨@Coldå’Œ@Creamyé™å®šIceCreamç±»å¯¹åº”çš„beanï¼š</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Cold</span></span><br><span class="line"><span class="meta">@Creamy</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setDessert</span><span class="params">(Dessert dessert)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.dessert = dessert;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p></p><h2>beançš„ä½œç”¨åŸŸ</h2><br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringåº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„beanéƒ½æ˜¯å•ä¾‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®ºç»™æŸä¸ªbeanè¢«å¤šå°‘æ¬¡è£…é…ç»™å…¶ä»–beanï¼Œéƒ½æ˜¯æŒ‡åŒä¸€ä¸ªå®ä¾‹ã€‚<p></p>
<p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå•ä¾‹beanå¾ˆå¥½ç”¨ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡æ²¡æœ‰çŠ¶æ€å¹¶ä¸”å¯ä»¥åœ¨åº”ç”¨ä¸­é‡å¤ä½¿ç”¨ï¼Œé‚£ä¹ˆé’ˆå¯¹è¯¥å¯¹è±¡çš„åˆå§‹åŒ–å’Œå†…å­˜ç®¡ç†å¼€é”€éå¸¸å°ã€‚</p>
<p>ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹ä½ å¿…é¡»ä½¿ç”¨æŸä¸­å¯å˜å¯¹è±¡æ¥ç»´æŠ¤å‡ ç§ä¸åŒçš„çŠ¶æ€ï¼Œå› æ­¤å½¢æˆéçº¿ç¨‹å®‰å…¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŠŠç±»å®šä¹‰ä¸ºå•ä¾‹å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„â€”â€”è¯¥å¯¹è±¡åœ¨é‡å…¥ä½¿ç”¨çš„æ—¶å€™å¯èƒ½é‡åˆ°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<p>Springå®šä¹‰äº†å‡ ç§beançš„ä½œç”¨åŸŸï¼Œåˆ—ä¸¾å¦‚ä¸‹ï¼š</p>
<p><li>Singletonâ€”â€”åœ¨æ•´ä¸ªåº”ç”¨ä¸­åªæœ‰ä¸€ä¸ªbeançš„å®ä¾‹ï¼›</li></p>
<p><li>Prototypeâ€”â€”æ¯æ¬¡æŸä¸ªbeanè¢«è£…é…ç»™å…¶ä»–beanæ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼›</li></p>
<p><li>Sessionâ€”â€”åœ¨webåº”ç”¨ä¸­ï¼Œåœ¨æ¯æ¬¡ä¼šè¯è¿‡ç¨‹ä¸­åªåˆ›å»ºä¸€ä¸ªbeançš„å®</li><li>ä¾‹ï¼›<br>Requestâ€”â€”åœ¨webåº”ç”¨ä¸­ï¼Œåœ¨æ¯æ¬¡httpè¯·æ±‚ä¸­åˆ›å»ºä¸€ä¸ªbeançš„å®ä¾‹ã€‚<br>SingletonåŸŸæ˜¯é»˜è®¤çš„ä½œç”¨åŸŸï¼Œå¦‚å‰æ‰€è¿°ï¼Œå¯¹äºå¯å˜ç±»å‹æ¥è¯´å¹¶ä¸ç†æƒ³ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Scopeæ³¨è§£â€”â€”å’Œ@Componentæˆ–@Beanæ³¨è§£éƒ½å¯ä»¥ä½¿ç”¨ã€‚</li></p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä½ ä¾èµ–component-scanningå‘ç°å’Œå®šä¹‰beanï¼Œåˆ™å¯ä»¥ç”¨å¦‚ä¸‹ä»£ç å®šä¹‰prototype beanï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Component</span></span><br><span class="line"><span class="variable">@Scope</span>(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</span><br><span class="line">public class Notepad&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>é™¤äº†ä½¿ç”¨SCOPE_PROTOTYPEå­—ç¬¦ä¸²æŒ‡å®šbeançš„ä½œç”¨åŸŸï¼Œè¿˜å¯ä»¥ä½¿ç”¨@Scope(â€œprototypeâ€)ï¼Œä½†ä½¿ç”¨ConfigurableBeanFactory.SCOPE_PROTOTYPEæ›´å®‰å…¨ï¼Œä¸å®¹æ˜“é‡åˆ°æ‹¼å†™é”™è¯¯ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœä½ ä½¿ç”¨JavaConfigå®šä¹‰Notepadçš„beanï¼Œä¹Ÿå¯ä»¥ç»™å‡ºä¸‹åˆ—å®šä¹‰ï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Bean</span></span><br><span class="line"><span class="variable">@Scope</span>(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</span><br><span class="line">public Notepad notepad() &#123;</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">new</span> <span class="selector-tag">Notepad</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ ä½¿ç”¨xmlæ–‡ä»¶å®šä¹‰Notepadçš„beanï¼Œåˆ™æœ‰å¦‚ä¸‹å®šä¹‰ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">"notepad"</span></span><br><span class="line">            <span class="attribute">class</span>=<span class="string">"com.myapp.Notepad"</span></span><br><span class="line">            <span class="attribute">scope</span>=<span class="string">"prototype"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>æ— è®ºä½ æœ€åé‡‡å–ä¸Šè¿°ä¸‰ç§å®šä¹‰æ–¹å¼çš„å“ªä¸€ç§å®šä¹‰prototypeç±»å‹çš„beanï¼Œæ¯æ¬¡Notepadè¢«è£…é…åˆ°å…¶ä»–beanæ—¶ï¼Œéƒ½ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚</p>
<p></p><h3>requestå’Œsessionä½œç”¨åŸŸ</h3><br>åœ¨Webåº”ç”¨ä¸­ï¼Œæœ‰æ—¶éœ€è¦åœ¨æŸä¸ªrequestæˆ–è€…sessionçš„ä½œç”¨åŸŸèŒƒå›´å†…å…±äº«åŒä¸€ä¸ªbeançš„å®ä¾‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ªå…¸å‹çš„ç”µå­å•†åŠ¡åº”ç”¨ä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ªbeanä»£è¡¨ç”¨æˆ·çš„è´­ç‰©è½¦ï¼Œå¦‚æœè´­ç‰©è½¦æ˜¯å•ä¾‹å¯¹è±¡ï¼Œåˆ™æ‰€æœ‰çš„ç”¨æˆ·ä¼šæŠŠè‡ªå·±è¦ä¹°çš„å•†å“æ·»åŠ åˆ°åŒä¸€ä¸ªè´­ç‰©è½¦ä¸­ï¼›å¦å¤–ï¼Œå¦‚æœè´­ç‰©è½¦beanè®¾ç½®ä¸ºprototypeï¼Œåˆ™åœ¨åº”ç”¨ä¸­æŸä¸ªæ¨¡å—ä¸­æ·»åŠ çš„å•†å“åœ¨å¦ä¸€ä¸ªæ¨¡å—ä¸­å°†ä¸èƒ½ä½¿ç”¨ã€‚<p></p>
<p>å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œä½¿ç”¨session scopeæ›´åˆé€‚ï¼Œå› ä¸ºä¸€ä¸ªä¼šè¯ï¼ˆsessionï¼‰å”¯ä¸€å¯¹åº”ä¸€ä¸ªç”¨æˆ·ï¼Œå¯ä»¥é€šè¿‡ä¸‹åˆ—ä»£ç ä½¿ç”¨session scope:</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Bean</span></span><br><span class="line"><span class="variable">@Scope</span>(value=WebApplicationContext.SCOPE_SESSION,</span><br><span class="line">                proxyMode=ScopedProxyMode.INTERFACES)</span><br><span class="line">public ShoppingCart cart() &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œä½ é€šè¿‡valueå±æ€§è®¾ç½®äº†WebApplicationContext.SCOPE_SESSIONï¼Œè¿™å‘Šè¯‰Springä¸ºwebåº”ç”¨ä¸­çš„æ¯ä¸ªsessionåˆ›å»ºä¸€ä¸ªShoppingCartbeançš„å®ä¾‹ã€‚åœ¨æ•´ä¸ªåº”ç”¨ä¸­ä¼šæœ‰å¤šä¸ªShoppingCartå®ä¾‹ï¼Œä½†æ˜¯åœ¨æŸä¸ªä¼šè¯çš„ä½œç”¨åŸŸä¸­ShoppingCartæ˜¯å•ä¾‹çš„ã€‚</p>
<p>è¿™é‡Œè¿˜ç”¨proxyModeå±æ€§è®¾ç½®äº†ScopedProxyMode.INTERFACESå€¼ï¼Œè¿™æ¶‰åŠåˆ°å¦ä¸€ä¸ªé—®é¢˜ï¼šæŠŠrequest/session scopeçš„beanè£…é…åˆ°singleton scopeçš„beanæ—¶ä¼šé‡åˆ°ã€‚é¦–å…ˆçœ‹ä¸‹è¿™ä¸ªé—®é¢˜çš„è¡¨ç°ã€‚</p>
<p>å‡è®¾åœ¨åº”ç”¨ä¸­éœ€è¦å°†ShoppingCartbeanè£…é…ç»™å•ä¾‹StoreServicebeançš„setteræ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StoreService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShoppingCart</span><span class="params">(ShoppingCart shoppingCart)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shoppingCart = shoppingCart;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºStoreServiceæ˜¯å•ä¾‹beanï¼Œå› æ­¤åœ¨Springåº”ç”¨ä¸Šä¸‹æ–‡åŠ è½½æ—¶è¯¥beanå°±ä¼šè¢«åˆ›å»ºã€‚åœ¨åˆ›å»ºè¿™ä¸ªbeanæ—¶ ï¼ŒSpringä¼šè¯•å›¾è£…é…å¯¹åº”çš„ShoppingCartbeanï¼Œä½†æ˜¯è¿™ä¸ªbeanæ˜¯session scopeçš„ï¼Œç›®å‰è¿˜æ²¡æœ‰åˆ›å»ºâ€”â€”åªæœ‰åœ¨ç”¨æˆ·è®¿é—®æ—¶å¹¶åˆ›å»ºsessionæ—¶ï¼Œæ‰ä¼šåˆ›å»ºShoppingCartbeanã€‚</p>
<p>è€Œä¸”ï¼Œä¹‹åè‚¯å®šä¼šæœ‰å¤šä¸ªShoppingCartbeanï¼šæ¯ä¸ªç”¨æˆ·ä¸€ä¸ªã€‚ç†æƒ³çš„æƒ…æ™¯æ˜¯ï¼šåœ¨éœ€è¦StoreServiceæ“ä½œè´­ç‰©è½¦æ—¶ï¼ŒStoreServiceèƒ½å¤Ÿå’ŒShoppingCartbeanæ­£å¸¸å·¥ä½œã€‚</p>
<p>é’ˆå¯¹è¿™ç§éœ€æ±‚ï¼ŒSpringåº”è¯¥ç»™StoreServicebeanè£…é…ä¸€ä¸ªShoppingCartbeançš„ä»£ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä»£ç†ç±»å¯¹å¤–æš´éœ²çš„æ¥å£å’ŒShoppingCartä¸­çš„ä¸€æ ·ï¼Œç”¨äºå‘Šè¯‰StoreServiceå…³äºShoppingCartçš„æ¥å£ä¿¡æ¯â€”â€”å½“StoreServiceè°ƒç”¨å¯¹åº”çš„æ¥å£æ—¶ï¼Œä»£ç†é‡‡å–å»¶è¿Ÿè§£æç­–ç•¥ï¼Œå¹¶æŠŠè°ƒç”¨å§”æ´¾ç»™å®é™…çš„session-scoped ShoppingCartbeanã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/44770-c117d67ea67a9f2a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" height="300px"></p>
<p>Scoped proxies enable deferred injected of request- and session-coped beans<br>å› ä¸ºShoppingCartæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå› æ­¤è¿™é‡Œå·¥ä½œæ­£å¸¸ï¼Œä½†æ˜¯ï¼Œå¦‚æœShoppingCartæ˜¯å…·ä½“çš„ç±»ï¼Œåˆ™Springä¸èƒ½åˆ›å»ºåŸºäºæ¥å£çš„ä»£ç†ã€‚è¿™é‡Œå¿…é¡»ä½¿ç”¨CGLibåˆ›å»ºclass-basedçš„beanï¼Œå³ä½¿ç”¨ScopedProxyMode.TARGET_CLASSæŒ‡ç¤ºä»£ç†ç±»åº”è¯¥åŸºç¡€è‡ªç›®æ ‡ç±»ã€‚</p>
<p>è¿™é‡Œä½¿ç”¨session scopeä½œä¸ºä¾‹å­ï¼Œåœ¨request scopeä¸­ä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ï¼Œå½“ç„¶è§£å†³åŠæ³•ä¹Ÿç›¸åŒã€‚</p>
<p></p><h3> åœ¨XMLæ–‡ä»¶ä¸­å®šä¹‰scopedä»£ç†</h3><br>å¦‚æœä½ åœ¨xmlé…ç½®æ–‡ä»¶ä¸­å®šä¹‰session-scopedæˆ–è€…request-scoped beanï¼Œåˆ™ä¸èƒ½ä½¿ç”¨@Scopeæ³¨è§£ä»¥åŠå¯¹åº”çš„proxyModeå±æ€§ã€‚<bean>å…ƒç´ çš„scopeå±æ€§å¯ä»¥ç”¨æ¥æŒ‡å®šbeançš„scopeï¼Œä½†æ˜¯å¦‚ä½•æŒ‡å®šä»£ç†æ¨¡å¼ï¼Ÿ<p></p>
<p>å¯ä»¥ä½¿ç”¨Spring aopæŒ‡å®šä»£ç†æ¨¡å¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;bean id=<span class="string">"cart"</span></span><br><span class="line">            <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.myapp.ShoppingCart"</span></span><br><span class="line">            scope=<span class="string">"session"</span></span><br><span class="line">      &lt;aop: scoped-proxy /&gt;</span><br><span class="line">&lt;<span class="regexp">/bean&gt;</span></span><br></pre></td></tr></table></figure>
<p>&lt;aop: scoped-proxy&gt;åœ¨XMLé…ç½®æ–¹å¼æ‰®æ¼”çš„è§’è‰²ä¸proxyModeå±æ€§åœ¨æ³¨è§£é…ç½®æ–¹å¼ä¸­çš„ç›¸åŒï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œé»˜è®¤ä½¿ç”¨CGLIBåº“åˆ›å»ºä»£ç†ï¼Œå› æ­¤ï¼Œå¦‚æœéœ€è¦åˆ›å»ºæ¥å£ä»£ç†ï¼Œåˆ™éœ€è¦è®¾ç½®proxy-target-classå±æ€§ä¸ºfalse:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;bean id=<span class="string">"cart"</span></span><br><span class="line">            <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.myapp.ShoppingCart"</span></span><br><span class="line">            scope=<span class="string">"session"</span></span><br><span class="line">      &lt;aop: scoped-proxy proxy-target-<span class="class"><span class="keyword">class</span></span>=<span class="string">"false"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/bean&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†ä½¿ç”¨&lt;aop: scoped-proxy&gt;å…ƒç´ ï¼Œéœ€è¦åœ¨XMLé…ç½®æ–‡ä»¶ä¸­å®šä¹‰Springçš„aopåå­—ç©ºé—´ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;?xml <span class="attribute">version</span>=<span class="string">"1.0"</span> <span class="attribute">encoding</span>=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans <span class="attribute">xmlns</span>=<span class="string">"htttp://www.springframework.org/schema/beans"</span></span><br><span class="line">              xmlns:<span class="attribute">xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">              xmlns:<span class="attribute">aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span><br><span class="line">              xsi:<span class="attribute">schemaLocations</span>=<span class="string">"</span></span><br><span class="line"><span class="string">                   http://www.springframework.org/schema/aop</span></span><br><span class="line"><span class="string">                   http://www.springframework.org/schema/aop/spring-aop.xsd</span></span><br><span class="line"><span class="string">                   http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">                   http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span><br><span class="line">    <span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span></span><br></pre></td></tr></table></figure>
<p></p><h2>è¿è¡Œæ—¶å€¼æ³¨å…¥</h2><br>ä¸€èˆ¬è€Œè¨€ï¼Œè®¨è®ºä¾èµ–æ³¨å…¥å’Œè£…é…æ—¶ï¼Œæˆ‘ä»¬å¤šå…³æ³¨çš„æ˜¯å¦‚ä½•ï¼ˆhowï¼‰å®ç°ä¾èµ–æ³¨å…¥ï¼ˆæ„é€ å‡½æ•°ã€setteræ–¹æ³•ï¼‰ï¼Œå³å¦‚ä½•å»ºç«‹å¯¹è±¡ä¹‹é—´çš„è”ç³»ã€‚<p></p>
<p>ä¾èµ–æ³¨å…¥çš„å¦ä¸€ä¸ªæ–¹é¢æ˜¯ä½•æ—¶ï¼ˆwhenï¼‰å°†å€¼è£…é…ç»™beançš„å±æ€§æˆ–è€…æ„é€ å‡½æ•°ã€‚åœ¨è£…é…beanâ€”ä¾èµ–æ³¨å…¥çš„æœ¬è´¨ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œäº†å¾ˆå¤šå€¼è£…é…çš„ä»»åŠ¡ï¼Œä¾‹å¦‚æœ‰å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">CompactDisc <span class="title">sgtPeppers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> BlankDisc(</span><br><span class="line">             <span class="string">"Sgt. Pepper's Lonely Hearts Club Band"</span>,</span><br><span class="line">             <span class="string">"The Beatles"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§ç¡¬ç¼–ç çš„æ–¹å¼æœ‰æ—¶å¯ä»¥ï¼Œæœ‰æ—¶å´éœ€è¦é¿å…ç¡¬ç¼–ç â€”â€”åœ¨è¿è¡Œæ—¶å†³å®šéœ€è¦æ³¨å…¥çš„å€¼ã€‚Springæä¾›ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®ç°è¿è¡Œæ—¶æ³¨å…¥ï¼š</p>
<p><li>Property placeholders</li></p>
<p><li>he Spring Expression Language(SpEL)</li></p>
<p></p><h3>æ³¨å…¥å¤–éƒ¨çš„å€¼</h3><br>åœ¨Springä¸­è§£æå¤–éƒ¨å€¼çš„æœ€å¥½æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶åé€šè¿‡Springçš„ç¯å¢ƒå®ä¾‹è·å–é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®é¡¹çš„å€¼ã€‚ä¾‹å¦‚ï¼Œä¸‹åˆ—ä»£ç å±•ç¤ºå¦‚ä½•åœ¨Spring é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨å¤–éƒ¨é…ç½®é¡¹çš„å€¼ã€‚<p></p>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">package com.spring.sample.config;</span><br><span class="line"></span><br><span class="line">import com.spring.sample.soundsystem.CompactDisc;</span><br><span class="line">import org.springframework.beans.factory.<span class="keyword">annotation</span>.<span class="title">Autowired</span>;</span><br><span class="line">import org.springframework.context.<span class="keyword">annotation</span>.<span class="title">Bean</span>;</span><br><span class="line">import org.springframework.context.<span class="keyword">annotation</span>.<span class="title">Configuration</span>;</span><br><span class="line">import org.springframework.context.<span class="keyword">annotation</span>.<span class="title">PropertySource</span>;</span><br><span class="line">import org.springframework.core.env.Environment;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@PropertySource(<span class="string">"classpath:/app.properties"</span>)</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ExpressiveConfig</span> &#123;</span></span><br><span class="line">        @Autowired</span><br><span class="line">        Environment env; </span><br><span class="line"></span><br><span class="line">       @Bean</span><br><span class="line">        public CompactDisc disc() &#123;</span><br><span class="line">              <span class="keyword">return</span> new BlankDisc(env.getProperty(<span class="string">"disc.title"</span>),</span><br><span class="line">                env.getProperty(<span class="string">"disc.artist"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œï¼Œ@PropertySourceæ³¨è§£å¼•ç”¨çš„é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">disc.<span class="attr">title=Sgt.</span> Pepper's Lonely Hearts Club Band</span><br><span class="line">disc.<span class="attr">artist=The</span> Beatles</span><br></pre></td></tr></table></figure>
<p>å±æ€§æ–‡ä»¶è¢«åŠ è½½åˆ°Springçš„Environmentå®ä¾‹ä¸­ï¼Œç„¶åé€šè¿‡getProperty()æ–¹æ³•è§£æå¯¹åº”é…ç½®é¡¹çš„å€¼ã€‚</p>
<p><strong>åœ¨Environmentç±»ä¸­ï¼ŒgetProperty()æ–¹æ³•æœ‰å¦‚ä¸‹å‡ ç§é‡è½½å½¢å¼</strong>ï¼š</p>
<p><li>String getProperty(String var1);</li></p>
<p><li>String getProperty(String var1, String var2);</li></p>
<p><li><t> T getProperty(String var1, Class<t> var2);</t></t></li></p>
<p><li><t> T getProperty(String var1, Class<t> var2, T var3);</t></t></li></p>
<p>å‰ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯è¿”å›Stringå€¼ï¼Œåˆ©ç”¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¯ä»¥è®¾ç½®é»˜è®¤å€¼ï¼›åä¸¤ä¸ªæ–¹æ³•å¯ä»¥æŒ‡å®šè¿”å›å€¼çš„ç±»å‹ï¼Œä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾ä½ éœ€è¦ä»è¿æ¥æ± ä¸­è·å–è¿æ¥ä¸ªæ•°ï¼Œå¦‚æœä½ ä½¿ç”¨å‰ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ™è¿”å›çš„å€¼æ˜¯Stringï¼Œä½ éœ€è¦æ‰‹åŠ¨å®Œæˆç±»å‹è½¬æ¢ï¼›ä½†æ˜¯ä½¿ç”¨åä¸¤ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”±Springè‡ªåŠ¨å®Œæˆè¿™ä¸ªè½¬æ¢ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">int<span class="built_in"> connection </span>= env.getProperty(<span class="string">"db.connection.count"</span>, Integer.class, 30)</span><br></pre></td></tr></table></figure>
<p>é™¤äº†getProperty()æ–¹æ³•ï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥è·å¾—é…ç½®é¡¹çš„å€¼ï¼Œå¦‚æœä¸è®¾ç½®é»˜è®¤å€¼å‚æ•°ï¼Œåˆ™åœ¨å¯¹åº”çš„é…ç½®é¡¹ä¸å­˜åœ¨çš„æƒ…å†µä¸‹å¯¹åº”çš„å±æ€§ä¼šé…ç½®ä¸ºnullï¼Œå¦‚æœä½ ä¸å¸Œæœ›è¿™ç§æƒ…å†µå‘ç”Ÿâ€”â€”å³è¦æ±‚æ¯ä¸ªé…ç½®é¡¹å¿…é¡»å­˜åœ¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨getRequiredProperty()æ–¹æ³•ï¼š</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">CompactDisc <span class="title">disc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> BlankDisc(</span><br><span class="line">            env.getRequiredProperty(<span class="string">"disc.title"</span>),</span><br><span class="line">            env.getRequiredProperty(<span class="string">"disc.artist"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå¦‚æœdisc.titleæˆ–è€…disc.artisté…ç½®é¡¹ä¸å­˜åœ¨ï¼ŒSpringéƒ½ä¼šæŠ›å‡ºIllegalStateExceptionå¼‚å¸¸ã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›æ£€æŸ¥æŸä¸ªé…ç½®é¡¹æ˜¯å¦å­˜åœ¨ï¼Œåˆ™å¯ä»¥è°ƒç”¨containsProperty()æ–¹æ³•ï¼š<code>boolean titleExists = env.containsProperty(â€œdisc.titleâ€);</code>ã€‚å¦‚æœä½ éœ€è¦å°†ä¸€ä¸ªå±æ€§è§£ææˆæŸä¸ªç±»ï¼Œåˆ™å¯ä»¥ä½¿ç”¨getPropertyAsClass()æ–¹æ³•ï¼š<code>Class<compactdisc> cdClass = env.getPropertyAsClass(â€œdisc.classâ€, CompactDisc.class);</compactdisc></code></p>
<p><strong>åœ¨Springä¸­ï¼Œå¯ä»¥ä½¿ç”¨${ â€¦ }å°†å ä½ç¬¦åŒ…è£¹èµ·æ¥</strong>ï¼Œä¾‹å¦‚ï¼Œåœ¨XMLæ–‡ä»¶ä¸­å¯ä»¥å®šä¹‰å¦‚ä¸‹ä»£ç ä»é…ç½®æ–‡ä»¶ä¸­è§£æå¯¹åº”é…ç½®é¡¹çš„å€¼ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">"sgtPeppers"</span></span><br><span class="line">             <span class="attribute">class</span>=<span class="string">"soundsystem.BlankDisc"</span></span><br><span class="line">             c:<span class="attribute">_title</span>=<span class="string">"<span class="variable">$&#123;disc.title&#125;</span>"</span></span><br><span class="line">             c:<span class="attribute">_artist</span>=<span class="string">"<span class="variable">$&#123;disc.artist&#125;</span>"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ ä½¿ç”¨component-scanningå’Œè‡ªåŠ¨è£…é…åˆ›å»ºå’Œåˆå§‹åŒ–åº”ç”¨ç»„ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨@Valueæ³¨è§£è·å–é…ç½®æ–‡ä»¶ä¸­é…ç½®é¡¹çš„å€¼ï¼Œä¾‹å¦‚BlankDiscçš„æ„é€ å‡½æ•°å¯ä»¥å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> BlankDisc(</span><br><span class="line">            <span class="meta">@Value(<span class="meta-string">"<span class="subst">$&#123;disc.title&#125;</span>"</span>)</span> String title,</span><br><span class="line">            <span class="meta">@Value(<span class="meta-string">"<span class="subst">$&#123;disc.artist&#125;</span>"</span>)</span> String artist) &#123;</span><br><span class="line">      <span class="keyword">this</span>.title = title;</span><br><span class="line">      <span class="keyword">this</span>.artist = artist;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†ä½¿ç”¨å ä½ç¬¦çš„å€¼ï¼Œéœ€è¦é…ç½®PropertyPlaceholderConfigerbeanæˆ–è€…PropertySourcesPlaceholderConfigurerbeanã€‚ä»Spring 3.1ä¹‹åï¼Œæ›´æ¨èä½¿ç”¨PropertySourcesPlaceholderConfigurerï¼Œå› ä¸ºè¿™ä¸ªbeanå’ŒSpring çš„Environmentçš„æ¥æºä¸€æ ·ï¼Œä¾‹å­ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function">PropertySourcesPlaceholderConfigurer <span class="title">placeholderConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PropertySourcesPlaceholderConfigurer();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½¿ç”¨XMLé…ç½®æ–‡ä»¶ï¼Œåˆ™é€šè¿‡<a href="context:property-placeholder" target="_blank" rel="noopener">context:property-placeholder</a>å…ƒç´ å¯ä»¥è·å¾—PropertySourcesPlaceholderConfigurerbeanï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span>       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:/app.properties"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p></p><h3>ä½¿ç”¨SpELè£…é…</h3><br>Spring 3å¼•å…¥äº†Spring Expression Languageï¼ˆSpELï¼‰ï¼Œè¿™æ˜¯ä¸€ç§åœ¨è¿è¡Œæ—¶ç»™beançš„å±æ€§æˆ–è€…æ„é€ å‡½æ•°å‚æ•°æ³¨å…¥å€¼çš„æ–¹æ³•ã€‚<p></p>
<p>SpELæœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œç®€å•åˆ—ä¸¾å¦‚ä¸‹ï¼š</p>
<p><li>å¯ä»¥é€šè¿‡beançš„IDå¼•ç”¨beanï¼›</li></p>
<p><li>å¯ä»¥è°ƒç”¨æŸä¸ªå¯¹è±¡çš„æ–¹æ³•æˆ–è€…è®¿é—®å®ƒçš„å±æ€§ï¼›</li></p>
<p><li>æ”¯æŒæ•°å­¦ã€å…³ç³»å’Œé€»è¾‘æ“ä½œï¼›</li></p>
<p><li>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼›</li></p>
<p><li>æ”¯æŒé›†åˆæ“ä½œ<br>åœ¨åç»­çš„æ–‡ç« ä¸­ï¼Œå¯ä»¥çœ‹åˆ°SpELè¢«ç”¨åˆ°ä¾èµ–æ³¨å…¥çš„å…¶ä»–æ–¹é¢ï¼Œä¾‹å¦‚åœ¨Spring Securityä¸­ï¼Œå¯ä»¥ä½¿ç”¨SpELè¡¨è¾¾å¼å®šä¹‰å®‰å…¨é™åˆ¶ï¼›å¦‚æœåœ¨Spring MVCä¸­ä½¿ç”¨Thymeleafæ¨¡æ¿ï¼Œåœ¨æ¨¡æ¿ä¸­å¯ä»¥ä½¿ç”¨SpELè¡¨è¾¾å¼è·å–æ¨¡å‹æ•°æ®ã€‚<br>SpELæ˜¯ä¸€é—¨éå¸¸çµæ´»çš„è¡¨è¾¾å¼è¯­è¨€ï¼Œåœ¨è¿™é‡Œä¸å‡†å¤‡èŠ±å¤§é‡ç¯‡å¹…æ¥æ¶µç›–å®ƒçš„æ‰€æœ‰æ–¹é¢ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›ä¾‹å­æ¥æ„Ÿå—ä¸€ä¸‹å®ƒçš„å¼ºå¤§èƒ½åŠ›ã€‚</li></p>
<p>é¦–å…ˆï¼ŒSpELè¡¨è¾¾å¼è¢«#{ â€¦ }åŒ…å›´ï¼Œè·Ÿplaceholdersä¸­çš„${ â€¦ }éå¸¸åƒï¼Œæœ€ç®€å•çš„SpELè¡¨è¾¾å¼å¯ä»¥å†™ä½œ<code>#{1}</code>ã€‚åœ¨åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½å›ä½¿ç”¨æ›´åŠ æœ‰å®é™…å«ä¹‰çš„SpELè¡¨è¾¾å¼ï¼Œä¾‹å¦‚<code>#{T(System).currentTimeMillis()}</code>â€”â€”è¿™ä¸ªè¡¨è¾¾å¼è´Ÿè´£è·å¾—å½“å‰çš„ç³»ç»Ÿæ—¶é—´ï¼Œè€ŒT()æ“ä½œç¬¦è´Ÿè´£å°†java.lang.Systemè§£ææˆç±»ï¼Œä»¥ä¾¿å¯ä»¥è°ƒç”¨currentTimeMillis()æ–¹æ³•ã€‚</p>
<p>SpELè¡¨è¾¾å¼å¯ä»¥å¼•ç”¨æŒ‡å®šIDçš„beanæˆ–è€…æŸä¸ªbeançš„å±æ€§ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­å¯ä»¥è·å¾—IDä¸ºsgtPeppersçš„beançš„artistå±æ€§çš„å€¼ï¼š<code>#{sgtPeppers.artist}</code>ï¼›ä¹Ÿå¯ä»¥é€šè¿‡<code>#{systemProperties[â€˜disc.titleâ€™]}</code>å¼•ç”¨ç³»ç»Ÿå±æ€§ã€‚</p>
<p>ä¸Šè¿°è¿™äº›ä¾‹å­éƒ½éå¸¸ç®€å•ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹ä¸‹å¦‚ä½•åœ¨beanè£…é…ä¸­ä½¿ç”¨SpELè¡¨è¾¾å¼ï¼Œä¹‹å‰æåˆ°è¿‡ï¼Œå¦‚æœä½ ä½¿ç”¨component-scanningå’Œè‡ªåŠ¨è£…é…åˆ›å»ºåº”ç”¨ç»„ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨@Valueæ³¨è§£è·å¾—é…ç½®æ–‡ä»¶ä¸­é…ç½®é¡¹çš„å€¼ï¼›é™¤äº†ä½¿ç”¨placeholderè¡¨è¾¾å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨SpELè¡¨è¾¾å¼ï¼Œä¾‹å¦‚BlankDiscçš„æ„é€ å‡½æ•°å¯ä»¥æŒ‰ç…§ä¸‹é¢è¿™ç§æ–¹å¼æ¥å†™ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> BlankDisc(</span><br><span class="line">            <span class="meta">@Value(<span class="meta-string">"#&#123;systemProperties['disc.title']&#125;"</span>)</span> String title,</span><br><span class="line">            <span class="meta">@Value(<span class="meta-string">"#&#123;systemProperties['disc.artist']&#125;"</span>)</span> String artist) &#123;</span><br><span class="line">      <span class="keyword">this</span>.title = title;</span><br><span class="line">      <span class="keyword">this</span>.artist = artist;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SpELè¡¨è¾¾å¼å¯ä»¥è¡¨ç¤ºæ•´æ•°å€¼ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºæµ®ç‚¹æ•°ã€Stringå€¼å’ŒBooleanå€¼ã€‚ä¾‹å¦‚å¯ä»¥ä½¿ç”¨#{3.14159}è¡¨å¼æµ®ç‚¹æ•°3.14159ï¼Œå¹¶ä¸”è¿˜æ”¯æŒç§‘å­¦è®¡æ•°æ³•â€”â€”<code>#{9.87E4}</code>è¡¨ç¤º98700ï¼›<code>#{â€˜Helloâ€™}</code>å¯ä»¥è¡¨ç¤ºå­—ç¬¦ä¸²å€¼ã€<code>#{false}</code>å¯ä»¥è¡¨ç¤ºBooleanå€¼ã€‚</p>
<p>å•ç‹¬ä½¿ç”¨å­—é¢å€¼æ˜¯ä¹å‘³çš„ï¼Œä¸€èˆ¬ä¸ä¼šä½¿ç”¨åˆ°åªåŒ…å«æœ‰å­—é¢å€¼çš„SpELè¡¨è¾¾å¼ï¼Œä¸è¿‡åœ¨æ„é€ æ›´æœ‰è¶£ã€æ›´å¤æ‚çš„è¡¨è¾¾å¼æ—¶æ”¯æŒå­—é¢å€¼è¿™ä¸ªç‰¹æ€§éå¸¸æœ‰ç”¨ã€‚</p>
<p>SpELè¡¨è¾¾å¼å¯ä»¥é€šè¿‡beançš„IDå¼•ç”¨beanï¼Œä¾‹å¦‚<code>#{sgtPeppers}</code>ï¼›ä¹Ÿå¯ä»¥å¼•ç”¨æŒ‡å®šbeançš„å±æ€§ï¼Œä¾‹å¦‚<code>#{sgtPeppers.artist}</code>ï¼›è¿˜å¯ä»¥è°ƒç”¨æŸä¸ªbeançš„æ–¹æ³•ï¼Œä¾‹å¦‚#<code>{artistSelector.selectArtist()}</code>è¡¨è¾¾å¼å¯ä»¥è°ƒç”¨artistSelectorè¿™ä¸ªbeançš„selectArtist()æ–¹æ³•ã€‚</p>
<p>SpELè¡¨è¾¾å¼ä¹Ÿæ”¯æŒæ–¹æ³•çš„è¿ç»­è°ƒç”¨ï¼Œä¾‹å¦‚#<code>{artistSelector.selectArtist().toUpperCase()}</code>,ä¸ºäº†é˜²æ­¢å‡ºç°NullPointerExceptionå¼‚å¸¸ï¼Œæœ€å¥½ä½¿ç”¨ç±»å‹å®‰å…¨çš„æ“ä½œç¬¦ï¼Œä¾‹å¦‚#<code>{artistSelector.selectArtist()?.toUpperCase()}</code>ã€‚?.æ“ä½œç¬¦åœ¨è°ƒç”¨å³è¾¹çš„å‡½æ•°ä¹‹å‰ï¼Œä¼šç¡®ä¿å·¦è¾¹çš„å‡½æ•°è¿”å›çš„å€¼ä¸ä¸ºnullã€‚</p>
<p>åœ¨SpELä¸­èƒ½å¤Ÿè°ƒç”¨ç±»çš„æ–¹æ³•æˆ–è€…å¸¸é‡çš„å…³é”®æ˜¯T()æ“ä½œç¬¦ï¼Œä¾‹å¦‚é€šè¿‡<code>T(java.lang.Math)</code>å¯ä»¥è®¿é—®Mathç±»ä¸­çš„æ–¹æ³•å’Œå±æ€§â€”â€”<code>#{(java.lang.Math).random()}</code>å’Œ<code>#{T(java.lang.Math).PI}</code>ã€‚</p>
<p>åœ¨æ“ä½œæ–‡æœ¬å­—ç¬¦ä¸²æ—¶ï¼Œæœ€å¸¸ç”¨çš„æ˜¯æ£€æŸ¥æŸä¸ªæ–‡æœ¬æ˜¯å¦ç¬¦åˆæŸç§æ ¼å¼ã€‚SpELé€šè¿‡matchesæ“ä½œç¬¦æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚ä¾‹å¦‚ï¼š<code>#{admin.email matches â€˜[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+.comâ€™}</code>å¯ä»¥æ£€æŸ¥admin.emailè¡¨ç¤ºçš„é‚®ä»¶åœ°å€æ˜¯å¦æ­£ç¡®ã€‚</p>
<p>é€šè¿‡SpELè¡¨è¾¾å¼è¿˜å¯ä»¥æ“ä½œé›†åˆå’Œæ•°ç»„ï¼Œä¾‹å¦‚<code>#{jukebox.songs[4].title}</code>è¿™ä¸ªè¡¨è¾¾å¼å¯ä»¥è®¿é—®jukeboxçš„songsæ•°ç»„çš„ç¬¬5ä¸ªå…ƒç´ ã€‚</p>
<p>ä¹Ÿå¯ä»¥å®ç°æ›´å¤æ‚çš„åŠŸèƒ½ï¼šéšæœºé€‰æ‹©ä¸€é¦–æ­Œâ€”â€”<code>#{jukebox.songs[T(java.lang.Math).random() * jukebox.songs.size()].title}</code>ã€‚</p>
<p>SpELæä¾›äº†ä¸€ä¸ªé€‰æ‹©æ“ä½œç¬¦â€”â€”<code>.?[]</code>ï¼Œå¯ä»¥è·å¾—æŸä¸ªé›†åˆçš„å­é›†ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ è·å¾—jukeboxä¸­æ‰€æœ‰artistä¸ºAerosmithçš„æ­Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¿™ä¸ªè¡¨è¾¾å¼ï¼š<code>#{jukebox.songs.?[artist eq â€˜Aerosmithâ€™]}</code>ã€‚å¯ä»¥çœ‹å‡ºï¼Œ<code>.?[]</code>æ“ä½œç¬¦æ”¯æŒåœ¨[]ä¸­åµŒå¥—å¦ä¸€ä¸ªSpELè¡¨è¾¾å¼ã€‚</p>
<p>SpELè¿˜æä¾›äº†å…¶ä»–ä¸¤ä¸ªé€‰æ‹©æ“ä½œç¬¦ï¼š<code>.^[]</code>ç”¨äºé€‰æ‹©ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ ï¼›<code>.$[]</code>ç”¨äºé€‰æ‹©æœ€åä¸€ä¸ªåŒ¹é…çš„å…ƒç´ ã€‚</p>
<p>æœ€åï¼ŒSpELè¿˜æä¾›äº†ä¸€ä¸ªæå–æ“ä½œç¬¦ï¼š<code>.![]</code>ï¼Œå¯ä»¥æ ¹æ®æŒ‡å®šçš„é›†åˆæ–°å»ºä¸€ä¸ªç¬¦åˆæŸä¸ªæ¡ä»¶çš„æ–°é›†åˆï¼Œä¾‹å¦‚<code>#{jukebox.songs.![title]}</code>å¯ä»¥å°†songsçš„titleéƒ½æå–å‡ºæ¥æ„æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²é›†åˆã€‚</p>
<p>OKï¼ŒSpELçš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦ç»™å¼€å‘äººå‘˜æä¸ªé†’ï¼šåˆ«è®©ä½ çš„SpELè¡¨è¾¾å¼è¿‡äºæ™ºèƒ½ã€‚ä½ çš„è¡¨è¾¾å¼è¶Šæ™ºèƒ½ï¼Œå°±è¶Šéš¾å¯¹å®ƒä»¬è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œå› æ­¤ï¼Œå°½é‡ä¿è¯ä½ çš„SpELè¡¨è¾¾å¼ç®€å•æ˜“ç†è§£ã€‚</p>
<p></p><h2>æ€»ç»“</h2><br>é¦–å…ˆæˆ‘ä»¬ä»‹ç»äº†é€šè¿‡Springçš„profilesè§£å†³å¤šç¯å¢ƒéƒ¨ç½²çš„é—®é¢˜ï¼Œé€šè¿‡åœ¨è¿è¡Œæ—¶æ ¹æ®ä»£è¡¨æŒ‡å®šç¯å¢ƒçš„profileé€‰æ‹©æ€§åˆ›å»ºæŸä¸ªbeanï¼ŒSpringå¯ä»¥å®ç°æ— éœ€é‡æ–°æ„å»ºå°±å¯ä»¥åœ¨å¤šä¸ªç¯å¢ƒä¸‹éƒ¨ç½²åŒä¸€ä¸ªåº”ç”¨ã€‚<p></p>
<p>Profiles beanæ˜¯è¿è¡Œæ—¶åˆ›å»ºbeançš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä¸è¿‡Spring 4æä¾›äº†ä¸€ä¸ªæ›´æ™®éçš„è§£å†³æ–¹æ¡ˆï¼šåˆ©ç”¨@Conditionalæ³¨è§£å’ŒConditionæ¥å£å®ç°æ¡ä»¶æ€§åˆ›å»ºbeanã€‚</p>
<p>æˆ‘ä»¬è¿˜ä»‹ç»äº†ä¸¤ç§æœºåˆ¶æ¥è§£å†³è‡ªåŠ¨è£…é…æ—¶å¯èƒ½é‡åˆ°çš„æ­§ä¹‰æ€§é—®é¢˜ï¼šprimary beanså’Œqualifiersã€‚å°½ç®¡å®šä¹‰ä¸€ä¸ªprimary beanéå¸¸ç®€å•ï¼Œä½†å®ƒä»ç„¶æœ‰å±€é™ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ©ç”¨qualifierç¼©å°è‡ªåŠ¨è£…é…çš„beançš„èŒƒå›´ï¼Œè€Œä¸”ï¼Œæˆ‘ä»¬ä¹Ÿæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºè‡ªå·±çš„qualifiersã€‚</p>
<p>å°½ç®¡å¤§å¤šæ•°Spring beanæ˜¯å•ä¾‹å¯¹è±¡ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹å…·å¤‡å…¶ä»–ä½œç”¨åŸŸçš„å¯¹è±¡æ›´åŠ åˆé€‚ã€‚Spring åº”ç”¨ä¸­å¯ä»¥åˆ›å»ºsingletonsã€prototypesã€request-scopedæˆ–session-scopedã€‚åœ¨ä½¿ç”¨request-scopedæˆ–è€…session-scopedç±»å‹çš„beanæ—¶ï¼Œè¿˜éœ€è¦è§£å†³å°†éå•ä¾‹å¯¹è±¡æ³¨å…¥åˆ°å•ä¾‹å¯¹è±¡æ—¶é‡åˆ°çš„é—®é¢˜â€”â€”åˆ©ç”¨ä»£ç†æ¥å£æˆ–ä»£ç†ç±»ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬ä¹Ÿä»‹ç»äº†Springè¡¨è¾¾å¼è¯­è¨€ï¼ˆSpELï¼‰ï¼Œåˆ©ç”¨SpELå¯ä»¥å®ç°åœ¨è¿è¡Œæ—¶ç»™beanæ³¨å…¥å€¼ã€‚</p>
</bean>]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Spring</tag>
        <tag>æ¡†æ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>ç³»ç»Ÿå­¦ä¹ Springï¼ˆäºŒï¼‰â€”â€”è£…é…Bean</title>
    <url>/2017/05/10/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0Spring%EF%BC%88%E4%BA%8C%EF%BC%89%E2%80%94%E2%80%94%E8%A3%85%E9%85%8DBean/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä»»ä½•ä¸€ä¸ªæˆåŠŸçš„åº”ç”¨éƒ½æ˜¯ç”±å¤šä¸ªä¸ºäº†å®ç°æŸä¸ªä¸šåŠ¡ç›®æ ‡è€Œç›¸äº’åä½œçš„ç»„ä»¶æ„æˆçš„ï¼Œè¿™äº›ç»„ä»¶å¿…é¡»ç›¸äº’äº†è§£ã€èƒ½å¤Ÿç›¸äº’åä½œå®Œæˆå·¥ä½œã€‚<a id="more"></a><br>ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªåœ¨çº¿è´­ç‰©ç³»ç»Ÿä¸­ï¼Œè®¢å•ç®¡ç†ç»„ä»¶éœ€è¦ä¸äº§å“ç®¡ç†ç»„ä»¶ä»¥åŠä¿¡ç”¨å¡è®¤è¯ç»„ä»¶åä½œï¼›è¿™äº›ç»„ä»¶è¿˜éœ€è¦è·Ÿæ•°æ®åº“ç»„ä»¶åä½œä»è€Œè¿›è¡Œæ•°æ®åº“è¯»å†™æ“ä½œã€‚<br>åœ¨Springåº”ç”¨ä¸­ï¼Œå¯¹è±¡æ— éœ€è‡ªå·±è´Ÿè´£æŸ¥æ‰¾æˆ–è€…åˆ›å»ºä¸å…¶å…³è”çš„å…¶ä»–å¯¹è±¡ï¼Œç”±å®¹å™¨è´Ÿè´£å°†åˆ›å»ºå„ä¸ªå¯¹è±¡ï¼Œå¹¶åˆ›å»ºå„ä¸ªå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚<br>é€šä¿—çš„æ¥è¯´ï¼ŒSpringå°±æ˜¯ä¸€ä¸ªå·¥å‚ï¼ŒBeanå°±æ˜¯Springå·¥å‚çš„äº§å“ï¼Œå¯¹äºSpringå·¥å‚èƒ½å¤Ÿç”Ÿäº§é‚£äº›äº§å“ï¼Œè¿™ä¸ªå–å†³äºé¢†å¯¼çš„å†³ç­–ï¼Œä¹Ÿå°±æ˜¯é…ç½®æ–‡ä»¶ä¸­é…ç½®ã€‚<br>å› æ­¤ï¼Œ<strong>å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„åªæ˜¯å‘Šè¯‰Springå®¹å™¨éœ€è¦åˆ›å»ºå“ªäº›beanä»¥åŠå¦‚ä½•å°†å„ä¸ªbeanè£…é…åˆ°ä¸€èµ·</strong>ã€‚<strong>å¯¹äºSpringæ¥è¯´ï¼Œå®ƒè¦åšçš„å°±æ˜¯æ ¹æ®é…ç½®æ–‡ä»¶æ¥åˆ›å»ºBeanå®ä¾‹ï¼Œå¹¶è°ƒç”¨Beanå®ä¾‹çš„æ–¹æ³•å®Œæˆâ€œä¾èµ–æ³¨å…¥â€</strong>ã€‚</p>
<h2>Beançš„å®šä¹‰</h2><br><li>   &lt; beans/&gt;æ˜¯Sringé…ç½®æ–‡ä»¶çš„æ ¹èŠ‚ç‚¹<br></li><li> ä¸€ä¸ª&lt; beans/&gt;èŠ‚ç‚¹é‡Œé¢å¯ä»¥æœ‰å¤šä¸ª<bean>èŠ‚ç‚¹<br>åœ¨å®šä¹‰Beançš„æ—¶å€™ï¼Œé€šå¸¸è¦æŒ‡å®šä¸¤ä¸ªå±æ€§ï¼šidå’Œclassã€‚å…¶ä¸­idç”¨æ¥æŒ‡æ˜beançš„æ ‡è¯†ç¬¦ï¼Œè¿™ä¸ªæ ‡è¯†ç¬¦å…·æœ‰å”¯ä¸€æ€§ï¼ŒSpringå¯¹beançš„ç®¡ç†ä»¥åŠbeanä¹‹é—´è¿™ç§ä¾èµ–å…³ç³»éƒ½éœ€è¦è¿™ä¸ªå±æ€§ï¼›è€ŒclassæŒ‡æ˜è¯¥beançš„å…·ä½“å®ç°ç±»ï¼Œè¿™é‡Œä¸èƒ½æ˜¯æ¥å£ï¼ˆå¯ä»¥æ˜¯æ¥å£å®ç°ç±»ï¼‰å…¨è·¯å¾„åŒ…å.ç±»åã€‚<br><br><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸€ä¸ªBeançš„é…ç½®</span></span><br><span class="line">    &lt;bean id=<span class="string">"bean"</span> <span class="keyword">class</span>=<span class="string">"å®ç°ç±»"</span> /&gt;</span><br></pre></td></tr></table></figure><br><br>æˆ–è€…<br><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component(<span class="meta-string">"bean"</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bean</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>å½“æˆ‘ä»¬ç”¨XMLé…ç½®äº†è¿™ä¸ªbeançš„æ—¶å€™ï¼Œè¯¥beanå®ç°ç±»ä¸­å¿…é¡»æœ‰ä¸€ä¸ªæ— å‚æ„é€ å™¨ï¼Œæ•…Springåº•å±‚ç›¸å½“äºè°ƒç”¨äº†å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">bean</span> = new å®ç°ç±»ï¼ˆï¼‰<span class="comment">;</span></span><br></pre></td></tr></table></figure><br><br>å¦‚æœåœ¨beançš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé€šè¿‡æ„é€ æ³¨å…¥å¦‚ï¼š<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;bean id=<span class="string">"bean"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"å®ç°ç±»"</span> /&gt;  </span><br><span class="line">       &lt;<span class="keyword">constructor</span>-arg value="bean"/&gt;  </span><br><span class="line">   &lt;/bean&gt;</span><br></pre></td></tr></table></figure><br><br>é‚£ä¹ˆSpringç›¸å½“äºè°ƒç”¨äº†<br><figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Bean </span><span class="keyword">bean </span>= new å®ç°ç±»ï¼ˆ<span class="string">"bean"</span>ï¼‰<span class="comment">;</span></span><br></pre></td></tr></table></figure><br><br><h2>Springçš„é…ç½®æ–¹æ³•</h2><br>Springå®¹å™¨è´Ÿè´£åˆ›å»ºåº”ç”¨ä¸­çš„beanï¼Œå¹¶é€šè¿‡DIç»´æŠ¤è¿™äº›beanä¹‹é—´çš„åä½œå…³ç³»ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œä½ åº”è¯¥è´Ÿè´£å‘Šè¯‰Springå®¹å™¨éœ€è¦åˆ›å»ºå“ªäº›beanä»¥åŠå¦‚ä½•å°†å„ä¸ªbeanè£…é…åˆ°ä¸€èµ·ã€‚Springæä¾›ä¸‰ç§è£…é…beançš„æ–¹å¼ï¼š<br><br><li>åŸºäºXMLæ–‡ä»¶çš„æ˜¾å¼è£…é…<br></li><li>åŸºäºJavaæ–‡ä»¶çš„æ˜¾å¼è£…é…<br></li><li>éšå¼beanå‘ç°æœºåˆ¶å’Œè‡ªåŠ¨è£…é…<br><br>ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ ¹æ®ä¸ªäººå“å‘³é€‰æ‹©è¿™ä¸‰ç§è£…é…æ–¹å¼ä¸­çš„ä¸€ç§ã€‚Springä¹Ÿæ”¯æŒåœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­æ··åˆä½¿ç”¨ä¸åŒçš„è£…é…æ–¹å¼ã€‚<br><br>ã€ŠSpringå®æˆ˜ã€‹çš„å»ºè®®æ˜¯ï¼šå°½å¯èƒ½ä½¿ç”¨è‡ªåŠ¨è£…é…ï¼Œè¶Šå°‘å†™æ˜¾å¼çš„é…ç½®æ–‡ä»¶è¶Šå¥½ï¼›å½“ä½ å¿…é¡»ä½¿ç”¨æ˜¾å¼é…ç½®æ—¶ï¼ˆä¾‹å¦‚ï¼Œä½ è¦é…ç½®ä¸€ä¸ªbeanï¼Œä½†æ˜¯è¯¥beançš„æºç ä¸æ˜¯ç”±ä½ ç»´æŠ¤ï¼‰ï¼Œå°½å¯èƒ½ä½¿ç”¨ç±»å‹å®‰å…¨ã€åŠŸèƒ½æ›´å¼ºå¤§çš„åŸºäºJavaæ–‡ä»¶çš„è£…é…æ–¹å¼ï¼›æœ€åï¼Œåœ¨æŸäº›æƒ…å†µä¸‹åªæœ‰XMLæ–‡ä»¶ä¸­æ‰åˆä½ éœ€è¦ä½¿ç”¨çš„åå­—ç©ºé—´æ—¶ï¼Œå†é€‰æ‹©ä½¿ç”¨åŸºäºXMLæ–‡ä»¶çš„è£…é…æ–¹å¼ã€‚<br><br><h2>è‡ªåŠ¨è£…é…Bean</h2>

<p>Springé€šè¿‡ä¸¤ä¸ªè§’åº¦æ¥å®ç°è‡ªåŠ¨è£…é…ï¼š</p>
<p><li>ç»„ä»¶æ‰«æï¼ŒSpringä¼šè‡ªåŠ¨å‘ç°åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€åˆ›å»ºçš„bean</li></p>
<p><li>è‡ªåŠ¨è£…é…ï¼ŒSpringè‡ªåŠ¨æ»¡è¶³beanä¹‹é—´çš„ä¾èµ–</li></p>
<p>ã€ŠSpringå®æˆ˜ã€‹ä¸­ç”¨äº†ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ï¼Œå‡è®¾ä½ éœ€è¦å®ç°ä¸€ä¸ªéŸ³å“ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿä¸­åŒ…å«CDPlayerå’ŒCompactDiscä¸¤ä¸ªç»„ä»¶ï¼ŒSpringå°†è‡ªåŠ¨å‘ç°è¿™ä¸¤ä¸ªbeanï¼Œå¹¶å°†CompactDiscçš„å¼•ç”¨æ³¨å…¥åˆ°CDPlayerä¸­ã€‚</p>
<p>é¦–å…ˆåˆ›å»ºCDçš„æ¦‚å¿µâ€”â€”CompactDiscæ¥å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ææ™º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2017/5/9</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CompactDisc</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>CompactDiscæ¥å£çš„ä½œç”¨æ˜¯å°†CDPlayerä¸å…·ä½“çš„CDå®ç°è§£è€¦åˆï¼Œå³é¢å‘æ¥å£ç¼–ç¨‹ã€‚è¿™é‡Œè¿˜éœ€å®šä¹‰ä¸€ä¸ªå…·ä½“çš„CDå®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ææ™º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2017/5/9</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SgtPeppers</span> <span class="keyword">implements</span> <span class="title">CompactDisc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String title = <span class="string">"Sgt.Pepper's Lonely Hearts Club Band"</span>;</span><br><span class="line">    <span class="keyword">private</span> String artist = <span class="string">"The Beatles"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Playing"</span> + title + <span class="string">"by"</span> + artist);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæœ€é‡è¦çš„æ˜¯@Componentæ³¨è§£ï¼Œå®ƒå‘Šè¯‰Springéœ€è¦åˆ›å»ºSgtPeppers beanã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦å¯åŠ¨è‡ªåŠ¨æ‰«ææœºåˆ¶ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼šåŸºäºXMLé…ç½®æ–‡ä»¶ï¼›åŸºäºJavaé…ç½®æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼ˆäºŒé€‰ä¸€ï¼‰ï¼š<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">//è¿™æ˜¯XMLé…ç½®</span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"soundsystem"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æˆ–<br><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿™æ˜¯Javaé…ç½®</span></span><br><span class="line"><span class="keyword">package</span> soundsystem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ææ™º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2017/5/9</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan()</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayerConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨è¿™ä¸ªJavaé…ç½®æ–‡ä»¶ä¸­æœ‰ä¸¤ä¸ªæ³¨è§£å€¼å¾—æ³¨æ„ï¼š@Configurationè¡¨ç¤ºè¿™ä¸ª.javaæ–‡ä»¶æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼›@ComponentScanè¡¨ç¤ºå¼€å¯Componentæ‰«æï¼ŒSpringå°†ä¼šè®¾ç½®è¯¥ç›®å½•ä»¥åŠå­ç›®å½•ä¸‹æ‰€æœ‰è¢«@Componentæ³¨è§£ä¿®é¥°çš„ç±»ã€‚</p>
<p>è‡ªåŠ¨é…ç½®çš„å¦ä¸€ä¸ªå…³é”®æ³¨è§£æ˜¯@Autowiredï¼ŒåŸºäºä¹‹å‰çš„ä¸¤ä¸ªç±»å’Œä¸€ä¸ªJavaé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥å†™ä¸ªæµ‹è¯•<br><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">package</span> <span class="selector-tag">com</span><span class="selector-class">.spring</span><span class="selector-class">.sample</span><span class="selector-class">.soundsystem</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">com</span><span class="selector-class">.spring</span><span class="selector-class">.sample</span><span class="selector-class">.config</span><span class="selector-class">.SoundSystemConfig</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.junit</span><span class="selector-class">.Assert</span>;<span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.junit</span><span class="selector-class">.Test</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.junit</span><span class="selector-class">.runner</span><span class="selector-class">.RunWith</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.beans</span><span class="selector-class">.factory</span><span class="selector-class">.annotation</span><span class="selector-class">.Autowired</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.test</span><span class="selector-class">.context</span><span class="selector-class">.ContextConfiguration</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.test</span><span class="selector-class">.context</span><span class="selector-class">.junit4</span><span class="selector-class">.SpringJUnit4ClassRunner</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2017/5/9</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="keyword">@ContextConfiguration</span>(classes = SoundSystemConfig.class)</span><br><span class="line">public class SoundSystemTest &#123;</span><br><span class="line">    <span class="keyword">@Autowired</span></span><br><span class="line">    private CompactDisc cd;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">@Test</span></span><br><span class="line">    public void cdShouldNotBeNull() &#123;</span><br><span class="line">        <span class="selector-tag">Assert</span><span class="selector-class">.assertNotNull</span>(<span class="selector-tag">cd</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œæµ‹è¯•ï¼Œçœ‹åˆ°ç»¿è‰²å°±æˆåŠŸäº†ï¼Œè¯´æ˜@Autowiredæ³¨è§£èµ·ä½œç”¨äº†ï¼šè‡ªåŠ¨å°†æ‰«ææœºåˆ¶åˆ›å»ºçš„CompactDiscç±»å‹çš„beanæ³¨å…¥åˆ°SoundSystemTestè¿™ä¸ªbeanä¸­ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸¤ä¸ªç‚¹ï¼Œä¸€ä¸ªæ˜¯junitéœ€è¦ç”¨é«˜çº§ä¸€ç‚¹çš„ç‰ˆæœ¬ï¼Œä¹‹å‰ç”¨3.8ä¸€ç›´æœ‰é—®é¢˜ï¼Œæ¢æˆ4.12ä¹‹åå°±å¥½äº†ï¼›è¿˜ä¸€ä¸ªæ˜¯SpringTestçš„æµ‹è¯•åŒ…ã€‚<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Sprint-test ç›¸å…³æµ‹è¯•åŒ… --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.11.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ç®€å•å¾—è¯´ï¼Œè‡ªåŠ¨è£…é…çš„æ„æ€å°±æ˜¯è®©Springä»åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ°å¯¹åº”çš„beançš„å¼•ç”¨ï¼Œå¹¶å°†å®ƒä»¬æ³¨å…¥åˆ°æŒ‡å®šçš„beanã€‚é€šè¿‡@Autowiredæ³¨è§£å¯ä»¥å®Œæˆè‡ªåŠ¨è£…é…ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸‹é¢ä»£ç ä¸­çš„CDPlayerç±»ï¼Œå®ƒçš„æ„é€ å‡½æ•°è¢«@Autowiredä¿®é¥°ï¼Œè¡¨æ˜å½“Springåˆ›å»ºCDPlayerçš„beanæ—¶ï¼Œä¼šç»™è¿™ä¸ªæ„é€ å‡½æ•°ä¼ å…¥ä¸€ä¸ªCompactDiscçš„beanå¯¹åº”çš„å¼•ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ææ™º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2017/5/9</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayer</span> <span class="keyword">implements</span> <span class="title">MediaPlay</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CompactDisc cd;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CDPlayer</span><span class="params">(CompactDisc cd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cd = cd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cd.play();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰åˆ«çš„å®ç°æ–¹æ³•ï¼Œä¾‹å¦‚å°†@Autowiredæ³¨è§£ä½œç”¨åœ¨setCompactDisc()æ–¹æ³•ä¸Š:</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setCd</span><span class="params">(CompactDisc cd)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.cd = cd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…æ˜¯å…¶ä»–åå­—çš„æ–¹æ³•ä¸Šï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">insertCD</span><span class="params">(CompactDisc cd)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.cd = cd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ›´ç®€å•çš„ç”¨æ³•æ˜¯ï¼Œå¯ä»¥å°†@Autowiredæ³¨è§£ç›´æ¥ä½œç”¨åœ¨æˆå‘˜å˜é‡ä¹‹ä¸Šï¼Œæˆ‘ä»¬å¼€å‘ä¸€èˆ¬éƒ½æ˜¯ç›´æ¥è¿™ä¹ˆç”¨çš„å§ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> CompactDisc cd;</span><br></pre></td></tr></table></figure></p>
<p>åªè¦å¯¹åº”ç±»å‹çš„beanæœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œåˆ™ä¼šè‡ªåŠ¨è£…é…åˆ°è¯¥å±æ€§ä¸Šã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„beanï¼Œåº”ç”¨ä¼šæŠ›å‡ºå¯¹åº”çš„å¼‚å¸¸ï¼Œå¦‚æœæƒ³é¿å…æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ï¼Œåˆ™éœ€è¦è®¾ç½®<strong>@Autowired(required=false)</strong>ã€‚ä¸è¿‡ï¼Œåœ¨åº”ç”¨ç¨‹åºè®¾è®¡ä¸­ï¼Œåº”è¯¥è°¨æ…è®¾ç½®è¿™ä¸ªå±æ€§ï¼Œå› ä¸ºè¿™ä¼šä½¿å¾—ä½ å¿…é¡»é¢å¯¹<strong>NullPointerException</strong>çš„é—®é¢˜ã€‚</p>
<p>å¦‚æœå­˜åœ¨å¤šä¸ªåŒä¸€ç±»å‹çš„beanï¼Œåˆ™Springä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¡¨ç¤ºè£…é…æœ‰æ­§ä¹‰ï¼Œè§£å†³åŠæ³•æœ‰ä¸¤ä¸ªï¼š<br>ï¼ˆ1ï¼‰é€šè¿‡@Qualifieræ³¨è§£æŒ‡å®šéœ€è¦çš„beançš„IDï¼›<br>ï¼ˆ2ï¼‰é€šè¿‡@Resourceæ³¨è§£æŒ‡å®šæ³¨å…¥ç‰¹å®šIDçš„beanï¼›</p>
<p>ç°åœ¨æˆ‘ä»¬éªŒè¯ä¸€ä¸‹ä¸Šè¿°ä»£ç ï¼Œé€šè¿‡ä¸‹åˆ—ä»£ç ï¼Œå¯ä»¥éªŒè¯ï¼šCompactDiscçš„beanå·²ç»æ³¨å…¥åˆ°CDPlayerçš„beanä¸­ï¼ŒåŒæ—¶åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­æ˜¯å°†CDPlayerçš„beanæ³¨å…¥åˆ°å½“å‰æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Rule;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.contrib.java.lang.system.StandardOutputStreamLog;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"><span class="keyword">import</span> soundsystem.CDPlayerConfig;</span><br><span class="line"><span class="keyword">import</span> soundsystem.CompactDisc;</span><br><span class="line"><span class="keyword">import</span> soundsystem.MediaPlay;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ææ™º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2017/5/9</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">ContextConfiguration</span>(<span class="title">classes</span> </span>= CDPlayerConfig<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">//@<span class="title">ContextConfiguration</span>(<span class="title">locations</span> </span>= &#123;<span class="string">"classpath:/applicationContext.xml"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayerTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Rule</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> StandardOutputStreamLog log = <span class="keyword">new</span> StandardOutputStreamLog();</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CompactDisc cd;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MediaPlay player;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cdShouldNotBeNull</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertNotNull(cd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        player.play();</span><br><span class="line">        assertEquals(<span class="string">"Playing"</span> + <span class="string">"Sgt.Pepper's Lonely Hearts Club Band"</span> + <span class="string">"by"</span> + <span class="string">"The Beatles\n"</span>, log.getLog());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨<code> public final Logger log = LoggerFactory.getLogger(CDPlayerTest.class);</code>æ¥æ›¿ä»£<code> public final StandardOutputStreamLog log = new StandardOutputStreamLog();</code>ï¼Œè¦ä½¿ç”¨StandardOutputStreamLogï¼Œéœ€è¦æ·»åŠ JaråŒ…å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.stefanbirkner<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>system-rules<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2>åŸºäºJavaé…ç½®æ–‡ä»¶è£…é…Bean</h2><br>Javaé…ç½®æ–‡ä»¶ä¸åŒäºå…¶ä»–ç”¨äºå®ç°ä¸šåŠ¡é€»è¾‘çš„Javaä»£ç ï¼Œå› æ­¤ä¸èƒ½å°†Javaé…ç½®æ–‡ä»¶ä¸šåŠ¡é€»è¾‘ä»£ç æ··åœ¨ä¸€èµ·ã€‚ä¸€èˆ¬éƒ½ä¼šç»™Javaé…ç½®æ–‡ä»¶æ–°å»ºä¸€ä¸ªå•ç‹¬çš„packageï¼Œå®é™…ä¸Šä¹‹å‰å°±ç”¨äº†Javaé…ç½®çš„ã€‚<br><br><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Configuration</span></span><br><span class="line"><span class="variable">@ComponentScan</span>(basePackageClasses = &#123;CDPlayer.class, DVDPlayer.class&#125;)</span><br><span class="line">public class SoundSystemConfig &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>@Configurationæ³¨è§£è¡¨ç¤ºè¿™ä¸ªç±»æ˜¯é…ç½®ç±»ï¼Œä¹‹å‰æˆ‘ä»¬æ˜¯é€šè¿‡@ComponentScanæ³¨è§£å®ç°beançš„è‡ªåŠ¨æ‰«æå’Œåˆ›å»ºï¼Œè¿™é‡Œæˆ‘ä»¬é‡ç‚¹æ˜¯å­¦ä¹ å¦‚ä½•æ˜¾å¼åˆ›å»ºbeanï¼Œå› æ­¤é¦–å…ˆå°†<strong>@ComponentScan(basePackageClasses = {CDPlayer.class, DVDPlayer.class})</strong>è¿™è¡Œä»£ç å»æ‰ã€‚<br><br>æˆ‘ä»¬å…ˆé€šè¿‡@Beanæ³¨è§£åˆ›å»ºä¸€ä¸ªSpring beanï¼Œè¯¥beançš„é»˜è®¤IDå’Œå‡½æ•°çš„æ–¹æ³•åç›¸åŒï¼Œå³sgtPeppersã€‚ä¾‹å¦‚ï¼š<br><br><figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">CompactDisc <span class="title">sgtPeppers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SgtPeppers();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æˆ–æ³¨æ˜id</span></span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"lonelyHeartsClub"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="function">CompactDisc <span class="title">sgtPeppers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SgtPeppers();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>å¯ä»¥åˆ©ç”¨Javaè¯­è¨€çš„è¡¨è¾¾èƒ½åŠ›ï¼Œå®ç°ç±»ä¼¼å·¥å‚æ¨¡å¼çš„ä»£ç å¦‚ä¸‹ï¼š<br><br><figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">CompactDisc <span class="title">randomBeatlesCD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> choice = (<span class="keyword">int</span>)Math.floor(Math.random() * <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (choice == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SgtPeppers();</span><br><span class="line">    &#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(choice == <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WhiteAlbum();</span><br><span class="line">    &#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(choice == <span class="number">2</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HardDaysNight();</span><br><span class="line">    &#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(choice == <span class="number">3</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Revolover();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>ç„¶ååœ¨JavaConfigä¸­çš„å±æ€§æ³¨å…¥ï¼š<br><br><figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">CDPlayer <span class="title">cdPlayer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CDPlayer(sgtPeppers());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>çœ‹èµ·æ¥æ˜¯å‡½æ•°è°ƒç”¨ï¼Œå®é™…ä¸Šä¸æ˜¯ï¼šç”±äºsgtPeppers()æ–¹æ³•è¢«@Beanæ³¨è§£ä¿®é¥°ï¼Œæ‰€ä»¥Springä¼šæ‹¦æˆªè¿™ä¸ªå‡½æ•°è°ƒç”¨ï¼Œå¹¶è¿”å›ä¹‹å‰å·²ç»åˆ›å»ºå¥½çš„beanâ€”â€”ç¡®ä¿è¯¥SgtPeppers beanä¸ºå•ä¾‹ã€‚<br><br><figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">CDPlayer <span class="title">cdPlayer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CDPlayer(sgtPeppers());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">CDPlayer <span class="title">anotherCDPlayer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CDPlayer(sgtPeppers());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼šå¦‚æœæŠŠsgtPeppers()æ–¹æ³•å½“ä½œæ™®é€šJavaæ–¹æ³•å¯¹å¾…ï¼Œåˆ™cdPlayerbeanå’ŒanotherCDPlayerbeanä¼šæŒæœ‰ä¸åŒçš„SgtPepperså®ä¾‹â€”â€”ç»“åˆCDPlayerçš„ä¸šåŠ¡åœºæ™¯çœ‹ï¼šå°±ç›¸å½“äºå°†ä¸€ç‰‡CDåŒæ—¶è£…å…¥ä¸¤ä¸ªCDæ’­æ”¾æœºä¸­ï¼Œæ˜¾ç„¶è¿™ä¸å¯èƒ½ã€‚<br><br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringä¸­æ‰€æœ‰çš„beanéƒ½æ˜¯å•ä¾‹æ¨¡å¼ï¼Œå› æ­¤cdPlayerå’ŒanotherCDPlayerè¿™ä¿©beanæŒæœ‰ç›¸åŒçš„SgtPepperså®ä¾‹ã€‚<br><br>å½“ç„¶ï¼Œè¿˜æœ‰ä¸€ç§æ›´æ¸…æ¥šçš„å†™æ³•ï¼š<br><br><figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">CDPlayer <span class="title">cdPlayer</span><span class="params">(CompactDisc compactDisc)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CDPlayer(compactDisc);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">CDPlayer <span class="title">anotherCDPlayer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CDPlayer(sgtPeppers());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>è¿™ç§æƒ…å†µä¸‹ï¼ŒcdPlayerå’ŒanotherCDPlayerè¿™ä¿©beanæŒæœ‰ç›¸åŒçš„SgtPepperså®ä¾‹ï¼Œè¯¥å®ä¾‹çš„IDä¸ºlonelyHeartsClubã€‚è¿™ç§æ–¹æ³•æœ€å€¼å¾—ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä¸è¦æ±‚CompactDisc beanåœ¨åŒä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­å®šä¹‰â€”â€”åªè¦åœ¨åº”ç”¨ä¸Šä¸‹æ–‡å®¹å™¨ä¸­å³å¯ï¼ˆä¸ç®¡æ˜¯åŸºäºè‡ªåŠ¨æ‰«æå‘ç°è¿˜æ˜¯åŸºäºXMLé…ç½®æ–‡ä»¶å®šä¹‰ï¼‰ã€‚<br><br><h2>åŸºäºXMLçš„é…ç½®æ–¹æ³•</h2><br>åœ¨ä¹‹å‰Beançš„å®šä¹‰æœ‰æåˆ°è¿‡ï¼Œè¿™é‡Œå°±ä¸å¤è¿°äº†ã€‚<br><br><h2>æ··åˆä½¿ç”¨å¤šç§é…ç½®æ–¹æ³•</h2><br>ä¹‹å‰æœ‰æåˆ°è¿‡ï¼Œå¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿå¯èƒ½ä½¿ç”¨æ··åˆé…ç½®ï¼Œé¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼šå¯¹äºè‡ªåŠ¨é…ç½®ï¼Œå®ƒä»æ•´ä¸ªå®¹å™¨ä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾åˆé€‚çš„beanï¼Œæ— è®ºè¿™ä¸ªbeanæ˜¯æ¥è‡ªJavaConfigè¿˜æ˜¯XMLé…ç½®ã€‚<br><br><strong>åœ¨JavaConfigä¸­è§£æXMLé…ç½®</strong><br><br><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é€šè¿‡@Importæ³¨è§£å¯¼å…¥å…¶ä»–çš„JavaConfigï¼Œå¹¶ä¸”æ”¯æŒåŒæ—¶å¯¼å…¥å¤šä¸ªé…ç½®æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="variable">@Configuration</span></span><br><span class="line"><span class="variable">@Import</span>(&#123;CDPlayerConfig.class, CDConfig.class&#125;)</span><br><span class="line">public class SoundSystemConfig &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€šè¿‡@ImportResourceæ³¨è§£å¯¼å…¥XMLé…ç½®æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="variable">@Configuration</span></span><br><span class="line"><span class="variable">@Import</span>(CDPlayerConfig.class)</span><br><span class="line"><span class="variable">@ImportResource</span>(<span class="string">"classpath: cd-config.xml"</span>)</span><br><span class="line">public class SoundSystemConfig &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br><strong>åœ¨XMLé…ç½®æ–‡ä»¶ä¸­åº”ç”¨JavaConfig</strong><br><br><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é€šè¿‡&lt;import&gt;æ ‡ç­¾å¼•å…¥å…¶ä»–çš„XMLé…ç½®æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">//é€šè¿‡&lt;bean&gt;æ ‡ç­¾å¯¼å…¥Javaé…ç½®æ–‡ä»¶åˆ°XMLé…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚</span></span><br><span class="line">&lt;bean <span class="keyword">class</span>=<span class="string">"soundsystem.CDConfig"</span> /&gt;</span><br></pre></td></tr></table></figure><br><br>é€šå¸¸çš„åšæ³•æ˜¯ï¼šæ— è®ºä½¿ç”¨JavaConfigæˆ–è€…XMLè£…é…ï¼Œéƒ½è¦åˆ›å»ºä¸€ä¸ªroot configurationï¼Œå³æ¨¡å—åŒ–é…ç½®å®šä¹‰ï¼›å¹¶ä¸”åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­å¼€å¯è‡ªåŠ¨æ‰«ææœºåˆ¶ï¼š<a href="context:component-scan" target="_blank" rel="noopener">context:component-scan</a>æˆ–è€…@ComponentScanã€‚<br><br><h2>æ€»ç»“</h2>

<p>ç”±äºè‡ªåŠ¨è£…é…å‡ ä¹ä¸éœ€è¦æ‰‹åŠ¨å®šä¹‰beanï¼Œå»ºè®®ä¼˜å…ˆé€‰æ‹©è‡ªåŠ¨è£…é…ï¼›å¦‚ä½•å¿…é¡»ä½¿ç”¨æ˜¾å¼é…ç½®ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹©åŸºäºJavaæ–‡ä»¶è£…é…è¿™ç§æ–¹å¼ï¼Œå› ä¸ºç›¸æ¯”äºXMLæ–‡ä»¶ï¼ŒJavaæ–‡ä»¶å…·å¤‡æ›´å¤šçš„èƒ½åŠ›ã€ç±»å‹å®‰å…¨ç­‰ç‰¹ç‚¹ï¼›ä½†æ˜¯ä¹Ÿæœ‰ä¸€ç§æƒ…å†µå¿…é¡»ä½¿ç”¨XMLé…ç½®æ–‡ä»¶ï¼Œå³ä½ éœ€è¦ä½¿ç”¨æŸä¸ªåå­—ç©ºé—´ï¼ˆname spaceï¼‰ï¼Œè¯¥åå­—ç©ºé—´åªåœ¨XMLæ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>ps:ä¸Šè¿°ä¾‹å­éƒ½æ˜¯ç›´æ¥ç”¨çš„ã€ŠSpringå®æˆ˜ã€‹</p>
</li></bean></li>]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Spring</tag>
        <tag>æ¡†æ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>ç³»ç»Ÿå­¦ä¹ Springï¼ˆä¸€ï¼‰</title>
    <url>/2017/05/09/Spring%E5%88%9D%E6%8E%A2%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>å¯¹äºJavaå¼€å‘è€…æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¥½çš„æ—¶ä»£ã€‚<a id="more"></a></p>
<p>åœ¨è¿‡å»çš„20å¹´ä¸­ï¼ŒJavaç»å†äº†å¥½çš„æ—¶å€™ï¼Œä¹Ÿç»å†äº†åçš„æ—¶å€™ã€‚å°½ç®¡æœ‰ä¸€äº›ç²—ç³™çš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼šAppletsã€<br>EJBã€JDOå’Œæ— æ•°çš„æ—¥å¿—æ¡†æ¶ï¼ŒJavaæœ‰ä¸°å¯Œå¤šæ ·çš„å†å²ï¼Œæœ‰å¾ˆå¤šä¼ä¸šå·²ç»å»ºç«‹çš„å¹³å°ã€‚å…¶ä¸­ï¼Œspringä¸€ç›´<br>éƒ½æ˜¯å…¶ä¸­æœ€é‡è¦çš„ç»„æˆéƒ¨åˆ†ã€‚</p>
<p>åœ¨æ—©æœŸï¼ŒSpringè¢«åˆ›å»ºç”¨äºæ›¿ä»£ç¬¨é‡çš„Javaä¼ä¸šæŠ€æœ¯ï¼Œæ¯”å¦‚EJBã€‚ç›¸æ¯”äºEJBï¼ŒSpringæä¾›äº†ä¸€ä¸ªæ›´åŠ ç²¾<br>ç®€çš„ç¼–ç¨‹æ¨¡å‹ã€‚å®ƒæä¾›äº†ç®€å•Javaå¯¹è±¡ï¼ˆPOJOï¼‰æ›´å¤§çš„æƒåŠ›ï¼Œç›¸å¯¹äºEJBåŠå…¶ä»–Javaä¼ä¸šè§„èŒƒã€‚</p>
<p>éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒEJBåŠJavaä¼ä¸šè§„èŒƒ2.0ç‰ˆæœ¬æœ¬èº«ä¹Ÿæä¾›äº†ä¸€ä¸ªç®€å•çš„POJOæ¨¡å‹ã€‚ç°åœ¨ï¼ŒEJBçš„ä¸€äº›æ¦‚<br>å¿µï¼Œå¦‚DIå’ŒAOPéƒ½æ¥è‡ªäºSpringã€‚</p>
<p>å°½ç®¡ç°åœ¨J2EEï¼ˆå³æ€»æ‰€å‘¨çŸ¥çš„JEEï¼‰èƒ½å¤Ÿèµ¶ä¸ŠSpringï¼Œä½†æ˜¯Springä»æœªåœæ­¢æ¼”è¿›ã€‚å³ä½¿æ˜¯ç°åœ¨ï¼ŒSpringå¼€å§‹è¿›æ­¥çš„æ—¶å€™ï¼Œ<br>J2EEéƒ½æ˜¯å¼€å§‹åœ¨æ¢ç´¢ï¼Œè€Œä¸æ˜¯åˆ›æ–°ã€‚ç§»åŠ¨å¼€å‘ã€ç¤¾äº¤APIçš„é›†æˆã€NoSqlæ•°æ®åº“ã€äº‘è®¡ç®—å’Œå¤§æ•°æ®ï¼Œä»…ä»…æ˜¯Springåˆ›æ–°<br>çš„ä¸€äº›æ–¹é¢ã€‚è€Œä¸”æœªæ¥ï¼ŒSpringä¼šç»§ç»­å‘å±•ã€‚</p>
<p>å°±åƒæˆ‘è¯´çš„ï¼Œå¯¹äºJavaç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¥½çš„æ—¶ä»£ã€‚ </p>
<p><strong>æ‘˜è‡ªã€ŠSpringå®æˆ˜ã€‹</strong></p>
<p>é¡¾åæ€ä¹‰ï¼ŒSpringå°±æ˜¯ä¸ºäº†ç®€åŒ–æˆ‘ä»¬Javaå¼€å‘è€Œæ¥çš„ï¼Œè€ŒSpringä¸»è¦è¿˜æ˜¯å›´ç»•ç€ä¸¤ä¸ªç‚¹ï¼šä¸€ä¸ªDIï¼ˆä¾èµ–æ³¨å…¥ï¼‰ï¼Œä¸€ä¸ªAOPï¼ˆé¢å‘åˆ‡é¢ï¼‰ï¼Œæˆ–è€…è¯´IOCï¼ˆæ§åˆ¶åè½¬ï¼‰å’ŒAOPï¼ˆé¢å‘åˆ‡é¢ï¼‰ã€‚</p>
<blockquote>
<p>IOCä¸»è¦çš„å®ç°æ–¹å¼æœ‰ä¸¤ç§ï¼šä¾èµ–æŸ¥æ‰¾ï¼Œä¾èµ–æ³¨å…¥<br>ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§æ›´å¯å–çš„æ–¹å¼</p>
</blockquote>
<p></p><h2>ä¾èµ–æ³¨å…¥â€”â€”Injecting Dependencies</h2><br>åˆšæ¥è§¦æ—¶ï¼ŒDIè¿™ä¸ªè¯åˆšå¬èµ·æ¥è§‰å¾—æ˜¯å®³æ€•çš„ï¼Œå®ƒå¯èƒ½æ˜¯ç›¸å½“å¤æ‚çš„ç¼–ç¨‹æŠ€æœ¯æˆ–è€…è®¾è®¡æ¨¡å¼ã€‚ä½†äº‹å®è¯æ˜ï¼ŒDIä¸€ç‚¹éƒ½ä¸åƒ ï¼Œå®ƒå¬èµ·æ¥é‚£ä¹ˆéš¾ã€‚é€šè¿‡åœ¨åº”ç”¨ä¸­ä½¿ç”¨DIï¼Œä½ ä¼šå‘ç°ä½ çš„åº”ç”¨ç¨‹åºå˜æ·¡ç®€å•ã€å®¹æ˜“ç†è§£å¹¶ä¸”æ˜“äºæµ‹è¯•ã€‚<br>é‚£ä¹ˆDIæ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢ï¼Ÿä¸€ä¸ªæ­£å¸¸çš„åº”ç”¨ç¨‹åºéƒ½æ˜¯æœ‰ä¸¤ä¸ªæˆ–è€…æ›´å¤šä¸ªç›¸äº’åä½œçš„ç±»ç»„åˆèµ·æ¥çš„ã€‚ä¼ ç»Ÿä¸Šï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ä¼šä¿å­˜å®ƒæ‰€ä»¥æ¥çš„å¯¹è±¡çš„å¼•ç”¨ã€‚è¿™ä¸ªä¼šå¯¼è‡´é«˜åº¦è€¦åˆå¹¶ä¸”éš¾äºæµ‹è¯•ã€‚<p></p>
<p>ä¾‹å¦‚ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> knights;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DamselRescuingKnight</span> <span class="keyword">implements</span> <span class="title">Knight</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> RescueDamselQuest quest;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DamselRescuingKnight</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.quest = <span class="keyword">new</span> RescueDamselQuest();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">embarkOnQuest</span><span class="params">()</span></span>&#123;</span><br><span class="line">        quest.embark();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œéª‘å£«åˆ›å»ºäº†ä¸€ä¸ªå°‘å¥³éœ€è¦è¥æ•‘çš„è¯·æ±‚ï¼ˆRescueDamselQuestï¼‰åœ¨å®ƒè‡ªå·±çš„æ„é€ å‡½æ•°ä¸­ã€‚è¿™ä¸ªä¼šä½¿éª‘å£«ä¸å°‘å¥³è¯·æ±‚ç»‘å®šåˆ°ä¸€èµ·ï¼Œè¿™ä¸¥é‡é™åˆ¶äº†éª‘å£«çš„èƒ½åŠ›ã€‚å¦‚æœä¸€ä¸ªå°‘å¥³éœ€è¦è¥æ•‘ï¼Œé‚£æ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœä¸€å¤´å·¨é¾™éœ€è¦è¢«æ€æ­»ï¼Œé‚£ä¹ˆéª‘å£«ä»€ä¹ˆéƒ½åšä¸äº†ï¼Œåªèƒ½ååœ¨æ—è¾¹è§‚çœ‹ã€‚</p>
<p>æ‰€ä»¥è€¦åˆæ˜¯ä¸€ä¸ªç‰¹åˆ«éš¾ä»¥æ‹“å±•çš„é—®é¢˜ï¼Œä¸€æ–¹é¢ï¼Œè€¦åˆçš„ä»£ç éš¾äºæµ‹è¯•ã€éš¾äºé‡ç”¨ã€éš¾ä»¥ç†è§£å¹¶ä¸”ä»–ç»å¸¸å¯¼è‡´â€œæ‰“åœ°é¼ â€çš„Bugè¡Œä¸ºï¼ˆä¸€ç§ä¿®æ”¹ä¸€ä¸ªBugé€šå¸¸ä¼šå¼•èµ·å…¶ä»–æ–°çš„ä¸€ä¸ªç”šè‡³æ›´å¤šçš„æ–°bugçš„è¡Œä¸ºï¼‰ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸€å®šæ•°é‡çš„è€¦åˆä»£ç æ˜¯å¿…é¡»çš„ï¼Œå®Œå…¨ä¸è€¦åˆçš„ä»£ç å°†ä»€ä¹ˆäº‹æƒ…éƒ½ä¸åšã€‚ä¸ºäº†å»åšä¸€äº›æœ‰ç”¨çš„äº‹æƒ…ï¼Œç±»éœ€è¦çŸ¥é“å½¼æ­¤ã€‚è€¦åˆæ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯å¿…é¡»è¢«å°å¿ƒçš„ç®¡ç†ã€‚</p>
<p>å› æ­¤ä½¿ç”¨DIï¼Œå¯¹è±¡åœ¨åˆ›å»ºçš„æ—¶å€™è¢«ä¸€äº›ç¡®å®šç³»ç»Ÿå¯¹è±¡åæ ‡çš„ç¬¬ä¸‰æ–¹å»ç»™äºˆå‡ºå…¶ä¾èµ–ï¼Œå¯¹è±¡ä¸éœ€è¦å»åˆ›å»ºæˆ–è€…è·å–å…¶ä¾èµ–ï¼Œåƒä¸‹å›¾æè¿°çš„é‚£æ ·ï¼Œä¾èµ–è¢«æ³¨å…¥è¿›äº†éœ€è¦ä»–ä»¬çš„å¯¹è±¡ã€‚</p>
<p>æ‰€ä»¥é’ˆå¯¹ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸€ä¸ªçµæ´»çš„éª‘å£«</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> knights;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BraveKnight</span> <span class="keyword">implements</span> <span class="title">Knight</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Quest quest;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BraveKnight</span><span class="params">(Quest quest)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.quest = quest;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">embarkOnQuest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        quest.embark();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å°±åƒåœ¨ä¸Šé¢çœ‹åˆ°çš„ä¸€æ ·ï¼ŒBraveKnightä¸åƒDamselRescuingKnight ä¸€æ ·åˆ›å»ºè‡ªå·±çš„Questï¼Œè€Œæ˜¯åœ¨æ„é€ å‡½æ•°çš„å‚æ•°ä¸­ä¼ å…¥Questï¼Œè¿™æ ·çš„DIå°±æ˜¯è‘—åçš„æ„é€ å‡½æ•°æ³¨å…¥ï¼ˆConstructor injectionï¼‰ã€‚</p>
<p>æ›´é‡è¦çš„æ˜¯ï¼Œé‚£ä¸ªQueståªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‰€æœ‰å®ç°è¯¥æ¥å£çš„å®ç°éƒ½å¯ä»¥ä¼ å…¥ã€‚æ‰€ä»¥BraveKnightå¯ä»¥å¤„ç†ä¸åŒçš„ éœ€æ±‚ã€‚</p>
<p>å…³é”®ç‚¹å°±æ˜¯BraveKnightæ²¡æœ‰è·Ÿä»»ä½•ç‰¹å®šçš„Questè¿›è¡Œç»‘å®šã€‚å®ƒä¸åœ¨ä¹æ˜¯ä»€ä¹ˆæ ·çš„è¯·æ±‚ï¼Œåªè¦è¯¥è¯·æ±‚å®ç°äº†Questæ¥å£å°±å¯ä»¥ã€‚è¿™ä¸ªå°±æ˜¯DIçš„å¥½å¤„â€“æ¾è€¦åˆã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡çš„ä¾èµ–åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆä½ å¯ä»¥å°†ä»–çš„å® ç°ä»ä¸€ä¸ªæ¢æˆå¦å¤–ä¸€ä¸ªã€‚</p>
<p>æ—¢ç„¶ä½ BraveKnightå¯¹è±¡å¯ä»¥å¤„ç†ä»»ä½•ä½ æƒ³ä¼ é€’ç»™ä»–çš„Questå¯¹è±¡ï¼Œå‡è®¾ä½ æƒ³ä¼ é€’ä¸€ä¸ªæ€æ­»å·¨é¾™çš„Questï¼Œé‚£ä¹ˆ ä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªSlayDragonQuestç»™ä»–æ˜¯åˆé€‚çš„ã€‚<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SlayDragonQuest</span> <span class="keyword">implements</span> <span class="title">Quest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> PrintStream stream;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SlayDragonQuest</span><span class="params">(PrintStream stream)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stream = stream;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">embark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stream.println(<span class="string">"Embarking on quest to slay the dragon"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å°±åƒä½ æ‰€çœ‹åˆ°çš„ä¸€æ ·ï¼ŒSlayDragonQuestå®ç°äº†Questæ¥å£ï¼Œä½¿å¾—å®ƒé€‚åˆBraveKnightã€‚</p>
<p>åº”ç”¨ç»„ä»¶ä¹‹é—´åˆ›å»ºå…³è”çš„è¡Œä¸ºé€šå¸¸ç§°ä¸ºå¸ƒçº¿æˆ–è€…è£…é…ï¼ˆwiringï¼‰ã€‚åœ¨Springä¸­ï¼Œç»„ä»¶ä¹‹é—´çš„è£…é…æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä½†æ˜¯ä¸€ä¸ªé€šå¸¸çš„æ–¹å¼æ˜¯ä½¿ç”¨XMLã€‚æ¥ä¸‹æ¥çš„æ¸…å•å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„Springé…ç½®æ–‡ä»¶â€“knights.xmlï¼Œå®ƒå°†ä¸€ä¸ªSlayDragonQuestã€BraveKnightå’Œä¸€ä¸ªPrintStreamè£…é…èµ·æ¥ã€‚</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span></span><br><span class="line"><span class="xml">       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line"><span class="xml">       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"knight"</span> <span class="attr">class</span>=<span class="string">"com.springinaction.knights.BraveKnight"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!--questæ³¨å…¥questçš„Bean--&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"quest"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--åˆ›å»ºQuest--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"quest"</span> <span class="attr">class</span>=<span class="string">"com.springinaction.knights.SlayDragonQuest"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"#</span></span></span><span class="template-variable">&#123;$(System).out&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œï¼ŒBraveKnightå’ŒSlayDragonQuestè¢«å£°æ˜ä¸ºBeanï¼Œåœ¨BraveKnight Beanä¸­ï¼Œé€šè¿‡ä¼ é€’ä¸€ä¸ªQuestçš„å¼•ç”¨ä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°ã€‚åŒæ—¶ï¼ŒSlayDragonQuestä½¿ç”¨Springè¡¨è¾¾å¼è¯­è¨€ä¼ é€’ä¸€ä¸ªSystem.outçš„æ„é€ å‡½æ•°å‚æ•°ç»™SlayDragonQuestå¯¹è±¡ã€‚å¦‚æœXMLé…ç½®æ–‡ä»¶ä¸é€‚åˆä½ çš„å£å‘³ï¼Œä½ å¯ä»¥ä½¿ç”¨Javaæ–¹å¼è¿›è¡Œé…ç½®ã€‚å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KnightConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Knight <span class="title">knight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BraveKnight(quest());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Quest <span class="title">quest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SlayDragonQuest(System.out);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸ç®¡ä½¿ç”¨xmlè¿˜æ˜¯javaï¼Œä¾èµ–æ³¨å…¥çš„å¥½å¤„éƒ½æ˜¯ä¸€æ ·çš„ã€‚å°½ç®¡BraveKnightä¾èµ–Questï¼Œä½†æ˜¯å®ƒä¸éœ€è¦çŸ¥é“å…·ä½“æ˜¯ä»€ä¹ˆQuestï¼ŒåŒæ ·çš„SlayDragonQuestä¹Ÿä¸éœ€è¦çŸ¥é“å…·ä½“çš„PrintStreamç±»å‹ã€‚åœ¨Springä¸­ï¼Œä»…ä»…é€šè¿‡é…ç½®ä½¿å¾—æ‰€æœ‰çš„ç‰‡æ®µç»„è£…åœ¨ä¸€èµ·ã€‚è¿™ä¸ªå°±ä½¿å¾—å¯ä»¥å»æ”¹å˜ä»–ä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»è€Œä¸éœ€è¦å»ä¿®æ”¹ç±»çš„å®ç°ã€‚</p>
<p></p><h2>AOPâ€”â€”Aspect-OrientedProgramming</h2><br>è™½ç„¶DIå¯ä»¥ä½¿å¾—ä½ çš„åº”ç”¨ç¨‹åºç»„ä»¶ä¹‹é—´æ˜¯æ¾è€¦åˆçš„ï¼Œä½†æ˜¯AOPå¯ä»¥ä½¿å¾—ä½ å¯ä»¥åœ¨ä½ åº”ç”¨ç¨‹åºä¸­å»æ•è·Beançš„åŠŸèƒ½ã€‚<p></p>
<p>AOPé€šå¸¸è¢«å®šä¹‰ä¸ºåˆ†ç¦»è½¯ä»¶å…³æ³¨ç‚¹çš„ä¸€ç§æŠ€æœ¯ã€‚ç³»ç»Ÿé€šå¸¸ç”±ä¸€äº›å…·æœ‰ç‰¹å®šåŠŸèƒ½çš„ç»„ä»¶ç»„æˆã€‚ä½†æ˜¯ï¼Œé€šå¸¸è¿™äº›ç»„ä»¶ä¹Ÿé™„å¸¦ä¸€äº›é™¤äº†æ ¸å¿ƒåŠŸèƒ½ä¹‹å¤–çš„ä¸€äº›åŠŸèƒ½ã€‚ç³»ç»ŸæœåŠ¡ï¼Œå¦‚æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†å’Œå®‰å…¨æ€§ï¼Œé€šå¸¸ä¼šåœ¨æ¯ä¸ªç»„ä»¶ä¸­éƒ½æ˜¯éœ€è¦çš„ã€‚è¿™äº›ç³»ç»ŸæœåŠ¡é€šå¸¸è¢«ç§°ä¸ºæ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆcross-cutting concernsï¼‰ï¼Œå› ä¸ºä»–ä»¬ä¼šåœ¨ç³»ç»Ÿä¸­åˆ‡å‰²å¤šä¸ªç»„ä»¶ã€‚</p>
<p>é€šè¿‡ä¼ é€’è¿™äº›æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œä½ ä¼šæä¾›ä½ åº”ç”¨ç¨‹åºçš„å¤æ‚æ€§ï¼š</p>
<p><li>ä»£ç é‡å¤ã€‚è¿™å°±æ„å‘³ç€ä½ å¦‚æœä¿®æ”¹å…¶ä¸­ä¸€ä¸ªåŠŸèƒ½ï¼Œä½ ä¿®æ”¹éœ€è¦è®¸å¤šçš„ç»„ä»¶ã€‚å³ä½¿ä½ æŠŠå…³æ³¨ç‚¹æŠ½è±¡ä¸ºä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ï¼Œè¿™æ ·å¯¹ä½ ç»„ä»¶çš„å½±å“æ˜¯ä¸€ä¸ªå•ä¸€çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è°ƒç”¨ä¹Ÿä¼šåœ¨å¤šä¸ªåœ°æ–¹é‡å¤ã€‚</li></p>
<p><li>ä½ çš„ç»„ä»¶ä¸­å……æ–¥è¿™ä¸å®ƒæ ¸å¿ƒåŠŸèƒ½ä¸ä¸€è‡´çš„ä»£ç ã€‚å¦‚æ·»åŠ ä¸€ä¸ªæ¡ç›®åˆ°ä¸€ä¸ªåœ°å€ç°¿ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥åªå…³å¿ƒå¦‚ä½•æ·»åŠ åœ°å€ï¼Œè€Œä¸æ˜¯å…³å¿ƒæ˜¯å¦å®‰å…¨æˆ–è€…æ˜¯å¦å…·æœ‰äº‹åŠ¡ä¸€è‡´æ€§ã€‚</li></p>
<p>AOPå¯ä»¥æ¨¡å—åŒ–è¿™äº›æœåŠ¡ï¼Œå¹¶ä¸”é€šè¿‡å£°æ˜å¼çš„æ–¹å¼åº”ç”¨è¿™äº›æœåŠ¡ï¼Œè¿™å°†å¯¼è‡´ç»„ä»¶æ›´åŠ å…·æœ‰å‡èšåŠ›ï¼Œå¹¶ä¸”ç»„ä»¶ä¸“æ³¨äºè‡ªå·±ç‰¹å®šçš„åŠŸèƒ½ï¼Œå¯¹å¯èƒ½æ¶‰åŠçš„ç³»ç»ŸæœåŠ¡å®Œå…¨ä¸çŸ¥æƒ…ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è®©POJOå§‹ç»ˆä¿æŒæ‰å¹³ã€‚</p>
<p>ä¸‹é¢ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤ºåˆ†ç¦»æ ¸å¿ƒåŠŸèƒ½ä¸ç³»ç»ŸæœåŠ¡ï¼š<br><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Minstrel</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> PrintStream stream;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Minstrel</span><span class="params">(PrintStream stream)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stream = stream;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//called before quest</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">singleBeforeQuest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stream.<span class="built_in">println</span>(<span class="string">"Fa la la, the knight is so brave"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//called after quest</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">singleAfterQuest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stream.<span class="built_in">println</span>(<span class="string">"Tee hee hee, the brave knight did embark on a quest"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å°±åƒä½ çœ‹åˆ°çš„ä¸€æ ·ï¼ŒMinstrelæ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæ–¹æ³•çš„ç®€å•å¯¹è±¡ï¼Œè¿™æ˜¯ç®€å•çš„ï¼Œå°†è¿™ä¸ªæ³¨å…¥è¿›æˆ‘ä»¬ä¹‹å‰çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BraveKnight</span> <span class="keyword">implements</span> <span class="title">Knight</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Quest quest;</span><br><span class="line">    <span class="keyword">private</span> Minstrel minstrel;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BraveKnight</span><span class="params">(Quest quest, Minstrel minstrel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.quest = quest;</span><br><span class="line">        <span class="keyword">this</span>.minstrel = minstrel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">embarkOnQuest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        minstrel.singleBeforeQuest();</span><br><span class="line">        quest.embark();</span><br><span class="line">        minstrel.singleAfterQuest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç°åœ¨ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­åŠ å…¥Ministrelçš„æ„é€ å‡½æ•°å‚æ•°ã€‚ä½†æ˜¯ï¼Œç­‰ç­‰â€¦.</p>
<p>å¥½åƒçœ‹èµ·æ¥ä¸å¯¹ï¼Œè¿™ä¸ªçœŸçš„æ˜¯éª‘å£«æœ¬èº«å…³æ³¨çš„å—ï¼Ÿéª‘å£«åº”è¯¥ä¸å¿…è¦åšè¿™ä¸ªå·¥ä½œã€‚æ¯•ç«Ÿï¼Œè¿™æ˜¯ä¸€ä¸ªæ­Œæ‰‹çš„å·¥ä½œï¼Œæ­Œé¢‚éª‘å£«çš„åŠªåŠ›ï¼Œä¸ºä»€ä¹ˆå…¶å®ä¸€ç›´åœ¨æé†’æ­Œæ‰‹å‘¢ï¼Ÿ</p>
<p>å¦å¤–ï¼Œç”±äºéª‘å£«å¿…é¡»çŸ¥é“æ­Œæ‰‹ï¼Œä½ è¢«è¿«ä¼ é€’æ­Œæ‰‹ç»™éª‘å£«ï¼Œè¿™ä¸ªä¸ä»…ä½¿éª‘å£«çš„ä»£ç å¤æ‚ï¼Œè€Œä¸”è®©æˆ‘å¾ˆå›°æƒ‘ï¼Œå½“æˆ‘éœ€è¦ä¸€ä¸ªéª‘å£«è€Œæ²¡æœ‰ä¸€ä¸ªæ­Œæ‰‹çš„æ—¶å€™ï¼Œå¦‚æœMinistrelä¸ºnullï¼Œåœ¨ä»£ç ä¸­è¿˜å¾—è¿›è¡Œéç©ºåˆ¤æ–­ï¼Œç®€å•çš„BraveKnightä»£ç å¼€å§‹å˜å¾—å¤æ‚ã€‚ä½†æ˜¯ä½¿ç”¨AOPï¼Œä½ å¯ä»¥å®£å¸ƒæ­Œæ‰‹å¿…é¡»æ­Œå”±éª‘å£«çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ï¼Œé‡Šæ”¾éª‘å£«ï¼Œç›´æ¥å¤„ç†æ­Œæ‰‹çš„æ–¹æ³•ã€‚</p>
<p>åœ¨Springé…ç½®æ–‡ä»¶ä¸­ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯å°†æ­Œæ‰‹å£°æ˜ä¸ºä¸€ä¸ªåˆ‡é¢ã€‚å¦‚ä¸‹ï¼š<br><figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span></span><br><span class="line"><span class="xml">       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line"><span class="xml">       xmlns:aop="http://www.springframework.org/schema/aop"</span></span><br><span class="line"><span class="xml">       xsi:schemaLocation="http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="xml">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="xml">       http://www.springframework.org/schema/aop</span></span><br><span class="line"><span class="xml">       http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"knight"</span> <span class="attr">class</span>=<span class="string">"com.springinaction.knights.BraveKnight"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!--questæ³¨å…¥questçš„Bean--&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"quest"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--åˆ›å»ºQuest--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"quest"</span> <span class="attr">class</span>=<span class="string">"com.springinaction.knights.SlayDragonQuest"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"#</span></span></span><span class="template-variable">&#123;T(System).out&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--å®šä¹‰æ­Œæ‰‹çš„Bean--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"ministrel"</span> <span class="attr">class</span>=<span class="string">"com.springinaction.knights.Minstrel"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"#</span></span></span><span class="template-variable">&#123;T(System).out&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"ministrel"</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="comment">&lt;!--å®šä¹‰åˆ‡ç‚¹--&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"embark"</span> <span class="attr">expression</span>=<span class="string">"execution(* *.embarkOnQuest(..))"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="comment">&lt;!--å®šä¹‰å‰ç½®é€šçŸ¥--&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">pointcut-ref</span>=<span class="string">"embark"</span> <span class="attr">method</span>=<span class="string">"singleBeforeQuest"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="comment">&lt;!--å®šä¹‰åç½®é€šçŸ¥--&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"singleAfterQuest"</span> <span class="attr">pointcut-ref</span>=<span class="string">"embark"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨Springçš„AOPé…ç½®ä¸€ä¸ªMinistrelä½œä¸ºåˆ‡é¢ï¼Œåœ¨åˆ‡é¢é‡Œé¢ï¼Œå®šä¹‰ä¸€ä¸ªåˆ‡ç‚¹ï¼Œç„¶åå®šä¹‰å‰ç½®é€šçŸ¥ï¼ˆbefore adviceï¼‰å’Œåç½®é€šçŸ¥ï¼ˆafter adviceï¼‰ã€‚åœ¨ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œpointcut-refå±æ€§éƒ½ä½¿ç”¨äº†ä¸€ä¸ªembarkçš„å¼•ç”¨ï¼Œè¿™ä¸ªåˆ‡ç‚¹æ˜¯é€šè¿‡pointcutå…ƒç´ å®šä¹‰çš„ï¼Œå®ƒè¡¨æ˜é€šçŸ¥åº”è¯¥åº”ç”¨åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Œè¡¨è¾¾å¼çš„è¯­æ³•éµå¾ªAspectJçš„åˆ‡ç‚¹è¡¨è¾¾å¼è¯­æ³•ã€‚</p>
<p>é¦–å…ˆï¼ŒMinistrelå§‹ç»ˆæ˜¯ä¸€ä¸ªPOJOï¼Œæ²¡æœ‰ä»»ä½•è¯´æ˜ä»–æ˜¯ç”¨æ¥ä½œä¸ºåˆ‡é¢çš„ã€‚ä½œä¸ºä¸€ä¸ªåˆ‡é¢æ˜¯é€šè¿‡Springé…ç½®æ–‡ä»¶å®ç°çš„ã€‚å…¶æ¬¡ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼ŒMinistrelå¯ä»¥åº”ç”¨åˆ°BraveKnightè€Œä¸éœ€è¦BraveKnightç›´æ¥è°ƒç”¨å®ƒï¼Œå®é™…ä¸Šï¼ŒBraveKnightæ ¹æœ¬ä¸çŸ¥é“Ministrelçš„å­˜åœ¨ã€‚</p>
<p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œä½ å¯ä»¥ä½¿ç”¨Springçš„é­”æ³•ä½¿å¾—Ministrelä½œä¸ºä¸€ä¸ªåˆ‡é¢ï¼Œä½†æ˜¯Ministrelå¿…é¡»é¦–å…ˆæ˜¯ä¸€ä¸ªSpringçš„Beanï¼Œå…³é”®çš„å°±æ˜¯ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•Spring Beanä½œä¸ºåˆ‡é¢ï¼Œè€Œä¸”å¯ä»¥å°†å…¶æ³¨å…¥å…¶ä»–çš„Beanä¸­ã€‚</p>
<p><strong>è¿™äº›åŸºç¡€çš„ç†è®ºéƒ½æ˜¯ä»ã€ŠSpringå®æˆ˜ç¬¬å››ç‰ˆã€‹ä¸€ä¹¦ä¸­è®°å½•ä¸‹æ¥çš„ï¼Œä»¥åçš„å­¦ä¹ ä¸­ï¼Œå°†ä¼šæºæ‚ä»¥è‡ªå·±è§†è§’æ¥å†™ã€‚</strong></p>
<p><strong>ps:å…¶å®ä¹‹å‰æœ‰å†™è¿‡Springçš„ä¸€äº›ç†è§£ï¼Œä½†æ˜¯å¼€å‘è¿‡ç¨‹ä¸­è¿˜æ˜¯å‘ç°å¾ˆå¤šç»†èŠ‚éƒ½ä¸ç†è§£ä¸æ˜ç™½ï¼Œå› ä¸ºä¹‹å‰Springçš„å­¦ä¹ éƒ½æ˜¯åŸºäºå¼€å‘è¿‡ç¨‹ä¸­è¾¹åšè¾¹å­¦ï¼Œæ‰€ä»¥å†³å®šä»å¤´å¼€å§‹ç³»ç»Ÿçš„å­¦ä¹ ã€‚</strong></p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Spring</tag>
        <tag>æ¡†æ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>userIdåˆ†åº“ï¼Œæ€ä¹ˆé€šè¿‡å…¶ä»–å­—æ®µæŸ¥è¯¢</title>
    <url>/2017/04/18/userId%E5%88%86%E5%BA%93%EF%BC%8C%E6%80%8E%E4%B9%88%E9%80%9A%E8%BF%87%E5%85%B6%E4%BB%96%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ç”¨æˆ·ä¸­å¿ƒæ˜¯å‡ ä¹æ¯ä¸€ä¸ªå…¬å¸å¿…å¤‡çš„åŸºç¡€æœåŠ¡ï¼Œç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯æŸ¥è¯¢ä¸ä¿®æ”¹éƒ½ç¦»ä¸å¼€ç”¨æˆ·ä¸­å¿ƒã€‚</p>
<p>å½“æ•°æ®é‡è¶Šæ¥è¶Šå¤§æ—¶ï¼Œéœ€è¦å¤šç”¨æˆ·ä¸­å¿ƒè¿›è¡Œæ°´å¹³åˆ‡åˆ†ã€‚æœ€å¸¸è§çš„æ°´å¹³åˆ‡åˆ†æ–¹å¼ï¼Œ<strong>æŒ‰ç…§userIdå–æ¨¡åˆ†åº“</strong>ï¼š<a id="more"></a></p>
<p>ä¾‹å¦‚ï¼š</p>
<p><img src="http://img.blog.csdn.net/20170418093703450" height="300px" width="500px"></p>
<p>é€šè¿‡userIdå–æ¨¡ï¼Œå°†æ•°æ®åˆ†å¸ƒåˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¸Šå»ï¼Œæé«˜æœåŠ¡å®ä¾‹ä¸ªæ•°ï¼Œé™ä½å•åº“æ•°æ®é‡ï¼Œä»¥è¾¾åˆ°æ‰©å®¹çš„ç›®çš„ã€‚</p>
<p>è¿™æ ·æ°´å¹³åˆ‡åˆ†ä¹‹åï¼ŒuserIdå±æ€§ä¸Šçš„æŸ¥è¯¢å¯ä»¥ç›´æ¥è·¯ç”±åˆ°åº“ï¼Œå¦‚ä¸Šå›¾ï¼Œå‡è®¾è®¿é—®uid=10çš„æ•°æ®ï¼Œå–æ¨¡åèƒ½å¤Ÿç›´æ¥å®šä½db1ã€‚</p>
<p>ä½†æ˜¯åˆ†åº“ä¹‹åï¼Œå¯¹äºå…¶ä»–å­—æ®µçš„æŸ¥è¯¢ï¼Œå°±ä¸èƒ½è¿™ä¹ˆå¹¸è¿äº†ã€‚å‡è®¾è®¿é—®userName=â€lizhiâ€çš„æ•°æ®ï¼Œç”±äºä¸çŸ¥é“æ•°æ®è½åœ¨å“ªä¸ªåº“ä¸Šï¼Œ<strong>å¾€å¾€éœ€è¦éå†æ‰€æœ‰åº“ï¼Œå½“åˆ†åº“æ•°é‡å¤šèµ·æ¥ï¼Œæ€§èƒ½ä¼šæ˜¾è‘—é™ä½</strong>ã€‚</p>
<p>æ‰€ä»¥æˆ‘è¦ä»¬å¯»æ‰¾å¦‚ä½•é«˜æ•ˆæŸ¥è¯¢çš„æ–¹æ³•ï¼ï¼ˆä»¥ä¸‹ç”¨userNameä¸ºä¾‹ï¼‰</p>
<h2>ç´¢å¼•è¡¨æ³•</h2>

<p>æ€è·¯ï¼šuserIdç›´æ¥å®šä½åˆ°åº“ï¼ŒuserNameä¸èƒ½ç›´æ¥å®šä½åˆ°åº“ï¼Œå¦‚æœé€šè¿‡userNameèƒ½æŸ¥è¯¢åˆ°userIdï¼Œé—®é¢˜è§£å†³ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š<br><br>1ï¼‰å»ºç«‹ä¸€ä¸ªç´¢å¼•è¡¨è®°å½•userName-&gt;userIdçš„æ˜ å°„å…³ç³»<br>2ï¼‰ç”¨userNameæ¥è®¿é—®æ—¶ï¼Œå…ˆé€šè¿‡ç´¢å¼•è¡¨æŸ¥è¯¢åˆ°userIdï¼Œå†å®šä½ç›¸åº”çš„åº“<br>3ï¼‰ç´¢å¼•è¡¨å±æ€§è¾ƒå°‘ï¼Œå¯ä»¥å®¹çº³éå¸¸å¤šæ•°æ®ï¼Œä¸€èˆ¬ä¸éœ€è¦åˆ†åº“<br>4ï¼‰å¦‚æœæ•°æ®é‡è¿‡å¤§ï¼Œå¯ä»¥é€šè¿‡userNameæ¥åˆ†åº“</p>
<p>æ½œåœ¨ä¸è¶³ï¼šå¤šä¸€æ¬¡æ•°æ®åº“æŸ¥è¯¢ï¼Œæ€§èƒ½ä¸‹é™ä¸€å€ã€‚</p>
<p></p><h2>ç¼“å­˜æ˜ å°„æ³•</h2><br>æ€è·¯ï¼šè®¿é—®ç´¢å¼•è¡¨æ€§èƒ½è¾ƒä½ï¼ŒæŠŠæ˜ å°„å…³ç³»æ”¾åœ¨ç¼“å­˜é‡Œæ€§èƒ½æ›´ä½³ã€‚<p></p>
<p>è§£å†³æ–¹æ¡ˆï¼š<br><br>1ï¼‰userNameæŸ¥è¯¢å…ˆåˆ°cacheä¸­æŸ¥è¯¢userIdï¼Œå†æ ¹æ®userIdå®šä½æ•°æ®åº“<br>2ï¼‰å‡è®¾cache missï¼Œé‡‡ç”¨æ‰«å…¨åº“æ³•è·å–userNameå¯¹åº”çš„userIdï¼Œæ”¾å…¥cache<br>3ï¼‰userNameåˆ°userIdçš„æ˜ å°„å…³ç³»ä¸ä¼šå˜åŒ–ï¼Œæ˜ å°„å…³ç³»ä¸€æ—¦æ”¾å…¥ç¼“å­˜ï¼Œä¸ä¼šæ›´æ”¹ï¼Œæ— éœ€æ·˜æ±°ï¼Œç¼“å­˜å‘½ä¸­ç‡è¶…é«˜<br>4ï¼‰å¦‚æœæ•°æ®é‡è¿‡å¤§ï¼Œå¯ä»¥é€šè¿‡userNameè¿›è¡Œcacheæ°´å¹³åˆ‡åˆ†</p>
<p>æ½œåœ¨ä¸è¶³ï¼šå¤šä¸€æ¬¡cacheæŸ¥è¯¢</p>
<p></p><h2>userNameç”ŸæˆuserId</h2><br>æ€è·¯ï¼šä¸è¿›è¡Œè¿œç¨‹æŸ¥è¯¢ï¼Œç”±userNameç›´æ¥å¾—åˆ°userId<p></p>
<p>è§£å†³æ–¹æ¡ˆï¼š<br><br>1ï¼‰åœ¨ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œè®¾è®¡å‡½æ•°userNameç”ŸæˆuserIdï¼ŒuserId=f(userName)ï¼ŒæŒ‰userIdåˆ†åº“æ’å…¥æ•°æ®<br>2ï¼‰ç”¨userNameæ¥è®¿é—®æ—¶ï¼Œå…ˆé€šè¿‡å‡½æ•°è®¡ç®—å‡ºuserIdï¼Œå³userId=f(userName)å†æ¥ä¸€éï¼Œç”±userIdè·¯ç”±åˆ°å¯¹åº”åº“</p>
<p>æ½œåœ¨ä¸è¶³ï¼šè¯¥å‡½æ•°è®¾è®¡éœ€è¦éå¸¸è®²ç©¶æŠ€å·§ï¼Œæœ‰userIdç”Ÿæˆå†²çªé£é™©</p>
<p></p><h2>userNameåŸºå› èå…¥userId</h2><br>æ€è·¯ï¼šä¸èƒ½ç”¨userNameç”ŸæˆuserIdï¼Œå¯ä»¥ä»userNameæŠ½å–â€œåŸºå› â€ï¼Œèå…¥userIdä¸­<p></p>
<p>å‡è®¾åˆ†8åº“ï¼Œé‡‡ç”¨userId%8è·¯ç”±ï¼Œæ½œå°è¯æ˜¯ï¼ŒuserIdçš„æœ€å3ä¸ªbitå†³å®šè¿™æ¡æ•°æ®è½åœ¨å“ªä¸ªåº“ä¸Šï¼Œè¿™3ä¸ªbitå°±æ˜¯æ‰€è°“çš„â€œåŸºå› â€ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š<br><br>1ï¼‰åœ¨ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œè®¾è®¡å‡½æ•°userNameç”Ÿæˆ3bitåŸºå› ï¼ŒuserName_gene=f(userName)<br>2ï¼‰åŒæ—¶ï¼Œç”Ÿæˆ61bitçš„å…¨å±€å”¯ä¸€idï¼Œä½œä¸ºç”¨æˆ·çš„æ ‡è¯†<br>3ï¼‰æ¥ç€æŠŠ3bitçš„userName_geneä¹Ÿä½œä¸ºuserIdçš„ä¸€éƒ¨åˆ†<br>4ï¼‰ç”Ÿæˆ64bitçš„userIdï¼Œç”±idå’ŒuserName_geneæ‹¼è£…è€Œæˆï¼Œå¹¶æŒ‰ç…§userIdåº“æ’å…¥æ•°æ®<br>5ï¼‰ç”¨userNameæ¥è®¿é—®æ—¶ï¼Œå…ˆé€šè¿‡å‡½æ•°ç”±userNameå†æ¬¡å¤åŸ3bitåŸºå› ï¼ŒuserName_gene=f(userName)ï¼Œé€šè¿‡userName_gene%8ç›´æ¥å®šä½åˆ°åº“</p>
]]></content>
      <categories>
        <category>æ•°æ®åº“é‚£ç‚¹äº‹</category>
      </categories>
      <tags>
        <tag>åˆ†åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºäºzxingç”ŸæˆäºŒç»´ç demo</title>
    <url>/2017/03/23/Java%E5%9F%BA%E4%BA%8Ezxing%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81demo/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>QRç å±äºçŸ©é˜µå¼äºŒç»´ç ä¸­çš„ä¸€ä¸ªç§ç±»ï¼Œç”±DENSO(æ—¥æœ¬ç”µè£…)å…¬å¸å¼€å‘ï¼Œç”±JISå’ŒISOå°†å…¶æ ‡å‡†åŒ–ã€‚QRç çš„æ ·å­å…¶å®åœ¨å¾ˆå¤šåœºåˆå·²ç»èƒ½å¤Ÿè¢«çœ‹åˆ°äº†ï¼Œæˆ‘è¿™è¿˜æ˜¯è´´ä¸ªå›¾å±•ç¤ºä¸€ä¸‹ï¼š</p>
<p><img src="http://img.blog.csdn.net/20170323193748791?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvTWVsb2RfYmM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" height="300" width="300"><br><a id="more"></a></p>
<p>è¿™ä¸ªå›¾å¦‚æœè¢«æ­£ç¡®è§£ç ï¼Œåº”è¯¥çœ‹åˆ°ç™¾åº¦ã€‚</p>
<p>å…·ä½“çš„ä¹Ÿä¸è¯´ä»€ä¹ˆäº†ï¼Œç™¾åº¦ä¸€å¤§æŠŠï¼Œç›´æ¥ä¸Šæºç ~</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.lincoln.Untils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.zxing.BarcodeFormat;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.EncodeHintType;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.MultiFormatWriter;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.common.BitMatrix;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.io.<span class="built_in">File</span>;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.awt.<span class="built_in">image</span>.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QRUtil</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BLACK = <span class="number">0xFF000000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> WHITE = <span class="number">0xFFFFFFFF</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param args</span></span><br><span class="line"><span class="comment">     * @throws Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> throws Exception </span>&#123;</span><br><span class="line">        <span class="keyword">String</span> <span class="built_in">text</span> = <span class="string">"http://www.baidu.com"</span>;</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">width</span> = <span class="number">300</span>;</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">height</span> = <span class="number">300</span>;</span><br><span class="line">        <span class="comment">//äºŒç»´ç çš„å›¾ç‰‡æ ¼å¼</span></span><br><span class="line">        <span class="keyword">String</span> format = <span class="string">"gif"</span>;</span><br><span class="line">        Hashtable hints = <span class="keyword">new</span> Hashtable();</span><br><span class="line">        <span class="comment">//å†…å®¹æ‰€ä½¿ç”¨ç¼–ç </span></span><br><span class="line">        hints.<span class="built_in">put</span>(EncodeHintType.CHARACTER_SET, <span class="string">"utf-8"</span>);</span><br><span class="line">        BitMatrix bitMatrix = <span class="keyword">new</span> MultiFormatWriter().encode(<span class="built_in">text</span>,</span><br><span class="line">                BarcodeFormat.QR_CODE, <span class="built_in">width</span>, <span class="built_in">height</span>, hints);</span><br><span class="line">        <span class="comment">//ç”ŸæˆäºŒç»´ç </span></span><br><span class="line">        <span class="built_in">File</span> outputFile = <span class="keyword">new</span> <span class="built_in">File</span>(<span class="string">"/Users/lizhi/Downloads"</span> + <span class="built_in">File</span>.separator + <span class="string">"new.gif"</span>);</span><br><span class="line">        QRUtil.writeToFile(bitMatrix, format, outputFile);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">QRUtil</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BufferedImage <span class="title">toBufferedImage</span><span class="params">(BitMatrix matrix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">width</span> = matrix.getWidth();</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">height</span> = matrix.getHeight();</span><br><span class="line">        BufferedImage <span class="built_in">image</span> = <span class="keyword">new</span> BufferedImage(<span class="built_in">width</span>, <span class="built_in">height</span>, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; <span class="built_in">width</span>; x++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; <span class="built_in">height</span>; y++) &#123;</span><br><span class="line">                <span class="built_in">image</span>.setRGB(x, y, matrix.<span class="built_in">get</span>(x, y) ? BLACK : WHITE);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">image</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeToFile</span><span class="params">(BitMatrix matrix, <span class="keyword">String</span> format, <span class="built_in">File</span> file)</span></span></span><br><span class="line"><span class="function">            throws IOException </span>&#123;</span><br><span class="line">        BufferedImage <span class="built_in">image</span> = toBufferedImage(matrix);</span><br><span class="line">        <span class="keyword">if</span> (!ImageIO.<span class="built_in">write</span>(<span class="built_in">image</span>, format, file)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Could not write an image of format "</span> + format + <span class="string">" to "</span> + file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeToStream</span><span class="params">(BitMatrix matrix, <span class="keyword">String</span> format, OutputStream stream)</span></span></span><br><span class="line"><span class="function">            throws IOException </span>&#123;</span><br><span class="line">        BufferedImage <span class="built_in">image</span> = toBufferedImage(matrix);</span><br><span class="line">        <span class="keyword">if</span> (!ImageIO.<span class="built_in">write</span>(<span class="built_in">image</span>, format, stream)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Could not write an image of format "</span> + format);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ©ï¼Œå°±è¿™ä¹ˆç®€å•ã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>äºŒç»´ç </tag>
      </tags>
  </entry>
  <entry>
    <title>Javaç½‘æ˜“çŸ­ä¿¡æ¥å…¥demo</title>
    <url>/2017/03/23/Java%E7%BD%91%E6%98%93%E7%9F%AD%E4%BF%A1%E6%8E%A5%E5%85%A5demo/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ç”±äºæœ€è¿‘ä½¿ç”¨äº‘ä¿¡æ·»åŠ çŸ­ä¿¡æ¥å…¥åŠŸèƒ½ï¼Œè®°å½•ä¸€ä¸‹ä¸€äº›ç‚¹é¿å…æ—¶é—´ä¹…äº†å¿˜è®°ã€‚<a id="more"></a></p>
<blockquote>
<p><strong>å‘çŸ­ä¿¡</strong></p>
</blockquote>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.lincoln.Untils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.NameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.message.BasicNameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Yunxin</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> throws Exception </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(sendMsg(<span class="string">"158********"</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> SERVER_URL = <span class="string">"https://api.netease.im/sms/sendcode.action"</span>;<span class="comment">//å‘é€éªŒè¯ç çš„è¯·æ±‚è·¯å¾„URL</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> APP_KEY = <span class="string">"*******"</span>;<span class="comment">//ç½‘æ˜“äº‘ä¿¡åˆ†é…çš„è´¦å·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> APP_SECRET = <span class="string">"*******"</span>;<span class="comment">//ç½‘æ˜“äº‘ä¿¡åˆ†é…çš„å¯†é’¥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> NONCE = <span class="string">"123456"</span>;<span class="comment">//éšæœºæ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> <span class="title">sendMsg</span><span class="params">(<span class="keyword">String</span> phone)</span> throws IOException </span>&#123;</span><br><span class="line">        CloseableHttpClient httpclient = HttpClients.createDefault();</span><br><span class="line">        HttpPost post = <span class="keyword">new</span> HttpPost(SERVER_URL);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">String</span> curTime = <span class="keyword">String</span>.valueOf((<span class="keyword">new</span> Date().getTime() / <span class="number">1000L</span>));</span><br><span class="line">        <span class="keyword">String</span> checkSum = CheckSumBuilder.getCheckSum(APP_SECRET, NONCE, curTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®è¯·æ±‚çš„header</span></span><br><span class="line">        post.addHeader(<span class="string">"AppKey"</span>, APP_KEY);</span><br><span class="line">        post.addHeader(<span class="string">"Nonce"</span>, NONCE);</span><br><span class="line">        post.addHeader(<span class="string">"CurTime"</span>, curTime);</span><br><span class="line">        post.addHeader(<span class="string">"CheckSum"</span>, checkSum);</span><br><span class="line">        post.addHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded;charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®è¯·æ±‚å‚æ•°</span></span><br><span class="line">        List&lt;NameValuePair&gt; nameValuePairs = <span class="keyword">new</span> ArrayList&lt;NameValuePair&gt;();</span><br><span class="line">        nameValuePairs.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"mobile"</span>, phone));</span><br><span class="line"></span><br><span class="line">        post.setEntity(<span class="keyword">new</span> UrlEncodedFormEntity(nameValuePairs, <span class="string">"utf-8"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰§è¡Œè¯·æ±‚</span></span><br><span class="line">        HttpResponse response = httpclient.execute(post);</span><br><span class="line">        <span class="keyword">String</span> responseEntity = EntityUtils.toString(response.getEntity(), <span class="string">"utf-8"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯å¦å‘é€æˆåŠŸï¼Œå‘é€æˆåŠŸè¿”å›true</span></span><br><span class="line">        <span class="keyword">String</span> code = JSON.parseObject(responseEntity).getString(<span class="string">"code"</span>);</span><br><span class="line">        <span class="keyword">if</span> (code.equals(<span class="string">"200"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"error"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>éªŒè¯</strong></p>
</blockquote>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lincoln.Untils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2017/3/22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.NameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.message.BasicNameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¡éªŒéªŒè¯ç å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @author Administrator</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> class MobileMessageCheck &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(checkMsg(<span class="string">"158********"</span>,<span class="string">"1234"</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> SERVER_URL = <span class="string">"https://api.netease.im/sms/verifycode.action"</span>;<span class="comment">//æ ¡éªŒéªŒè¯ç çš„è¯·æ±‚è·¯å¾„URL</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> APP_KEY = <span class="string">"*******"</span>;<span class="comment">//ç½‘æ˜“äº‘ä¿¡åˆ†é…çš„è´¦å·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> APP_SECRET = <span class="string">"*******"</span>;<span class="comment">//ç½‘æ˜“äº‘ä¿¡åˆ†é…çš„å¯†é’¥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> NONCE = <span class="string">"123456"</span>;<span class="comment">//éšæœºæ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> checkMsg(<span class="keyword">String</span> phone, <span class="keyword">String</span> sum) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        CloseableHttpClient httpclient = HttpClients.createDefault();</span><br><span class="line">        HttpPost post = <span class="keyword">new</span> HttpPost(SERVER_URL);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">String</span> curTime = <span class="keyword">String</span>.valueOf((<span class="keyword">new</span> Date().getTime() / <span class="number">1000</span>L));</span><br><span class="line">        <span class="keyword">String</span> checkSum = CheckSumBuilder.getCheckSum(APP_SECRET, NONCE, curTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®è¯·æ±‚çš„header</span></span><br><span class="line">        post.addHeader(<span class="string">"AppKey"</span>, APP_KEY);</span><br><span class="line">        post.addHeader(<span class="string">"Nonce"</span>, NONCE);</span><br><span class="line">        post.addHeader(<span class="string">"CurTime"</span>, curTime);</span><br><span class="line">        post.addHeader(<span class="string">"CheckSum"</span>, checkSum);</span><br><span class="line">        post.addHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded;charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®è¯·æ±‚å‚æ•°</span></span><br><span class="line">        List&lt;NameValuePair&gt; nameValuePairs = <span class="keyword">new</span> ArrayList&lt;NameValuePair&gt;();</span><br><span class="line">        nameValuePairs.<span class="built_in">add</span>(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"mobile"</span>, phone));</span><br><span class="line">        nameValuePairs.<span class="built_in">add</span>(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"code"</span>, sum));</span><br><span class="line"></span><br><span class="line">        post.setEntity(<span class="keyword">new</span> UrlEncodedFormEntity(nameValuePairs, <span class="string">"utf-8"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰§è¡Œè¯·æ±‚</span></span><br><span class="line">        HttpResponse response = httpclient.execute(post);</span><br><span class="line">        <span class="keyword">String</span> responseEntity = EntityUtils.toString(response.getEntity(), <span class="string">"utf-8"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯å¦å‘é€æˆåŠŸï¼Œå‘é€æˆåŠŸè¿”å›true</span></span><br><span class="line">        <span class="keyword">String</span> code = JSON.parseObject(responseEntity).getString(<span class="string">"code"</span>);</span><br><span class="line">        <span class="keyword">if</span> (code.equals(<span class="string">"200"</span>)) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"error"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>è·å–è®¡ç®—checksum</strong></p>
</blockquote>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.lincoln.Untils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2017/3/22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckSumBuilder</span> &#123;</span></span><br><span class="line">    <span class="comment">// è®¡ç®—å¹¶è·å–CheckSum</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> <span class="title">getCheckSum</span><span class="params">(<span class="keyword">String</span> appSecret, <span class="keyword">String</span> nonce, <span class="keyword">String</span> curTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> encode(<span class="string">"sha1"</span>, appSecret + nonce + curTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—å¹¶è·å–md5å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> <span class="title">getMD5</span><span class="params">(<span class="keyword">String</span> requestBody)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> encode(<span class="string">"md5"</span>, requestBody);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">String</span> <span class="title">encode</span><span class="params">(<span class="keyword">String</span> algorithm, <span class="keyword">String</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (value == null) &#123;</span><br><span class="line">            <span class="keyword">return</span> null;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MessageDigest messageDigest = MessageDigest.getInstance(algorithm);</span><br><span class="line">            messageDigest.update(value.getBytes());</span><br><span class="line">            <span class="keyword">return</span> getFormattedText(messageDigest.digest());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">String</span> <span class="title">getFormattedText</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = bytes.length;</span><br><span class="line">        StringBuilder buf = <span class="keyword">new</span> StringBuilder(len * <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j++) &#123;</span><br><span class="line">            buf.append(HEX_DIGITS[(bytes[j] &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0f</span>]);</span><br><span class="line">            buf.append(HEX_DIGITS[bytes[j] &amp; <span class="number">0x0f</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> buf.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] HEX_DIGITS =</span><br><span class="line">            &#123;<span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>äº²æµ‹æœ‰æ•ˆã€‚</p>
<p>ps:è¿™é‡Œç”¨çš„æ˜¯é»˜è®¤çš„çŸ­ä¿¡æ¨¡æ¿ï¼Œå¦‚æœè‡ªå®šä¹‰äº†çŸ­ä¿¡æ¨¡æ¿ï¼Œä¼ å…¥å‚æ•°çš„æ—¶å€™å¤šåŠ ä¸€ä¸ªæ¨¡æ¿idå°±è¡Œäº†ã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaä½¿ç”¨websocketå’ŒWebRTCå®ç°è§†é¢‘é€šè¯</title>
    <url>/2017/03/11/Java%E4%BD%BF%E7%94%A8websocket%E5%92%8CWebRTC%E5%AE%9E%E7%8E%B0%E8%A7%86%E9%A2%91%E9%80%9A%E8%AF%9D/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æœ€è¿‘è¿™æ®µæ—¶é—´æŠ˜è…¾äº†ä¸€ä¸‹WebRTCï¼Œè¿™ä¸¤å¤©ç»ˆäºæ˜¯æŠ½äº†æ—¶é—´æŠŠWebRTCæå®šäº†ï¼Œå»å¹´å°±æƒ³å¼„çš„ï¼Œä½†æ˜¯ç¡®å®æ²¡æ—¶é—´ã€‚çœ‹äº†ç½‘ä¸Šçš„<a href="https://apprtc.appspot.com/çš„ä¾‹å­ï¼ˆå¯èƒ½éœ€è¦ç¿»å¢™è®¿é—®ï¼‰ï¼Œè¿™ä¸ªä¾‹å­æ˜¯éƒ¨ç½²åœ¨Google" target="_blank" rel="noopener">https://apprtc.appspot.com/çš„ä¾‹å­ï¼ˆå¯èƒ½éœ€è¦ç¿»å¢™è®¿é—®ï¼‰ï¼Œè¿™ä¸ªä¾‹å­æ˜¯éƒ¨ç½²åœ¨Google</a> App Engineä¸Šçš„åº”ç”¨ç¨‹åºï¼Œä¾èµ–ä¸GAEçš„ç¯å¢ƒï¼Œåå°çš„è¯­è¨€æ˜¯pythonï¼Œè€Œä¸”è¿˜ä¾èµ–Google App Engine Channel APIï¼Œæ‰€ä»¥æ— æ³•åœ¨æœ¬åœ°è¿è¡Œï¼Œä¹Ÿæ— æ³•æ‰©å±•ã€‚è´¹äº†ä¸€ç•ªåŠŸå¤«ç ”è¯»äº†ä¾‹å­çš„pythonç«¯çš„æºä»£ç ï¼Œå†³å®šç”¨Javaå®ç°ï¼ŒTomcat7ä¹‹åå¼€å§‹æ”¯æŒWebSocketï¼Œæ‰“ç®—ç”¨WebSocketä»£æ›¿Google App Engine Channel APIå®ç°å‰åå°çš„é€šè®¯ï¼Œåœ¨æ•´ä¸ªä¾‹å­ä¸­Java+WebSocketèµ·åˆ°çš„ä½œç”¨æ˜¯è´Ÿè´£å®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡ï¼Œå¹¶ä¸è´Ÿè´£è§†é¢‘çš„ä¼ è¾“ï¼Œè§†é¢‘çš„ä¼ è¾“ä¾èµ–äºWebRTCã€‚<br><a id="more"></a></p>
<p>é¦–å…ˆWebRTC,è¿™ä¸ªå¯ä»¥ç™¾åº¦ä¸€ä¸‹ï¼Œå¤§æ¦‚å°±æ˜¯ä¸€ä¸ªéŸ³é¢‘å’Œè§†é¢‘é€šè®¯æŠ€æœ¯ï¼Œå¯ä»¥è·¨å¹³å°ï¼Œåªè¦èƒ½ç”¨æµè§ˆå™¨çš„åŸºæœ¬éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå½“ç„¶è¦ä½ çš„æµè§ˆå™¨æ”¯æŒã€‚</p>
<p>è¿™é‡Œå¼•ç”¨äº†googleçš„jsåº“ï¼š<code>channel.js</code>ã€‚ä¸è¿‡è¿˜æ˜¯ä¸‹è½½ä¸‹æ¥æ”¾åˆ°æœ¬åœ°æœåŠ¡å™¨å§ï¼Œå› ä¸ºå¾ˆå¤šåœ°æ–¹è®¿é—®google.comå¾ˆåƒåŠ›å•Šã€‚æœ€å¼€å§‹å°±æ˜¯è¿™ä¸ªjsæ²¡æœ‰åŠ è½½å®Œéƒé—·äº†å¾ˆä¹…ï¼Œè¿˜ä¸€ç›´ä»¥ä¸ºæ˜¯ä»£ç å†™é”™äº†ã€‚</p>
<p>å¦å¤–åœ¨è¿›å…¥é¡µé¢çš„æ—¶å€™ï¼Œæ³¨æ„åˆå§‹åŒ–é¡µé¢jsä¸­çš„ä¸€ä¸ªå‚æ•°ï¼š<code>initiator</code>ï¼šå¦‚æœæ˜¯åˆ›å»ºäººè¿™ä¸ªå‚æ•°è®¾ä¸ºfalseï¼›å¦‚æœæ˜¯åŠ å…¥çš„æ—¶å€™è¿™ä¸ªè®¾ç½®ä¸ºtrueã€‚ä¸ºtrueçš„æ—¶å€™ï¼Œæ‰ä¼šå‘èµ·è§†é¢‘é€šè¯çš„è¯·æ±‚ã€‚</p>
<p><strong><h2>å®ç°</h2></strong></p>
<p>å¯¹äºå‰ç«¯JSä»£ç åŠç”¨åˆ°çš„å¯¹è±¡å¤§å®¶å¯ä»¥å»æŸ¥çœ‹è¯¦ç»†çš„ä»£ç ä»‹ç»ï¼Œæˆ‘å°±è´´ä¸€ä¸ªè¿æ¥çš„æ–¹æ³•ã€‚é¦–å…ˆå»ºç«‹ä¸€ä¸ªå®¢æˆ·ç«¯å®æ—¶è·å–çŠ¶æ€çš„è¿æ¥ï¼Œåœ¨GAEçš„ä¾‹å­ä¸Šæ˜¯é€šè¿‡GAE Channel APIå®ç°ï¼Œæˆ‘åœ¨è¿™é‡Œç”¨WebSocketå®ç°ï¼Œä»£ç ï¼š</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">function openChannel() &#123;  </span><br><span class="line">     console.log(<span class="string">"æ‰“å¼€websocket"</span>)<span class="comment">;</span></span><br><span class="line">     socket = new WebSocket(<span class="string">"ws://192.168.1.158:8080/WebRTC/acgist.video/$&#123;requestScope.uid&#125;"</span>)<span class="comment">;				</span></span><br><span class="line">	 socket.onopen = onChannelOpened<span class="comment">;</span></span><br><span class="line">	 socket.onmessage = onChannelMessage<span class="comment">;</span></span><br><span class="line">	 socket.onclose = onChannelClosed<span class="comment">;  </span></span><br><span class="line">	 socket.onerror = onChannelError()<span class="comment">;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æœåŠ¡ç«¯ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯æ”¶åˆ°ç”¨æˆ·çš„è¯·æ±‚ï¼Œå‘é€ç»™å¦å¤–ä¸€ä¸ªç”¨æˆ·å°±å¯ä»¥äº†ï¼Œè¿™é‡Œå¤„ç†çš„å…¶å®æ˜¯ç”¨æˆ·WebRTCçš„ä¸€äº›ä¿¡æ¯ï¼Œå¹¶ä¸æ˜¯å»ä¼ è¾“è§†é¢‘ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.<span class="built_in">Map</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.websocket.OnClose;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.OnMessage;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.OnOpen;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.Session;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.PathParam;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpoint;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>@author ææ™º</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>@date 2017/3/11</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> *</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>WebRTCè§†é¢‘é€šè¯</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> */</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@ServerEndpoint</span>(<span class="string">"/acgist.video/&#123;uid&#125;"</span>)</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">AcgistVideo</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æœ€å¤§é€šè¯æ•°é‡</span></span><br><span class="line">    private <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">int</span> MAX_COUNT = <span class="number">10</span>;</span><br><span class="line">    private <span class="keyword">static</span> <span class="keyword">final</span> long MAX_TIME_OUT = <span class="number">1</span> * <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line">    <span class="comment">// ç”¨æˆ·å’Œç”¨æˆ·çš„å¯¹è¯æ˜ å°„</span></span><br><span class="line">    private <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt; user_user = Collections.synchronizedMap(<span class="keyword">new</span> HashMap&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt;()); </span><br><span class="line">    <span class="comment">// ç”¨æˆ·å’Œwebsocketçš„sessionæ˜ å°„</span></span><br><span class="line">    private <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, Session&gt; sessions = Collections.synchronizedMap(<span class="keyword">new</span> HashMap&lt;<span class="built_in">String</span>, Session&gt;());</span><br><span class="line">     </span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>æ‰“å¼€websocket</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param session websocketçš„session</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param uid æ‰“å¼€ç”¨æˆ·çš„UID</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    public <span class="keyword">void</span> onOpen(Session session, <span class="meta">@PathParam</span>(<span class="string">"uid"</span>)<span class="built_in">String</span> uid) &#123;</span><br><span class="line">        session.setMaxIdleTimeout(MAX_TIME_OUT);</span><br><span class="line">        sessions.put(uid, session);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>websocketå…³é—­</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param session å…³é—­çš„session</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param uid å…³é—­çš„ç”¨æˆ·æ ‡è¯†</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    public <span class="keyword">void</span> onClose(Session session, <span class="meta">@PathParam</span>(<span class="string">"uid"</span>)<span class="built_in">String</span> uid) &#123;</span><br><span class="line">        remove(session, uid);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>æ”¶åˆ°æ¶ˆæ¯</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param message æ¶ˆæ¯å†…å®¹</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param session å‘é€æ¶ˆæ¯çš„session</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param uid</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    public <span class="keyword">void</span> onMessage(<span class="built_in">String</span> message, Session session, <span class="meta">@PathParam</span>(<span class="string">"uid"</span>)<span class="built_in">String</span> uid) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(uid != <span class="keyword">null</span> &amp;&amp; user_user.<span class="keyword">get</span>(uid) != <span class="keyword">null</span> &amp;&amp; AcgistVideo.sessions.<span class="keyword">get</span>(user_user.<span class="keyword">get</span>(uid)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Session osession = sessions.<span class="keyword">get</span>(user_user.<span class="keyword">get</span>(uid)); <span class="comment">// è¢«å‘¼å«çš„session</span></span><br><span class="line">                <span class="keyword">if</span>(osession.isOpen())</span><br><span class="line">                    osession.getAsyncRemote().sendText(<span class="keyword">new</span> <span class="built_in">String</span>(message.getBytes(<span class="string">"utf-8"</span>)));</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">this</span>.nowaiting(osession);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.nowaiting(session);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>æ²¡æœ‰äººåœ¨ç­‰å¾…</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param session å‘é€æ¶ˆæ¯çš„session</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    private <span class="keyword">void</span> nowaiting(Session session) &#123;</span><br><span class="line">        session.getAsyncRemote().sendText(<span class="string">"&#123;\"type\" : \"nowaiting\"&#125;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>æ˜¯å¦å¯ä»¥ç»§ç»­åˆ›å»ºé€šè¯æˆ¿é—´</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return å¯ä»¥ï¼štrueï¼›ä¸å¯ä»¥falseï¼›</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">static</span> boolean canCreate() &#123;</span><br><span class="line">        <span class="keyword">return</span> sessions.size() &lt;= MAX_COUNT;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>åˆ¤æ–­æ˜¯å¦å¯ä»¥åŠ å…¥</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param oid è¢«ç”³è¯·å¯¹è¯çš„ID</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return å¦‚æœèƒ½åŠ å…¥è¿”å›ï¼štrueï¼›å¦åˆ™è¿”å›falseï¼›</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">static</span> boolean canJoin(<span class="built_in">String</span> oid) &#123;</span><br><span class="line">        <span class="keyword">return</span> !(oid != <span class="keyword">null</span> &amp;&amp; user_user.containsKey(oid) &amp;&amp; user_user.<span class="keyword">get</span>(oid) != <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>æ·»åŠ è§†é¢‘å¯¹è±¡</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param uid ç”³è¯·å¯¹è¯çš„ID</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param oid è¢«ç”³è¯·å¯¹è¯çš„ID</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return æ˜¯å¦æ˜¯åˆ›å»ºè€…ï¼šå¦‚æœæ²¡æœ‰ç”³è¯·å¯¹è¯IDä¸ºåˆ›å»ºè€…ï¼Œå¦åˆ™ä¸ºä¸ºåŠ å…¥è€…ã€‚åˆ›å»ºè€…è¿”å›ï¼štrueï¼›åŠ å…¥è€…è¿”å›ï¼šfalseï¼›</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">static</span> boolean addUser(<span class="built_in">String</span> uid, <span class="built_in">String</span> oid) &#123;</span><br><span class="line">        <span class="keyword">if</span>(oid != <span class="keyword">null</span> &amp;&amp; !oid.isEmpty()) &#123;</span><br><span class="line">            AcgistVideo.user_user.put(uid, oid);</span><br><span class="line">            AcgistVideo.user_user.put(oid, uid);</span><br><span class="line">             </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            AcgistVideo.user_user.put(uid, <span class="keyword">null</span>);</span><br><span class="line">             </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>ç§»é™¤èŠå¤©ç”¨æˆ·</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param session ç§»é™¤çš„session</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param uid ç§»é™¤çš„UID</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    private <span class="keyword">static</span> <span class="keyword">void</span> remove(Session session, <span class="built_in">String</span> uid) &#123;</span><br><span class="line">        <span class="built_in">String</span> oid = user_user.<span class="keyword">get</span>(uid);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(oid != <span class="keyword">null</span>) user_user.put(oid, <span class="keyword">null</span>); <span class="comment">// è®¾ç½®å¯¹æ–¹æ— äººèŠå¤©</span></span><br><span class="line">         </span><br><span class="line">        sessions.remove(uid); <span class="comment">// å¼‚å¸¸session</span></span><br><span class="line">        user_user.remove(uid); <span class="comment">// ç§»é™¤è‡ªå·±</span></span><br><span class="line">         </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(session != <span class="keyword">null</span> &amp;&amp; session.isOpen()) session.close(); <span class="comment">// å…³é—­session</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡ªå·±æµ‹è¯•çš„æ—¶å€™æä¸ªå…¬ç”¨çš„stunæœåŠ¡å™¨å¼„ä¸€å¼„å°±å¥½äº†ã€‚ä¸è¿‡äººå¤šçš„æ—¶å€™ä¼šå»¶è¿Ÿå¾ˆå°±æ˜¯äº†ï¼ŒæˆåŠŸæˆªå›¾å°±ä¸æ”¾äº†ï¼Œäººä¸‘å®¶è´«ã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>WebSocket</tag>
        <tag>WebRTC</tag>
      </tags>
  </entry>
  <entry>
    <title>spring iocåŸç†ï¼ˆè‡ªå·±ä¹Ÿå¯ä»¥å†™ä¸ªspringï¼‰</title>
    <url>/2017/03/10/spring-ioc%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æœ€è¿‘ï¼Œä¹°äº†æœ¬springå…¥é—¨ä¹¦ï¼šspring In Action ã€‚å¤§è‡´æµè§ˆäº†ä¸‹æ„Ÿè§‰è¿˜ä¸é”™ã€‚å°±æ˜¯å…¥é—¨äº†ç‚¹ã€‚Manningçš„ä¹¦è¿˜æ˜¯ä¸é”™çš„ï¼Œæˆ‘è™½ç„¶ä¸åƒå“ªäº›åªçœ‹Manningä¹¦çš„äººé‚£æ ·ä¸“æ³¨äºManning,ä½†æ€€ç€å´‡æ•¬çš„å¿ƒæƒ…å’Œæ¿€æƒ…é€šè§ˆäº†ä¸€éã€‚åˆä¸€æ¬¡æ¥å—äº†IOC ã€DIã€AOPç­‰Springæ ¸å¿ƒæ¦‚å¿µã€‚ å…ˆå°±IOCå’ŒDIè°ˆä¸€ç‚¹æˆ‘çš„çœ‹æ³•ã€‚<br><a id="more"></a><br>IOCï¼ˆDIï¼‰ï¼šå…¶å®è¿™ä¸ªSpringæ¶æ„æ ¸å¿ƒçš„æ¦‚å¿µæ²¡æœ‰è¿™ä¹ˆå¤æ‚ï¼Œæ›´ä¸åƒæœ‰äº›ä¹¦ä¸Šæè¿°çš„é‚£æ ·æ™¦æ¶©ã€‚Javaç¨‹åºå‘˜éƒ½çŸ¥é“ï¼šjavaç¨‹åºä¸­çš„æ¯ä¸ªä¸šåŠ¡é€»è¾‘è‡³å°‘éœ€è¦ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„å¯¹è±¡æ¥åä½œå®Œæˆï¼Œé€šå¸¸ï¼Œæ¯ä¸ªå¯¹è±¡åœ¨ä½¿ç”¨ä»–çš„åˆä½œå¯¹è±¡æ—¶ï¼Œè‡ªå·±å‡è¦ä½¿ç”¨åƒnew objectï¼ˆï¼‰ è¿™æ ·çš„è¯­æ³•æ¥å®Œæˆåˆä½œå¯¹è±¡çš„ç”³è¯·å·¥ä½œã€‚ä½ ä¼šå‘ç°ï¼šå¯¹è±¡é—´çš„è€¦åˆåº¦é«˜äº†ã€‚è€ŒIOCçš„æ€æƒ³æ˜¯ï¼šSpringå®¹å™¨æ¥å®ç°è¿™äº›ç›¸äº’ä¾èµ–å¯¹è±¡çš„åˆ›å»ºã€åè°ƒå·¥ä½œã€‚å¯¹è±¡åªéœ€è¦å…³ç³»ä¸šåŠ¡é€»è¾‘æœ¬èº«å°±å¯ä»¥äº†ã€‚ä»è¿™æ–¹é¢æ¥è¯´ï¼Œå¯¹è±¡å¦‚ä½•å¾—åˆ°ä»–çš„åä½œå¯¹è±¡çš„è´£ä»»è¢«åè½¬äº†ï¼ˆIOCã€DIï¼‰ã€‚</p>
<p>è¿™æ˜¯æˆ‘å¯¹Springçš„IOCçš„ä½“ä¼šã€‚DIå…¶å®å°±æ˜¯IOCçš„å¦å¤–ä¸€ç§è¯´æ³•ã€‚DIæ˜¯ç”±Martin Fowler åœ¨2004å¹´åˆçš„ä¸€ç¯‡è®ºæ–‡ä¸­é¦–æ¬¡æå‡ºçš„ã€‚<code>ä»–æ€»ç»“ï¼šæ§åˆ¶çš„ä»€ä¹ˆè¢«åè½¬äº†ï¼Ÿå°±æ˜¯ï¼šè·å¾—ä¾èµ–å¯¹è±¡çš„æ–¹å¼åè½¬äº†ã€‚</code></p>
<p>å¦‚æœå¯¹è¿™ä¸€æ ¸å¿ƒæ¦‚å¿µè¿˜ä¸ç†è§£ï¼šè¿™é‡Œå¼•ç”¨ä¸€ä¸ªå«Bromonçš„blogä¸Šæ‰¾åˆ°çš„æµ…æ˜¾æ˜“æ‡‚çš„ç­”æ¡ˆï¼š</p>
<blockquote>
<p>IoCä¸DI</p>
</blockquote>
<blockquote>
<p>ã€€ã€€é¦–å…ˆæƒ³è¯´è¯´IoCï¼ˆInversion of Controlï¼Œæ§åˆ¶å€’è½¬ï¼‰ã€‚è¿™æ˜¯springçš„æ ¸å¿ƒï¼Œè´¯ç©¿å§‹ç»ˆã€‚æ‰€è°“IoCï¼Œå¯¹äºspringæ¡†æ¶æ¥è¯´ï¼Œå°±æ˜¯ç”±springæ¥è´Ÿè´£æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œå¯¹è±¡é—´çš„å…³ç³»ã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•æ‰¾å¥³æœ‹å‹çš„ï¼Ÿå¸¸è§çš„æƒ…å†µæ˜¯ï¼Œæˆ‘ä»¬åˆ°å¤„å»çœ‹å“ªé‡Œæœ‰é•¿å¾—æ¼‚äº®èº«æåˆå¥½çš„mmï¼Œç„¶åæ‰“å¬å¥¹ä»¬çš„å…´è¶£çˆ±å¥½ã€qqå·ã€ç”µè¯å·ã€ipå·ã€iqå·â€¦â€¦â€¦ï¼Œæƒ³åŠæ³•è®¤è¯†å¥¹ä»¬ï¼ŒæŠ•å…¶æ‰€å¥½é€å…¶æ‰€è¦ï¼Œç„¶åå˜¿å˜¿â€¦â€¦è¿™ä¸ªè¿‡ç¨‹æ˜¯å¤æ‚æ·±å¥¥çš„ï¼Œæˆ‘ä»¬å¿…é¡»è‡ªå·±è®¾è®¡å’Œé¢å¯¹æ¯ä¸ªç¯èŠ‚ã€‚ä¼ ç»Ÿçš„ç¨‹åºå¼€å‘ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œåœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œå¦‚æœè¦ä½¿ç”¨å¦å¤–çš„å¯¹è±¡ï¼Œå°±å¿…é¡»å¾—åˆ°å®ƒï¼ˆè‡ªå·±newä¸€ä¸ªï¼Œæˆ–è€…ä»JNDIä¸­æŸ¥è¯¢ä¸€ä¸ªï¼‰ï¼Œä½¿ç”¨å®Œä¹‹åè¿˜è¦å°†å¯¹è±¡é”€æ¯ï¼ˆæ¯”å¦‚Connectionç­‰ï¼‰ï¼Œå¯¹è±¡å§‹ç»ˆä¼šå’Œå…¶ä»–çš„æ¥å£æˆ–ç±»è—•åˆèµ·æ¥ã€‚</p>
</blockquote>
<blockquote>
<p>ã€€ã€€é‚£ä¹ˆIoCæ˜¯å¦‚ä½•åšçš„å‘¢ï¼Ÿæœ‰ç‚¹åƒé€šè¿‡å©šä»‹æ‰¾å¥³æœ‹å‹ï¼Œåœ¨æˆ‘å’Œå¥³æœ‹å‹ä¹‹é—´å¼•å…¥äº†ä¸€ä¸ªç¬¬ä¸‰è€…ï¼šå©šå§»ä»‹ç»æ‰€ã€‚å©šä»‹ç®¡ç†äº†å¾ˆå¤šç”·ç”·å¥³å¥³çš„èµ„æ–™ï¼Œæˆ‘å¯ä»¥å‘å©šä»‹æå‡ºä¸€ä¸ªåˆ—è¡¨ï¼Œå‘Šè¯‰å®ƒæˆ‘æƒ³æ‰¾ä¸ªä»€ä¹ˆæ ·çš„å¥³æœ‹å‹ï¼Œæ¯”å¦‚é•¿å¾—åƒæå˜‰æ¬£ï¼Œèº«æåƒæ—ç†™é›·ï¼Œå”±æ­Œåƒå‘¨æ°ä¼¦ï¼Œé€Ÿåº¦åƒå¡æ´›æ–¯ï¼ŒæŠ€æœ¯åƒé½è¾¾å†…ä¹‹ç±»çš„ï¼Œç„¶åå©šä»‹å°±ä¼šæŒ‰ç…§æˆ‘ä»¬çš„è¦æ±‚ï¼Œæä¾›ä¸€ä¸ªmmï¼Œæˆ‘ä»¬åªéœ€è¦å»å’Œå¥¹è°ˆæ‹çˆ±ã€ç»“å©šå°±è¡Œäº†ã€‚ç®€å•æ˜äº†ï¼Œå¦‚æœå©šä»‹ç»™æˆ‘ä»¬çš„äººé€‰ä¸ç¬¦åˆè¦æ±‚ï¼Œæˆ‘ä»¬å°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸å†ç”±æˆ‘è‡ªå·±æ§åˆ¶ï¼Œè€Œæ˜¯æœ‰å©šä»‹è¿™æ ·ä¸€ä¸ªç±»ä¼¼å®¹å™¨çš„æœºæ„æ¥æ§åˆ¶ã€‚Springæ‰€å€¡å¯¼çš„å¼€å‘æ–¹å¼å°±æ˜¯å¦‚æ­¤ï¼Œæ‰€æœ‰çš„ç±»éƒ½ä¼šåœ¨springå®¹å™¨ä¸­ç™»è®°ï¼Œå‘Šè¯‰springä½ æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œä½ éœ€è¦ä»€ä¹ˆä¸œè¥¿ï¼Œç„¶åspringä¼šåœ¨ç³»ç»Ÿè¿è¡Œåˆ°é€‚å½“çš„æ—¶å€™ï¼ŒæŠŠä½ è¦çš„ä¸œè¥¿ä¸»åŠ¨ç»™ä½ ï¼ŒåŒæ—¶ä¹ŸæŠŠä½ äº¤ç»™å…¶ä»–éœ€è¦ä½ çš„ä¸œè¥¿ã€‚æ‰€æœ‰çš„ç±»çš„åˆ›å»ºã€é”€æ¯éƒ½ç”± springæ¥æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´æ§åˆ¶å¯¹è±¡ç”Ÿå­˜å‘¨æœŸçš„ä¸å†æ˜¯å¼•ç”¨å®ƒçš„å¯¹è±¡ï¼Œè€Œæ˜¯springã€‚å¯¹äºæŸä¸ªå…·ä½“çš„å¯¹è±¡è€Œè¨€ï¼Œä»¥å‰æ˜¯å®ƒæ§åˆ¶å…¶ä»–å¯¹è±¡ï¼Œç°åœ¨æ˜¯æ‰€æœ‰å¯¹è±¡éƒ½è¢«springæ§åˆ¶ï¼Œæ‰€ä»¥è¿™å«æ§åˆ¶åè½¬ã€‚å¦‚æœä½ è¿˜ä¸æ˜ç™½çš„è¯ï¼Œæˆ‘å†³å®šæ”¾å¼ƒã€‚</p>
</blockquote>
<blockquote>
<p>IoCçš„ä¸€ä¸ªé‡ç‚¹æ˜¯åœ¨ç³»ç»Ÿè¿è¡Œä¸­ï¼ŒåŠ¨æ€çš„å‘æŸä¸ªå¯¹è±¡æä¾›å®ƒæ‰€éœ€è¦çš„å…¶ä»–å¯¹è±¡ã€‚è¿™ä¸€ç‚¹æ˜¯é€šè¿‡DIï¼ˆDependency Injectionï¼Œä¾èµ–æ³¨å…¥ï¼‰æ¥å®ç°çš„ã€‚æ¯”å¦‚å¯¹è±¡Aéœ€è¦æ“ä½œæ•°æ®åº“ï¼Œä»¥å‰æˆ‘ä»¬æ€»æ˜¯è¦åœ¨Aä¸­è‡ªå·±ç¼–å†™ä»£ç æ¥è·å¾—ä¸€ä¸ªConnectionå¯¹è±¡ï¼Œæœ‰äº† springæˆ‘ä»¬å°±åªéœ€è¦å‘Šè¯‰springï¼ŒAä¸­éœ€è¦ä¸€ä¸ªConnectionï¼Œè‡³äºè¿™ä¸ªConnectionæ€ä¹ˆæ„é€ ï¼Œä½•æ—¶æ„é€ ï¼ŒAä¸éœ€è¦çŸ¥é“ã€‚åœ¨ç³»ç»Ÿè¿è¡Œæ—¶ï¼Œspringä¼šåœ¨é€‚å½“çš„æ—¶å€™åˆ¶é€ ä¸€ä¸ªConnectionï¼Œç„¶ååƒæ‰“é’ˆä¸€æ ·ï¼Œæ³¨å°„åˆ°Aå½“ä¸­ï¼Œè¿™æ ·å°±å®Œæˆäº†å¯¹å„ä¸ªå¯¹è±¡ä¹‹é—´å…³ç³»çš„æ§åˆ¶ã€‚Aéœ€è¦ä¾èµ– Connectionæ‰èƒ½æ­£å¸¸è¿è¡Œï¼Œè€Œè¿™ä¸ªConnectionæ˜¯ç”±springæ³¨å…¥åˆ°Aä¸­çš„ï¼Œä¾èµ–æ³¨å…¥çš„åå­—å°±è¿™ä¹ˆæ¥çš„ã€‚é‚£ä¹ˆDIæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ Java 1.3ä¹‹åä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯åå°„ï¼ˆreflectionï¼‰ï¼Œå®ƒå…è®¸ç¨‹åºåœ¨è¿è¡Œçš„æ—¶å€™åŠ¨æ€çš„ç”Ÿæˆå¯¹è±¡ã€æ‰§è¡Œå¯¹è±¡çš„æ–¹æ³•ã€æ”¹å˜å¯¹è±¡çš„å±æ€§ï¼Œspringå°±æ˜¯é€šè¿‡åå°„æ¥å®ç°æ³¨å…¥çš„ã€‚å…³äºåå°„çš„ç›¸å…³èµ„æ–™è¯·æŸ¥é˜…java docã€‚<br>ã€€ç†è§£äº†IoCå’ŒDIçš„æ¦‚å¿µåï¼Œä¸€åˆ‡éƒ½å°†å˜å¾—ç®€å•æ˜äº†ï¼Œå‰©ä¸‹çš„å·¥ä½œåªæ˜¯åœ¨springçš„æ¡†æ¶ä¸­å †ç§¯æœ¨è€Œå·²ã€‚</p>
</blockquote>
<p>å¦‚æœè¿˜ä¸æ˜ç™½ï¼Œæ”¾å¼ƒjavaå§ï¼</p>
<p><strong>ä¸‹é¢æ¥è®©å¤§å®¶äº†è§£ä¸€ä¸‹Springåˆ°åº•æ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‚</strong></p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;   </span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> FileSystemXmlApplicationContext(   </span><br><span class="line">                <span class="string">"applicationContext.xml"</span>);   </span><br><span class="line">        Animal animal = (Animal) context.getBean(<span class="string">"animal"</span>);   </span><br><span class="line">        animal.say();   </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç ä½ ä¸€å®šå¾ˆç†Ÿæ‚‰å§ï¼Œä¸è¿‡è¿˜æ˜¯è®©æˆ‘ä»¬åˆ†æä¸€ä¸‹å®ƒå§ï¼Œé¦–å…ˆæ˜¯applicationContext.xml</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">&lt;bean <span class="built_in">id</span>=<span class="string">"animal"</span> <span class="built_in">class</span>=<span class="string">"phz.springframework.test.Cat"</span>&gt;   </span><br><span class="line">        &lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">"name"</span> value=<span class="string">"kitty"</span> /&gt;   </span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>ä»–æœ‰ä¸€ä¸ªç±»Cat</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="title">implements</span> <span class="title">Animal</span> &#123;</span>   </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">()</span> </span>&#123;   </span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"I am "</span> + name + <span class="string">"!"</span>);   </span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;   </span><br><span class="line">        <span class="keyword">this</span>.name = name;   </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ç°äº†Animalæ¥å£</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">public<span class="built_in"> interface </span>Animal &#123;   </span><br><span class="line">    public void say();   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜æ˜¾ä¸Šé¢çš„ä»£ç è¾“å‡ºI am kitty! </p>
<p>é‚£ä¹ˆåˆ°åº•Springæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ<br>æ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬è‡ªå·±å†™ä¸ªSpring æ¥çœ‹çœ‹Spring åˆ°åº•æ˜¯æ€ä¹ˆè¿è¡Œçš„å§ï¼ </p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªBeanç±»ï¼Œè¿™ä¸ªç±»ç”¨æ¥å­˜æ”¾ä¸€ä¸ªBeanæ‹¥æœ‰çš„å±æ€§</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* Bean Id */</span>  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> id;   </span><br><span class="line">    <span class="comment">/* Bean Class */</span>  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> type;   </span><br><span class="line">    <span class="comment">/* Bean Property */</span>  </span><br><span class="line">    <span class="keyword">private</span> Map&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt; properties = <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt;();</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªBeanåŒ…æ‹¬id,type,å’ŒPropertiesã€‚ </p>
<p>æ¥ä¸‹æ¥Spring å°±å¼€å§‹åŠ è½½æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶äº†ï¼Œå°†æˆ‘ä»¬é…ç½®çš„ä¿¡æ¯ä¿å­˜åœ¨ä¸€ä¸ªHashMapä¸­ï¼ŒHashMapçš„keyå°±æ˜¯Bean çš„ Id ï¼ŒHasMap çš„valueæ˜¯è¿™ä¸ªBeanï¼Œåªæœ‰è¿™æ ·æˆ‘ä»¬æ‰èƒ½é€šè¿‡context.getBean(â€œanimalâ€)è¿™ä¸ªæ–¹æ³•è·å¾—Animalè¿™ä¸ªç±»ã€‚æˆ‘ä»¬éƒ½çŸ¥é“Spirngå¯ä»¥æ³¨å…¥åŸºæœ¬ç±»å‹ï¼Œè€Œä¸”å¯ä»¥æ³¨å…¥åƒListï¼ŒMapè¿™æ ·çš„ç±»å‹ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬ä»¥Mapä¸ºä¾‹çœ‹çœ‹Springæ˜¯æ€ä¹ˆä¿å­˜çš„å§ </p>
<p>Mapé…ç½®å¯ä»¥åƒä¸‹é¢çš„</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;bean id=<span class="string">"test"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"Test"</span>&gt;   </span><br><span class="line">        &lt;property name=<span class="string">"testMap"</span>&gt;   </span><br><span class="line">            &lt;map&gt;   </span><br><span class="line">                &lt;entry key=<span class="string">"a"</span>&gt;   </span><br><span class="line">                    &lt;value&gt;<span class="number">1</span>&lt;<span class="regexp">/value&gt;   </span></span><br><span class="line"><span class="regexp">                &lt;/</span>entry&gt;   </span><br><span class="line">                &lt;entry key=<span class="string">"b"</span>&gt;   </span><br><span class="line">                    &lt;value&gt;<span class="number">2</span>&lt;<span class="regexp">/value&gt;   </span></span><br><span class="line"><span class="regexp">                &lt;/</span>entry&gt;   </span><br><span class="line">            &lt;<span class="regexp">/map&gt;   </span></span><br><span class="line"><span class="regexp">        &lt;/</span>property&gt;   </span><br><span class="line">    &lt;<span class="regexp">/bean&gt;</span></span><br></pre></td></tr></table></figure>
<p>Springæ˜¯æ€æ ·ä¿å­˜ä¸Šé¢çš„é…ç½®å‘¢ï¼Ÿï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (beanProperty.element(<span class="string">"map"</span>) != <span class="keyword">null</span>) &#123;   </span><br><span class="line">                    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; propertiesMap = <span class="keyword">new</span> HashMap&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt;();   </span><br><span class="line">                    <span class="built_in">Element</span> propertiesListMap = (<span class="built_in">Element</span>) beanProperty   </span><br><span class="line">                            .elements().<span class="keyword">get</span>(<span class="number">0</span>);   </span><br><span class="line">                    <span class="built_in">Iterator</span>&lt;?&gt; propertiesIterator = propertiesListMap   </span><br><span class="line">                            .elements().iterator();   </span><br><span class="line">                    <span class="keyword">while</span> (propertiesIterator.hasNext()) &#123;   </span><br><span class="line">                        <span class="built_in">Element</span> vet = (<span class="built_in">Element</span>) propertiesIterator.next();   </span><br><span class="line">                        <span class="keyword">if</span> (vet.getName().equals(<span class="string">"entry"</span>)) &#123;   </span><br><span class="line">                            <span class="built_in">String</span> key = vet.attributeValue(<span class="string">"key"</span>);   </span><br><span class="line">                            <span class="built_in">Iterator</span>&lt;?&gt; valuesIterator = vet.elements()   </span><br><span class="line">                                    .iterator();   </span><br><span class="line">                            <span class="keyword">while</span> (valuesIterator.hasNext()) &#123;   </span><br><span class="line">                                <span class="built_in">Element</span> value = (<span class="built_in">Element</span>) valuesIterator.next();   </span><br><span class="line">                                <span class="keyword">if</span> (value.getName().equals(<span class="string">"value"</span>)) &#123;   </span><br><span class="line">                                    propertiesMap.put(key, value.getText());   </span><br><span class="line">                                &#125;   </span><br><span class="line">                                <span class="keyword">if</span> (value.getName().equals(<span class="string">"ref"</span>)) &#123;   </span><br><span class="line">                                    propertiesMap.put(key, <span class="keyword">new</span> <span class="built_in">String</span>[] &#123; value   </span><br><span class="line">                                            .attributeValue(<span class="string">"bean"</span>) &#125;);   </span><br><span class="line">                                &#125;   </span><br><span class="line">                            &#125;   </span><br><span class="line">                        &#125;   </span><br><span class="line">                    &#125;   </span><br><span class="line">                    bean.getProperties().put(name, propertiesMap);   </span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å°±è¿›å…¥æœ€æ ¸å¿ƒéƒ¨åˆ†äº†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹Spring åˆ°åº•æ˜¯æ€ä¹ˆä¾èµ–æ³¨å…¥çš„å§ï¼Œå…¶å®ä¾èµ–æ³¨å…¥çš„æ€æƒ³ä¹Ÿå¾ˆç®€å•ï¼Œå®ƒæ˜¯é€šè¿‡åå°„æœºåˆ¶å®ç°çš„ï¼Œåœ¨å®ä¾‹åŒ–ä¸€ä¸ªç±»æ—¶ï¼Œå®ƒé€šè¿‡åå°„è°ƒç”¨ç±»ä¸­setæ–¹æ³•å°†äº‹å…ˆä¿å­˜åœ¨HashMapä¸­çš„ç±»å±æ€§æ³¨å…¥åˆ°ç±»ä¸­ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å…·ä½“å®ƒæ˜¯æ€ä¹ˆåšçš„å§ã€‚<br>é¦–å…ˆå®ä¾‹åŒ–ä¸€ä¸ªç±»ï¼Œåƒè¿™æ ·</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="keyword">new</span><span class="type">Instance</span>(<span class="keyword">String</span> className) &#123;   </span><br><span class="line">        Class&lt;?&gt; cls = <span class="literal">null</span>;   </span><br><span class="line">        Object obj = <span class="literal">null</span>;   </span><br><span class="line">        <span class="keyword">try</span> &#123;   </span><br><span class="line">            cls = Class.forName(className);   </span><br><span class="line">            obj = cls.<span class="keyword">new</span><span class="type">Instance</span>();   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;   </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">RuntimeException</span>(e);   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;   </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">RuntimeException</span>(e);   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;   </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">RuntimeException</span>(e);   </span><br><span class="line">        &#125;   </span><br><span class="line">        <span class="keyword">return</span> obj;   </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ç€å®ƒå°†è¿™ä¸ªç±»çš„ä¾èµ–æ³¨å…¥è¿›å»ï¼Œåƒè¿™æ ·</p>
<figure class="highlight monkey"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> static void setProperty(Object obj, String name, String value) &#123;   </span><br><span class="line">        <span class="class"><span class="keyword">Class</span>&lt;? <span class="keyword">extends</span> <span class="title">Object</span>&gt; <span class="title">clazz</span> = <span class="title">obj</span>.<span class="title">getClass</span>();   </span></span><br><span class="line">        <span class="keyword">try</span> &#123;   </span><br><span class="line">            String methodName = returnSetMthodName(name);   </span><br><span class="line">            <span class="function"><span class="keyword">Method</span>[] <span class="title">ms</span> =</span> clazz.getMethods();   </span><br><span class="line">            <span class="keyword">for</span> (<span class="function"><span class="keyword">Method</span> <span class="title">m</span> :</span> ms) &#123;   </span><br><span class="line">                <span class="keyword">if</span> (m.getName().equals(methodName)) &#123;   </span><br><span class="line">                    <span class="keyword">if</span> (m.getParameterTypes().length == <span class="number">1</span>) &#123;   </span><br><span class="line">                        <span class="class"><span class="keyword">Class</span>&lt;?&gt; <span class="title">clazzParameterType</span> = <span class="title">m</span>.<span class="title">getParameterTypes</span>()[0];   </span></span><br><span class="line">                        setFieldValue(clazzParameterType.getName(), value, m,   </span><br><span class="line">                                obj);   </span><br><span class="line">                        break;   </span><br><span class="line">                    &#125;   </span><br><span class="line">                &#125;   </span><br><span class="line">            &#125;   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException e) &#123;   </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;   </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;   </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;   </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);   </span><br><span class="line">        &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åå®ƒå°†è¿™ä¸ªç±»çš„å®ä¾‹è¿”å›ç»™æˆ‘ä»¬ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨äº†ã€‚æˆ‘ä»¬è¿˜æ˜¯ä»¥Mapä¸ºä¾‹çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆåšçš„ï¼Œæˆ‘å†™çš„ä»£ç é‡Œé¢æ˜¯åˆ›å»ºä¸€ä¸ªHashMapå¹¶æŠŠè¯¥HashMapæ³¨å…¥åˆ°éœ€è¦æ³¨å…¥çš„ç±»ä¸­ï¼Œåƒè¿™æ ·ï¼Œ</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">if</span> (value instanceof <span class="meta">Map</span>) &#123;   </span><br><span class="line">                <span class="keyword">Iterator&lt;?&gt; </span>entryIterator = ((<span class="meta">Map</span>&lt;?, ?&gt;) value).entrySet()   </span><br><span class="line">                        .<span class="keyword">iterator(); </span>  </span><br><span class="line">                <span class="meta">Map</span>&lt;<span class="keyword">String, </span>Object&gt; <span class="meta">map</span> = new HashMap&lt;<span class="keyword">String, </span>Object&gt;()<span class="comment">;   </span></span><br><span class="line">                <span class="meta">while</span> (entryIterator.hasNext()) &#123;   </span><br><span class="line">                    <span class="meta">Entry</span>&lt;?, ?&gt; entryMap = (<span class="meta">Entry</span>&lt;?, ?&gt;) entryIterator.next()<span class="comment">;   </span></span><br><span class="line">                    <span class="meta">if</span> (entryMap.getValue() instanceof <span class="keyword">String[]) </span>&#123;   </span><br><span class="line">                        <span class="meta">map</span>.put((<span class="keyword">String) </span>entryMap.getKey(),   </span><br><span class="line">                                getBean(((<span class="keyword">String[]) </span>entryMap.getValue())[<span class="number">0</span>]))<span class="comment">;   </span></span><br><span class="line">                    &#125;   </span><br><span class="line">                &#125;   </span><br><span class="line">                <span class="keyword">BeanProcesser.setProperty(obj, </span>property, <span class="meta">map</span>)<span class="comment">;   </span></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p>å¥½äº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨Spring ç»™æˆ‘ä»¬åˆ›å»ºçš„ç±»äº†ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿä¸æ˜¯å¾ˆéš¾å•Šï¼Ÿå½“ç„¶Springèƒ½åšåˆ°çš„è¿œä¸æ­¢è¿™äº›ï¼Œè¿™ä¸ªç¤ºä¾‹ç¨‹åºä»…ä»…æä¾›äº†Springæœ€æ ¸å¿ƒçš„ä¾èµ–æ³¨å…¥åŠŸèƒ½ä¸­çš„ä¸€éƒ¨åˆ†ã€‚<br>æœ¬æ–‡å‚è€ƒäº†å¤§é‡æ–‡ç« æ— æ³•ä¸€ä¸€æ„Ÿè°¢ï¼Œåœ¨è¿™ä¸€èµ·æ„Ÿè°¢ï¼Œå¦‚æœä¾µçŠ¯äº†ä½ çš„ç‰ˆæƒæ·±è¡¨æ­‰æ„ï¼Œå¾ˆå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ï¼</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Spring</tag>
        <tag>æ¡†æ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>Volatileå°ç»“</title>
    <url>/2017/03/03/Volatile%E5%B0%8F%E7%BB%93/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><blockquote>
<p>1ï¼‰Java ä¸­èƒ½åˆ›å»º Volatile æ•°ç»„å—ï¼Ÿ</p>
</blockquote>
<p>èƒ½ï¼ŒJava ä¸­å¯ä»¥åˆ›å»º volatile ç±»å‹æ•°ç»„ï¼Œä¸è¿‡åªæ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ•°ç»„ã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œå¦‚æœæ”¹å˜å¼•ç”¨æŒ‡å‘çš„æ•°ç»„ï¼Œå°†ä¼šå—åˆ° volatile çš„ä¿æŠ¤ï¼Œä½†æ˜¯å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ”¹å˜æ•°ç»„çš„å…ƒç´ ï¼Œvolatile æ ‡ç¤ºç¬¦å°±ä¸èƒ½èµ·åˆ°ä¹‹å‰çš„ä¿æŠ¤ä½œç”¨äº†ã€‚<br><a id="more"></a></p>
<blockquote>
<p>2ï¼‰volatile èƒ½ä½¿å¾—ä¸€ä¸ªéåŸå­æ“ä½œå˜æˆåŸå­æ“ä½œå—ï¼Ÿ</p>
</blockquote>
<p>ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯åœ¨ç±»ä¸­æœ‰ä¸€ä¸ª long ç±»å‹çš„æˆå‘˜å˜é‡ã€‚å¦‚æœä½ çŸ¥é“è¯¥æˆå‘˜å˜é‡ä¼šè¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œå¦‚è®¡æ•°å™¨ã€ä»·æ ¼ç­‰ï¼Œä½ æœ€å¥½æ˜¯å°†å…¶è®¾ç½®ä¸º volatileã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸º Java ä¸­è¯»å– long ç±»å‹å˜é‡ä¸æ˜¯åŸå­çš„ï¼Œéœ€è¦åˆ†æˆä¸¤æ­¥ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ä¿®æ”¹è¯¥ long å˜é‡çš„å€¼ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½åªèƒ½çœ‹åˆ°è¯¥å€¼çš„ä¸€åŠï¼ˆå‰ 32 ä½ï¼‰ã€‚ä½†æ˜¯å¯¹ä¸€ä¸ª volatile å‹çš„ long æˆ– double å˜é‡çš„è¯»å†™æ˜¯åŸå­ã€‚</p>
<blockquote>
<p>3ï¼‰volatile ä¿®é¥°ç¬¦æœ‰è¿‡ä»€ä¹ˆå®è·µï¼Ÿ</p>
</blockquote>
<p>ä¸€ç§å®è·µæ˜¯ç”¨ volatile ä¿®é¥° long å’Œ double å˜é‡ï¼Œä½¿å…¶èƒ½æŒ‰åŸå­ç±»å‹æ¥è¯»å†™ã€‚double å’Œ long éƒ½æ˜¯64ä½å®½ï¼Œå› æ­¤å¯¹è¿™ä¸¤ç§ç±»å‹çš„è¯»æ˜¯åˆ†ä¸ºä¸¤éƒ¨åˆ†çš„ï¼Œç¬¬ä¸€æ¬¡è¯»å–ç¬¬ä¸€ä¸ª 32 ä½ï¼Œç„¶åå†è¯»å‰©ä¸‹çš„ 32 ä½ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸æ˜¯åŸå­çš„ï¼Œä½† Java ä¸­ volatile å‹çš„ long æˆ– double å˜é‡çš„è¯»å†™æ˜¯åŸå­çš„ã€‚volatile ä¿®å¤ç¬¦çš„å¦ä¸€ä¸ªä½œç”¨æ˜¯æä¾›å†…å­˜å±éšœï¼ˆmemory barrierï¼‰ï¼Œä¾‹å¦‚åœ¨åˆ†å¸ƒå¼æ¡†æ¶ä¸­çš„åº”ç”¨ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯å½“ä½ å†™ä¸€ä¸ª volatile å˜é‡ä¹‹å‰ï¼ŒJava å†…å­˜æ¨¡å‹ä¼šæ’å…¥ä¸€ä¸ªå†™å±éšœï¼ˆwrite barrierï¼‰ï¼Œè¯»ä¸€ä¸ª volatile å˜é‡ä¹‹å‰ï¼Œä¼šæ’å…¥ä¸€ä¸ªè¯»å±éšœï¼ˆread barrierï¼‰ã€‚æ„æ€å°±æ˜¯è¯´ï¼Œåœ¨ä½ å†™ä¸€ä¸ª volatile åŸŸæ—¶ï¼Œèƒ½ä¿è¯ä»»ä½•çº¿ç¨‹éƒ½èƒ½çœ‹åˆ°ä½ å†™çš„å€¼ï¼ŒåŒæ—¶ï¼Œåœ¨å†™ä¹‹å‰ï¼Œä¹Ÿèƒ½ä¿è¯ä»»ä½•æ•°å€¼çš„æ›´æ–°å¯¹æ‰€æœ‰çº¿ç¨‹æ˜¯å¯è§çš„ï¼Œå› ä¸ºå†…å­˜å±éšœä¼šå°†å…¶ä»–æ‰€æœ‰å†™çš„å€¼æ›´æ–°åˆ°ç¼“å­˜ã€‚</p>
<blockquote>
<p>4ï¼‰volatile ç±»å‹å˜é‡æä¾›ä»€ä¹ˆä¿è¯ï¼Ÿ</p>
</blockquote>
<p>volatile å˜é‡æä¾›é¡ºåºå’Œå¯è§æ€§ä¿è¯ï¼Œä¾‹å¦‚ï¼ŒJVM æˆ–è€… JITä¸ºäº†è·å¾—æ›´å¥½çš„æ€§èƒ½ä¼šå¯¹è¯­å¥é‡æ’åºï¼Œä½†æ˜¯ volatile ç±»å‹å˜é‡å³ä½¿åœ¨æ²¡æœ‰åŒæ­¥å—çš„æƒ…å†µä¸‹èµ‹å€¼ä¹Ÿä¸ä¼šä¸å…¶ä»–è¯­å¥é‡æ’åºã€‚ volatile æä¾› happens-before çš„ä¿è¯ï¼Œç¡®ä¿ä¸€ä¸ªçº¿ç¨‹çš„ä¿®æ”¹èƒ½å¯¹å…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ã€‚æŸäº›æƒ…å†µä¸‹ï¼Œvolatile è¿˜èƒ½æä¾›åŸå­æ€§ï¼Œå¦‚è¯» 64 ä½æ•°æ®ç±»å‹ï¼Œåƒ long å’Œ double éƒ½ä¸æ˜¯åŸå­çš„ï¼Œä½† volatile ç±»å‹çš„ double å’Œ long å°±æ˜¯åŸå­çš„ã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºä»€ä¹ˆvolatileä¸èƒ½ä¿è¯åŸå­æ€§è€ŒAtomicå¯ä»¥ï¼Ÿ</title>
    <url>/2017/03/02/%E4%B8%BA%E4%BB%80%E4%B9%88volatile%E4%B8%8D%E8%83%BD%E4%BF%9D%E8%AF%81%E5%8E%9F%E5%AD%90%E6%80%A7%E8%80%8CAtomic%E5%8F%AF%E4%BB%A5%EF%BC%9F/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>åœ¨Javaä¸­longèµ‹å€¼ä¸æ˜¯åŸå­æ“ä½œï¼Œå› ä¸ºå…ˆå†™32ä½ï¼Œå†å†™å32ä½ï¼Œåˆ†ä¸¤æ­¥æ“ä½œï¼Œè€ŒAtomicLongèµ‹å€¼æ˜¯åŸå­æ“ä½œï¼Œä¸ºä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆvolatileèƒ½æ›¿ä»£ç®€å•çš„é”ï¼Œå´ä¸èƒ½ä¿è¯åŸå­æ€§ï¼Ÿè¿™é‡Œé¢æ¶‰åŠvolatileï¼Œæ˜¯javaä¸­çš„ä¸€ä¸ªæˆ‘è§‰å¾—è¿™ä¸ªè¯åœ¨Javaè§„èŒƒä¸­ä»æœªè¢«è§£é‡Šæ¸…æ¥šçš„ç¥å¥‡å…³é”®è¯ï¼Œåœ¨Sunçš„JDKå®˜æ–¹æ–‡æ¡£æ˜¯è¿™æ ·å½¢å®¹volatileçš„ï¼š<br><a id="more"></a></p>
<blockquote>
<p>The Java programming language provides a second mechanism, volatile fields, that is more convenient than locking for some purposes. A field may be declared volatile, in which case the Java Memory Model ensures that all threads see a consistent value for the variable.</p>
</blockquote>
<p>æ„æ€å°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªå˜é‡åŠ äº†volatileå…³é”®å­—ï¼Œå°±ä¼šå‘Šè¯‰ç¼–è¯‘å™¨å’ŒJVMçš„å†…å­˜æ¨¡å‹ï¼šè¿™ä¸ªå˜é‡æ˜¯å¯¹æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ã€å¯è§çš„ï¼Œæ¯æ¬¡jvméƒ½ä¼šè¯»å–æœ€æ–°å†™å…¥çš„å€¼å¹¶ä½¿å…¶æœ€æ–°å€¼åœ¨æ‰€æœ‰CPUå¯è§ã€‚<strong>volatileä¼¼ä¹æ˜¯æœ‰æ—¶å€™å¯ä»¥ä»£æ›¿ç®€å•çš„é”ï¼Œä¼¼ä¹åŠ äº†volatileå…³é”®å­—å°±çœæ‰äº†é”ã€‚ä½†åˆè¯´volatileä¸èƒ½ä¿è¯åŸå­æ€§ï¼ˆjavaç¨‹åºå‘˜å¾ˆç†Ÿæ‚‰è¿™å¥è¯ï¼švolatileä»…ä»…ç”¨æ¥ä¿è¯è¯¥å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§ï¼Œä½†ä¸ä¿è¯åŸå­æ€§ï¼‰</strong>ã€‚è¿™ä¸æ˜¯äº’ç›¸çŸ›ç›¾å—ï¼Ÿ</p>
<blockquote>
<p>ä¸è¦å°†volatileç”¨åœ¨getAndOperateåœºåˆï¼Œä»…ä»…setæˆ–è€…getçš„åœºæ™¯æ˜¯é€‚åˆvolatileçš„</p>
</blockquote>
<p><strong>ä¸è¦å°†volatileç”¨åœ¨getAndOperateåœºåˆï¼ˆè¿™ç§åœºåˆä¸åŸå­ï¼Œéœ€è¦å†åŠ é”ï¼‰ï¼Œä»…ä»…setæˆ–è€…getçš„åœºæ™¯æ˜¯é€‚åˆvolatileçš„ã€‚</strong></p>
<blockquote>
<p>volatileæ²¡æœ‰åŸå­æ€§ä¸¾ä¾‹ï¼šAtomicIntegerè‡ªå¢</p>
</blockquote>
<p>ä¾‹å¦‚ä½ è®©ä¸€ä¸ªvolatileçš„integerè‡ªå¢ï¼ˆi++ï¼‰ï¼Œå…¶å®è¦åˆ†æˆ3æ­¥ï¼š1ï¼‰è¯»å–volatileå˜é‡å€¼åˆ°localï¼› 2ï¼‰å¢åŠ å˜é‡çš„å€¼ï¼›3ï¼‰æŠŠlocalçš„å€¼å†™å›ï¼Œè®©å…¶å®ƒçš„çº¿ç¨‹å¯è§ã€‚è¿™3æ­¥çš„jvmæŒ‡ä»¤ä¸ºï¼š</p>
<figure class="highlight cos"><table><tr><td class="code"><pre><span class="line">mov    <span class="number">0</span>xc(<span class="built_in">%r</span>10),<span class="built_in">%r</span>8d <span class="comment">; Load</span></span><br><span class="line">inc    <span class="built_in">%r</span>8d           <span class="comment">; Increment</span></span><br><span class="line">mov    <span class="built_in">%r</span>8d,<span class="number">0</span>xc(<span class="built_in">%r</span>10) <span class="comment">; Store</span></span><br><span class="line"><span class="keyword">lock</span> addl $<span class="number">0</span>x0,(<span class="built_in">%rsp</span>) <span class="comment">; StoreLoad Barrier</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„æœ€åä¸€æ­¥æ˜¯å†…å­˜å±éšœã€‚</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯å†…å­˜å±éšœï¼ˆMemory Barrierï¼‰ï¼Ÿ</p>
</blockquote>
<p>å†…å­˜å±éšœï¼ˆmemory barrierï¼‰æ˜¯ä¸€ä¸ªCPUæŒ‡ä»¤ã€‚åŸºæœ¬ä¸Šï¼Œå®ƒæ˜¯è¿™æ ·ä¸€æ¡æŒ‡ä»¤ï¼š a) ç¡®ä¿ä¸€äº›ç‰¹å®šæ“ä½œæ‰§è¡Œçš„é¡ºåºï¼› b) å½±å“ä¸€äº›æ•°æ®çš„å¯è§æ€§(å¯èƒ½æ˜¯æŸäº›æŒ‡ä»¤æ‰§è¡Œåçš„ç»“æœ)ã€‚ç¼–è¯‘å™¨å’ŒCPUå¯ä»¥åœ¨ä¿è¯è¾“å‡ºç»“æœä¸€æ ·çš„æƒ…å†µä¸‹å¯¹æŒ‡ä»¤é‡æ’åºï¼Œä½¿æ€§èƒ½å¾—åˆ°ä¼˜åŒ–ã€‚æ’å…¥ä¸€ä¸ªå†…å­˜å±éšœï¼Œç›¸å½“äºå‘Šè¯‰CPUå’Œç¼–è¯‘å™¨å…ˆäºè¿™ä¸ªå‘½ä»¤çš„å¿…é¡»å…ˆæ‰§è¡Œï¼Œåäºè¿™ä¸ªå‘½ä»¤çš„å¿…é¡»åæ‰§è¡Œã€‚å†…å­˜å±éšœå¦ä¸€ä¸ªä½œç”¨æ˜¯å¼ºåˆ¶æ›´æ–°ä¸€æ¬¡ä¸åŒCPUçš„ç¼“å­˜ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå†™å±éšœä¼šæŠŠè¿™ä¸ªå±éšœå‰å†™å…¥çš„æ•°æ®åˆ·æ–°åˆ°ç¼“å­˜ï¼Œè¿™æ ·ä»»ä½•è¯•å›¾è¯»å–è¯¥æ•°æ®çš„çº¿ç¨‹å°†å¾—åˆ°æœ€æ–°å€¼ï¼Œè€Œä¸ç”¨è€ƒè™‘åˆ°åº•æ˜¯è¢«å“ªä¸ªcpuæ ¸å¿ƒæˆ–è€…å“ªé¢—CPUæ‰§è¡Œçš„ã€‚</p>
<p>å†…å­˜å±éšœï¼ˆmemory barrierï¼‰å’Œvolatileä»€ä¹ˆå…³ç³»ï¼Ÿä¸Šé¢çš„è™šæ‹ŸæœºæŒ‡ä»¤é‡Œé¢æœ‰æåˆ°ï¼Œå¦‚æœä½ çš„å­—æ®µæ˜¯volatileï¼ŒJavaå†…å­˜æ¨¡å‹å°†åœ¨å†™æ“ä½œåæ’å…¥ä¸€ä¸ªå†™å±éšœæŒ‡ä»¤ï¼Œåœ¨è¯»æ“ä½œå‰æ’å…¥ä¸€ä¸ªè¯»å±éšœæŒ‡ä»¤ã€‚è¿™æ„å‘³ç€å¦‚æœä½ å¯¹ä¸€ä¸ªvolatileå­—æ®µè¿›è¡Œå†™æ“ä½œï¼Œä½ å¿…é¡»çŸ¥é“ï¼š1ã€ä¸€æ—¦ä½ å®Œæˆå†™å…¥ï¼Œä»»ä½•è®¿é—®è¿™ä¸ªå­—æ®µçš„çº¿ç¨‹å°†ä¼šå¾—åˆ°æœ€æ–°çš„å€¼ã€‚2ã€åœ¨ä½ å†™å…¥å‰ï¼Œä¼šä¿è¯æ‰€æœ‰ä¹‹å‰å‘ç”Ÿçš„äº‹å·²ç»å‘ç”Ÿï¼Œå¹¶ä¸”ä»»ä½•æ›´æ–°è¿‡çš„æ•°æ®å€¼ä¹Ÿæ˜¯å¯è§çš„ï¼Œå› ä¸ºå†…å­˜å±éšœä¼šæŠŠä¹‹å‰çš„å†™å…¥å€¼éƒ½åˆ·æ–°åˆ°ç¼“å­˜ã€‚</p>
<blockquote>
<p>volatileä¸ºä»€ä¹ˆæ²¡æœ‰åŸå­æ€§?</p>
</blockquote>
<p>æ˜ç™½äº†å†…å­˜å±éšœï¼ˆmemory barrierï¼‰è¿™ä¸ªCPUæŒ‡ä»¤ï¼Œå›åˆ°å‰é¢çš„JVMæŒ‡ä»¤ï¼šä»Loadåˆ°storeåˆ°å†…å­˜å±éšœï¼Œä¸€å…±4æ­¥ï¼Œå…¶ä¸­æœ€åä¸€æ­¥jvmè®©è¿™ä¸ªæœ€æ–°çš„å˜é‡çš„å€¼åœ¨æ‰€æœ‰çº¿ç¨‹å¯è§ï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€æ­¥è®©æ‰€æœ‰çš„CPUå†…æ ¸éƒ½è·å¾—äº†æœ€æ–°çš„å€¼ï¼Œä½†ä¸­é—´çš„å‡ æ­¥ï¼ˆä»Loadåˆ°Storeï¼‰æ˜¯ä¸å®‰å…¨çš„ï¼Œä¸­é—´å¦‚æœå…¶ä»–çš„CPUä¿®æ”¹äº†å€¼å°†ä¼šä¸¢å¤±ã€‚ä¸‹é¢çš„æµ‹è¯•ä»£ç å¯ä»¥å®é™…æµ‹è¯•voaltileçš„è‡ªå¢æ²¡æœ‰åŸå­æ€§ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">long</span> _longVal = <span class="number">0</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LoopVolatile</span> <span class="keyword">implements</span> <span class="title">Runnable</span> &#123;</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> run() &#123;</span><br><span class="line">            <span class="keyword">long</span> val = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (val &lt; <span class="number">10000000</span>L) &#123;</span><br><span class="line">                _longVal++;</span><br><span class="line">                val++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LoopVolatile2</span> <span class="keyword">implements</span> <span class="title">Runnable</span> &#123;</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> run() &#123;</span><br><span class="line">            <span class="keyword">long</span> val = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (val &lt; <span class="number">10000000</span>L) &#123;</span><br><span class="line">                _longVal++;</span><br><span class="line">                val++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">void</span> testVolatile()&#123;</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> LoopVolatile());</span><br><span class="line">        t1.start();</span><br><span class="line">         </span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> LoopVolatile2());</span><br><span class="line">        t2.start();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">while</span> (t1.isAlive() || t2.isAlive()) &#123;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">"final val is: "</span> + _longVal);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"><span class="string">Output:</span>-------------</span><br><span class="line">     </span><br><span class="line"><span class="keyword">final</span> val <span class="string">is:</span> <span class="number">11223828</span></span><br><span class="line"><span class="keyword">final</span> val <span class="string">is:</span> <span class="number">17567127</span></span><br><span class="line"><span class="keyword">final</span> val <span class="string">is:</span> <span class="number">12912109</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>volatileæ²¡æœ‰åŸå­æ€§ä¸¾ä¾‹ï¼šsingletonå•ä¾‹æ¨¡å¼å®ç°</p>
</blockquote>
<p>è¿™æ˜¯ä¸€æ®µçº¿ç¨‹ä¸å®‰å…¨çš„singletonï¼ˆå•ä¾‹æ¨¡å¼ï¼‰å®ç°ï¼Œå°½ç®¡ä½¿ç”¨äº†volatileï¼š</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">wrongsingleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> wrongsingleton _instance = <span class="literal">null</span>; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">wrongsingleton</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> wrongsingleton <span class="title">getInstance</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (_instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            _instance = <span class="keyword">new</span> wrongsingleton();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> _instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢çš„æµ‹è¯•ä»£ç å¯ä»¥æµ‹è¯•å‡ºæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼š</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">wrongsingleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> volatile wrongsingleton _instance = <span class="literal">null</span>; </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> wrongsingleton() &#123;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> wrongsingleton getInstance() &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (_instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            _instance = <span class="keyword">new</span> <span class="type">wrongsingleton</span>();</span><br><span class="line">            System.out.println(<span class="string">"--initialized once."</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> _instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> void testInit()&#123;</span><br><span class="line">         </span><br><span class="line">        Thread t1 = <span class="keyword">new</span> <span class="type">Thread</span>(<span class="keyword">new</span> <span class="type">LoopInit</span>());</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> <span class="type">Thread</span>(<span class="keyword">new</span> <span class="type">LoopInit2</span>());</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> <span class="type">Thread</span>(<span class="keyword">new</span> <span class="type">LoopInit</span>());</span><br><span class="line">        Thread t4 = <span class="keyword">new</span> <span class="type">Thread</span>(<span class="keyword">new</span> <span class="type">LoopInit2</span>());</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">        t4.start();</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">while</span> (t1.isAlive() || t2.isAlive() || t3.isAlive()|| t4.isAlive()) &#123;</span><br><span class="line">             </span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">è¾“å‡ºï¼šæœ‰æ—¶è¾“å‡º<span class="string">"--initialized once."</span>ä¸€æ¬¡ï¼Œæœ‰æ—¶è¾“å‡ºå¥½å‡ æ¬¡</span><br></pre></td></tr></table></figure>
<p>åŸå› è‡ªç„¶å’Œä¸Šé¢çš„ä¾‹å­æ˜¯ä¸€æ ·çš„ã€‚<strong>å› ä¸ºvolatileä¿è¯å˜é‡å¯¹çº¿ç¨‹çš„å¯è§æ€§ï¼Œä½†ä¸ä¿è¯åŸå­æ€§ã€‚</strong></p>
<p>é™„ï¼šæ­£ç¡®çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼å†™æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ThreadSafe</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SafeLazyInitialization</span> </span>&#123; </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> Resource resource; </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> Resource <span class="title">getInstance</span><span class="params">()</span> </span>&#123; </span><br><span class="line">      <span class="keyword">if</span> (resource == <span class="keyword">null</span>) </span><br><span class="line">          resource = <span class="keyword">new</span> Resource(); </span><br><span class="line">      <span class="keyword">return</span> resource; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ä¸€ç§å†™æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ThreadSafe</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EagerInitialization</span> </span>&#123; </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Resource resource = <span class="keyword">new</span> Resource(); </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Resource <span class="title">getResource</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> resource; &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å»¶è¿Ÿåˆå§‹åŒ–çš„å†™æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ThreadSafe</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceFactory</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceHolder</span> </span>&#123; </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Resource resource = <span class="keyword">new</span> Resource(); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Resource <span class="title">getResource</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> ResourceHolder.resource ; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>äºŒæ¬¡æ£€æŸ¥é”å®š/Double Checked Lockingçš„å†™æ³•ï¼ˆåæ¨¡å¼ï¼‰</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">public class SingletonDemo &#123;</span><br><span class="line">   <span class="keyword"> private</span><span class="keyword"> static</span> volatile SingletonDemo<span class="built_in"> instance </span>= null;//æ³¨æ„éœ€è¦volatile</span><br><span class="line">  </span><br><span class="line">   <span class="keyword"> private</span> SingletonDemo() &#123;   &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="keyword"> public</span><span class="keyword"> static</span> SingletonDemo getInstance() &#123;</span><br><span class="line">       <span class="built_in"> if </span>(instance == null) &#123; //äºŒæ¬¡æ£€æŸ¥ï¼Œæ¯”ç›´æ¥ç”¨ç‹¬å é”æ•ˆç‡é«˜</span><br><span class="line">               synchronized (SingletonDemo .class)&#123;</span><br><span class="line">                   <span class="built_in"> if </span>(instance == null) &#123;</span><br><span class="line">                              <span class="built_in"> instance </span>=<span class="built_in"> new </span>SingletonDemo (); </span><br><span class="line">                    &#125;</span><br><span class="line">             &#125;</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="built_in"> return </span>instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸ºä»€ä¹ˆAtomicXXXå…·æœ‰åŸå­æ€§å’Œå¯è§æ€§ï¼Ÿ</p>
</blockquote>
<p>å°±æ‹¿AtomicLongæ¥è¯´ï¼Œå®ƒæ—¢è§£å†³äº†ä¸Šè¿°çš„volatileçš„åŸå­æ€§æ²¡æœ‰ä¿è¯çš„é—®é¢˜ï¼Œåˆå…·æœ‰å¯è§æ€§ã€‚å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„ï¼ŸCASï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰æŒ‡ä»¤ã€‚ å…¶å®AtomicLongçš„æºç é‡Œä¹Ÿç”¨åˆ°äº†volatileï¼Œä½†åªæ˜¯ç”¨æ¥è¯»å–æˆ–å†™å…¥ï¼Œè§æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicLong</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">long</span> value;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a new AtomicLong with the given initial value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> initialValue the initial value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AtomicLong</span><span class="params">(<span class="keyword">long</span> initialValue)</span> </span>&#123;</span><br><span class="line">        value = initialValue;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a new AtomicLong with initial value &#123;<span class="doctag">@code</span> 0&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AtomicLong</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å…¶CASæºç æ ¸å¿ƒä»£ç ä¸ºï¼š</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> compare_and_swap (<span class="keyword">int</span>* <span class="keyword">reg</span>, <span class="keyword">int</span> oldval, <span class="keyword">int</span> newval) </span><br><span class="line">&#123;</span><br><span class="line">  ATOMIC();</span><br><span class="line">  <span class="keyword">int</span> old_reg_val = *<span class="keyword">reg</span>;</span><br><span class="line">  <span class="keyword">if</span> (old_reg_val == oldval) </span><br><span class="line">     *<span class="keyword">reg</span> = newval;</span><br><span class="line">  END_ATOMIC();</span><br><span class="line">  <span class="keyword">return</span> old_reg_val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è™šæ‹ŸæœºæŒ‡ä»¤ä¸ºï¼š</p>
<figure class="highlight cos"><table><tr><td class="code"><pre><span class="line">mov    <span class="number">0</span>xc(<span class="built_in">%r</span>11),<span class="built_in">%eax</span>       <span class="comment">; Load</span></span><br><span class="line">mov    <span class="built_in">%eax</span>,<span class="built_in">%r</span>8d            </span><br><span class="line">inc    <span class="built_in">%r</span>8d                 <span class="comment">; Increment</span></span><br><span class="line"><span class="keyword">lock</span> cmpxchg <span class="built_in">%r</span>8d,<span class="number">0</span>xc(<span class="built_in">%r</span>11) <span class="comment">; Compare and exchange</span></span><br></pre></td></tr></table></figure>
<p>å› ä¸ºCASæ˜¯åŸºäºä¹è§‚é”çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å†™å…¥çš„æ—¶å€™ï¼Œå¦‚æœå¯„å­˜å™¨æ—§å€¼å·²ç»ä¸ç­‰äºç°å€¼ï¼Œè¯´æ˜æœ‰å…¶ä»–CPUåœ¨ä¿®æ”¹ï¼Œé‚£å°±ç»§ç»­å°è¯•ã€‚æ‰€ä»¥è¿™å°±ä¿è¯äº†æ“ä½œçš„åŸå­æ€§ã€‚</p>
<p> <img src="http://images.cnitblog.com/blog/28306/201402/191824486252285.png " width="400" height="300" alt="å›¾ç‰‡åç§°" align="center"></p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®åº“ç³»ç»Ÿåˆ†å±‚ä¼˜åŒ–</title>
    <url>/2017/02/24/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%88%86%E5%B1%82%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ç½‘ä¸Šæœ‰ä¸°å¯Œçš„æ•°æ®åº“ä¼˜åŒ–æ–¹æ¡ˆï¼Œä½†æ˜¯å¤§å¤šéƒ½æ˜¯é›¶é›¶ç¢ç¢ï¼Œç³»ç»Ÿåœ°ä»‹ç»æ•°æ®åº“ä¼˜åŒ–çš„å¾ˆå°‘ã€‚ç¬”è€…æ ¹æ®è‡ªå·±çš„ç»éªŒï¼Œä»¥åŠå‚è€ƒäº†å…¶ä»–é«˜æ‰‹çš„ä¼˜åŒ–æ–‡ç« ï¼Œæ•´ç†ä¸€ä»½ç³»ç»Ÿçš„ä¼˜åŒ–æ–¹æ¡ˆã€‚</p>
<p>æ•°æ®åº“ä¼˜åŒ–çš„ç›®çš„æ˜¯æé«˜DBçš„å·¥ä½œæ•ˆç‡ï¼Œå‡å°‘å“åº”æ—¶é—´ã€‚åŸºäºæ­¤ï¼Œç¬”è€…è®¤ä¸ºåº”è¯¥ä»å¦‚ä¸‹å››ä¸ªå±‚æ¬¡æ¥ä¼˜åŒ–æ•°æ®åº“æ€§èƒ½ã€‚<br><a id="more"></a></p>
<p><li>ç¡¬ä»¶å±‚é¢ä¼˜åŒ–</li></p>
<p><li>æ“ä½œç³»ç»Ÿ/DBMSå±‚é¢ä¼˜åŒ–</li></p>
<p><li>DBè®¾è®¡å±‚é¢ä¼˜åŒ–</li></p>
<p><li>ç¨‹åºè®¾è®¡å±‚é¢çš„ä¼˜åŒ–</li></p>
<blockquote>
<ol>
<li>ç¡¬ä»¶å±‚é¢ä¼˜åŒ–<br>è¯¥å±‚é¢çš„ä¼˜åŒ–æ˜¯æœ€åº•å±‚çš„ï¼ŒåŒ…æ‹¬å†…å­˜ã€CPUã€ç£ç›˜/ç£ç›˜é˜µåˆ—ç­‰ç¡¬ä»¶çš„ä¼˜åŒ–ã€‚è™½ç„¶å¯ä¼˜åŒ–çš„ç‚¹å¹¶ä¸å¤šï¼Œä½†æ˜¯åœ¨æ•´ä¸ªæ•°æ®åº“ä¼˜åŒ–ä¸­ä¸å¯æˆ–ç¼ºã€‚</li>
<li>æ“ä½œç³»ç»Ÿ/DBMSå±‚é¢çš„ä¼˜åŒ–<br>åŒ…æ‹¬DBMSçš„é€‰æ‹©ã€ç¼“å­˜çš„è®¾ç½®ã€æ•°æ®æ–‡ä»¶çš„å­˜å‚¨ä½ç½®åŠæ–¹æ³•(è¿ç»­å­˜å‚¨/éšæœºå­˜å‚¨)ã€å­˜å‚¨å¼•æ“çš„é€‰æ‹©(MySQLé‡Œé¢ä¼šæœ‰å¤šä¸ªå¼•æ“)ã€I/Oä¼˜åŒ–(ç£ç›˜I/Oã€é€»è¾‘I/O)ã€‚è¯¥å±‚é¢çš„ä¼˜åŒ–å†…å®¹ç›¸å¯¹ä¸å¤šï¼Œä½†æ˜¯æ•°æ®åº“ä¼˜åŒ–çš„ç“¶é¢ˆä¸€èˆ¬éƒ½åœ¨è¿™é‡Œã€‚</li>
<li>DBè®¾è®¡å±‚é¢ä¼˜åŒ–<br>è¯¥å±‚é¢å¯ä¼˜åŒ–çš„ç‚¹å¾ˆå¤šï¼ŒåŒ…æ‹¬æ•°æ®åº“èŒƒå¼ã€æ•°æ®è¡¨ç»“æ„ã€æ•°æ®ç±»å‹ã€è§†å›¾ã€ç´¢å¼•ã€è¡¨/å­—æ®µå†—ä½™ã€è¡¨åˆ†å‰²(æ°´å¹³åˆ†å‰²åŠå‚ç›´åˆ†å‰²ã€åˆ†ç±»åˆ†å‰²)ã€è¡¨è§¦å‘å™¨ã€å‘½åç­‰å¤šæ–¹é¢ï¼Œè€Œä¸”æ¯ä¸ªæ–¹é¢åˆæœ‰å¾ˆå¤šçš„çŸ¥è¯†ç‚¹ï¼Œè¿™æ˜¯æ•°æ®åº“ä¼˜åŒ–çš„åŸºç¡€ã€‚</li>
<li>ç¨‹åºè®¾è®¡å±‚é¢ä¼˜åŒ–<br>è¿™é‡Œç”±ç¨‹åºå‘˜æ§åˆ¶å±‚é¢çš„ä¼˜åŒ–ã€‚åŒ…æ‹¬SQLè¯­å¥ã€å­˜å‚¨è¿‡ç¨‹ã€ä¸´æ—¶è¡¨ã€ä¸šåŠ¡é€»è¾‘ã€ç®—æ³•è®¾è®¡ã€è¿ç®—ç¬¦ã€æ¡ä»¶é¡ºåºã€æ•°æ®åº“å‡½æ•°ã€‚è¿™å±‚çš„çŸ¥è¯†ç‚¹æ¯”è¾ƒæ•£ï¼Œè€Œä¸”å¤šã€‚ç¨‹åºå‘˜åº”è¯¥ä¸‹åŠŸå¤«çš„åœ°æ–¹ã€‚</li>
</ol>
</blockquote>
]]></content>
      <categories>
        <category>æ•°æ®åº“é‚£ç‚¹äº‹</category>
      </categories>
      <tags>
        <tag>ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸Œå°”æ’åº</title>
    <url>/2017/02/20/%E5%B8%8C%E5%B0%94%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>å¸Œå°”æ’åºï¼Œä¹Ÿç§°<strong>é€’å‡å¢é‡æ’åºç®—æ³•</strong>ï¼Œæ˜¯æ’å…¥æ’åºçš„ä¸€ç§æ›´é«˜æ•ˆçš„æ”¹è¿›ç‰ˆæœ¬ã€‚å¸Œå°”æ’åºæ˜¯éç¨³å®šæ’åºç®—æ³•ã€‚<br>å¸Œå°”æ’åºæ˜¯åŸºäºæ’å…¥æ’åºçš„ä»¥ä¸‹ä¸¤ç‚¹æ€§è´¨è€Œæå‡ºæ”¹è¿›æ–¹æ³•çš„ï¼š</p>
<p><li>æ’å…¥æ’åºåœ¨å¯¹å‡ ä¹å·²ç»æ’å¥½åºçš„æ•°æ®æ“ä½œæ—¶ï¼Œæ•ˆç‡é«˜ï¼Œå³å¯ä»¥è¾¾åˆ°çº¿æ€§æ’åºçš„æ•ˆç‡</li></p>
<p><li>ä½†æ’å…¥æ’åºä¸€èˆ¬æ¥è¯´æ˜¯ä½æ•ˆçš„ï¼Œå› ä¸ºæ’å…¥æ’åºæ¯æ¬¡åªèƒ½å°†æ•°æ®ç§»åŠ¨ä¸€ä½<br><a id="more"></a><br>åŸå§‹çš„ç®—æ³•å®ç°åœ¨æœ€åçš„æƒ…å†µä¸‹éœ€è¦è¿›è¡ŒO(n2)çš„æ¯”è¾ƒå’Œäº¤æ¢ã€‚ä¹‹åå¯¹ç®—æ³•è¿›è¡Œäº†å°‘é‡ä¿®æ”¹ï¼Œå¯ä»¥ä½¿å¾—æ€§èƒ½æå‡è‡³O(n log2 n)ã€‚è¿™æ¯”æœ€å¥½çš„æ¯”è¾ƒç®—æ³•çš„O(n log n)è¦å·®ä¸€äº›ã€‚</li></p>
<p>å¸Œå°”æ’åºé€šè¿‡å°†æ¯”è¾ƒçš„å…¨éƒ¨å…ƒç´ åˆ†ä¸ºå‡ ä¸ªåŒºåŸŸæ¥æå‡æ’å…¥æ’åºçš„æ€§èƒ½ã€‚è¿™æ ·å¯ä»¥è®©ä¸€ä¸ªå…ƒç´ å¯ä»¥ä¸€æ¬¡æ€§åœ°æœæœ€ç»ˆä½ç½®å‰è¿›ä¸€å¤§æ­¥ã€‚ç„¶åç®—æ³•å†å–è¶Šæ¥è¶Šå°çš„æ­¥é•¿è¿›è¡Œæ’åºï¼Œç®—æ³•çš„æœ€åä¸€æ­¥å°±æ˜¯æ™®é€šçš„æ’å…¥æ’åºï¼Œä½†æ˜¯åˆ°äº†è¿™æ­¥ï¼Œéœ€æ’åºçš„æ•°æ®å‡ ä¹æ˜¯å·²æ’å¥½çš„äº†ï¼ˆæ­¤æ—¶æ’å…¥æ’åºè¾ƒå¿«ï¼‰ã€‚</p>
<p>å‡è®¾æœ‰ä¸€ä¸ªå¾ˆå°çš„æ•°æ®åœ¨ä¸€ä¸ªå·²æŒ‰å‡åºæ’å¥½åºçš„æ•°ç»„çš„æœ«ç«¯ã€‚å¦‚æœç”¨å¤æ‚åº¦ä¸ºO(n2)çš„æ’åºï¼ˆå†’æ³¡æ’åºæˆ–æ’å…¥æ’åºï¼‰ï¼Œå¯èƒ½ä¼šè¿›è¡Œnæ¬¡çš„æ¯”è¾ƒå’Œäº¤æ¢æ‰èƒ½å°†è¯¥æ•°æ®ç§»è‡³æ­£ç¡®ä½ç½®ã€‚è€Œå¸Œå°”æ’åºä¼šç”¨è¾ƒå¤§çš„æ­¥é•¿ç§»åŠ¨æ•°æ®ï¼Œæ‰€ä»¥å°æ•°æ®åªéœ€è¿›è¡Œå°‘æ•°æ¯”è¾ƒå’Œäº¤æ¢å³å¯åˆ°æ­£ç¡®ä½ç½®ã€‚</p>
<p>ä¸€ä¸ªæ›´å¥½ç†è§£çš„å¸Œå°”æ’åºå®ç°ï¼šå°†æ•°ç»„åˆ—åœ¨ä¸€ä¸ªè¡¨ä¸­å¹¶å¯¹åˆ—æ’åºï¼ˆç”¨æ’å…¥æ’åºï¼‰ã€‚é‡å¤è¿™è¿‡ç¨‹ï¼Œä¸è¿‡æ¯æ¬¡ç”¨æ›´é•¿çš„åˆ—æ¥è¿›è¡Œã€‚æœ€åæ•´ä¸ªè¡¨å°±åªæœ‰ä¸€åˆ—äº†ã€‚å°†æ•°ç»„è½¬æ¢è‡³è¡¨æ˜¯ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ç®—æ³•ï¼Œç®—æ³•æœ¬èº«ä»…ä»…å¯¹åŸæ•°ç»„è¿›è¡Œæ’åºï¼ˆé€šè¿‡å¢åŠ ç´¢å¼•çš„æ­¥é•¿ï¼Œä¾‹å¦‚æ˜¯ç”¨<code>i += step_size</code>è€Œä¸æ˜¯<code>i++</code>ï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æœ‰è¿™æ ·ä¸€ç»„æ•°<code>[ 13 14 94 33 82 25 59 94 65 23 45 27 73 25 39 10 ]</code>ï¼Œå¦‚æœæˆ‘ä»¬ä»¥æ­¥é•¿ä¸º5å¼€å§‹è¿›è¡Œæ’åºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†è¿™åˆ—è¡¨æ”¾åœ¨æœ‰5åˆ—çš„è¡¨ä¸­æ¥æ›´å¥½åœ°æè¿°ç®—æ³•ï¼Œè¿™æ ·ä»–ä»¬å°±åº”è¯¥çœ‹èµ·æ¥æ˜¯è¿™æ ·ï¼š</p>
<blockquote>
<p>13 14 94 33 82<br>25 59 94 65 23<br>45 27 73 25 39<br>10</p>
</blockquote>
<p>ç„¶åæˆ‘ä»¬å¯¹æ¯åˆ—è¿›è¡Œæ’åºï¼š</p>
<blockquote>
<p>10 14 73 25 23<br>13 27 94 33 39<br>25 59 94 65 82<br>45</p>
</blockquote>
<p>å°†ä¸Šè¿°å››è¡Œæ•°å­—ï¼Œä¾åºæ¥åœ¨ä¸€èµ·æ—¶æˆ‘ä»¬å¾—åˆ°ï¼š[ 10 14 73 25 23 13 27 94 33 39 25 59 94 65 82 45 ].è¿™æ—¶10å·²ç»ç§»è‡³æ­£ç¡®ä½ç½®äº†ï¼Œç„¶åå†ä»¥3ä¸ºæ­¥é•¿è¿›è¡Œæ’åºï¼š</p>
<blockquote>
<p>10 14 73<br>25 23 13<br>27 94 33<br>39 25 59<br>94 65 82<br>45</p>
</blockquote>
<p>æ’åºä¹‹åå˜ä¸ºï¼š</p>
<blockquote>
<p>10 14 13<br>25 23 33<br>27 25 59<br>39 65 73<br>45 94 82<br>94</p>
</blockquote>
<p>æœ€åä»¥1æ­¥é•¿è¿›è¡Œæ’åºï¼ˆæ­¤æ—¶å°±æ˜¯ç®€å•çš„æ’å…¥æ’åºäº†ï¼‰ã€‚</p>
<p>æ­¥é•¿çš„é€‰æ‹©æ˜¯å¸Œå°”æ’åºçš„é‡è¦éƒ¨åˆ†ã€‚åªè¦æœ€ç»ˆæ­¥é•¿ä¸º1ä»»ä½•æ­¥é•¿åºåˆ—éƒ½å¯ä»¥å·¥ä½œã€‚ç®—æ³•æœ€å¼€å§‹ä»¥ä¸€å®šçš„æ­¥é•¿è¿›è¡Œæ’åºã€‚ç„¶åä¼šç»§ç»­ä»¥ä¸€å®šæ­¥é•¿è¿›è¡Œæ’åºï¼Œæœ€ç»ˆç®—æ³•ä»¥æ­¥é•¿ä¸º1è¿›è¡Œæ’åºã€‚å½“æ­¥é•¿ä¸º1æ—¶ï¼Œç®—æ³•å˜ä¸ºæ’å…¥æ’åºï¼Œè¿™å°±ä¿è¯äº†æ•°æ®ä¸€å®šä¼šè¢«æ’åºã€‚</p>
<p>è¯¥ç®—æ³•æœ€åˆå»ºè®®æ­¥é•¿é€‰æ‹©ä¸ºn/2å¹¶ä¸”å¯¹æ­¥é•¿å–åŠç›´åˆ°æ­¥é•¿è¾¾åˆ°1ã€‚è™½ç„¶è¿™æ ·å–å¯ä»¥æ¯”O(nâ€™2)ç±»çš„ç®—æ³•ï¼ˆæ’å…¥æ’åºï¼‰æ›´å¥½ï¼Œä½†è¿™æ ·ä»ç„¶æœ‰å‡å°‘å¹³å‡æ—¶é—´å’Œæœ€å·®æ—¶é—´çš„ä½™åœ°ã€‚å¯èƒ½å¸Œå°”æ’åºæœ€é‡è¦çš„åœ°æ–¹åœ¨äºå½“ç”¨è¾ƒå°æ­¥é•¿æ’åºåï¼Œä»¥å‰ç”¨çš„è¾ƒå¤§æ­¥é•¿ä»ç„¶æ˜¯æœ‰åºçš„ã€‚</p>
<p>æ¯”å¦‚ï¼Œå¦‚æœä¸€ä¸ªæ•°åˆ—ä»¥æ­¥é•¿5è¿›è¡Œäº†æ’åºç„¶åå†ä»¥æ­¥é•¿3è¿›è¡Œæ’åºï¼Œé‚£ä¹ˆè¯¥æ•°åˆ—ä¸ä»…æ˜¯ä»¥æ­¥é•¿3æœ‰åºï¼Œè€Œä¸”æ˜¯ä»¥æ­¥é•¿5æœ‰åºã€‚å¦‚æœä¸æ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆç®—æ³•åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¼šæ‰“ä¹±ä»¥å‰çš„é¡ºåºï¼Œé‚£å°±ä¸ä¼šä»¥å¦‚æ­¤çŸ­çš„æ—¶é—´å®Œæˆæ’åºäº†ã€‚</p>
<p><strong>å®ç°ï¼š</strong><br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">public</span> <span class="string">static</span> <span class="string">void</span> <span class="string">shell_sort(int[]</span> <span class="string">arr)</span> <span class="string">&#123;</span></span><br><span class="line">	<span class="string">int</span> <span class="string">gap</span> <span class="string">=</span> <span class="number">1</span><span class="string">,</span> <span class="string">i,</span> <span class="string">j,</span> <span class="string">len</span> <span class="string">=</span> <span class="string">arr.length;</span></span><br><span class="line">	<span class="string">int</span> <span class="string">temp;</span></span><br><span class="line">	<span class="string">while</span> <span class="string">(gap</span> <span class="string">&lt;</span> <span class="string">len</span> <span class="string">/</span> <span class="number">3</span><span class="string">)</span></span><br><span class="line">		<span class="string">gap</span> <span class="string">=</span> <span class="string">gap</span> <span class="string">*</span> <span class="number">3</span> <span class="string">+</span> <span class="number">1</span><span class="string">;</span> <span class="string">//</span> <span class="number">1</span><span class="string">,</span> <span class="number">4</span><span class="string">,</span> <span class="number">13</span><span class="string">,</span> <span class="number">40</span><span class="string">,</span> <span class="number">121</span><span class="string">,</span> <span class="string">...</span></span><br><span class="line">	<span class="string">for</span> <span class="string">(;</span> <span class="string">gap</span> <span class="string">&gt;</span> <span class="number">0</span><span class="string">;</span> <span class="string">gap</span> <span class="string">/=</span> <span class="number">3</span><span class="string">)</span></span><br><span class="line">		<span class="string">for</span> <span class="string">(i</span> <span class="string">=</span> <span class="string">gap;</span> <span class="string">i</span> <span class="string">&lt;</span> <span class="string">len;</span> <span class="string">i++)</span> <span class="string">&#123;</span></span><br><span class="line">			<span class="string">temp</span> <span class="string">=</span> <span class="string">arr[i];</span></span><br><span class="line">			<span class="string">for</span> <span class="string">(j</span> <span class="string">=</span> <span class="string">i</span> <span class="bullet">-</span> <span class="string">gap;</span> <span class="string">j</span> <span class="string">&gt;=</span> <span class="number">0</span> <span class="string">&amp;&amp;</span> <span class="string">arr[j]</span> <span class="string">&gt;</span> <span class="string">temp;</span> <span class="string">j</span> <span class="string">-=</span> <span class="string">gap)</span></span><br><span class="line">				<span class="string">arr[j</span> <span class="string">+</span> <span class="string">gap]</span> <span class="string">=</span> <span class="string">arr[j];</span></span><br><span class="line">			<span class="string">arr[j</span> <span class="string">+</span> <span class="string">gap]</span> <span class="string">=</span> <span class="string">temp;</span></span><br><span class="line">		<span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>æ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®åº“30æ¡å†›è§„è§£è¯»</title>
    <url>/2017/02/18/58%E5%88%B0%E5%AE%B6%E6%95%B0%E6%8D%AE%E5%BA%9330%E6%9D%A1%E5%86%9B%E8%A7%84%E8%A7%A3%E8%AF%BB/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>å†›è§„é€‚ç”¨åœºæ™¯ï¼šå¹¶å‘é‡å¤§ã€æ•°æ®é‡å¤§çš„äº’è”ç½‘ä¸šåŠ¡<br><br>å†›è§„ï¼šä»‹ç»å†…å®¹<br><br>è§£è¯»ï¼šè®²è§£åŸå› ï¼Œè§£è¯»æ¯”å†›è§„æ›´é‡è¦<br> <a id="more"></a><br>ä¸€ã€åŸºç¡€è§„èŒƒ</p>
<p>ï¼ˆ1ï¼‰å¿…é¡»ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“</p>
<blockquote>
<p>è§£è¯»ï¼šæ”¯æŒäº‹åŠ¡ã€è¡Œçº§é”ã€å¹¶å‘æ€§èƒ½æ›´å¥½ã€CPUåŠå†…å­˜ç¼“å­˜é¡µä¼˜åŒ–ä½¿å¾—èµ„æºåˆ©ç”¨ç‡æ›´é«˜</p>
</blockquote>
<p><br>ï¼ˆ2ï¼‰å¿…é¡»ä½¿ç”¨UTF8å­—ç¬¦é›†</p>
<blockquote>
<p>è§£è¯»ï¼šä¸‡å›½ç ï¼Œæ— éœ€è½¬ç ï¼Œæ— ä¹±ç é£é™©ï¼ŒèŠ‚çœç©ºé—´</p>
</blockquote>
<p><br>ï¼ˆ3ï¼‰æ•°æ®è¡¨ã€æ•°æ®å­—æ®µå¿…é¡»åŠ å…¥ä¸­æ–‡æ³¨é‡Š</p>
<blockquote>
<p>è§£è¯»ï¼šNå¹´åè°tmçŸ¥é“è¿™ä¸ªr1,r2,r3å­—æ®µæ˜¯å¹²å˜›çš„</p>
</blockquote>
<p><br>ï¼ˆ4ï¼‰ç¦æ­¢ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ã€è§†å›¾ã€è§¦å‘å™¨ã€Event</p>
<blockquote>
<p>è§£è¯»ï¼šé«˜å¹¶å‘å¤§æ•°æ®çš„äº’è”ç½‘ä¸šåŠ¡ï¼Œæ¶æ„è®¾è®¡æ€è·¯æ˜¯â€œè§£æ”¾æ•°æ®åº“CPUï¼Œå°†è®¡ç®—è½¬ç§»åˆ°æœåŠ¡å±‚â€ï¼Œå¹¶å‘é‡å¤§çš„æƒ…å†µä¸‹ï¼Œè¿™äº›åŠŸèƒ½å¾ˆå¯èƒ½å°†æ•°æ®åº“æ‹–æ­»ï¼Œä¸šåŠ¡é€»è¾‘æ”¾åˆ°æœåŠ¡å±‚å…·å¤‡æ›´å¥½çš„æ‰©å±•æ€§ï¼Œèƒ½å¤Ÿè½»æ˜“å®ç°â€œå¢æœºå™¨å°±åŠ æ€§èƒ½â€ã€‚æ•°æ®åº“æ“…é•¿å­˜å‚¨ä¸ç´¢å¼•ï¼ŒCPUè®¡ç®—è¿˜æ˜¯ä¸Šç§»å§</p>
</blockquote>
<p><br>ï¼ˆ5ï¼‰ç¦æ­¢å­˜å‚¨å¤§æ–‡ä»¶æˆ–è€…å¤§ç…§ç‰‡</p>
<blockquote>
<p>è§£è¯»ï¼šä¸ºä½•è¦è®©æ•°æ®åº“åšå®ƒä¸æ“…é•¿çš„äº‹æƒ…ï¼Ÿå¤§æ–‡ä»¶å’Œç…§ç‰‡å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿï¼Œæ•°æ®åº“é‡Œå­˜URIå¤šå¥½</p>
</blockquote>
<p><br>äºŒã€å‘½åè§„èŒƒ</p>
<p>ï¼ˆ6ï¼‰åªå…è®¸ä½¿ç”¨å†…ç½‘åŸŸåï¼Œè€Œä¸æ˜¯ipè¿æ¥æ•°æ®åº“</p>
<p>ï¼ˆ7ï¼‰çº¿ä¸Šç¯å¢ƒã€å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒæ•°æ®åº“å†…ç½‘åŸŸåéµå¾ªå‘½åè§„èŒƒ</p>
<blockquote>
<p>ä¸šåŠ¡åç§°ï¼šxxx<br>çº¿ä¸Šç¯å¢ƒï¼šdj.xxx.db<br>å¼€å‘ç¯å¢ƒï¼šdj.xxx.rdb<br>æµ‹è¯•ç¯å¢ƒï¼šdj.xxx.tdb<br>ä»åº“åœ¨åç§°ååŠ -sæ ‡è¯†ï¼Œå¤‡åº“åœ¨åç§°ååŠ -ssæ ‡è¯†<br>çº¿ä¸Šä»åº“ï¼šdj.xxx-s.db<br>çº¿ä¸Šå¤‡åº“ï¼šdj.xxx-sss.db</p>
</blockquote>
<p><br>ï¼ˆ8ï¼‰åº“åã€è¡¨åã€å­—æ®µåï¼šå°å†™ï¼Œä¸‹åˆ’çº¿é£æ ¼ï¼Œä¸è¶…è¿‡32ä¸ªå­—ç¬¦ï¼Œå¿…é¡»è§åçŸ¥æ„ï¼Œç¦æ­¢æ‹¼éŸ³è‹±æ–‡æ··ç”¨</p>
<p>ï¼ˆ9ï¼‰è¡¨åt_xxxï¼Œéå”¯ä¸€ç´¢å¼•åidx_xxxï¼Œå”¯ä¸€ç´¢å¼•åuniq_xxx</p>
<p>ä¸‰ã€è¡¨è®¾è®¡è§„èŒƒ</p>
<p>ï¼ˆ10ï¼‰å•å®ä¾‹è¡¨æ•°ç›®å¿…é¡»å°äº500</p>
<p>ï¼ˆ11ï¼‰å•è¡¨åˆ—æ•°ç›®å¿…é¡»å°äº30</p>
<p>ï¼ˆ12ï¼‰è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼Œä¾‹å¦‚è‡ªå¢ä¸»é”®</p>
<blockquote>
<p>è§£è¯»ï¼š<br>aï¼‰ä¸»é”®é€’å¢ï¼Œæ•°æ®è¡Œå†™å…¥å¯ä»¥æé«˜æ’å…¥æ€§èƒ½ï¼Œå¯ä»¥é¿å…pageåˆ†è£‚ï¼Œå‡å°‘è¡¨ç¢ç‰‡æå‡ç©ºé—´å’Œå†…å­˜çš„ä½¿ç”¨<br>bï¼‰ä¸»é”®è¦é€‰æ‹©è¾ƒçŸ­çš„æ•°æ®ç±»å‹ï¼Œ Innodbå¼•æ“æ™®é€šç´¢å¼•éƒ½ä¼šä¿å­˜ä¸»é”®çš„å€¼ï¼Œè¾ƒçŸ­çš„æ•°æ®ç±»å‹å¯ä»¥æœ‰æ•ˆçš„å‡å°‘ç´¢å¼•çš„ç£ç›˜ç©ºé—´ï¼Œæé«˜ç´¢å¼•çš„ç¼“å­˜æ•ˆç‡<br>cï¼‰ æ— ä¸»é”®çš„è¡¨åˆ é™¤ï¼Œåœ¨rowæ¨¡å¼çš„ä¸»ä»æ¶æ„ï¼Œä¼šå¯¼è‡´å¤‡åº“å¤¯ä½</p>
</blockquote>
<p><br>ï¼ˆ13ï¼‰ç¦æ­¢ä½¿ç”¨å¤–é”®ï¼Œå¦‚æœæœ‰å¤–é”®å®Œæ•´æ€§çº¦æŸï¼Œéœ€è¦åº”ç”¨ç¨‹åºæ§åˆ¶</p>
<blockquote>
<p>è§£è¯»ï¼šå¤–é”®ä¼šå¯¼è‡´è¡¨ä¸è¡¨ä¹‹é—´è€¦åˆï¼Œupdateä¸deleteæ“ä½œéƒ½ä¼šæ¶‰åŠç›¸å…³è”çš„è¡¨ï¼Œååˆ†å½±å“sql çš„æ€§èƒ½ï¼Œç”šè‡³ä¼šé€ æˆæ­»é”ã€‚é«˜å¹¶å‘æƒ…å†µä¸‹å®¹æ˜“é€ æˆæ•°æ®åº“æ€§èƒ½ï¼Œå¤§æ•°æ®é«˜å¹¶å‘ä¸šåŠ¡åœºæ™¯æ•°æ®åº“ä½¿ç”¨ä»¥æ€§èƒ½ä¼˜å…ˆ</p>
</blockquote>
<p><br>å››ã€å­—æ®µè®¾è®¡è§„èŒƒ</p>
<p><br>ï¼ˆ14ï¼‰å¿…é¡»æŠŠå­—æ®µå®šä¹‰ä¸ºNOT NULLå¹¶ä¸”æä¾›é»˜è®¤å€¼</p>
<blockquote>
<p>è§£è¯»ï¼š<br>aï¼‰nullçš„åˆ—ä½¿ç´¢å¼•/ç´¢å¼•ç»Ÿè®¡/å€¼æ¯”è¾ƒéƒ½æ›´åŠ å¤æ‚ï¼Œå¯¹MySQLæ¥è¯´æ›´éš¾ä¼˜åŒ–<br>bï¼‰null è¿™ç§ç±»å‹MySQLå†…éƒ¨éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œå¢åŠ æ•°æ®åº“å¤„ç†è®°å½•çš„å¤æ‚æ€§ï¼›åŒç­‰æ¡ä»¶ä¸‹ï¼Œè¡¨ä¸­æœ‰è¾ƒå¤šç©ºå­—æ®µçš„æ—¶å€™ï¼Œæ•°æ®åº“çš„å¤„ç†æ€§èƒ½ä¼šé™ä½å¾ˆå¤š<br>cï¼‰nullå€¼éœ€è¦æ›´å¤šçš„å­˜å‚¨ç©ºï¼Œæ— è®ºæ˜¯è¡¨è¿˜æ˜¯ç´¢å¼•ä¸­æ¯è¡Œä¸­çš„nullçš„åˆ—éƒ½éœ€è¦é¢å¤–çš„ç©ºé—´æ¥æ ‡è¯†<br>dï¼‰å¯¹null çš„å¤„ç†æ—¶å€™ï¼Œåªèƒ½é‡‡ç”¨is nullæˆ–is not nullï¼Œè€Œä¸èƒ½é‡‡ç”¨=ã€inã€&lt;ã€&lt;&gt;ã€!=ã€not inè¿™äº›æ“ä½œç¬¦å·ã€‚å¦‚ï¼šwhere name!=â€™shenjianâ€™ï¼Œå¦‚æœå­˜åœ¨nameä¸ºnullå€¼çš„è®°å½•ï¼ŒæŸ¥è¯¢ç»“æœå°±ä¸ä¼šåŒ…å«nameä¸ºnullå€¼çš„è®°å½•</p>
</blockquote>
<p><br>ï¼ˆ15ï¼‰ç¦æ­¢ä½¿ç”¨TEXTã€BLOBç±»å‹</p>
<blockquote>
<p>è§£è¯»ï¼šä¼šæµªè´¹æ›´å¤šçš„ç£ç›˜å’Œå†…å­˜ç©ºé—´ï¼Œéå¿…è¦çš„å¤§é‡çš„å¤§å­—æ®µæŸ¥è¯¢ä¼šæ·˜æ±°æ‰çƒ­æ•°æ®ï¼Œå¯¼è‡´å†…å­˜å‘½ä¸­ç‡æ€¥å‰§é™ä½ï¼Œå½±å“æ•°æ®åº“æ€§èƒ½</p>
</blockquote>
<p><br>ï¼ˆ16ï¼‰ç¦æ­¢ä½¿ç”¨å°æ•°å­˜å‚¨è´§å¸</p>
<blockquote>
<p>è§£è¯»ï¼šä½¿ç”¨æ•´æ•°å§ï¼Œå°æ•°å®¹æ˜“å¯¼è‡´é’±å¯¹ä¸ä¸Š</p>
</blockquote>
<p><br>ï¼ˆ17ï¼‰å¿…é¡»ä½¿ç”¨varchar(20)å­˜å‚¨æ‰‹æœºå·</p>
<blockquote>
<p>è§£è¯»ï¼š<br>aï¼‰æ¶‰åŠåˆ°åŒºå·æˆ–è€…å›½å®¶ä»£å·ï¼Œå¯èƒ½å‡ºç°+-()<br>bï¼‰æ‰‹æœºå·ä¼šå»åšæ•°å­¦è¿ç®—ä¹ˆï¼Ÿ<br>cï¼‰varcharå¯ä»¥æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼šlikeâ€œ138%â€</p>
</blockquote>
<p><br>ï¼ˆ18ï¼‰ç¦æ­¢ä½¿ç”¨ENUMï¼Œå¯ä½¿ç”¨TINYINTä»£æ›¿</p>
<blockquote>
<p>è§£è¯»ï¼š<br>aï¼‰å¢åŠ æ–°çš„ENUMå€¼è¦åšDDLæ“ä½œ<br>bï¼‰ENUMçš„å†…éƒ¨å®é™…å­˜å‚¨å°±æ˜¯æ•´æ•°ï¼Œä½ ä»¥ä¸ºè‡ªå·±å®šä¹‰çš„æ˜¯å­—ç¬¦ä¸²ï¼Ÿ</p>
</blockquote>
<p><br>äº”ã€ç´¢å¼•è®¾è®¡è§„èŒƒ</p>
<p>ï¼ˆ19ï¼‰å•è¡¨ç´¢å¼•å»ºè®®æ§åˆ¶åœ¨5ä¸ªä»¥å†…</p>
<p>ï¼ˆ20ï¼‰å•ç´¢å¼•å­—æ®µæ•°ä¸å…è®¸è¶…è¿‡5ä¸ª</p>
<blockquote>
<p>è§£è¯»ï¼šå­—æ®µè¶…è¿‡5ä¸ªæ—¶ï¼Œå®é™…å·²ç»èµ·ä¸åˆ°æœ‰æ•ˆè¿‡æ»¤æ•°æ®çš„ä½œç”¨äº†</p>
</blockquote>
<p><br>ï¼ˆ21ï¼‰ç¦æ­¢åœ¨æ›´æ–°ååˆ†é¢‘ç¹ã€åŒºåˆ†åº¦ä¸é«˜çš„å±æ€§ä¸Šå»ºç«‹ç´¢å¼•</p>
<blockquote>
<p>è§£è¯»ï¼š<br>aï¼‰æ›´æ–°ä¼šå˜æ›´B+æ ‘ï¼Œæ›´æ–°é¢‘ç¹çš„å­—æ®µå»ºç«‹ç´¢å¼•ä¼šå¤§å¤§é™ä½æ•°æ®åº“æ€§èƒ½<br>bï¼‰â€œæ€§åˆ«â€è¿™ç§åŒºåˆ†åº¦ä¸å¤§çš„å±æ€§ï¼Œå»ºç«‹ç´¢å¼•æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„ï¼Œä¸èƒ½æœ‰æ•ˆè¿‡æ»¤æ•°æ®ï¼Œæ€§èƒ½ä¸å…¨è¡¨æ‰«æç±»ä¼¼</p>
</blockquote>
<p><br>ï¼ˆ22ï¼‰å»ºç«‹ç»„åˆç´¢å¼•ï¼Œå¿…é¡»æŠŠåŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾åœ¨å‰é¢</p>
<blockquote>
<p>è§£è¯»ï¼šèƒ½å¤Ÿæ›´åŠ æœ‰æ•ˆçš„è¿‡æ»¤æ•°æ®</p>
</blockquote>
<p><br>å…­ã€SQLä½¿ç”¨è§„èŒƒ</p>
<p>ï¼ˆ23ï¼‰ç¦æ­¢ä½¿ç”¨SELECT *ï¼Œåªè·å–å¿…è¦çš„å­—æ®µï¼Œéœ€è¦æ˜¾ç¤ºè¯´æ˜åˆ—å±æ€§</p>
<blockquote>
<p>è§£è¯»ï¼š<br>aï¼‰è¯»å–ä¸éœ€è¦çš„åˆ—ä¼šå¢åŠ CPUã€IOã€NETæ¶ˆè€—<br>bï¼‰ä¸èƒ½æœ‰æ•ˆçš„åˆ©ç”¨è¦†ç›–ç´¢å¼•<br>cï¼‰ä½¿ç”¨SELECT *å®¹æ˜“åœ¨å¢åŠ æˆ–è€…åˆ é™¤å­—æ®µåå‡ºç°ç¨‹åºBUG</p>
</blockquote>
<p><br>ï¼ˆ24ï¼‰ç¦æ­¢ä½¿ç”¨INSERT INTO t_xxx VALUES(xxx)ï¼Œå¿…é¡»æ˜¾ç¤ºæŒ‡å®šæ’å…¥çš„åˆ—å±æ€§</p>
<blockquote>
<p>è§£è¯»ï¼šå®¹æ˜“åœ¨å¢åŠ æˆ–è€…åˆ é™¤å­—æ®µåå‡ºç°ç¨‹åºBUG</p>
</blockquote>
<p><br>ï¼ˆ25ï¼‰ç¦æ­¢ä½¿ç”¨å±æ€§éšå¼è½¬æ¢</p>
<blockquote>
<p>è§£è¯»ï¼šSELECT uid FROM t_user WHERE phone=13812345678 ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œè€Œä¸èƒ½å‘½ä¸­phoneç´¢å¼•ï¼ŒçŒœçŒœä¸ºä»€ä¹ˆï¼Ÿï¼ˆè¿™ä¸ªçº¿ä¸Šé—®é¢˜ä¸æ­¢å‡ºç°è¿‡ä¸€æ¬¡ï¼‰</p>
</blockquote>
<p><br>ï¼ˆ26ï¼‰ç¦æ­¢åœ¨WHEREæ¡ä»¶çš„å±æ€§ä¸Šä½¿ç”¨å‡½æ•°æˆ–è€…è¡¨è¾¾å¼</p>
<blockquote>
<p>è§£è¯»ï¼šSELECT uid FROM t_user WHERE from_unixtime(day)&gt;=â€™2017-02-15â€™ ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ<br>æ­£ç¡®çš„å†™æ³•æ˜¯ï¼šSELECT uid FROM t_user WHERE day&gt;= unix_timestamp(â€˜2017-02-15 00:00:00â€™)</p>
</blockquote>
<p><br>ï¼ˆ27ï¼‰ç¦æ­¢è´Ÿå‘æŸ¥è¯¢ï¼Œä»¥åŠ%å¼€å¤´çš„æ¨¡ç³ŠæŸ¥è¯¢</p>
<blockquote>
<p>è§£è¯»ï¼š<br>aï¼‰è´Ÿå‘æŸ¥è¯¢æ¡ä»¶ï¼šNOTã€!=ã€&lt;&gt;ã€!&lt;ã€!&gt;ã€NOT INã€NOT LIKEç­‰ï¼Œä¼šå¯¼è‡´å…¨è¡¨æ‰«æ<br>bï¼‰%å¼€å¤´çš„æ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¼šå¯¼è‡´å…¨è¡¨æ‰«æ</p>
</blockquote>
<p><br>ï¼ˆ28ï¼‰ç¦æ­¢å¤§è¡¨ä½¿ç”¨JOINæŸ¥è¯¢ï¼Œç¦æ­¢å¤§è¡¨ä½¿ç”¨å­æŸ¥è¯¢</p>
<blockquote>
<p>è§£è¯»ï¼šä¼šäº§ç”Ÿä¸´æ—¶è¡¨ï¼Œæ¶ˆè€—è¾ƒå¤šå†…å­˜ä¸CPUï¼Œæå¤§å½±å“æ•°æ®åº“æ€§èƒ½</p>
</blockquote>
<p><br>ï¼ˆ29ï¼‰ç¦æ­¢ä½¿ç”¨ORæ¡ä»¶ï¼Œå¿…é¡»æ”¹ä¸ºINæŸ¥è¯¢</p>
<blockquote>
<p>è§£è¯»ï¼šæ—§ç‰ˆæœ¬Mysqlçš„ORæŸ¥è¯¢æ˜¯ä¸èƒ½å‘½ä¸­ç´¢å¼•çš„ï¼Œå³ä½¿èƒ½å‘½ä¸­ç´¢å¼•ï¼Œä¸ºä½•è¦è®©æ•°æ®åº“è€—è´¹æ›´å¤šçš„CPUå¸®åŠ©å®æ–½æŸ¥è¯¢ä¼˜åŒ–å‘¢ï¼Ÿ</p>
</blockquote>
<p><br>ï¼ˆ30ï¼‰åº”ç”¨ç¨‹åºå¿…é¡»æ•è·SQLå¼‚å¸¸ï¼Œå¹¶æœ‰ç›¸åº”å¤„ç†</p>
<p>æ€»ç»“ï¼šå¤§æ•°æ®é‡é«˜å¹¶å‘çš„äº’è”ç½‘ä¸šåŠ¡ï¼Œæå¤§å½±å“æ•°æ®åº“æ€§èƒ½çš„éƒ½ä¸è®©ç”¨ï¼Œä¸è®©ç”¨å“Ÿã€‚<br>==ã€å®Œã€‘==</p>
]]></content>
      <categories>
        <category>æ•°æ®åº“é‚£ç‚¹äº‹</category>
      </categories>
      <tags>
        <tag>å†›è§„</tag>
      </tags>
  </entry>
  <entry>
    <title>apache poiæ“ä½œ(é€‚ç”¨äºword 2007)</title>
    <url>/2017/02/18/apache-poi%E6%93%8D%E4%BD%9C-%E9%80%82%E7%94%A8%E4%BA%8Eword-2007/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>é€‚ç”¨äºword 2007 poi ç‰ˆæœ¬ 3.7<br><a id="more"></a><br><figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.<span class="keyword">HashMap</span>;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.poi.POIXMLDocument;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.openxml4j.opc.OPCPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xwpf.usermodel.XWPFDocument;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xwpf.usermodel.XWPFParagraph;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xwpf.usermodel.XWPFRun;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xwpf.usermodel.XWPFTable;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xwpf.usermodel.XWPFTableCell;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xwpf.usermodel.XWPFTableRow;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€‚ç”¨äºword 2007 poi ç‰ˆæœ¬ 3.7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> class WordPoiUtil &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æŒ‡å®šçš„å‚æ•°å€¼ã€æ¨¡æ¿ï¼Œç”Ÿæˆ word æ–‡æ¡£</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param param</span></span><br><span class="line"><span class="comment">     *            éœ€è¦æ›¿æ¢çš„å˜é‡</span></span><br><span class="line"><span class="comment">     * @param template</span></span><br><span class="line"><span class="comment">     *            æ¨¡æ¿</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> XWPFDocument generateWord(Map&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt; param,</span><br><span class="line">            <span class="keyword">String</span> template) &#123;</span><br><span class="line">        XWPFDocument doc = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            OPCPackage pack = POIXMLDocument.openPackage(template);</span><br><span class="line">            doc = <span class="keyword">new</span> XWPFDocument(pack);</span><br><span class="line">            <span class="keyword">if</span> (param != <span class="keyword">null</span> &amp;&amp; param.<span class="built_in">size</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å¤„ç†æ®µè½</span></span><br><span class="line">                List&lt;XWPFParagraph&gt; paragraphList = doc.getParagraphs();</span><br><span class="line">                processParagraphs(paragraphList, param, doc);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å¤„ç†è¡¨æ ¼</span></span><br><span class="line">                Iterator&lt;XWPFTable&gt; it = doc.getTablesIterator();</span><br><span class="line">                <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">                    XWPFTable table = it.next();</span><br><span class="line">                    List&lt;XWPFTableRow&gt; rows = table.getRows();</span><br><span class="line">                    <span class="keyword">for</span> (XWPFTableRow row : rows) &#123;</span><br><span class="line">                        List&lt;XWPFTableCell&gt; cells = row.getTableCells();</span><br><span class="line">                        <span class="keyword">for</span> (XWPFTableCell cell : cells) &#123;</span><br><span class="line">                            List&lt;XWPFParagraph&gt; paragraphListTable = cell</span><br><span class="line">                                    .getParagraphs();</span><br><span class="line">                            processParagraphs(paragraphListTable, param, doc);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> doc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†æ®µè½</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param paragraphList</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> processParagraphs(List&lt;XWPFParagraph&gt; paragraphList,</span><br><span class="line">            Map&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt; param, XWPFDocument doc) &#123;</span><br><span class="line">        <span class="keyword">if</span> (paragraphList != <span class="keyword">null</span> &amp;&amp; paragraphList.<span class="built_in">size</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (XWPFParagraph paragraph : paragraphList) &#123;</span><br><span class="line">                <span class="built_in">boolean</span> addReplace = <span class="keyword">false</span>;</span><br><span class="line">                List&lt;XWPFRun&gt; runs = paragraph.getRuns();</span><br><span class="line">                <span class="comment">//æ¯ä¸ªéœ€è¦æ›¿æ¢çš„keyçš„runçš„ä½ç½®çš„é›†åˆ</span></span><br><span class="line">                List&lt;Integer&gt; replaceRuns = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">                <span class="comment">//æ¯ä¸ªæ®µè½çš„æ‰€æœ‰çš„key runçš„é›†åˆ</span></span><br><span class="line">                List&lt;List&lt;Integer&gt;&gt; perReplaceRunList = <span class="keyword">new</span> ArrayList&lt;List&lt;Integer&gt;&gt;();</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i&lt; runs.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">                    <span class="keyword">String</span> <span class="built_in">text</span> = runs.<span class="built_in">get</span>(i).getText(<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">if</span>(addReplace)&#123;</span><br><span class="line">                        replaceRuns.<span class="built_in">add</span>(i);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">text</span> != <span class="keyword">null</span> &amp;&amp; <span class="built_in">text</span>.contains(<span class="string">"#"</span>))&#123;</span><br><span class="line">                        addReplace = <span class="keyword">true</span>;</span><br><span class="line">                        replaceRuns.<span class="built_in">add</span>(i);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">text</span> != <span class="keyword">null</span> &amp;&amp; <span class="built_in">text</span>.contains(<span class="string">"&#125;"</span>))&#123;</span><br><span class="line">                        addReplace = <span class="keyword">false</span>;</span><br><span class="line">                        perReplaceRunList.<span class="built_in">add</span>(replaceRuns);</span><br><span class="line">                        replaceRuns = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;perReplaceRunList.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">                    List&lt;Integer&gt; runsList = perReplaceRunList.<span class="built_in">get</span>(i);</span><br><span class="line">                    System.out.<span class="built_in">println</span>(<span class="string">"=========================="</span>);</span><br><span class="line">                    StringBuffer textSb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="built_in">int</span> j = <span class="number">0</span>;j&lt;runsList.<span class="built_in">size</span>();j++)&#123;</span><br><span class="line">                        System.out.<span class="built_in">println</span>(<span class="string">"============replace_runs"</span>+runs.<span class="built_in">get</span>(runsList.<span class="built_in">get</span>(j)).getText(<span class="number">0</span>));</span><br><span class="line">                        textSb.<span class="built_in">append</span>(runs.<span class="built_in">get</span>(runsList.<span class="built_in">get</span>(j)).getText(<span class="number">0</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">String</span> replaceStr = textSb.toString();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="built_in">int</span> j = <span class="number">0</span>; j&lt;runsList.<span class="built_in">size</span>();j++)&#123;</span><br><span class="line">                        <span class="keyword">for</span> (Entry&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt; entry : param.entrySet()) &#123;</span><br><span class="line">                            <span class="keyword">String</span> <span class="built_in">key</span> = entry.getKey();</span><br><span class="line">                            <span class="keyword">if</span> (replaceStr.indexOf(<span class="built_in">key</span>) != <span class="number">-1</span>) &#123;</span><br><span class="line">                                <span class="keyword">Object</span> value = entry.getValue();</span><br><span class="line">                                <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="keyword">String</span>) &#123;<span class="comment">// æ–‡æœ¬æ›¿æ¢</span></span><br><span class="line">                                    replaceStr = replaceStr.replace(<span class="built_in">key</span>, value.toString());</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.<span class="built_in">println</span>(<span class="string">"==========="</span>+replaceStr);</span><br><span class="line">                    <span class="keyword">for</span>(<span class="built_in">int</span> j = <span class="number">0</span>;j&lt;runsList.<span class="built_in">size</span>();j++)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(j == <span class="number">0</span>)&#123;</span><br><span class="line">                            runs.<span class="built_in">get</span>(runsList.<span class="built_in">get</span>(j)).setText(replaceStr, <span class="number">0</span>);</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            runs.<span class="built_in">get</span>(runsList.<span class="built_in">get</span>(j)).setText(<span class="string">""</span>, <span class="number">0</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="built_in">int</span> j = <span class="number">0</span>;j&lt;runsList.<span class="built_in">size</span>();j++)&#123;</span><br><span class="line">                        System.out.<span class="built_in">println</span>(<span class="string">"============è½¬æ¢å"</span>+runs.<span class="built_in">get</span>(runsList.<span class="built_in">get</span>(j)).getText(<span class="number">0</span>));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;<span class="keyword">String</span>&gt; getReplaceFields(<span class="keyword">String</span> template)&#123;</span><br><span class="line">        List&lt;<span class="keyword">String</span>&gt; replaceFields = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">String</span>&gt;();</span><br><span class="line">        XWPFDocument doc = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            OPCPackage pack = POIXMLDocument.openPackage(template);</span><br><span class="line">            doc = <span class="keyword">new</span> XWPFDocument(pack);</span><br><span class="line">            <span class="comment">// å¤„ç†æ®µè½</span></span><br><span class="line">            List&lt;XWPFParagraph&gt; paragraphList = doc.getParagraphs();</span><br><span class="line">            replaceFields.addAll(getFields(paragraphList));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¤„ç†è¡¨æ ¼</span></span><br><span class="line">            Iterator&lt;XWPFTable&gt; it = doc.getTablesIterator();</span><br><span class="line">            <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">                XWPFTable table = it.next();</span><br><span class="line">                List&lt;XWPFTableRow&gt; rows = table.getRows();</span><br><span class="line">                <span class="keyword">for</span> (XWPFTableRow row : rows) &#123;</span><br><span class="line">                    List&lt;XWPFTableCell&gt; cells = row.getTableCells();</span><br><span class="line">                    <span class="keyword">for</span> (XWPFTableCell cell : cells) &#123;</span><br><span class="line">                        List&lt;XWPFParagraph&gt; paragraphListTable = cell</span><br><span class="line">                                .getParagraphs();</span><br><span class="line">                        replaceFields.addAll(getFields(paragraphListTable));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> replaceFields;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æ®µè½çš„éœ€è¦æ›¿æ¢çš„å­—æ®µ</span></span><br><span class="line"><span class="comment">     * @param paragraphList</span></span><br><span class="line"><span class="comment">     * @return</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;<span class="keyword">String</span>&gt; getFields(List&lt;XWPFParagraph&gt; paragraphList) &#123;</span><br><span class="line">        List&lt;<span class="keyword">String</span>&gt; fieldList = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">String</span>&gt;();</span><br><span class="line">        <span class="keyword">if</span> (paragraphList != <span class="keyword">null</span> &amp;&amp; paragraphList.<span class="built_in">size</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (XWPFParagraph paragraph : paragraphList) &#123;</span><br><span class="line">                <span class="built_in">boolean</span> addReplace = <span class="keyword">false</span>;</span><br><span class="line">                List&lt;XWPFRun&gt; runs = paragraph.getRuns();</span><br><span class="line">                <span class="comment">//æ¯ä¸ªéœ€è¦æ›¿æ¢çš„keyçš„runçš„ä½ç½®çš„é›†åˆ</span></span><br><span class="line">                List&lt;Integer&gt; replaceRuns = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">                <span class="comment">//æ¯ä¸ªæ®µè½çš„æ‰€æœ‰çš„key runçš„é›†åˆ</span></span><br><span class="line">                List&lt;List&lt;Integer&gt;&gt; perReplaceRunList = <span class="keyword">new</span> ArrayList&lt;List&lt;Integer&gt;&gt;();</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i&lt; runs.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">                    <span class="keyword">String</span> <span class="built_in">text</span> = runs.<span class="built_in">get</span>(i).getText(<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">if</span>(addReplace)&#123;</span><br><span class="line">                        replaceRuns.<span class="built_in">add</span>(i);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">text</span> != <span class="keyword">null</span> &amp;&amp; <span class="built_in">text</span>.contains(<span class="string">"#"</span>))&#123;</span><br><span class="line">                        addReplace = <span class="keyword">true</span>;</span><br><span class="line">                        replaceRuns.<span class="built_in">add</span>(i);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">text</span> != <span class="keyword">null</span> &amp;&amp; <span class="built_in">text</span>.contains(<span class="string">"&#125;"</span>))&#123;</span><br><span class="line">                        addReplace = <span class="keyword">false</span>;</span><br><span class="line">                        perReplaceRunList.<span class="built_in">add</span>(replaceRuns);</span><br><span class="line">                        replaceRuns = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;perReplaceRunList.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">                    List&lt;Integer&gt; runsList = perReplaceRunList.<span class="built_in">get</span>(i);</span><br><span class="line">                    System.out.<span class="built_in">println</span>(<span class="string">"=========================="</span>);</span><br><span class="line">                    StringBuffer textSb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="built_in">int</span> j = <span class="number">0</span>;j&lt;runsList.<span class="built_in">size</span>();j++)&#123;</span><br><span class="line">                        System.out.<span class="built_in">println</span>(<span class="string">"============replace_runs"</span>+runs.<span class="built_in">get</span>(runsList.<span class="built_in">get</span>(j)).getText(<span class="number">0</span>));</span><br><span class="line">                        textSb.<span class="built_in">append</span>(runs.<span class="built_in">get</span>(runsList.<span class="built_in">get</span>(j)).getText(<span class="number">0</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">String</span> replaceStr = textSb.toString().<span class="built_in">trim</span>();</span><br><span class="line">                    System.out.<span class="built_in">println</span>(<span class="string">"====replaceStr="</span> + replaceStr.substring(replaceStr.indexOf(<span class="string">"#"</span>)+<span class="number">2</span>,replaceStr.length()<span class="number">-1</span>));</span><br><span class="line"><span class="comment">//                  System.out.println(replaceStr.substring(2,replaceStr.length()-1));</span></span><br><span class="line">                    fieldList.<span class="built_in">add</span>(replaceStr.substring(replaceStr.indexOf(<span class="string">"#"</span>)+<span class="number">2</span>,replaceStr.length()<span class="number">-1</span>));</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fieldList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦è¯¦è§£</title>
    <url>/2017/02/18/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%92%8C%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><blockquote>
<p>æ²¡æœ‰æŒ¤å…¬äº¤æ¥ä¸Šç­è¿‡ï¼Œå°±ä¸çŸ¥é“ç”Ÿæ´»çš„å‹åŠ›æœ‰å¤šå¤§ã€‚</p>
</blockquote>
<a id="more"></a>
<p>ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦åˆç§°ä¸ºç®—æ³•çš„å¤æ‚åº¦ã€‚<br><br>1.æ—¶é—´å¤æ‚åº¦<br>ï¼ˆ1ï¼‰æ—¶é—´é¢‘åº¦ ä¸€ä¸ªç®—æ³•æ‰§è¡Œæ‰€è€—è´¹çš„æ—¶é—´ï¼Œä»ç†è®ºä¸Šæ˜¯ä¸èƒ½ç®—å‡ºæ¥çš„ï¼Œå¿…é¡»ä¸Šæœºè¿è¡Œæµ‹è¯•æ‰èƒ½çŸ¥é“ã€‚ä½†æˆ‘ä»¬ä¸å¯èƒ½ä¹Ÿæ²¡æœ‰å¿…è¦å¯¹æ¯ä¸ªç®—æ³•éƒ½ä¸Šæœºæµ‹è¯•ï¼Œåªéœ€çŸ¥é“å“ªä¸ªç®—æ³•èŠ±è´¹çš„æ—¶é—´å¤šï¼Œå“ªä¸ªç®—æ³•èŠ±è´¹çš„æ—¶é—´å°‘å°±å¯ä»¥äº†ã€‚å¹¶ä¸”ä¸€ä¸ªç®—æ³•èŠ±è´¹çš„æ—¶é—´ä¸ç®—æ³•ä¸­è¯­å¥çš„æ‰§è¡Œæ¬¡æ•°æˆæ­£æ¯”ä¾‹ï¼Œå“ªä¸ªç®—æ³•ä¸­è¯­å¥æ‰§è¡Œæ¬¡æ•°å¤šï¼Œå®ƒèŠ±è´¹æ—¶é—´å°±å¤šã€‚ä¸€ä¸ªç®—æ³•ä¸­çš„è¯­å¥æ‰§è¡Œæ¬¡æ•°ç§°ä¸ºè¯­å¥é¢‘åº¦æˆ–æ—¶é—´é¢‘åº¦ã€‚è®°ä¸ºT(n)ã€‚<br><br>ï¼ˆ2ï¼‰æ—¶é—´å¤æ‚åº¦ åœ¨åˆšæ‰æåˆ°çš„æ—¶é—´é¢‘åº¦ä¸­ï¼Œnç§°ä¸ºé—®é¢˜çš„è§„æ¨¡ï¼Œå½“nä¸æ–­å˜åŒ–æ—¶ï¼Œæ—¶é—´é¢‘åº¦T(n)ä¹Ÿä¼šä¸æ–­å˜åŒ–ã€‚ä½†æœ‰æ—¶æˆ‘ä»¬æƒ³çŸ¥é“å®ƒå˜åŒ–æ—¶å‘ˆç°ä»€ä¹ˆè§„å¾‹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¼•å…¥æ—¶é—´å¤æ‚åº¦æ¦‚å¿µã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç®—æ³•ä¸­åŸºæœ¬æ“ä½œé‡å¤æ‰§è¡Œçš„æ¬¡æ•°æ˜¯é—®é¢˜è§„æ¨¡nçš„æŸä¸ªå‡½æ•°ï¼Œç”¨T(n)è¡¨ç¤ºï¼Œè‹¥æœ‰æŸä¸ªè¾…åŠ©å‡½æ•°f(n),ä½¿å¾—å½“nè¶‹è¿‘äºæ— ç©·å¤§æ—¶ï¼ŒTï¼ˆn)/f(n)çš„æé™å€¼ä¸ºä¸ç­‰äºé›¶çš„å¸¸æ•°ï¼Œåˆ™ç§°f(n)æ˜¯T(n)çš„åŒæ•°é‡çº§å‡½æ•°ã€‚è®°ä½œT(n)=ï¼¯(f(n)),ç§°ï¼¯(f(n)) ä¸ºç®—æ³•çš„æ¸è¿›æ—¶é—´å¤æ‚åº¦ï¼Œç®€ç§°æ—¶é—´å¤æ‚åº¦ã€‚<br><br>     æ—¶é—´é¢‘åº¦ä¸åŒï¼Œä½†æ—¶é—´å¤æ‚åº¦å¯èƒ½ç›¸åŒã€‚å¦‚ï¼šT(n)=n2+3n+4ä¸T(n)=4n2+2n+1å®ƒä»¬çš„é¢‘åº¦ä¸åŒï¼Œä½†æ—¶é—´å¤æ‚åº¦ç›¸åŒï¼Œéƒ½ä¸ºO(n2)ã€‚<br><br>    æŒ‰æ•°é‡çº§é€’å¢æ’åˆ—ï¼Œå¸¸è§çš„æ—¶é—´å¤æ‚åº¦æœ‰ï¼šå¸¸æ•°é˜¶O(1),å¯¹æ•°é˜¶O(log2n),çº¿æ€§é˜¶O(n), çº¿æ€§å¯¹æ•°é˜¶O(nlog2n),å¹³æ–¹é˜¶O(n2)ï¼Œç«‹æ–¹é˜¶O(n3),â€¦ï¼Œ kæ¬¡æ–¹é˜¶O(nk),æŒ‡æ•°é˜¶O(2n)ã€‚éšç€é—®é¢˜è§„æ¨¡nçš„ä¸æ–­å¢å¤§ï¼Œä¸Šè¿°æ—¶é—´å¤æ‚åº¦ä¸æ–­å¢å¤§ï¼Œç®—æ³•çš„æ‰§è¡Œæ•ˆç‡è¶Šä½ã€‚<br><br> ï¼ˆ3ï¼‰æœ€åæ—¶é—´å¤æ‚åº¦å’Œå¹³å‡æ—¶é—´å¤æ‚åº¦ ã€€æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ç§°æœ€åæ—¶é—´å¤æ‚åº¦ã€‚ä¸€èˆ¬ä¸ç‰¹åˆ«è¯´æ˜ï¼Œè®¨è®ºçš„æ—¶é—´å¤æ‚åº¦å‡æ˜¯æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ã€‚ è¿™æ ·åšçš„åŸå› æ˜¯ï¼šæœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ç®—æ³•åœ¨ä»»ä½•è¾“å…¥å®ä¾‹ä¸Šè¿è¡Œæ—¶é—´çš„ä¸Šç•Œï¼Œè¿™å°±ä¿è¯äº†ç®—æ³•çš„è¿è¡Œæ—¶é—´ä¸ä¼šæ¯”ä»»ä½•æ›´é•¿ã€‚<br><br>     åœ¨æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ä¸ºT(n)=0(n)ï¼Œå®ƒè¡¨ç¤ºå¯¹äºä»»ä½•è¾“å…¥å®ä¾‹,è¯¥ç®—æ³•çš„è¿è¡Œæ—¶é—´ä¸å¯èƒ½å¤§äº0(n)ã€‚ å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯æŒ‡æ‰€æœ‰å¯èƒ½çš„è¾“å…¥å®ä¾‹å‡ä»¥ç­‰æ¦‚ç‡å‡ºç°çš„æƒ…å†µä¸‹ï¼Œç®—æ³•çš„æœŸæœ›è¿è¡Œæ—¶é—´ã€‚<br><br>    æŒ‡æ•°é˜¶0(2n)ï¼Œæ˜¾ç„¶ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºæŒ‡æ•°é˜¶0(2n)çš„ç®—æ³•æ•ˆç‡æä½ï¼Œå½“nå€¼ç¨å¤§æ—¶å°±æ— æ³•åº”ç”¨ã€‚<br><br>ï¼ˆ4ï¼‰æ±‚æ—¶é—´å¤æ‚åº¦<br><br>ã€1ã€‘å¦‚æœç®—æ³•çš„æ‰§è¡Œæ—¶é—´ä¸éšç€é—®é¢˜è§„æ¨¡nçš„å¢åŠ è€Œå¢é•¿ï¼Œå³ä½¿ç®—æ³•ä¸­æœ‰ä¸Šåƒæ¡è¯­å¥ï¼Œå…¶æ‰§è¡Œæ—¶é—´ä¹Ÿä¸è¿‡æ˜¯ä¸€ä¸ªè¾ƒå¤§çš„å¸¸æ•°ã€‚æ­¤ç±»ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ã€‚<br></p>
<blockquote>
<p>x=91; y=100;<br>while(y&gt;0) if(x&gt;100) {x=x-10;yâ€“;} else x++;</p>
</blockquote>
<p>è§£ç­”ï¼š T(n)=O(1)ï¼Œ<br>è¿™ä¸ªç¨‹åºçœ‹èµ·æ¥æœ‰ç‚¹å“äººï¼Œæ€»å…±å¾ªç¯è¿è¡Œäº†1100æ¬¡ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°næ²¡æœ‰?<br>æ²¡ã€‚è¿™æ®µç¨‹åºçš„è¿è¡Œæ˜¯å’Œnæ— å…³çš„ï¼Œ<br>å°±ç®—å®ƒå†å¾ªç¯ä¸€ä¸‡å¹´ï¼Œæˆ‘ä»¬ä¹Ÿä¸ç®¡ä»–ï¼Œåªæ˜¯ä¸€ä¸ªå¸¸æ•°é˜¶çš„å‡½æ•°</p>
<p>ã€2ã€‘å½“æœ‰è‹¥å¹²ä¸ªå¾ªç¯è¯­å¥æ—¶ï¼Œç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ç”±åµŒå¥—å±‚æ•°æœ€å¤šçš„å¾ªç¯è¯­å¥ä¸­æœ€å†…å±‚è¯­å¥çš„é¢‘åº¦f(n)å†³å®šçš„ã€‚</p>
<blockquote>
<p>x=1;<br>for(i=1;i&lt;=n;i++)<br>        for(j=1;j&lt;=i;j++)<br>           for(k=1;k&lt;=j;k++)<br>               x++; ã€€</p>
</blockquote>
<p>è¯¥ç¨‹åºæ®µä¸­é¢‘åº¦æœ€å¤§çš„è¯­å¥æ˜¯(5)ï¼Œå†…å¾ªç¯çš„æ‰§è¡Œæ¬¡æ•°è™½ç„¶ä¸é—®é¢˜è§„æ¨¡næ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œä½†æ˜¯å´ä¸å¤–å±‚å¾ªç¯çš„å˜é‡å–å€¼æœ‰å…³ï¼Œè€Œæœ€å¤–å±‚å¾ªç¯çš„æ¬¡æ•°ç›´æ¥ä¸næœ‰å…³ï¼Œå› æ­¤å¯ä»¥ä»å†…å±‚å¾ªç¯å‘å¤–å±‚åˆ†æè¯­å¥(5)çš„æ‰§è¡Œæ¬¡æ•°ï¼š  åˆ™è¯¥ç¨‹åºæ®µçš„æ—¶é—´å¤æ‚åº¦ä¸ºT(n)=O(n3/6+ä½æ¬¡é¡¹)=O(n3)</p>
<p>ã€3ã€‘ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ä»…ä»…ä¾èµ–äºé—®é¢˜çš„è§„æ¨¡ï¼Œè¿˜ä¸è¾“å…¥å®ä¾‹çš„åˆå§‹çŠ¶æ€æœ‰å…³ã€‚<br>åœ¨æ•°å€¼A[0..n-1]ä¸­æŸ¥æ‰¾ç»™å®šå€¼Kçš„ç®—æ³•å¤§è‡´å¦‚ä¸‹ï¼š </p>
<blockquote>
<p>i=n-1;<br>while(i&gt;=0&amp;&amp;(A[i]!=k))<br>      iâ€“;<br>return i;      </p>
</blockquote>
<p>æ­¤ç®—æ³•ä¸­çš„è¯­å¥(3)çš„é¢‘åº¦ä¸ä»…ä¸é—®é¢˜è§„æ¨¡næœ‰å…³ï¼Œè¿˜ä¸è¾“å…¥å®ä¾‹ä¸­Açš„å„å…ƒç´ å–å€¼åŠKçš„å–å€¼æœ‰å…³: â‘ è‹¥Aä¸­æ²¡æœ‰ä¸Kç›¸ç­‰çš„å…ƒç´ ï¼Œåˆ™è¯­å¥(3)çš„é¢‘åº¦f(n)=nï¼› â‘¡è‹¥Açš„æœ€åä¸€ä¸ªå…ƒç´ ç­‰äºK,åˆ™è¯­å¥(3)çš„é¢‘åº¦f(n)æ˜¯å¸¸æ•°0ã€‚<br>ï¼ˆ5ï¼‰æ—¶é—´å¤æ‚åº¦è¯„ä»·æ€§èƒ½<br>æœ‰ä¸¤ä¸ªç®—æ³•A1å’ŒA2æ±‚è§£åŒä¸€é—®é¢˜ï¼Œæ—¶é—´å¤æ‚åº¦åˆ†åˆ«æ˜¯T1(n)=100n2ï¼ŒT2(n)=5n3ã€‚ï¼ˆ1ï¼‰å½“è¾“å…¥é‡nï¼œ20æ—¶ï¼Œæœ‰T1(n)ï¼T2(n)ï¼Œåè€…èŠ±è´¹çš„æ—¶é—´è¾ƒå°‘ã€‚ï¼ˆ2ï¼‰éšç€é—®é¢˜è§„æ¨¡nçš„å¢å¤§ï¼Œä¸¤ä¸ªç®—æ³•çš„æ—¶é—´å¼€é”€ä¹‹æ¯”5n3/100n2=n/20äº¦éšç€å¢å¤§ã€‚å³å½“é—®é¢˜è§„æ¨¡è¾ƒå¤§æ—¶ï¼Œç®—æ³•A1æ¯”ç®—æ³•A2è¦æœ‰æ•ˆåœ°å¤šã€‚å®ƒä»¬çš„æ¸è¿‘æ—¶é—´å¤æ‚åº¦O(n2)å’ŒO(n3)ä»å®è§‚ä¸Šè¯„ä»·äº†è¿™ä¸¤ä¸ªç®—æ³•åœ¨æ—¶é—´æ–¹é¢çš„è´¨é‡ã€‚åœ¨ç®—æ³•åˆ†ææ—¶ï¼Œå¾€å¾€å¯¹ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å’Œæ¸è¿‘æ—¶é—´å¤æ‚åº¦ä¸äºˆåŒºåˆ†ï¼Œè€Œç»å¸¸æ˜¯å°†æ¸è¿‘æ—¶é—´å¤æ‚åº¦T(n)=O(f(n))ç®€ç§°ä¸ºæ—¶é—´å¤æ‚åº¦ï¼Œå…¶ä¸­çš„f(n)ä¸€èˆ¬æ˜¯ç®—æ³•ä¸­é¢‘åº¦æœ€å¤§çš„è¯­å¥é¢‘åº¦ã€‚</p>
<p>2.ç©ºé—´å¤æ‚åº¦<br>ä¸€ä¸ªç¨‹åºçš„ç©ºé—´å¤æ‚åº¦æ˜¯æŒ‡è¿è¡Œå®Œä¸€ä¸ªç¨‹åºæ‰€éœ€å†…å­˜çš„å¤§å°ã€‚åˆ©ç”¨ç¨‹åºçš„ç©ºé—´å¤æ‚åº¦ï¼Œå¯ä»¥å¯¹ç¨‹åºçš„è¿è¡Œæ‰€éœ€è¦çš„å†…å­˜å¤šå°‘æœ‰ä¸ªé¢„å…ˆä¼°è®¡ã€‚ä¸€ä¸ªç¨‹åºæ‰§è¡Œæ—¶é™¤äº†éœ€è¦å­˜å‚¨ç©ºé—´å’Œå­˜å‚¨æœ¬èº«æ‰€ä½¿ç”¨çš„æŒ‡ä»¤ã€å¸¸æ•°ã€å˜é‡å’Œè¾“å…¥æ•°æ®å¤–ï¼Œè¿˜éœ€è¦ä¸€äº›å¯¹æ•°æ®è¿›è¡Œæ“ä½œçš„å·¥ä½œå•å…ƒå’Œå­˜å‚¨ä¸€äº›ä¸ºç°å®è®¡ç®—æ‰€éœ€ä¿¡æ¯çš„è¾…åŠ©ç©ºé—´ã€‚ç¨‹åºæ‰§è¡Œæ—¶æ‰€éœ€å­˜å‚¨ç©ºé—´åŒ…æ‹¬ä»¥ä¸‹ä¸¤éƒ¨åˆ†ã€‚ã€€</p>
<p>ï¼ˆ1ï¼‰å›ºå®šéƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†ç©ºé—´çš„å¤§å°ä¸è¾“å…¥/è¾“å‡ºçš„æ•°æ®çš„ä¸ªæ•°å¤šå°‘ã€æ•°å€¼æ— å…³ã€‚ä¸»è¦åŒ…æ‹¬æŒ‡ä»¤ç©ºé—´ï¼ˆå³ä»£ç ç©ºé—´ï¼‰ã€æ•°æ®ç©ºé—´ï¼ˆå¸¸é‡ã€ç®€å•å˜é‡ï¼‰ç­‰æ‰€å çš„ç©ºé—´ã€‚è¿™éƒ¨åˆ†å±äºé™æ€ç©ºé—´ã€‚<br><br>ï¼ˆ2ï¼‰å¯å˜ç©ºé—´ï¼Œè¿™éƒ¨åˆ†ç©ºé—´çš„ä¸»è¦åŒ…æ‹¬åŠ¨æ€åˆ†é…çš„ç©ºé—´ï¼Œä»¥åŠé€’å½’æ ˆæ‰€éœ€çš„ç©ºé—´ç­‰ã€‚è¿™éƒ¨åˆ†çš„ç©ºé—´å¤§å°ä¸ç®—æ³•æœ‰å…³ã€‚<br><br>ä¸€ä¸ªç®—æ³•æ‰€éœ€çš„å­˜å‚¨ç©ºé—´ç”¨f(n)è¡¨ç¤ºã€‚S(n)=O(f(n))ã€€ã€€å…¶ä¸­nä¸ºé—®é¢˜çš„è§„æ¨¡ï¼ŒS(n)è¡¨ç¤ºç©ºé—´å¤æ‚åº¦ã€‚</p>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>æ—¶é—´å¤æ‚åº¦</tag>
        <tag>ç©ºé—´å¤æ‚åº¦</tag>
      </tags>
  </entry>
  <entry>
    <title>2016å¹´æ€»ç»“</title>
    <url>/2017/02/18/2016%E5%B9%B4%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2>åœ¨2016è¿™ä¸€å¹´</h2>

<p>æŠ€æœ¯é•¿è¿›äº†ã€‚</p>
<p>Java:ä»SSHæ¡†æ¶è½¬åˆ°SSMï¼Œå¹¶ä¸”è§è¯†äº†åŸºäºSpring bootçš„å¨åŠ›ï¼Œè¡¥äº†ä¸€ä¸‹JavaåŸºç¡€ï¼Œæ­£åœ¨æ¥è§¦ç®—æ³•ã€‚</p>
<p>Linux:è®°ä½äº†è¶Šæ¥çš„è¶Šå¤šçš„Linuxå‘½ä»¤ï¼Œèƒ½ç‹¬ç«‹ç»´æŠ¤å¹¶å¤„ç†éƒ¨åˆ†æœåŠ¡é—®é¢˜äº†ã€‚</p>
<p>Python:ç»ˆäºç®—æ˜¯å…¥é—¨äº†ï¼Œå…¥é—¨äº†å´æ²¡çœ‹åˆ°å‡ºé—¨åœ¨å“ªé‡Œã€‚<br><a id="more"></a></p>
<p>JS&amp;HTML&amp;CSS3:è¿™ä¼¼ä¹ä¸æ˜¯æˆ‘è¯¥å…³æ³¨çš„é—®é¢˜ï¼Œèƒ½ç‹¬ç«‹è§£å†³UIä¸Šçš„é—®é¢˜å·²ç»å¤Ÿäº†ã€‚</p>
<p>å®Œæˆäº†è‡³å°‘ä¸‰ä¸ªé¡¹ç›®ï¼Œä»pcç«¯åˆ°webç«¯åˆ°å¾®ä¿¡ç«¯åˆ°hybridAppã€‚</p>
<p>é¡¹ç›®æ˜¯æœ€å¥½çš„å¯¼å¸ˆï¼Œè¾¹å­¦è¾¹åšï¼Œè¾¹å­¦è¾¹ç”¨ï¼Œè™½ç„¶ä¸èƒ½ç”¨åˆ°æœ€å¥½ï¼Œä½†è¿™ç¡®å®æ˜¯å¾ˆæœ‰æ•ˆçš„å­¦ä¹ é€”å¾„ï¼Œå…ˆå®ç°å†ä¼˜åŒ–ã€‚</p>
<p>æœ‰æ¯…åŠ›å’Œæ´»åŠ›ï¼Œå¤©ç”Ÿä¹è§‚æ´¾ã€‚è®¤å®šäº†çš„äº‹æƒ…ä¸€å®šè¦å»å®Œæˆï¼Œæœ¬èŒå·¥ä½œå¿…é¡»è¦åšåˆ°å°½èŒå°½è´£ã€‚</p>
<p><strong>ä¸è¶³ï¼š</strong></p>
<p>å‘ç°çš„è‡ªå·±å®åŠ›è¿˜æ˜¯ç¦»è‡ªå·±çš„æœŸæœ›çš„å·®äº†å¾ˆå¤šã€‚</p>
<p>çº ç»“ç»¼åˆç—‡ã€‚</p>
<p>å¼ºè¿«ç—‡ã€‚</p>
<h2>å±•æœ›2017ï¼</h2>

<p>æœ‰æƒ³æ³•</p>
<p>æƒ³æ³•ä¸€ï¼šç»§ç»­è¡¥è¯¾</p>
<p>å®ä¹ å¤§åŠå¹´åï¼Œå‘ç°åœ¨å¤§å­¦æœŸé—´æ²¡æœ‰å¥½å¥½å­¦ä¹ JavaåŸºç¡€ï¼Œä¹Ÿæ²¡æœ‰å­¦çš„ç‰¹åˆ«æ‰å®ï¼å¾ˆå¤šä¸œè¥¿è‡ªå·±è¿˜ä¸çŸ¥é“ï¼Œéœ€è¦è¡¥è¯¾ï¼ç°åœ¨ä¹Ÿç®—æ˜¯ä¸ªåŠåŠå­çš„Javaç¨‹åºå‘˜ï¼Œè™½ç„¶çœ‹äº†ä¸€éçš„Javaæ ¸å¿ƒæŠ€æœ¯ï¼Œä½†æ˜¯è¿˜æ˜¯è¦ç»§ç»­å·©å›ºï¼Œä¸åŒé˜¶æ®µç›¸ä¿¡æœ‰ä¸åŒçš„ç†è§£ï¼Œä»¥åè¿˜ä¼šä¹°æ›´å¤šçš„ä¹¦å›æ¥ï¼Œç»§ç»­å­¦ä¹ ã€‚</p>
<p>æƒ³æ³•äºŒï¼šå­¦ä¹ æ¡†æ¶å’Œç®—æ³•</p>
<p>å®Œæˆäº†åŸºæœ¬çš„åŸºç¡€å­¦ä¹ ï¼Œå¼€å§‹ç€æ‰‹æ¡†æ¶ï¼Œä»Springå¼€å§‹å­¦èµ·ï¼Œäº†è§£æ¡†æ¶åº•å±‚åŸç†ï¼Œå¹¶ä¸”æ¨¡ä»¿é€ å‡ ä¸ªè½®å­ã€‚</p>
<p>å¤§å­¦åªæŒæ¡äº†ä¸€äº›åŸºç¡€çš„æ•°æ®ç»“æ„çŸ¥è¯†ï¼Œæƒ³è¦è¿›å¤§ä¼ä¸šï¼Œç®—æ³•ä¹Ÿä¸èƒ½è½ä¸‹ï¼Œä¸è¿‡è¿™ç§ä¸œè¥¿ä¸æ˜¯å¯ä»¥å¿«é€Ÿè§åˆ°æˆæ•ˆçš„ï¼Œæ‰€ä»¥é™ä¸‹å¿ƒï¼Œæ…¢æ…¢æ¥ï¼</p>
<p>æƒ³æ³•ä¸‰ï¼šæ”¹</p>
<p>ç°åœ¨çš„å†™çš„ä»£ç ç”¨ä¸€ä¸ªå­—å½¢å®¹â€”â€”ä¹±ã€‚</p>
<p>SVNæ²¡æœ‰å‘æŒ¥å®ƒè¯¥æœ‰çš„ä½œç”¨ï¼ŒSVNä¸Šçš„ä»£ç éƒ½ä¸æ˜¯æœ€æ–°çš„ã€‚</p>
<p>ç¼ºå°‘ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ç®¡ç†è½¯ä»¶ï¼ŒBUGæ²¡æœ‰ä»»ä½•è¿½è¸ªè®°å½•ï¼Œè§£å†³äº†ï¼Ÿï¼æ²¡è§£å†³ï¼Ÿï¼è¿›åº¦èµ°åˆ°å“ªé‡Œäº†ï¼Ÿï¼åç»­æ˜¯å…³æ³¨è¿˜æ˜¯ä¸‹æ”¾åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬è§£å†³ï¼Ÿï¼é¡¹ç›®çš„å¼€å‘è¿›åº¦å®Œæˆäº†å—ï¼Ÿï¼</p>
<p>æœ‰è®¡åˆ’</p>
<p>è®¡åˆ’ä¸€:è¯»ä¹¦è®¡åˆ’ã€‚</p>
<p>è¯»å®Œè‡³å°‘6æœ¬æŠ€æœ¯ä¹¦ç±ï¼Œä»¥ä¸‹ä¸ºè®¡åˆ’ä¹¦å•ï¼š</p>
<p>1.ã€ŠJavaæ ¸å¿ƒæŠ€æœ¯ å·ä¸€ã€‹ å†è¯»</p>
<p>2.ã€ŠJavaæ ¸å¿ƒæŠ€æœ¯ å·äºŒã€‹ ä¹Ÿå¯é€‰æ‹©ã€Šjavaç¼–ç¨‹æ€æƒ³ã€‹</p>
<p>3.ã€ŠEffective Javaã€‹</p>
<p>4.ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼šJVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µã€‹</p>
<p>5.ã€Šå¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„ æ ¸å¿ƒåŸç†ä¸æ¡ˆä¾‹åˆ†æã€‹</p>
<p>6.ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹</p>
<p>7.ã€Šç®—æ³•ç¬¬å››ç‰ˆã€‹</p>
<p>è®¡åˆ’äºŒï¼šå·¥ä½œè®¡åˆ’</p>
<p>1.2017å¹´ï¼Œç»§ç»­åšæŒç°æœ‰çš„å·¥ä½œçŠ¶æ€ã€‚</p>
<p>2.åŠ å¼ºè‡ªå·±çš„ä¸šåŠ¡ä»£ç èƒ½åŠ›ã€‚</p>
<p>3.æ¥è§¦æ–°é¡¹ç›®ï¼ˆä¸åŒé¢†åŸŸï¼‰ã€‚</p>
<p>4.è‡ªå·±åšç‚¹å¤–åŒ…ã€‚</p>
<p>ï¼ˆå®Œï¼‰</p>
]]></content>
      <categories>
        <category>ç¨‹åºäººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ€»ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title>jdk1.8çš„HashMapå’ŒConcurrentHashMap</title>
    <url>/2017/02/18/jdk1-8%E7%9A%84HashMap%E5%92%8CConcurrentHashMap/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æœ¬æ–‡é’ˆå¯¹jdk1.8çš„ConcurrentHashMap</p>
<h1>1.8çš„HashMapè®¾è®¡</h1>

<h2>1.1 æ•´ä½“æ¦‚è§ˆ</h2>

<p>HashMapé‡‡ç”¨çš„æ˜¯<strong>æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</strong>çš„å½¢å¼ã€‚</p>
<p>æ•°ç»„æ˜¯å¯ä»¥æ‰©å®¹çš„ï¼Œé“¾è¡¨ä¹Ÿæ˜¯è½¬åŒ–ä¸ºçº¢é»‘æ ‘çš„ï¼Œè¿™2ç§æ–¹å¼éƒ½å¯ä»¥æ‰¿è½½æ›´å¤šçš„æ•°æ®ã€‚</p>
<p>ç”¨æˆ·å¯ä»¥è®¾ç½®çš„å‚æ•°ï¼šåˆå§‹æ€»å®¹é‡é»˜è®¤16ï¼Œé»˜è®¤çš„åŠ è½½å› å­0.75</p>
<p>åˆå§‹çš„æ•°ç»„ä¸ªæ•°é»˜è®¤æ˜¯16ï¼ˆç”¨æˆ·ä¸èƒ½è®¾ç½®çš„ï¼‰</p>
<p>å®¹é‡XåŠ è½½å› å­=é˜ˆå€¼</p>
<p>ä¸€æ—¦ç›®å‰å®¹é‡è¶…è¿‡è¯¥é˜ˆå€¼ï¼Œåˆ™æ‰§è¡Œæ‰©å®¹æ“ä½œã€‚<a id="more"></a></p>
<p><strong>ä»€ä¹ˆæ—¶å€™æ‰©å®¹ï¼Ÿ</strong></p>
<p><li>å½“å‰å®¹é‡è¶…è¿‡é˜ˆå€¼</li></p>
<p><li>å½“é“¾è¡¨ä¸­å…ƒç´ ä¸ªæ•°è¶…è¿‡é»˜è®¤è®¾å®šï¼ˆ8ä¸ªï¼‰ï¼Œå½“æ•°ç»„çš„å¤§å°è¿˜æœªè¶…è¿‡64çš„æ—¶å€™ï¼Œæ­¤æ—¶è¿›è¡Œæ•°ç»„çš„æ‰©å®¹ï¼Œå¦‚æœè¶…è¿‡åˆ™å°†é“¾è¡¨è½¬åŒ–æˆçº¢é»‘æ ‘</li></p>
<p><strong>ä»€ä¹ˆæ—¶å€™é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Ÿï¼ˆä¸Šé¢å·²ç»æåˆ°äº†ï¼‰</strong></p>
<p><li>å½“æ•°ç»„å¤§å°å·²ç»è¶…è¿‡64å¹¶ä¸”é“¾è¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡é»˜è®¤è®¾å®šï¼ˆ8ä¸ªï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘</li></p>
<p>ç›®å‰å½¢è±¡çš„è¡¨ç¤ºæ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ ç§°ä¸ºä¸€ä¸ªæ¡¶</p>
<h2>1.2 putè¿‡ç¨‹</h2>

<p><li>æ ¹æ®keyè®¡ç®—å‡ºhashå€¼</li></p>
<p><li>hashå€¼&amp;ï¼ˆæ•°ç»„é•¿åº¦-1ï¼‰å¾—åˆ°æ‰€åœ¨æ•°ç»„çš„index</li></p>
<pre><code>å¦‚æœè¯¥indexä½ç½®çš„Nodeå…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„Node
å¦‚æœè¯¥indexä½ç½®çš„Nodeå…ƒç´ æ˜¯TreeNodeç±»å‹å³çº¢é»‘æ ‘ç±»å‹äº†ï¼Œåˆ™ç›´æ¥æŒ‰ç…§çº¢é»‘æ ‘çš„æ’å…¥æ–¹å¼è¿›è¡Œæ’å…¥
å¦‚æœè¯¥indexä½ç½®çš„Nodeå…ƒç´ æ˜¯éTreeNodeç±»å‹åˆ™ï¼Œåˆ™æŒ‰ç…§é“¾è¡¨çš„å½¢å¼è¿›è¡Œæ’å…¥æ“ä½œ
</code></pre><p>é“¾è¡¨æ’å…¥æ“ä½œå®Œæˆåï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼TREEIFY_THRESHOLDï¼ˆé»˜è®¤æ˜¯8ï¼‰ï¼Œè¶…è¿‡åˆ™è¦ä¹ˆæ•°ç»„æ‰©å®¹è¦ä¹ˆé“¾è¡¨è½¬åŒ–æˆçº¢é»‘æ ‘</p>
<p><li>åˆ¤æ–­å½“å‰æ€»å®¹é‡æ˜¯å¦è¶…å‡ºé˜ˆå€¼ï¼Œå¦‚æœè¶…å‡ºåˆ™æ‰§è¡Œæ‰©å®¹</li></p>
<p>æºç å¦‚ä¸‹ï¼š</p>
<p><img src="http://img.blog.csdn.net/20170107004609227" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>ä¸‹é¢æ¥è¯´è¯´è¿™ä¸ªæ‰©å®¹çš„è¿‡ç¨‹</p>
<h2>1.3 æ‰©å®¹è¿‡ç¨‹</h2>

<p>æŒ‰ç…§2å€æ‰©å®¹çš„æ–¹å¼ï¼Œé‚£ä¹ˆå°±éœ€è¦å°†ä¹‹å‰çš„æ‰€æœ‰å…ƒç´ å…¨éƒ¨é‡æ–°æŒ‰ç…§2å€æ¡¶çš„é•¿åº¦é‡æ–°è®¡ç®—æ‰€åœ¨æ¡¶ã€‚è¿™é‡Œä¸ºå•¥æ˜¯2å€ï¼Ÿ</p>
<p>å› ä¸º2å€çš„è¯ï¼Œæ›´åŠ å®¹æ˜“è®¡ç®—ä»–ä»¬æ‰€åœ¨çš„æ¡¶ï¼Œå¹¶ä¸”å„è‡ªä¸ä¼šç›¸äº’å¹²æ‰°ã€‚å¦‚åŸæ¡¶é•¿åº¦æ˜¯4ï¼Œç°åœ¨æ¡¶é•¿åº¦æ˜¯8ï¼Œé‚£ä¹ˆ</p>
<pre><code>æ¡¶0ä¸­çš„å…ƒç´ ä¼šè¢«åˆ†åˆ°æ¡¶0å’Œæ¡¶4ä¸­
æ¡¶1ä¸­çš„å…ƒç´ ä¼šè¢«åˆ†åˆ°æ¡¶1å’Œæ¡¶5ä¸­
æ¡¶2ä¸­çš„å…ƒç´ ä¼šè¢«åˆ†åˆ°æ¡¶2å’Œæ¡¶6ä¸­
æ¡¶3ä¸­çš„å…ƒç´ ä¼šè¢«åˆ†åˆ°æ¡¶3å’Œæ¡¶7ä¸­
</code></pre><p>ä¸ºå•¥æ˜¯è¿™æ ·å‘¢ï¼Ÿ</p>
<p>æ¡¶0ä¸­çš„å…ƒç´ çš„hashå€¼å2ä½å¿…ç„¶æ˜¯00ï¼Œè¿™äº›hashå€¼å¯ä»¥æ ¹æ®å3ä½000æˆ–è€…100åˆ†æˆ2ç±»æ•°æ®ã€‚ä»–ä»¬åˆ†åˆ«&amp;ï¼ˆ8-1ï¼‰å³&amp;111,åˆ™å3ä½ä¸º000çš„åœ¨æ¡¶0ä¸­ï¼Œå3ä½ä¸º100çš„å¿…ç„¶åœ¨æ¡¶4ä¸­ã€‚å…¶ä»–åŒç†ï¼Œä¹Ÿå°±æ˜¯è¯´æ¡¶4å’Œæ¡¶0é‡æ–°ç“œåˆ†äº†åŸæ¥æ¡¶0ä¸­çš„å…ƒç´ ã€‚</p>
<p>å¦‚æœæ¢æˆå…¶ä»–å€æ•°ï¼Œé‚£ä¹ˆç“œåˆ†å°±æ¯”è¾ƒæ··ä¹±äº†ã€‚</p>
<p>è¿™æ ·åœ¨ç“œåˆ†è¿™äº›æ•°æ®çš„æ—¶å€™ï¼Œåªéœ€è¦å…ˆæŠŠè¿™äº›æ•°æ®åˆ†ç±»ï¼Œå¦‚ä¸Šè¿°æ¡¶0ä¸­åˆ†æˆ000å’Œ100 2ç±»ï¼Œç„¶åç›´æ¥æ„æˆæ–°çš„é“¾è¡¨ï¼Œåˆ†ç±»å®Œæ¯•åï¼Œç›´æ¥å°†æ–°çš„é“¾è¡¨æŒ‚åœ¨å¯¹åº”çš„æ¡¶ä¸‹å³å¯ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<p><img src="http://img.blog.csdn.net/20170107004911697" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>ä¸Šè¿° (e.hash &amp; oldCap) == 0 å³å¯å°†åŸæ¡¶ä¸­çš„æ•°æ®åˆ†æˆ2ç±»</p>
<p>ä¸Šè¿°æ˜¯å¯¹äºé“¾è¡¨æƒ…å†µä¸‹çš„é‡æ–°ç§»åŠ¨ï¼Œè€Œé’ˆå¯¹çº¢é»‘æ ‘æƒ…å†µä¸‹ï¼š</p>
<p>åˆ™éœ€è¦è€ƒè™‘åˆ†ç±»ä¹‹åæ˜¯å¦è¿˜éœ€è¦ä¾ç„¶ä¿æŒçº¢é»‘æ ‘ï¼Œå¦‚æœä¸ªæ•°å°‘åˆ™ç›´æ¥ä½¿ç”¨é“¾è¡¨å³å¯ã€‚</p>
<h2>1.4 getè¿‡ç¨‹</h2>

<p>getè¿‡ç¨‹æ¯”è¾ƒç®€å•</p>
<p><li>æ ¹æ®keyè®¡ç®—å‡ºhashå€¼</li></p>
<p><li>hashå€¼&amp;ï¼ˆæ•°ç»„é•¿åº¦-1ï¼‰å¾—åˆ°æ‰€åœ¨æ•°ç»„çš„index        </li></p>
<pre><code>å¦‚æœè¦æ‰¾çš„keyå°±æ˜¯ä¸Šè¿°æ•°ç»„indexä½ç½®çš„å…ƒç´ ï¼Œç›´æ¥è¿”å›è¯¥å…ƒç´ çš„å€¼
å¦‚æœè¯¥æ•°ç»„indexä½ç½®å…ƒç´ æ˜¯TreeNodeç±»å‹ï¼Œåˆ™æŒ‰ç…§çº¢é»‘æ ‘çš„æŸ¥è¯¢æ–¹å¼æ¥è¿›è¡ŒæŸ¥æ‰¾
å¦‚æœè¯¥æ•°ç»„indexä½ç½®å…ƒç´ éTreeNodeç±»å‹ï¼Œåˆ™æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼æ¥è¿›è¡Œéå†æŸ¥è¯¢
</code></pre><p>æºç å¦‚ä¸‹ï¼š</p>
<p><img src="http://img.blog.csdn.net/20170107005249311" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<h1>1.7çš„ConcurrentHashMapè®¾è®¡</h1>

<p>ConcurrentHashMapæ˜¯çº¿ç¨‹å®‰å…¨ï¼Œé€šè¿‡åˆ†æ®µé”çš„æ–¹å¼æé«˜äº†å¹¶å‘åº¦ã€‚åˆ†æ®µæ˜¯ä¸€å¼€å§‹å°±ç¡®å®šçš„äº†ï¼ŒåæœŸä¸èƒ½å†è¿›è¡Œæ‰©å®¹çš„ã€‚</p>
<p>å…¶ä¸­çš„æ®µSegmentç»§æ‰¿äº†é‡å…¥é”ReentrantLockï¼Œæœ‰äº†é”çš„åŠŸèƒ½ï¼ŒåŒæ—¶å«æœ‰ç±»ä¼¼HashMapä¸­çš„æ•°ç»„åŠ é“¾è¡¨ç»“æ„ï¼ˆè¿™é‡Œæ²¡æœ‰ä½¿ç”¨çº¢é»‘æ ‘ï¼‰</p>
<p>è™½ç„¶Segmentçš„ä¸ªæ•°æ˜¯ä¸èƒ½æ‰©å®¹çš„ï¼Œä½†æ˜¯å•ä¸ªSegmenté‡Œé¢çš„æ•°ç»„æ˜¯å¯ä»¥æ‰©å®¹çš„ã€‚</p>
<h2>2.1 æ•´ä½“æ¦‚è§ˆ</h2>

<p>ConcurrentHashMapæœ‰3ä¸ªå‚æ•°ï¼š</p>
<pre><code>initialCapacityï¼šåˆå§‹æ€»å®¹é‡ï¼Œé»˜è®¤16
loadFactorï¼šåŠ è½½å› å­ï¼Œé»˜è®¤0.75
concurrencyLevelï¼šå¹¶å‘çº§åˆ«ï¼Œé»˜è®¤16
</code></pre><p>ç„¶åæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯ï¼š</p>
<p><li>segmentçš„ä¸ªæ•°å³ssize</li></p>
<p>å–å¤§äºç­‰äºå¹¶å‘çº§åˆ«çš„æœ€å°çš„2çš„å¹‚æ¬¡ã€‚å¦‚concurrencyLevel=16ï¼Œé‚£ä¹ˆsszie=16,å¦‚concurrencyLevel=10ï¼Œé‚£ä¹ˆssize=16</p>
<p><li>å•ä¸ªsegmentçš„åˆå§‹å®¹é‡cap</li></p>
<p>c=initialCapacity/ssize,å¹¶ä¸”å¯èƒ½éœ€è¦+1ã€‚å¦‚15/7=2ï¼Œé‚£ä¹ˆcè¦å–3ï¼Œå¦‚16/8=2ï¼Œé‚£ä¹ˆcå–2</p>
<p>cå¯èƒ½æ˜¯ä¸€ä¸ªä»»æ„å€¼ï¼Œé‚£ä¹ˆåŒä¸Šè¿°ä¸€æ ·ï¼Œcapå–çš„å€¼å°±æ˜¯å¤§äºç­‰äºcçš„æœ€ä¸‹2çš„å¹‚æ¬¡ã€‚æœ€å°å€¼è¦æ±‚æ˜¯2</p>
<p><li>å•ä¸ªsegmentçš„é˜ˆå€¼threshold</li></p>
<p>cap*loadFactor</p>
<p>æ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹ï¼Œsegmentçš„ä¸ªæ•°sszie=16,æ¯ä¸ªsegmentçš„åˆå§‹å®¹é‡cap=2ï¼Œå•ä¸ªsegmentçš„é˜ˆå€¼threshold=1</p>
<h2>2.2 putè¿‡ç¨‹</h2>

<p><li>é¦–å…ˆæ ¹æ®keyè®¡ç®—å‡ºä¸€ä¸ªhashå€¼ï¼Œæ‰¾åˆ°å¯¹åº”çš„Segment</li></p>
<p><li>è°ƒç”¨Segmentçš„lockæ–¹æ³•ï¼Œä¸ºåé¢çš„putæ“ä½œåŠ é”</li></p>
<p><li>æ ¹æ®keyè®¡ç®—å‡ºhashå€¼ï¼Œæ‰¾åˆ°Segmentä¸­æ•°ç»„ä¸­å¯¹åº”indexçš„é“¾è¡¨ï¼Œå¹¶å°†è¯¥æ•°æ®æ”¾ç½®åˆ°è¯¥é“¾è¡¨ä¸­</li></p>
<p><li>åˆ¤æ–­å½“å‰SegmentåŒ…å«å…ƒç´ çš„æ•°é‡å¤§äºé˜ˆå€¼ï¼Œåˆ™Segmentè¿›è¡Œæ‰©å®¹</li></p>
<p>æ•´ä½“ä»£ç é€»è¾‘è§å¦‚ä¸‹æºç ï¼š</p>
<p><img src="http://img.blog.csdn.net/20170107005617154" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>å…¶ä¸­ä¸Šè¿°Segmentçš„putè¿‡ç¨‹æºç å¦‚ä¸‹ï¼š</p>
<p><img src="http://img.blog.csdn.net/20170107005641091" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<h2>2.3 æ‰©å®¹è¿‡ç¨‹</h2>

<p>è¿™ä¸ªæ‰©å®¹æ˜¯åœ¨Segmentçš„é”çš„ä¿æŠ¤ä¸‹è¿›è¡Œæ‰©å®¹çš„ï¼Œä¸éœ€è¦å…³æ³¨å¹¶å‘é—®é¢˜ã€‚</p>
<p><img src="http://img.blog.csdn.net/20170107005716473" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>è¿™é‡Œçš„é‡ç‚¹å°±æ˜¯ï¼š</p>
<p>é¦–å…ˆæ‰¾åˆ°ä¸€ä¸ªlastRunï¼ŒlastRunä¹‹åçš„å…ƒç´ å’ŒlastRunæ˜¯åœ¨åŒä¸€ä¸ªæ¡¶ä¸­ï¼Œæ‰€ä»¥åé¢çš„ä¸éœ€è¦è¿›è¡Œå˜åŠ¨ã€‚</p>
<p>ç„¶åå¯¹å¼€å§‹åˆ°lastRunéƒ¨åˆ†çš„å…ƒç´ ï¼Œé‡æ–°è®¡ç®—ä¸‹è®¾ç½®åˆ°newTableä¸­ï¼Œæ¯æ¬¡éƒ½æ˜¯å°†å½“å‰å…ƒç´ ä½œä¸ºnewTableçš„é¦–å…ƒç´ ï¼Œä¹‹å‰è€çš„é“¾è¡¨ä½œä¸ºè¯¥é¦–å…ƒç´ çš„nextéƒ¨åˆ†ã€‚</p>
<h2>2.4 getè¿‡ç¨‹</h2>

<p><li>æ ¹æ®keyè®¡ç®—å‡ºå¯¹åº”çš„segment</li></p>
<p><li>å†æ ¹æ®keyè®¡ç®—å‡ºå¯¹åº”segmentä¸­æ•°ç»„çš„index</li></p>
<p><li>æœ€ç»ˆéå†ä¸Šè¿°indexä½ç½®çš„é“¾è¡¨ï¼ŒæŸ¥æ‰¾å‡ºå¯¹åº”çš„keyçš„value</li></p>
<p>æºç å¦‚ä¸‹ï¼š</p>
<p><img src="http://img.blog.csdn.net/20170107005803333" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<h1>1.8çš„ConcurrentHashMapè®¾è®¡</h1>

<p>1.8çš„ConcurrentHashMapæ‘’å¼ƒäº†1.7çš„segmentè®¾è®¡ï¼Œè€Œæ˜¯åœ¨1.8HashMapçš„åŸºç¡€ä¸Šå®ç°äº†çº¿ç¨‹å®‰å…¨çš„ç‰ˆæœ¬ï¼Œå³ä¹Ÿæ˜¯é‡‡ç”¨<strong>æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</strong>çš„å½¢å¼ã€‚</p>
<p>æ•°ç»„å¯ä»¥æ‰©å®¹ï¼Œé“¾è¡¨å¯ä»¥è½¬åŒ–ä¸ºçº¢é»‘æ ‘</p>
<h2>3.1 æ•´ä½“æ¦‚è§ˆ</h2>

<p>æœ‰ä¸€ä¸ªé‡è¦çš„å‚æ•°sizeCtlï¼Œä»£è¡¨æ•°ç»„çš„å¤§å°ï¼ˆä½†æ˜¯è¿˜æœ‰å…¶ä»–å–å€¼åŠå…¶å«ä¹‰ï¼Œåé¢å†è¯¦ç»†è¯´åˆ°ï¼‰</p>
<p>ç”¨æˆ·å¯ä»¥è®¾ç½®ä¸€ä¸ªåˆå§‹å®¹é‡initialCapacityç»™ConcurrentHashMap</p>
<p>sizeCtl=å¤§äºï¼ˆ1.5å€initialCapacity+1ï¼‰çš„æœ€å°çš„2çš„å¹‚æ¬¡ã€‚</p>
<p>å³initialCapacity=20ï¼Œåˆ™sizeCtl=32,å¦‚initialCapacity=24ï¼Œåˆ™sizeCtl=64ã€‚</p>
<p>åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šæŒ‰ç…§sizeCtlçš„å¤§å°åˆ›å»ºå‡ºå¯¹åº”å¤§å°çš„æ•°ç»„</p>
<h2>3.2 putè¿‡ç¨‹</h2>

<p>æºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://img.blog.csdn.net/20170107005911460" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p><li>å¦‚æœæ•°ç»„è¿˜æœªåˆå§‹åŒ–ï¼Œé‚£ä¹ˆè¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™é‡Œä¼šé€šè¿‡ä¸€ä¸ªCASæ“ä½œå°†sizeCtlè®¾ç½®ä¸º-1ï¼Œè®¾ç½®æˆåŠŸçš„ï¼Œå¯ä»¥è¿›è¡Œåˆå§‹åŒ–æ“ä½œ</li></p>
<p><li>æ ¹æ®keyçš„hashå€¼æ‰¾åˆ°å¯¹åº”çš„æ¡¶ï¼Œå¦‚æœæ¡¶è¿˜ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆé€šè¿‡ä¸€ä¸ªCASæ“ä½œæ¥è®¾ç½®æ¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¤±è´¥çš„ç»§ç»­æ‰§è¡Œä¸‹é¢çš„é€»è¾‘å³å‘æ¡¶ä¸­æ’å…¥æˆ–æ›´æ–°</li></p>
<p><li>å¦‚æœæ‰¾åˆ°çš„æ¡¶å­˜åœ¨ï¼Œä½†æ˜¯æ¡¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„hashå€¼æ˜¯-1ï¼Œè¯´æ˜æ­¤æ—¶è¯¥æ¡¶æ­£åœ¨è¿›è¡Œè¿ç§»æ“ä½œï¼Œè¿™ä¸€å—ä¼šåœ¨ä¸‹é¢çš„æ‰©å®¹ä¸­è¯¦ç»†è°ˆåŠã€‚</li></p>
<p><li>å¦‚æœæ‰¾åˆ°çš„æ¡¶å­˜åœ¨ï¼Œé‚£ä¹ˆè¦ä¹ˆæ˜¯é“¾è¡¨ç»“æ„è¦ä¹ˆæ˜¯çº¢é»‘æ ‘ç»“æ„ï¼Œæ­¤æ—¶éœ€è¦è·å–è¯¥æ¡¶çš„é”ï¼Œåœ¨é”å®šçš„æƒ…å†µä¸‹æ‰§è¡Œé“¾è¡¨æˆ–è€…çº¢é»‘æ ‘çš„æ’å…¥æˆ–æ›´æ–°</li></p>
<pre><code>å¦‚æœæ¡¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„hashå€¼å¤§äº0ï¼Œè¯´æ˜æ˜¯é“¾è¡¨ç»“æ„ï¼Œåˆ™å¯¹é“¾è¡¨æ’å…¥æˆ–è€…æ›´æ–°
å¦‚æœæ¡¶ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ç±»å‹æ˜¯TreeBinï¼Œè¯´æ˜æ˜¯çº¢é»‘æ ‘ç»“æ„ï¼Œåˆ™æŒ‰ç…§çº¢é»‘æ ‘çš„æ–¹å¼è¿›è¡Œæ’å…¥æˆ–è€…æ›´æ–°
</code></pre><p><li>åœ¨é”çš„ä¿æŠ¤ä¸‹æ’å…¥æˆ–è€…æ›´æ–°å®Œæ¯•åï¼Œå¦‚æœæ˜¯é“¾è¡¨ç»“æ„ï¼Œéœ€è¦åˆ¤æ–­é“¾è¡¨ä¸­å…ƒç´ çš„æ•°é‡æ˜¯å¦è¶…è¿‡8ï¼ˆé»˜è®¤ï¼‰ï¼Œä¸€æ—¦è¶…è¿‡å°±è¦è€ƒè™‘è¿›è¡Œæ•°ç»„æ‰©å®¹æˆ–è€…æ˜¯é“¾è¡¨è½¬çº¢é»‘æ ‘</li></p>
<p><strong>ä¸‹é¢å°±æ¥é‡ç‚¹çœ‹çœ‹è¿™ä¸ªæ‰©å®¹è¿‡ç¨‹</strong></p>
<h2>3.3 æ‰©å®¹è¿‡ç¨‹</h2>

<p>ä¸€æ—¦é“¾è¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡äº†8ä¸ªï¼Œé‚£ä¹ˆå¯ä»¥æ‰§è¡Œæ•°ç»„æ‰©å®¹æˆ–è€…é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ï¼Œè¿™é‡Œä¾æ®çš„ç­–ç•¥è·ŸHashMapä¾æ®çš„ç­–ç•¥æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>å½“æ•°ç»„é•¿åº¦è¿˜æœªè¾¾åˆ°64ä¸ªæ—¶ï¼Œä¼˜å…ˆæ•°ç»„çš„æ‰©å®¹ï¼Œå¦åˆ™é€‰æ‹©é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ã€‚</p>
<p>æºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://img.blog.csdn.net/20170107010024665" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>é‡ç‚¹æ¥çœ‹çœ‹è¿™ä¸ªæ‰©å®¹è¿‡ç¨‹ï¼Œå³çœ‹ä¸‹ä¸Šè¿°tryPresizeæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°ä¸Šè¿°æ˜¯2å€æ‰©å®¹çš„æ–¹å¼</p>
<p><img src="http://img.blog.csdn.net/20170107010051374" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„çº¿ç¨‹ä¼šé¦–å…ˆè®¾ç½®sizeCtlå±æ€§ä¸ºä¸€ä¸ªè´Ÿå€¼ï¼Œç„¶åæ‰§è¡Œtransfer(tab, null)ï¼Œå…¶ä»–æ™šè¿›æ¥çš„çº¿ç¨‹ä¼šæ£€æŸ¥å½“å‰æ‰©å®¹æ˜¯å¦å·²ç»å®Œæˆï¼Œæ²¡å®Œæˆåˆ™å¸®åŠ©è¿›è¡Œæ‰©å®¹ï¼Œå®Œæˆäº†åˆ™ç›´æ¥é€€å‡ºã€‚</p>
<p>è¯¥ConcurrentHashMapçš„æ‰©å®¹æ“ä½œå¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œé‚£ä¹ˆå°±è¦å¤„ç†å¥½ä»»åŠ¡çš„åˆ†é…å·¥ä½œã€‚æ¯ä¸ªçº¿ç¨‹è·å–ä¸€éƒ¨åˆ†æ¡¶çš„è¿ç§»ä»»åŠ¡ï¼Œå¦‚æœå½“å‰çº¿ç¨‹çš„ä»»åŠ¡å®Œæˆï¼ŒæŸ¥çœ‹æ˜¯å¦è¿˜æœ‰æœªè¿ç§»çš„æ¡¶ï¼Œè‹¥æœ‰åˆ™ç»§ç»­é¢†å–ä»»åŠ¡æ‰§è¡Œï¼Œè‹¥æ²¡æœ‰åˆ™é€€å‡ºã€‚åœ¨é€€å‡ºæ—¶éœ€è¦æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å…¶ä»–çº¿ç¨‹åœ¨å‚ä¸è¿ç§»å·¥ä½œï¼Œå¦‚æœæœ‰åˆ™è‡ªå·±ä»€ä¹ˆä¹Ÿä¸åšç›´æ¥é€€å‡ºï¼Œå¦‚æœæ²¡æœ‰äº†åˆ™æ‰§è¡Œæœ€ç»ˆçš„æ”¶å°¾å·¥ä½œã€‚</p>
<p><strong>é—®é¢˜1ï¼šå½“å‰çº¿ç¨‹å¦‚ä½•æ„ŸçŸ¥å…¶ä»–çº¿ç¨‹ä¹Ÿåœ¨å‚ä¸è¿ç§»å·¥ä½œï¼Ÿ</strong></p>
<p>é sizeCtlçš„å€¼ï¼Œå®ƒåˆå§‹å€¼æ˜¯ä¸€ä¸ªè´Ÿå€¼=(rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2)ï¼Œæ¯å½“ä¸€ä¸ªçº¿ç¨‹å‚ä¸è¿›æ¥æ‰§è¡Œè¿ç§»å·¥ä½œï¼Œåˆ™è¯¥å€¼è¿›è¡ŒCASè‡ªå¢ï¼Œè¯¥çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•è¦é€€å‡ºæ—¶å¯¹è¯¥å€¼è¿›è¡ŒCASè‡ªå‡æ“ä½œï¼Œæ‰€ä»¥å½“sizeCtlçš„å€¼ç­‰äºä¸Šè¿°åˆå€¼åˆ™è¯´æ˜äº†æ­¤æ—¶æœªæœ‰å…¶ä»–çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œè¿ç§»å·¥ä½œï¼Œå¯ä»¥å»æ‰§è¡Œæ”¶å°¾å·¥ä½œäº†ã€‚è§å¦‚ä¸‹ä»£ç </p>
<p><img src="http://img.blog.csdn.net/20170107010125312" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p><strong>é—®é¢˜2ï¼šä»»åŠ¡æŒ‰ç…§ä½•è§„åˆ™è¿›è¡Œåˆ†ç‰‡ï¼Ÿ</strong></p>
<p><img src="http://img.blog.csdn.net/20170107010151062" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>ä¸Šè¿°strideå³æ˜¯æ¯ä¸ªåˆ†ç‰‡çš„å¤§å°ï¼Œç›®å‰æœ‰æœ€ä½è¦æ±‚16ï¼Œå³æ¯ä¸ªåˆ†ç‰‡è‡³å°‘éœ€è¦16ä¸ªæ¡¶ã€‚strideçš„è®¡ç®—ä¾èµ–äºCPUçš„æ ¸æ•°ï¼Œå¦‚æœåªæœ‰1ä¸ªæ ¸ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¸ç”¨åˆ†ç‰‡ï¼Œå³stride=nã€‚å…¶ä»–æƒ…å†µå°±æ˜¯ (n &gt;&gt;&gt; 3) / NCPUã€‚</p>
<p><strong>é—®é¢˜3ï¼šå¦‚ä½•è®°å½•ç›®å‰å·²ç»åˆ†å‡ºå»çš„ä»»åŠ¡ï¼Ÿ</strong></p>
<p>ConcurrentHashMapå«æœ‰ä¸€ä¸ªå±æ€§transferIndexï¼ˆåˆå€¼ä¸ºæœ€åä¸€ä¸ªæ¡¶ï¼‰ï¼Œè¡¨ç¤ºä»transferIndexå¼€å§‹åˆ°åé¢æ‰€æœ‰çš„æ¡¶çš„è¿ç§»ä»»åŠ¡å·²ç»è¢«åˆ†é…å‡ºå»äº†ã€‚æ‰€ä»¥æ¯æ¬¡çº¿ç¨‹é¢†å–æ‰©å®¹ä»»åŠ¡ï¼Œåˆ™éœ€è¦å¯¹è¯¥å±æ€§è¿›è¡ŒCASçš„å‡æ“ä½œï¼Œå³ä¸€èˆ¬æ˜¯transferIndex-strideã€‚</p>
<p><strong>é—®é¢˜4ï¼šæ¯ä¸ªçº¿ç¨‹å¦‚ä½•å¤„ç†åˆ†åˆ°çš„éƒ¨åˆ†æ¡¶çš„è¿ç§»å·¥ä½œ</strong></p>
<p>ç¬¬ä¸€ä¸ªè·å–åˆ°åˆ†ç‰‡çš„çº¿ç¨‹ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå®¹é‡æ˜¯ä¹‹å‰çš„2å€ã€‚</p>
<p>éå†è‡ªå·±æ‰€åˆ†åˆ°çš„æ¡¶ï¼š</p>
<pre><code>æ¡¶ä¸­å…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ™é€šè¿‡CASæ“ä½œè®¾ç½®æ¡¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºForwardingNodeï¼Œå…¶Hashå€¼ä¸ºMOVEDï¼ˆ-1ï¼‰,åŒæ—¶è¯¥å…ƒç´ å«æœ‰æ–°çš„æ•°ç»„å¼•ç”¨

æ­¤æ—¶è‹¥å…¶ä»–çº¿ç¨‹è¿›è¡Œputæ“ä½œï¼Œå‘ç°ç¬¬ä¸€ä¸ªå…ƒç´ çš„hashå€¼ä¸º-1åˆ™ä»£è¡¨æ­£åœ¨è¿›è¡Œæ‰©å®¹æ“ä½œï¼ˆå¹¶ä¸”è¡¨æ˜è¯¥æ¡¶å·²ç»å®Œæˆæ‰©å®¹æ“ä½œäº†ï¼Œå¯ä»¥ç›´æ¥åœ¨æ–°çš„æ•°ç»„ä¸­é‡æ–°è¿›è¡Œhashå’Œæ’å…¥æ“ä½œï¼‰ï¼Œè¯¥çº¿ç¨‹å°±å¯ä»¥å»å‚ä¸è¿›å»ï¼Œæˆ–è€…æ²¡æœ‰ä»»åŠ¡åˆ™ä¸ç”¨å‚ä¸ï¼Œæ­¤æ—¶å¯ä»¥å»ç›´æ¥æ“ä½œæ–°çš„æ•°ç»„äº†

æ¡¶ä¸­å…ƒç´ å­˜åœ¨ä¸”hashå€¼ä¸º-1ï¼Œåˆ™è¯´æ˜è¯¥æ¡¶å·²ç»è¢«å¤„ç†äº†ï¼ˆæœ¬ä¸ä¼šå‡ºç°å¤šä¸ªçº¿ç¨‹ä»»åŠ¡é‡å çš„æƒ…å†µï¼Œè¿™é‡Œä¸»è¦æ˜¯è¯¥çº¿ç¨‹åœ¨æ‰§è¡Œå®Œæ‰€æœ‰çš„ä»»åŠ¡åä¼šå†æ¬¡è¿›è¡Œæ£€æŸ¥ï¼Œå†æ¬¡æ ¸å¯¹ï¼‰

æ¡¶ä¸­ä¸ºé“¾è¡¨æˆ–è€…çº¢é»‘æ ‘ç»“æ„ï¼Œåˆ™éœ€è¦è·å–æ¡¶é”ï¼Œé˜²æ­¢å…¶ä»–çº¿ç¨‹å¯¹è¯¥æ¡¶è¿›è¡Œputæ“ä½œï¼Œç„¶åå¤„ç†æ–¹å¼åŒHashMapçš„å¤„ç†æ–¹å¼ä¸€æ ·ï¼Œå¯¹æ¡¶ä¸­å…ƒç´ åˆ†ä¸º2ç±»ï¼Œåˆ†åˆ«ä»£è¡¨å½“å‰æ¡¶ä¸­å’Œè¦è¿ç§»åˆ°æ–°æ¡¶ä¸­çš„å…ƒç´ ã€‚è®¾ç½®å®Œæ¯•åä»£è¡¨æ¡¶è¿ç§»å·¥ä½œå·²ç»å®Œæˆï¼Œæ—§æ•°ç»„ä¸­è¯¥æ¡¶å¯ä»¥è®¾ç½®æˆForwardingNodeäº†
</code></pre><p>ä¸‹é¢æ¥çœ‹ä¸‹è¯¦ç»†çš„ä»£ç ï¼š</p>
<p><img src="http://img.blog.csdn.net/20170107010302919" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<h2>3.4 getè¿‡ç¨‹</h2>

<p><li>æ ¹æ®kè®¡ç®—å‡ºhashå€¼ï¼Œæ‰¾åˆ°å¯¹åº”çš„æ•°ç»„index</li></p>
<p><li>å¦‚æœè¯¥indexä½ç½®æ— å…ƒç´ åˆ™ç›´æ¥è¿”å›null</li></p>
<p><li>å¦‚æœè¯¥indexä½ç½®æœ‰å…ƒç´ </li></p>
<pre><code>å¦‚æœç¬¬ä¸€ä¸ªå…ƒç´ çš„hashå€¼å°äº0ï¼Œåˆ™è¯¥èŠ‚ç‚¹å¯èƒ½ä¸ºForwardingNodeæˆ–è€…çº¢é»‘æ ‘èŠ‚ç‚¹TreeBin

å¦‚æœæ˜¯ForwardingNodeï¼ˆè¡¨ç¤ºå½“å‰æ­£åœ¨è¿›è¡Œæ‰©å®¹ï¼‰ï¼Œä½¿ç”¨æ–°çš„æ•°ç»„æ¥è¿›è¡ŒæŸ¥æ‰¾

å¦‚æœæ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹TreeBinï¼Œä½¿ç”¨çº¢é»‘æ ‘çš„æŸ¥æ‰¾æ–¹å¼æ¥è¿›è¡ŒæŸ¥æ‰¾

å¦‚æœç¬¬ä¸€ä¸ªå…ƒç´ çš„hashå¤§äºç­‰äº0ï¼Œåˆ™ä¸ºé“¾è¡¨ç»“æ„ï¼Œä¾æ¬¡éå†å³å¯æ‰¾åˆ°å¯¹åº”çš„å…ƒç´ 
</code></pre><p>è¯¦ç»†ä»£ç å¦‚ä¸‹</p>
<p><img src="http://img.blog.csdn.net/20170107010356702" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>è‡³æ­¤ï¼ŒConcurrentHashMapä¸»è¦çš„æ“ä½œéƒ½ç²—ç•¥çš„ä»‹ç»å®Œæ¯•äº†ï¼Œå…¶ä»–ä¸€äº›æ“ä½œé å„ä½è‡ªè¡Œå»çœ‹äº†ã€‚</p>
<p>ä¸‹é¢é’ˆå¯¹ä¸€äº›é—®é¢˜æ¥è¿›è¡Œè§£ç­”</p>
<p></p><h1>é—®é¢˜åˆ†æ<h1><p></p>
<h2>4.1 ConcurrentHashMapè¯»ä¸ºä»€ä¹ˆä¸éœ€è¦é”ï¼Ÿ</h2>

<p>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨è¯»å†™é”æ¥ä¿æŠ¤å¯¹ä¸€å †æ•°æ®çš„è¯»å†™æ“ä½œã€‚è¯»æ—¶åŠ è¯»é”ï¼Œå†™æ—¶åŠ å†™é”ã€‚åœ¨ä»€ä¹ˆæ ·çš„æƒ…å†µä¸‹å¯ä»¥ä¸éœ€è¦è¯»é”å‘¢ï¼Ÿ</p>
<p>å¦‚æœå¯¹æ•°æ®çš„è¯»å†™æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œé‚£ä¹ˆæ­¤æ—¶æ˜¯å¯ä»¥ä¸éœ€è¦è¯»é”çš„ã€‚å¦‚ConcurrentHashMapå¯¹æ•°æ®çš„è¯»å†™ï¼Œå†™æ“ä½œæ˜¯ä¸éœ€è¦åˆ†2æ¬¡å†™çš„ï¼ˆæ²¡æœ‰ä¸­é—´çŠ¶æ€ï¼‰ï¼Œè¯»æ“ä½œä¹Ÿæ˜¯ä¸éœ€è¦2æ¬¡è¯»å–çš„ã€‚å‡å¦‚ä¸€ä¸ªå†™æ“ä½œéœ€è¦åˆ†å¤šæ¬¡å†™ï¼Œå¿…ç„¶ä¼šæœ‰ä¸­é—´çŠ¶æ€ï¼Œå¦‚æœè¯»ä¸åŠ é”ï¼Œé‚£ä¹ˆå¯èƒ½å°±ä¼šè¯»åˆ°ä¸­é—´çŠ¶æ€ï¼Œé‚£å°±ä¸å¯¹äº†ã€‚</p>
<p>å‡å¦‚ConcurrentHashMapæä¾›put(key1,value1,key2,value2)ï¼Œå†™å…¥çš„æ—¶å€™å¿…ç„¶ä¼šå­˜åœ¨ä¸­é—´çŠ¶æ€å³key1å†™å®Œæˆï¼Œä½†æ˜¯key2è¿˜æœªå†™ï¼Œæ­¤æ—¶å¦‚æœè¯»ä¸åŠ é”ï¼Œé‚£ä¹ˆå°±å¯èƒ½è¯»åˆ°key1æ˜¯æ–°æ•°æ®è€Œkey2æ˜¯è€æ•°æ®çš„ä¸­é—´çŠ¶æ€ã€‚</p>
<p>è™½ç„¶ConcurrentHashMapçš„è¯»ä¸éœ€è¦é”ï¼Œä½†æ˜¯éœ€è¦ä¿è¯èƒ½è¯»åˆ°æœ€æ–°æ•°æ®ï¼Œæ‰€ä»¥å¿…é¡»åŠ volatileã€‚å³æ•°ç»„çš„å¼•ç”¨éœ€è¦åŠ volatileï¼ŒåŒæ—¶ä¸€ä¸ªNodeèŠ‚ç‚¹ä¸­çš„valå’Œnextå±æ€§ä¹Ÿå¿…é¡»è¦åŠ volatileã€‚</p>
<h2>4.2 ConcurrentHashMapæ˜¯å¦å¯ä»¥åœ¨æ— é”çš„æƒ…å†µä¸‹è¿›è¡Œè¿ç§»ï¼Ÿ</h2>

<p>ç›®å‰1.8çš„ConcurrentHashMapè¿ç§»æ˜¯åœ¨é”å®šæ—§æ¡¶çš„å‰æä¸‹è¿›è¡Œè¿ç§»çš„ï¼Œç„¶è€Œå¹¶æ²¡æœ‰å»é”å®šæ–°æ¡¶ã€‚é‚£ä¹ˆå°±å¯èƒ½æå‡ºå¦‚ä¸‹é—®é¢˜ï¼š</p>
<p><li>åœ¨æŸä¸ªæ¡¶çš„è¿ç§»è¿‡ç¨‹ä¸­ï¼Œåˆ«çš„çº¿ç¨‹æƒ³è¦å¯¹è¯¥æ¡¶è¿›è¡Œputæ“ä½œæ€ä¹ˆåŠï¼Ÿ</li></p>
<p>ä¸€æ—¦æŸä¸ªæ¡¶åœ¨è¿ç§»è¿‡ç¨‹ä¸­äº†ï¼Œå¿…ç„¶è¦è·å–è¯¥æ¡¶çš„é”ï¼Œæ‰€ä»¥å…¶ä»–çº¿ç¨‹çš„putæ“ä½œè¦è¢«é˜»å¡ï¼Œä¸€æ—¦è¿ç§»å®Œæ¯•ï¼Œè¯¥æ¡¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ å°±ä¼šè¢«è®¾ç½®æˆForwardingNodeèŠ‚ç‚¹ï¼Œæ‰€ä»¥å…¶ä»–çº¿ç¨‹putæ—¶éœ€è¦é‡æ–°åˆ¤æ–­ä¸‹æ¡¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å¦è¢«æ›´æ”¹äº†ï¼Œå¦‚æœè¢«æ”¹äº†é‡æ–°è·å–é‡æ–°æ‰§è¡Œé€»è¾‘ï¼Œå¦‚ä¸‹ä»£ç </p>
<p><img src="http://img.blog.csdn.net/20170107010526876" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p><li>æŸä¸ªæ¡¶å·²ç»è¿ç§»å®Œæˆï¼ˆå…¶ä»–æ¡¶è¿˜æœªå®Œæˆï¼‰ï¼Œåˆ«çš„çº¿ç¨‹æƒ³è¦å¯¹è¯¥æ¡¶è¿›è¡Œputæ“ä½œæ€ä¹ˆåŠï¼Ÿ</li></p>
<p>è¯¥çº¿ç¨‹ä¼šé¦–å…ˆæ£€æŸ¥æ˜¯å¦è¿˜æœ‰æœªåˆ†é…çš„è¿ç§»ä»»åŠ¡ï¼Œå¦‚æœæœ‰åˆ™å…ˆå»æ‰§è¡Œè¿ç§»ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å³å…¨éƒ¨ä»»åŠ¡å·²ç»åˆ†å‘å‡ºå»äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶è¯¥çº¿ç¨‹å¯ä»¥ç›´æ¥å¯¹æ–°çš„æ¡¶è¿›è¡Œæ’å…¥æ“ä½œï¼ˆæ˜ å°„åˆ°çš„æ–°æ¡¶å¿…ç„¶å·²ç»å®Œæˆäº†è¿ç§»ï¼Œæ‰€ä»¥å¯ä»¥æ”¾å¿ƒæ‰§è¡Œæ“ä½œï¼‰</p>
<p>ä»ä¸Šé¢çœ‹åˆ°æˆ‘ä»¬åœ¨è¿ç§»çš„æ—¶å€™è¿˜æ˜¯éœ€è¦å¯¹æ—§æ¡¶é”å®šçš„ï¼Œèƒ½å¦åœ¨æ— é”çš„æƒ…å†µä¸‹å®ç°è¿ç§»ï¼Ÿ</p>
<p>å¯ä»¥å‚è€ƒå‚è€ƒè¿™ç¯‡è®ºæ–‡Split-Ordered Lists: Lock-Free Extensible Hash Tables</p>
<p>ä¸€æ—¦æ‰©å®¹å°±æ¶‰åŠåˆ°è¿ç§»æ¡¶ä¸­å…ƒç´ çš„æ“ä½œï¼Œå°†ä¸€ä¸ªæ¡¶ä¸­çš„å…ƒç´ è¿ç§»åˆ°å¦ä¸€ä¸ªæ¡¶ä¸­çš„æ“ä½œä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œæ‰€ä»¥éœ€è¦åœ¨é”çš„ä¿æŠ¤ä¸‹è¿›è¡Œè¿ç§»ã€‚å¦‚æœæ‰©å®¹æ“ä½œæ˜¯ç§»åŠ¨æ¡¶çš„æŒ‡å‘ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ä¸€ä¸ªCASæ“ä½œæ¥å®Œæˆæ‰©å®¹æ“ä½œã€‚ä¸Šè¿°Split-Ordered Listså°±æ˜¯æŠŠæ‰€æœ‰å…ƒç´ æŒ‰ç…§ä¸€å®šçš„é¡ºåºè¿›è¡Œæ’åˆ—ã€‚è¯¥listè¢«åˆ†æˆä¸€æ®µä¸€æ®µçš„ï¼Œæ¯ä¸€æ®µéƒ½ä»£è¡¨æŸä¸ªæ¡¶ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚æ¯ä¸ªæ¡¶ä¸­éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆï¼Œå¦‚ä¸‹å›¾ç»“æ„æ‰€ç¤ºï¼š</p>
<p><img src="http://img.blog.csdn.net/20170107010603392" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>æ¯ä¸€æ®µå…¶å®ä¹Ÿæ˜¯åˆ†æˆ2ç±»çš„ï¼Œå¦‚åŒå‰é¢æ‰€è¯´çš„HashMapåœ¨æ‰©å®¹æ˜¯åˆ†æˆ2ç±»çš„æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œæ­¤æ—¶Split-Ordered Listsåœ¨æ‰©å®¹æ—¶å°±åªéœ€è¦å°†æ–°æ¡¶çš„æŒ‡é’ˆæŒ‡å‘è¿™2ç±»çš„åˆ†ç•Œç‚¹å³å¯ã€‚</p>
<p>è¿™ä¸€å—ä¹‹åå†è¯¦ç»†è¯´æ˜å§ã€‚</p>
<h2>4.3 ConcurrentHashMapæ›¾ç»çš„å¼±ä¸€è‡´æ€§</h2>

<p>å…·ä½“è¯¦è§è¿™ç¯‡é’ˆå¯¹è€ç‰ˆæœ¬çš„ConcurrentHashMapçš„è¯´æ˜æ–‡ç« <a href="http://ifeve.com/concurrenthashmap-weakly-consistent/" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆConcurrentHashMapæ˜¯å¼±ä¸€è‡´çš„</a></p>
<p>æ–‡ä¸­å·²ç»è§£é‡Šåˆ°ï¼šå¯¹æ•°ç»„çš„å¼•ç”¨æ˜¯volatileæ¥ä¿®é¥°çš„ï¼Œä½†æ˜¯æ•°ç»„ä¸­çš„å…ƒç´ å¹¶ä¸æ˜¯ã€‚å³è¯»å–æ•°ç»„çš„å¼•ç”¨æ€»æ˜¯èƒ½è¯»å–åˆ°æœ€æ–°çš„å€¼ï¼Œä½†æ˜¯è¯»å–æ•°ç»„ä¸­æŸä¸€ä¸ªå…ƒç´ çš„æ—¶å€™å¹¶ä¸ä¸€å®šèƒ½è¯»åˆ°æœ€æ–°çš„å€¼ã€‚æ‰€ä»¥è¯´æ˜¯å¼±ä¸€è‡´æ€§çš„ã€‚</p>
<p>æˆ‘è§‰å¾—è¿™ä¸ªåªéœ€è¦ç¨å¾®æ”¹åŠ¨ä¸‹å°±å¯ä»¥å®ç°å¼ºä¸€è‡´æ€§ï¼š</p>
<p><li>å¯¹äºæ–°åŠ çš„keyï¼Œé€šè¿‡å†™å…¥åˆ°é“¾è¡¨çš„æœ«å°¾å³å¯ã€‚å› ä¸ºä¸€ä¸ªå…ƒç´ çš„nextå±æ€§æ˜¯volatileçš„ï¼Œå¯ä»¥ä¿è¯å†™å…¥åç«‹é©¬çœ‹çš„åˆ°ï¼Œå¦‚ä¸‹1.8çš„æ–¹å¼</li></p>
<p><li>æˆ–è€…å¯¹æ•°ç»„ä¸­å…ƒç´ çš„æ›´æ–°é‡‡ç”¨volatileå†™çš„æ–¹å¼ï¼Œå¦‚ä¸‹1.7çš„å½¢å¼</li></p>
<p>ä½†æ˜¯ç°åœ¨1.7ç‰ˆæœ¬çš„ConcurrentHashMapå¯¹äºæ•°ç»„ä¸­å…ƒç´ çš„å†™ä¹Ÿæ˜¯åŠ äº†volatileçš„ï¼Œå¦‚ä¸‹ä»£ç </p>
<p><img src="http://img.blog.csdn.net/20170107010723393" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>1.8çš„æ–¹å¼å°±æ˜¯ï¼šç›´æ¥å°†æ–°åŠ å…¥çš„å…ƒç´ å†™å…¥nextå±æ€§ï¼ˆå«æœ‰volatileä¿®é¥°ï¼‰ä¸­è€Œä¸æ˜¯ä¿®æ”¹æ¡¶ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</p>
<p><img src="http://img.blog.csdn.net/20170107010744786" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>æ‰€ä»¥åœ¨1.7å’Œ1.8ç‰ˆæœ¬çš„ConcurrentHashMapä¸­ä¸å†æ˜¯å¼±ä¸€è‡´æ€§ï¼Œå†™å…¥çš„æ•°æ®æ˜¯å¯ä»¥ç«‹é©¬æœ¬è¯»åˆ°çš„ã€‚</p>
</h1></h1>]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>cordovaä¸­ä¸inBrowserçš„é€šè®¯</title>
    <url>/2017/02/18/Browser%E7%9A%84%E9%80%9A%E8%AE%AF%E2%80%9D/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä¸ºäº†æŠŠæˆ‘çš„ç»ƒç´è®°å½•ä»ªæ”¹æˆå¤šç”¨æˆ·Appï¼Œæˆ‘éœ€è¦åšä¸€ä¸ªWeibo OAuthåŠŸèƒ½ï¼Œå› ä¸ºç»ƒç´è®°å½•ä»ªæ˜¯Single Page Appï¼Œæˆ‘ä¸æ„¿æ„ç›´æ¥è·³è½¬åˆ°OAuthé¡µé¢ï¼Œé‚£æ ·ä¼šæ‰“æ–­æˆ‘çš„åº”ç”¨çŠ¶æ€ï¼Œäºæ˜¯æˆ‘æ‰“ç®—æ‰“å¼€ä¸€ä¸ªæ–°çª—å£æ¥å®ŒæˆOAuthã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œé—®é¢˜è‡ªç„¶å°±è½¬æ¢ä¸ºè·¨çª—å£é€šè®¯é—®é¢˜äº†ã€‚<br><a id="more"></a><br>çª—å£é—´é€šè®¯æ¯«æ— ç–‘é—®é¦–é€‰æ˜¯ window.postMessage ï¼Œåœ¨cordovaå½“ä¸­ï¼ŒåŸç”Ÿ window.open æ˜¯ä¸èƒ½ç”¨çš„ï¼Œå®˜æ–¹ç»™çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨ cordova-plugin-inappbrowser æ’ä»¶æ‰€æä¾›çš„ cordova.InAppBrowser.open(url, target, options) æ¥å–ä»£ window.open ï¼Œè¿™ä¸¤è€…åŸºæœ¬ä¸ŠAPIå·®ä¸å¤šä¸€è‡´ã€‚</p>
<p>ä½†æ˜¯IABæ’ä»¶æ‰€è¿”å›çš„å¯¹è±¡å¹¶ä¸æ˜¯çœŸæ­£çš„ window ï¼Œå®ƒæ²¡æœ‰ postMessage åŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨IABæ‰€æ‰“å¼€çš„é¡µé¢ä¸­ï¼Œä¹Ÿæ²¡æœ‰ window.opener ï¼Œäºæ˜¯åªèƒ½å¦è¾Ÿè¹Šå¾„ï¼Œæ‰¾ç‚¹ä¸é è°±çš„æŒ«æ–¹æ³•æ¥è¯•è¯•äº†ã€‚</p>
<p>OAuthåŸºæœ¬æµç¨‹</p>
<p>OAuthçš„åŸºæœ¬æµç¨‹è¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œç®€å•æè¿°ä¸€ä¸‹</p>
<p>Clientéœ€è¦æˆæƒï¼ŒæŠŠè‡ªå·±ï¼ˆç”±æœåŠ¡å•†åˆ†é…çš„ï¼‰ client_id â€”â€”ä¹Ÿç§° app key ä»¥åŠåœ¨æœåŠ¡å•†æ³¨å†Œçš„ redirect_url æ‹¼åœ¨ä¸€èµ·ï¼Œè®©ç”¨æˆ·å»è®¿é—®æœåŠ¡å•†çš„ authorize åœ°å€ã€‚<br>æœåŠ¡å•†ä¼šè¯¢é—®ç”¨æˆ·æ˜¯å¦å¯¹è¿™ä¸ª client_id æˆæƒè‡ªå·±çš„è´¦å·ï¼Œå¦‚æœæ˜¯ï¼Œä¼šè·³è½¬åˆ° redirect_url?code=xxxxxx ã€‚<br>åº”ç”¨çš„æœåŠ¡ç«¯æ¥æ”¶åˆ° redirect_url çš„è®¿é—®ï¼Œç”¨URLå‚æ•°ä¸­çš„ code å’Œè‡ªå·±çš„ client_id ä»¥åŠ app secret ï¼ˆç›¸å½“äºå¯†ç ï¼‰å»è¯·æ±‚æœåŠ¡å•†çš„ access_token æ¥å£ï¼Œå¾—åˆ° access_token ï¼Œè¿™ä¸ªå°±æ˜¯æ­¤åº”ç”¨å¯¹äºè¿™ä¸ªç”¨æˆ·è´¦å·çš„è®¿é—®å‡­æ¡ã€‚<br>redirect_url é¡µé¢æ ¹æ®åº”ç”¨è‡ªèº«éœ€è¦æŠŠè·å¾—çš„ access_token ä¼ å›åº”ç”¨ï¼Œå®Œæˆæˆæƒè¿‡ç¨‹ã€‚<br>ä½¿ç”¨ window.open æ—¶çš„æµç¨‹</p>
<p>å®¢æˆ·ç«¯ var win = window.open(oauth_url) ã€‚<br>å®ŒæˆOAuthæˆæƒï¼Œè·³è½¬åˆ° redirect_url ã€‚<br>åœ¨ redirect_url ä¸Šï¼ŒæŠŠ access_token ç”¨ window.opener.postMessage çš„æ–¹å¼å‘ç»™åº”ç”¨ã€‚<br>åº”ç”¨ç›‘å¬ win çš„ onmessage äº‹ä»¶ï¼Œä¸€æ—¦æ”¶åˆ°äº† access_token å°±å®Œæˆæˆæƒï¼Œå¯ä»¥ win.close() äº†ã€‚<br>ç„¶åæˆ‘å…ˆæŠŠå®ƒå†™æˆäº†ä¸€ä¸ªå‡½æ•°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">crossWindowViaBrowser</span>(<span class="params">url, target, opts, key, timeout</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> defer = <span class="built_in">Promise</span>.defer()</span><br><span class="line">  <span class="keyword">let</span> resolve = defer.resolve.bind(defer)</span><br><span class="line">  <span class="keyword">let</span> reject = defer.reject.bind(defer)</span><br><span class="line">  <span class="keyword">let</span> promise = defer.promise</span><br><span class="line">  <span class="keyword">let</span> timing</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> win = <span class="built_in">window</span>.open(url, target, utils.buildOpenWindowOptions(opts))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> onMessage = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = e.data || &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> (data.type === <span class="string">'cross-window'</span> &amp;&amp; data.key === key) &#123;</span><br><span class="line">      parseResult(data.result, resolve, reject)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// closeï¼ˆè²Œä¼¼ï¼‰æ²¡æœ‰å¯ç”¨çš„äº‹ä»¶ï¼Œ`win.addEventListener('close')`æ²¡ç”¨çš„æ ·å­</span></span><br><span class="line">  <span class="comment">// `win.addEventListener`ä¸å¥½ç”¨çš„é—®é¢˜ä¹Ÿå¯èƒ½æ˜¯å› ä¸ºè·¨åŸŸï¼ŒçœŸæ˜¯è›‹ç–¼å•Š</span></span><br><span class="line">  <span class="comment">// äºæ˜¯è½®è¯¢`closed`å±æ€§å§</span></span><br><span class="line">  <span class="keyword">let</span> pollingClosed = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (win.closed) &#123;</span><br><span class="line">      reject(<span class="keyword">new</span> <span class="built_in">Error</span>(ErrorType.CANCELED))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, POLLING_INTERVAL)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, onMessage, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¶…æ—¶`reject`</span></span><br><span class="line">  <span class="keyword">if</span> (timeout &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    timing = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      reject(<span class="keyword">new</span> <span class="built_in">Error</span>(ErrorType.TIMEOUT))</span><br><span class="line">    &#125;, timeout)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  promise.finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// clean up</span></span><br><span class="line">    clearInterval(pollingClosed)</span><br><span class="line">    clearTimeout(timing)</span><br><span class="line">    <span class="built_in">window</span>.removeEventListener(<span class="string">'message'</span>, onMessage)</span><br><span class="line">    win.close()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> promise</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ cordova.InAppBrowser.open æ—¶çš„æµç¨‹</p>
<p>å®¢æˆ·ç«¯ var win = cordova.InAppBrowser.open(oauth_url) ã€‚<br>å®¢æˆ·ç«¯å¼€å§‹å¯¹ win.executeScript å¹¶è¿›è¡Œè½®è¯¢ï¼Œå…¶å†…å®¹æ˜¯å°è¯•è¯»å– localStorage.getItem(key) ã€‚<br>redirect_url é¡µé¢æŠŠè·å–åˆ°çš„ access_token å†™åˆ° localStorage.setItem(key, access_token) ã€‚<br>å®¢æˆ·ç«¯ä¸€æ—¦è½®è¯¢åˆ° localStorage.getItem(key) æœ‰å€¼ï¼Œå°±å¯ä»¥å¾—åˆ° access_token ï¼Œç„¶åå°±å¯ä»¥ localStorage.removeItem(key) ï¼Œå®Œæˆæˆæƒï¼Œ win.close() ã€‚<br>ç„¶åæˆ‘ä¹Ÿå•ç‹¬å†™äº†ä¸€ä¸ªå‡½æ•°</p>
<figure class="highlight zephir"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">crossWindowViaCordovaIAB</span><span class="params">(url, target, opts, key, timeout)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> defer = Promise.defer()</span><br><span class="line">  <span class="keyword">let</span> resolve = defer.resolve.bind(defer)</span><br><span class="line">  <span class="keyword">let</span> reject = defer.reject.bind(defer)</span><br><span class="line">  <span class="keyword">let</span> promise = defer.promise</span><br><span class="line">  <span class="keyword">let</span> timing</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> win = cordova.InAppBrowser.open(url, target, utils.buildOpenWindowOptions(opts))</span><br><span class="line">  <span class="comment">// cordovaçš„InAppBrowseræ²¡æœ‰window.openerå¯¹è±¡ï¼Œåªèƒ½ä½¿ç”¨è½®è¯¢ç½¢ã€‚ã€‚</span></span><br><span class="line">  <span class="keyword">const</span> code = `(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> key = <span class="string">'$&#123;key&#125;'</span></span><br><span class="line">    <span class="keyword">var</span> data = localStorage.getItem(key)</span><br><span class="line">    <span class="keyword">if</span> (data !== <span class="keyword">null</span>) &#123;</span><br><span class="line">      localStorage.removeItem(key)</span><br><span class="line">      <span class="keyword">return</span> data</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span></span><br><span class="line">  &#125;)()`</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> poll = () =&gt; &#123;</span><br><span class="line">    win.executeScript(&#123; code: code &#125;, ret =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (ret[<span class="number">0</span>] === <span class="keyword">false</span>) &#123;</span><br><span class="line">        <span class="comment">// ç­‰å¾…</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        clearInterval(pollingData)</span><br><span class="line">        parseResult(ret[<span class="number">0</span>], resolve, reject)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> pollingData = setInterval(poll, POLLING_INTERVAL)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// çª—å£å…³é—­æ—¶`reject`</span></span><br><span class="line">  <span class="comment">// æ­£å¸¸æµç¨‹ä¸Šé¢`resolve`åæ‰ä¼š`win.close()`ï¼Œæ‰€ä»¥è¿™é‡Œå†`reject`ä¹Ÿä¸ä¼šæœ‰å½±å“</span></span><br><span class="line">  win.addEventListener(<span class="string">'exit'</span>, e =&gt; &#123;</span><br><span class="line">    reject(<span class="keyword">new</span> Error(ErrorType.CANCELED))</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¶…æ—¶`reject`</span></span><br><span class="line">  <span class="keyword">if</span> (timeout &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    timing = setTimeout(() =&gt; &#123;</span><br><span class="line">      reject(<span class="keyword">new</span> Error(ErrorType.TIMEOUT))</span><br><span class="line">    &#125;, timeout)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  promise.<span class="keyword">finally</span>(() =&gt; &#123;</span><br><span class="line">    <span class="comment">// clean up</span></span><br><span class="line">    clearInterval(pollingData)</span><br><span class="line">    clearTimeout(timing)</span><br><span class="line">    win.close()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> promise</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ•´åˆ</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">crossWindow</span><span class="params">(<span class="rest_arg">...args</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (window.cordova !== <span class="literal">undefined</span> &amp;&amp; cordova.InAppBrowser !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> crossWindowViaCordovaIAB(...args)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> crossWindowViaBrowser(...args)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœåŠ¡ç«¯</p>
<p>æœåŠ¡ç«¯çš„Redirect Pageæˆ‘æ˜¯ç”¨PHPå†™çš„ï¼Œæ¶‰åŠåˆ°ä¸Šé¢çš„ cross-browser çš„éƒ¨åˆ†å¤§æ¦‚æ˜¯ï¼š</p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">window.onload = function() </span><span class="xquery">&#123;</span></span><br><span class="line"><span class="xquery">  var<span class="built_in"> key</span> = &lt;?= json_encode(<span class="variable">$key</span>) ?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="xquery">  var result = &lt;?= json_encode(<span class="variable">$output</span>) ?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="xquery">  localStorage.setItem<span class="built_in">(key</span>, result)</span></span><br><span class="line"><span class="xquery">  <span class="keyword">if</span> (<span class="keyword">window</span>.opener) &#123;</span></span><br><span class="line"><span class="xquery">    <span class="keyword">window</span>.opener.postMessage(&#123;</span></span><br><span class="line"><span class="xquery">      type: <span class="string">'cross-window'</span>,</span></span><br><span class="line"><span class="xquery">     <span class="built_in"> key</span>:<span class="built_in"> key</span>,</span></span><br><span class="line"><span class="xquery">      result: result</span></span><br><span class="line"><span class="xquery">    &#125;</span><span class="xml">, '*')</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ $output æ˜¯å¯¹ access_token æ¥å£ curl å¾—åˆ°çš„è¿”å›å€¼ï¼Œè™½ç„¶å¾®åšç»™çš„è¿”å›å€¼ç†è®ºä¸Šè¯´éƒ½æ˜¯åˆæ³•çš„JSONï¼Œä½†å‡ºäºé€šç”¨è€ƒè™‘æˆ‘è¿˜æ˜¯ç›´æ¥æŠŠå®ƒå½“å­—ç¬¦ä¸²ä¼ é€’ï¼Œè®©å®¢æˆ·ç«¯è‡ªå·±åœ¨ parse çš„æ—¶å€™è¿›è¡Œ try/catch ï¼Œè€Œä¸”è¿™æ ·å¯¹ localStorage ä¹Ÿæ¯”è¾ƒç›´æ¥ã€‚</p>
]]></content>
      <categories>
        <category>ç§»åŠ¨å¼€å‘</category>
      </categories>
      <tags>
        <tag>Cordova</tag>
      </tags>
  </entry>
  <entry>
    <title>é«˜çº§forå¾ªç¯ä½¿ç”¨remove/add é—®é¢˜</title>
    <url>/2017/02/18/%E9%AB%98%E7%BA%A7for%E5%BE%AA%E7%8E%AF%E4%BD%BF%E7%94%A8remove-add-%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä»Šå¤©åœ¨é«˜çº§forå¾ªç¯ä¸­ç”¨äº†ä¸€ä¸‹removeå‘ç°æŠ¥é”™ï¼Œå†™äº†ä¸ªdemoæµ‹è¯•çœ‹ï¼š<br><figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line"> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; a = <span class="literal">new</span> ArrayList&lt;<span class="built_in">String</span>&gt;();</span><br><span class="line"> a.add(<span class="string">"1"</span>);</span><br><span class="line"> a.add(<span class="string">"2"</span>);</span><br><span class="line"> for (<span class="built_in">String</span> temp : a) &#123;</span><br><span class="line">     <span class="keyword">if</span>(<span class="string">"1"</span>.<span class="keyword">equals</span>(temp))&#123;</span><br><span class="line">         a.remove(temp);</span><br><span class="line">&#125; &#125;</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>æ­¤æ—¶ä»£ç æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œè¿è¡Œæ­£å¸¸ï¼›ä½†æ˜¯æŠŠâ€1â€.equals(temp)æ¢æˆâ€2â€.equals(temp)ä¹‹åï¼Œé—®é¢˜å°±å‡ºæ¥äº†ï¼</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java<span class="selector-class">.util</span>.ConcurrentModificationException</span><br><span class="line">	at java<span class="selector-class">.util</span>.ArrayList<span class="variable">$Itr</span>.checkForComodification(ArrayList<span class="selector-class">.java</span>:<span class="number">901</span>)</span><br><span class="line">	at java<span class="selector-class">.util</span>.ArrayList<span class="variable">$Itr</span>.next(ArrayList<span class="selector-class">.java</span>:<span class="number">851</span>)</span><br><span class="line">	at main<span class="selector-class">.exam</span><span class="selector-class">.ForeachTest</span>.main(ForeachTest<span class="selector-class">.java</span>:<span class="number">15</span>)</span><br><span class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.NativeMethodAccessorImpl</span>.invoke0(Native Method)</span><br><span class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.NativeMethodAccessorImpl</span>.invoke(NativeMethodAccessorImpl<span class="selector-class">.java</span>:<span class="number">62</span>)</span><br><span class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.DelegatingMethodAccessorImpl</span>.invoke(DelegatingMethodAccessorImpl<span class="selector-class">.java</span>:<span class="number">43</span>)</span><br><span class="line">	at java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.Method</span>.invoke(Method<span class="selector-class">.java</span>:<span class="number">497</span>)</span><br><span class="line">	at com<span class="selector-class">.intellij</span><span class="selector-class">.rt</span><span class="selector-class">.execution</span><span class="selector-class">.application</span><span class="selector-class">.AppMain</span>.main(AppMain<span class="selector-class">.java</span>:<span class="number">147</span>)</span><br></pre></td></tr></table></figure>
<p> æŠ¥äº†è¿™ä¹ˆä¸€å †å¼‚å¸¸ã€‚</p>
<p>è‡ªå·±æƒ³äº†æƒ³ç”»äº†ä¸ªå›¾ï¼š</p>
<p><img src="http://img.blog.csdn.net/20161229172604530" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>çœ‹å›¾å°±æ˜ç™½äº†ï¼Œ<strong>è¯¥listæ¯å½“åˆ é™¤ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œé›†åˆçš„sizeæ–¹æ³•çš„å€¼éƒ½ä¼šå‡å°1,è¿™å°†ç›´æ¥å¯¼è‡´é›†åˆä¸­å…ƒç´ çš„ç´¢å¼•é‡æ–°æ’åº</strong>ï¼Œè¿›ä¸€æ­¥è¯´ï¼Œå°±æ˜¯å‰©ä½™æ‰€æœ‰å…ƒç´ çš„ç´¢å¼•å€¼éƒ½å‡1ï¼Œæ­£å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè€Œforå¾ªç¯è¯­å¥çš„å±€éƒ¨å˜é‡iä»ç„¶åœ¨é€’å¢ï¼Œè¿™å°†å¯¼è‡´åˆ é™¤æ“ä½œå‘ç”Ÿè·³è·ƒã€‚ä»è€Œå¯¼è‡´ä¸Šè¿°ä»£ç è¿˜æœ‰åˆ é™¤çš„é—®é¢˜ã€‚</p>
<p>æ‰€ä»¥<font color="red">ä¸è¦åœ¨ foreach å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ remove/add æ“ä½œã€‚remove å…ƒç´ è¯·ä½¿ç”¨ Iterator æ–¹å¼ï¼Œå¦‚æœå¹¶å‘æ“ä½œï¼Œéœ€è¦å¯¹ Iterator å¯¹è±¡åŠ é”ã€‚</font>å¦‚ä¸‹ï¼š</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Iterator&lt;String&gt; </span><span class="keyword">it </span>= a.<span class="keyword">iterator(); </span><span class="meta">while</span>(<span class="keyword">it.hasNext())&#123;</span></span><br><span class="line"><span class="keyword">String </span>temp = <span class="keyword">it.next(); </span><span class="meta">if</span>(åˆ é™¤å…ƒç´ çš„æ¡ä»¶)&#123;</span><br><span class="line">        <span class="keyword">it.remove();</span></span><br><span class="line"><span class="keyword"> </span>      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>HashMapé¢è¯•é¢˜æ€»ç»“ï¼</title>
    <url>/2017/02/18/HashMap%E9%9D%A2%E8%AF%95%E9%A2%98%E6%80%BB%E7%BB%93%EF%BC%81/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><strong>HashTableå’ŒHashMapçš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ</strong></p>
<p>HashMapå’ŒHashtableéƒ½å®ç°äº†Mapæ¥å£ï¼Œä½†å†³å®šç”¨å“ªä¸€ä¸ªä¹‹å‰å…ˆè¦å¼„æ¸…æ¥šå®ƒä»¬ä¹‹é—´çš„åˆ†åˆ«ã€‚ä¸»è¦çš„åŒºåˆ«æœ‰ï¼šçº¿ç¨‹å®‰å…¨æ€§ï¼ŒåŒæ­¥(synchronization)ï¼Œä»¥åŠé€Ÿåº¦ã€‚</p>
<p>ç†è§£HashMapæ˜¯Hashtableçš„è½»é‡çº§å®ç°ï¼ˆéçº¿ç¨‹å®‰å…¨çš„å®ç°ï¼Œhashtableæ˜¯éè½»é‡çº§ï¼Œçº¿ç¨‹å®‰å…¨çš„ï¼‰ï¼Œéƒ½å®ç°Mapæ¥å£ï¼Œä¸»è¦åŒºåˆ«åœ¨äºï¼š<br><a id="more"></a><br>1ã€ç”±äºHashMapéçº¿ç¨‹å®‰å…¨ï¼Œåœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®çš„æƒ…å†µä¸‹ï¼Œæ•ˆç‡è¦é«˜äºHashTable</p>
<p>2ã€HashMapå…è®¸å°†nullä½œä¸ºä¸€ä¸ªentryçš„keyæˆ–è€…valueï¼Œè€ŒHashtableä¸å…è®¸ã€‚</p>
<p>3ã€HashMapæŠŠHashtableçš„containsæ–¹æ³•å»æ‰äº†ï¼Œæ”¹æˆcontainsValueå’ŒcontainsKeyã€‚å› ä¸ºcontainsæ–¹æ³•å®¹æ˜“è®©äººå¼•èµ·è¯¯è§£ã€‚</p>
<p>4ã€Hashtableç»§æ‰¿è‡ªé™ˆæ—§çš„Dictionaryç±»ï¼Œè€ŒHashMapæ˜¯Java1.2å¼•è¿›çš„Map çš„ä¸€ä¸ªå®ç°ã€‚</p>
<p>5ã€Hashtableå’ŒHashMapæ‰©å®¹çš„æ–¹æ³•ä¸ä¸€æ ·ï¼ŒHashTableä¸­hashæ•°ç»„é»˜è®¤å¤§å°11ï¼Œæ‰©å®¹æ–¹å¼æ˜¯ old*2+1ã€‚HashMapä¸­hashæ•°ç»„çš„é»˜è®¤å¤§å°æ˜¯16ï¼Œè€Œä¸”ä¸€å®šæ˜¯2çš„æŒ‡æ•°ï¼Œå¢åŠ ä¸ºåŸæ¥çš„2å€ï¼Œæ²¡æœ‰åŠ 1ã€‚</p>
<p>6ã€ä¸¤è€…é€šè¿‡hashå€¼æ•£åˆ—åˆ°hashè¡¨çš„ç®—æ³•ä¸ä¸€æ ·ï¼ŒHashTbaleæ˜¯å¤è€çš„é™¤ç•™ä½™æ•°æ³•ï¼Œç›´æ¥ä½¿ç”¨hashcodeï¼Œè€Œåè€…æ˜¯å¼ºåˆ¶å®¹é‡ä¸º2çš„å¹‚ï¼Œé‡æ–°æ ¹æ®hashcodeè®¡ç®—hashå€¼ï¼Œåœ¨ä½¿ç”¨hash ä½ä¸ ï¼ˆhashè¡¨é•¿åº¦ â€“ 1ï¼‰ï¼Œä¹Ÿç­‰ä»·å–è†œï¼Œä½†æ›´åŠ é«˜æ•ˆï¼Œå–å¾—çš„ä½ç½®æ›´åŠ åˆ†æ•£ï¼Œå¶æ•°ï¼Œå¥‡æ•°ä¿è¯äº†éƒ½ä¼šåˆ†æ•£åˆ°ã€‚å‰è€…å°±ä¸èƒ½ä¿è¯ã€‚</p>
<p>7ã€å¦ä¸€ä¸ªåŒºåˆ«æ˜¯HashMapçš„è¿­ä»£å™¨(Iterator)æ˜¯fail-fastè¿­ä»£å™¨ï¼Œè€ŒHashtableçš„enumeratorè¿­ä»£å™¨ä¸æ˜¯fail-fastçš„ã€‚æ‰€ä»¥å½“æœ‰å…¶å®ƒçº¿ç¨‹æ”¹å˜äº†HashMapçš„ç»“æ„ï¼ˆå¢åŠ æˆ–è€…ç§»é™¤å…ƒç´ ï¼‰ï¼Œå°†ä¼šæŠ›å‡ºConcurrentModificationExceptionï¼Œä½†è¿­ä»£å™¨æœ¬èº«çš„remove()æ–¹æ³•ç§»é™¤å…ƒç´ åˆ™ä¸ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ã€‚ä½†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªä¸€å®šå‘ç”Ÿçš„è¡Œä¸ºï¼Œè¦çœ‹JVMã€‚è¿™æ¡åŒæ ·ä¹Ÿæ˜¯Enumerationå’ŒIteratorçš„åŒºåˆ«ã€‚</p>
<li>fail-fastå’Œiteratorè¿­ä»£å™¨ç›¸å…³ã€‚å¦‚æœæŸä¸ªé›†åˆå¯¹è±¡åˆ›å»ºäº†Iteratoræˆ–è€…ListIteratorï¼Œç„¶åå…¶å®ƒçš„çº¿ç¨‹è¯•å›¾â€œç»“æ„ä¸Šâ€æ›´æ”¹é›†åˆå¯¹è±¡ï¼Œå°†ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ã€‚ä½†å…¶å®ƒçº¿ç¨‹å¯ä»¥é€šè¿‡set()æ–¹æ³•æ›´æ”¹é›†åˆå¯¹è±¡æ˜¯å…è®¸çš„ï¼Œå› ä¸ºè¿™å¹¶æ²¡æœ‰ä»â€œç»“æ„ä¸Šâ€æ›´æ”¹é›†åˆã€‚ä½†æ˜¯å‡å¦‚å·²ç»ä»ç»“æ„ä¸Šè¿›è¡Œäº†æ›´æ”¹ï¼Œå†è°ƒç”¨set()æ–¹æ³•ï¼Œå°†ä¼šæŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸ã€‚</li>

<li>ç»“æ„ä¸Šçš„æ›´æ”¹æŒ‡çš„æ˜¯åˆ é™¤æˆ–è€…æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œè¿™æ ·ä¼šå½±å“åˆ°mapçš„ç»“æ„ã€‚</li>

<p><li>è¯¥æ¡è¯´ç™½äº†å°±æ˜¯åœ¨ä½¿ç”¨è¿­ä»£å™¨çš„è¿‡ç¨‹ä¸­æœ‰å…¶ä»–çº¿ç¨‹åœ¨ç»“æ„ä¸Šä¿®æ”¹äº†mapï¼Œé‚£ä¹ˆå°†æŠ›å‡ºConcurrentModificationExceptionï¼Œè¿™å°±æ˜¯æ‰€è°“fail-fastç­–ç•¥ã€‚</li><br><br><br><strong>ä¸ºä»€ä¹ˆHashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå®é™…ä¼šå¦‚ä½•ä½“ç°ï¼Ÿ</strong></p>
<p>ç¬¬ä¸€ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨putæ–¹æ³•æ·»åŠ å…ƒç´ </p>
<p>å‡è®¾æ­£å¥½å­˜åœ¨ä¸¤ä¸ªputçš„keyå‘ç”Ÿäº†ç¢°æ’(hashå€¼ä¸€æ ·)ï¼Œé‚£ä¹ˆæ ¹æ®HashMapçš„å®ç°ï¼Œè¿™ä¸¤ä¸ªkeyä¼šæ·»åŠ åˆ°æ•°ç»„çš„åŒä¸€ä¸ªä½ç½®ï¼Œè¿™æ ·æœ€ç»ˆå°±ä¼šå‘ç”Ÿå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹çš„putçš„æ•°æ®è¢«è¦†ç›–ã€‚</p>
<p>ç¬¬äºŒï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ£€æµ‹åˆ°å…ƒç´ ä¸ªæ•°è¶…è¿‡æ•°ç»„å¤§å°*loadFactor</p>
<p>è¿™æ ·ä¼šå‘ç”Ÿå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹hashæ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œéƒ½åœ¨é‡æ–°è®¡ç®—å…ƒç´ ä½ç½®ä»¥åŠå¤åˆ¶æ•°æ®ï¼Œä½†æ˜¯æœ€ç»ˆåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰©å®¹åçš„æ•°ç»„ä¼šèµ‹ç»™tableï¼Œä¹Ÿå°±æ˜¯è¯´å…¶ä»–çº¿ç¨‹çš„éƒ½ä¼šä¸¢å¤±ï¼Œå¹¶ä¸”å„è‡ªçº¿ç¨‹putçš„æ•°æ®ä¹Ÿä¸¢å¤±ã€‚ä¸”ä¼šå¼•èµ·æ­»å¾ªç¯çš„é”™è¯¯ã€‚</p>
<p>å…·ä½“ç»†èŠ‚ä¸Šçš„åŸå› ï¼Œå¯ä»¥å‚è€ƒï¼š<a href="http://ifeve.com/hashmap-infinite-loop/" target="_blank" rel="noopener">ä¸æ­£å½“ä½¿ç”¨HashMapå¯¼è‡´cpu 100%çš„é—®é¢˜è¿½ç©¶</a></p>
<p><br><br><strong>èƒ½å¦è®©HashMapå®ç°çº¿ç¨‹å®‰å…¨ï¼Œå¦‚ä½•åšï¼Ÿ</strong></p>
<p>1ã€ç›´æ¥ä½¿ç”¨Hashtableï¼Œä½†æ˜¯å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®HashTableçš„åŒæ­¥æ–¹æ³•æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¦‚æœä¹Ÿè¦è®¿é—®åŒæ­¥æ–¹æ³•ï¼Œä¼šè¢«é˜»å¡ä½ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨putæ–¹æ³•æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸ä½†ä¸å¯ä»¥ä½¿ç”¨putæ–¹æ³•ï¼Œè¿getæ–¹æ³•éƒ½ä¸å¯ä»¥ï¼Œæ•ˆç‡å¾ˆä½ï¼Œç°åœ¨åŸºæœ¬ä¸ä¼šé€‰æ‹©å®ƒäº†ã€‚</p>
<p>2ã€HashMapå¯ä»¥é€šè¿‡ä¸‹é¢çš„è¯­å¥è¿›è¡ŒåŒæ­¥ï¼š</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">Collections.synchronizeMap(hashMap)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>3ã€ç›´æ¥ä½¿ç”¨JDK 5 ä¹‹åçš„ ConcurrentHashMapï¼Œå¦‚æœä½¿ç”¨Java 5æˆ–ä»¥ä¸Šçš„è¯ï¼Œè¯·ä½¿ç”¨ConcurrentHashMapã€‚</p>
<p><br><br><strong>Collections.synchronizeMap(hashMap);åˆæ˜¯å¦‚ä½•ä¿è¯äº†HashMapçº¿ç¨‹å®‰å…¨ï¼Ÿ</strong></p>
<p>ç›´æ¥åˆ†ææºç å§</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="comment">// synchronizedMapæ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;K,V&gt; Map&lt;K,V&gt; synchronizedMap(Map&lt;K,V&gt; m) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> SynchronizedMap&lt;&gt;(m);</span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment">// SynchronizedMapç±»</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> class SynchronizedMap&lt;K,V&gt;</span><br><span class="line">       implements Map&lt;K,V&gt;, Serializable &#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1978198479659022715</span>L;</span><br><span class="line"> </span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;K,V&gt; m;     <span class="comment">// Backing Map</span></span><br><span class="line">       <span class="keyword">final</span> <span class="keyword">Object</span>      mutex;        <span class="comment">// Object on which to synchronize</span></span><br><span class="line"> </span><br><span class="line">       SynchronizedMap(Map&lt;K,V&gt; m) &#123;</span><br><span class="line">           <span class="keyword">this</span>.m = Objects.requireNonNull(m);</span><br><span class="line">           mutex = <span class="keyword">this</span>;</span><br><span class="line">       &#125;</span><br><span class="line"> </span><br><span class="line">       SynchronizedMap(Map&lt;K,V&gt; m, <span class="keyword">Object</span> mutex) &#123;</span><br><span class="line">           <span class="keyword">this</span>.m = m;</span><br><span class="line">           <span class="keyword">this</span>.mutex = mutex;</span><br><span class="line">       &#125;</span><br><span class="line"> </span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">int</span> <span class="built_in">size</span>() &#123;</span><br><span class="line">           <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> m.<span class="built_in">size</span>();&#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">boolean</span> isEmpty() &#123;</span><br><span class="line">           <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> m.isEmpty();&#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">boolean</span> containsKey(<span class="keyword">Object</span> <span class="built_in">key</span>) &#123;</span><br><span class="line">           <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> m.containsKey(<span class="built_in">key</span>);&#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">boolean</span> containsValue(<span class="keyword">Object</span> value) &#123;</span><br><span class="line">           <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> m.containsValue(value);&#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">public</span> V <span class="built_in">get</span>(<span class="keyword">Object</span> <span class="built_in">key</span>) &#123;</span><br><span class="line">           <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> m.<span class="built_in">get</span>(<span class="built_in">key</span>);&#125;</span><br><span class="line">       &#125;</span><br><span class="line"> </span><br><span class="line">       <span class="keyword">public</span> V put(K <span class="built_in">key</span>, V value) &#123;</span><br><span class="line">           <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> m.put(<span class="built_in">key</span>, value);&#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">public</span> V remove(<span class="keyword">Object</span> <span class="built_in">key</span>) &#123;</span><br><span class="line">           <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> m.remove(<span class="built_in">key</span>);&#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// çœç•¥å…¶ä»–æ–¹æ³•</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>ä»æºç ä¸­çœ‹å‡º synchronizedMap()æ–¹æ³•è¿”å›ä¸€ä¸ªSynchronizedMapç±»çš„å¯¹è±¡ï¼Œè€Œåœ¨SynchronizedMapç±»ä¸­ä½¿ç”¨äº†synchronizedæ¥ä¿è¯å¯¹Mapçš„æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ•…æ•ˆç‡å…¶å®ä¹Ÿä¸é«˜ã€‚</p>
<p><br><br><strong>ä¸ºä»€ä¹ˆHashTableçš„é»˜è®¤å¤§å°å’ŒHashMapä¸ä¸€æ ·ï¼Ÿ</strong></p>
<p>å‰é¢åˆ†æäº†ï¼ŒHashtable çš„æ‰©å®¹æ–¹æ³•æ˜¯ä¹˜2å†+1ï¼Œä¸æ˜¯ç®€å•çš„ä¹˜2ï¼Œæ•…hashtableä¿è¯äº†å®¹é‡æ°¸è¿œæ˜¯å¥‡æ•°ï¼Œç»“åˆä¹‹å‰åˆ†æhashmapçš„é‡ç®—hashå€¼çš„é€»è¾‘ï¼Œå°±æ˜ç™½äº†ï¼Œå› ä¸ºåœ¨æ•°æ®åˆ†å¸ƒåœ¨ç­‰å·®æ•°æ®é›†åˆ(å¦‚å¶æ•°)ä¸Šæ—¶ï¼Œå¦‚æœå…¬å·®ä¸æ¡¶å®¹é‡æœ‰å…¬çº¦æ•° nï¼Œåˆ™è‡³å°‘æœ‰(n-1)/n æ•°é‡çš„æ¡¶æ˜¯åˆ©ç”¨ä¸åˆ°çš„ï¼Œæ•…ä¹‹å‰çš„hashmap ä¼šåœ¨å–æ¨¡ï¼ˆä½¿ç”¨ä½ä¸è¿ç®—ä»£æ›¿ï¼‰å“ˆå¸Œå‰å…ˆåšä¸€æ¬¡å“ˆå¸Œè¿ç®—ï¼Œè°ƒæ•´hashå€¼ã€‚è¿™é‡Œhashtableæ¯”è¾ƒå¤è€ï¼Œç›´æ¥ä½¿ç”¨äº†é™¤ç•™ä½™æ•°æ³•ï¼Œé‚£ä¹ˆå°±éœ€è¦è®¾ç½®å®¹é‡èµ·ç ä¸æ˜¯å¶æ•°ï¼ˆé™¤ï¼ˆè¿‘ä¼¼ï¼‰è´¨æ•°æ±‚ä½™çš„åˆ†æ•£æ•ˆæœå¥½ï¼‰ã€‚è€ŒJDKå¼€å‘è€…é€‰äº†11ã€‚</p>
<font color="red">æ„Ÿè§‰é’ˆå¯¹Javaçš„hashmapå’Œhashtableé¢è¯•ï¼Œæˆ–è€…ç†è§£ï¼Œåˆ°è¿™é‡Œå°±å¯ä»¥äº†ï¼Œå…·ä½“å°±æ˜¯å¤šå†™ä»£ç å®è·µã€‚</font>]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>é›†åˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆHashMap</title>
    <url>/2017/02/18/%E6%B5%85%E8%B0%88HashMap/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><strong>ä»€ä¹ˆæ˜¯Map?</strong></p>
<font color="#008080">Mapç”¨äºä¿å­˜å…·æœ‰key-valueæ˜ å°„å…³ç³»çš„æ•°æ®</font><br><a id="more"></a><br>é¦–å…ˆçœ‹å›¾ï¼<br><br><img src="http://img.blog.csdn.net/20161224234534698" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"><br><br>å¯ä»¥çœ‹å‡ºJava ä¸­æœ‰å››ç§å¸¸è§çš„Mapå®ç°â€”â€”HashMap, TreeMap, Hashtableå’ŒLinkedHashMapï¼š<br><br>Â·HashMapå°±æ˜¯ä¸€å¼ hashè¡¨ï¼Œé”®å’Œå€¼éƒ½æ²¡æœ‰æ’åºã€‚<br><br>Â·TreeMapä»¥çº¢é»‘æ ‘ç»“æ„ä¸ºåŸºç¡€ï¼Œé”®å€¼å¯ä»¥è®¾ç½®æŒ‰æŸç§é¡ºåºæ’åˆ—ã€‚<br><br>Â·LinkedHashMapä¿å­˜äº†æ’å…¥æ—¶çš„é¡ºåºã€‚<br><br>Â·Hashtableæ˜¯åŒæ­¥çš„(è€ŒHashMapæ˜¯ä¸åŒæ­¥çš„)ã€‚æ‰€ä»¥å¦‚æœåœ¨çº¿ç¨‹å®‰å…¨çš„ç¯å¢ƒä¸‹åº”è¯¥å¤šä½¿ç”¨HashMapï¼Œè€Œä¸æ˜¯Hashtableï¼Œå› ä¸ºHashtableå¯¹åŒæ­¥æœ‰é¢å¤–çš„å¼€é”€ã€‚<br><br><br><strong>æˆ‘ä»¬åœ¨è¿™é‡Œç®€å•çš„è¯´è¯´HashMapï¼š</strong><br><br>(1)HashMapæ˜¯åŸºäºå“ˆå¸Œè¡¨å®ç°çš„ï¼Œæ¯ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªkey-valueå¯¹ï¼Œå…¶å†…éƒ¨é€šè¿‡å•é“¾è¡¨è§£å†³å†²çªé—®é¢˜ï¼Œå®¹é‡ä¸è¶³ï¼ˆè¶…è¿‡äº†é˜€å€¼ï¼‰æ—¶ï¼ŒåŒæ ·ä¼šè‡ªåŠ¨å¢é•¿ã€‚<br><br>(2)HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œåªç”¨äºå•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯ä»¥é‡‡ç”¨concurrentå¹¶å‘åŒ…ä¸‹çš„concurrentHashMapã€‚<br><br>(3)HashMap å®ç°äº†Serializableæ¥å£ï¼Œå› æ­¤å®ƒæ”¯æŒåºåˆ—åŒ–ã€‚<br><br>(4)HashMapè¿˜å®ç°äº†Cloneableæ¥å£ï¼Œæ•…èƒ½è¢«å…‹éš†ã€‚<br><br><br><br>å…ˆä»<strong>HashMapçš„å­˜å‚¨ç»“æ„</strong>è¯´èµ·ï¼š<br><br><img src="http://img.blog.csdn.net/20161224235308725" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"><br><br>è“è‰²éƒ¨åˆ†å³ä»£è¡¨å“ˆå¸Œè¡¨æœ¬èº«ï¼ˆå…¶å®æ˜¯ä¸€ä¸ªæ•°ç»„ï¼‰ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œé“¾è¡¨æ˜¯ç”¨æ¥è§£å†³hashåœ°å€å†²çªçš„ï¼Œå¦‚æœä¸åŒçš„keyæ˜ å°„åˆ°äº†æ•°ç»„çš„åŒä¸€ä½ç½®å¤„ï¼Œå°±å°†å…¶æ”¾å…¥å•é“¾è¡¨ä¸­ä¿å­˜ã€‚<br><br><strong>HashMapçš„æ„é€ æ–¹æ³•ä¸­æœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„å‚æ•°ï¼š</strong><font color="#008080">åˆå§‹å®¹é‡å’ŒåŠ è½½å› å­</font>

<p>è¿™ä¸¤ä¸ªå‚æ•°æ˜¯å½±å“HashMapæ€§èƒ½çš„é‡è¦å‚æ•°ï¼Œå…¶ä¸­å®¹é‡è¡¨ç¤ºå“ˆå¸Œè¡¨ä¸­æ§½çš„æ•°é‡ï¼ˆå³å“ˆå¸Œæ•°ç»„çš„é•¿åº¦ï¼‰ï¼Œåˆå§‹å®¹é‡æ˜¯åˆ›å»ºå“ˆå¸Œè¡¨æ—¶çš„å®¹é‡ï¼ˆé»˜è®¤ä¸º16ï¼‰ï¼ŒåŠ è½½å› å­æ˜¯å“ˆå¸Œè¡¨å½“å‰keyçš„æ•°é‡å’Œå®¹é‡çš„æ¯”å€¼ï¼Œå½“å“ˆå¸Œè¡¨ä¸­çš„æ¡ç›®æ•°è¶…å‡ºäº†åŠ è½½å› å­ä¸å½“å‰å®¹é‡çš„ä¹˜ç§¯æ—¶ï¼Œåˆ™è¦å¯¹è¯¥å“ˆå¸Œè¡¨æå‰è¿›è¡Œ resize æ“ä½œï¼ˆå³æ‰©å®¹ï¼‰ã€‚å¦‚æœåŠ è½½å› å­è¶Šå¤§ï¼Œå¯¹ç©ºé—´çš„åˆ©ç”¨æ›´å……åˆ†ï¼Œä½†æ˜¯æŸ¥æ‰¾æ•ˆç‡ä¼šé™ä½ï¼ˆé“¾è¡¨é•¿åº¦ä¼šè¶Šæ¥è¶Šé•¿ï¼‰ï¼›å¦‚æœåŠ è½½å› å­å¤ªå°ï¼Œé‚£ä¹ˆè¡¨ä¸­çš„æ•°æ®å°†è¿‡äºç¨€ç–ï¼ˆå¾ˆå¤šç©ºé—´è¿˜æ²¡ç”¨ï¼Œå°±å¼€å§‹æ‰©å®¹äº†ï¼‰ï¼Œä¸¥é‡æµªè´¹ã€‚</p>
<p>JDKå¼€å‘è€…è§„å®šçš„é»˜è®¤åŠ è½½å› å­ä¸º0.75ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç†æƒ³çš„å€¼ã€‚å¦å¤–ï¼Œæ— è®ºæŒ‡å®šåˆå§‹å®¹é‡ä¸ºå¤šå°‘ï¼Œæ„é€ æ–¹æ³•éƒ½ä¼šå°†å®é™…å®¹é‡è®¾ä¸ºä¸å°äºæŒ‡å®šå®¹é‡çš„2çš„å¹‚æ¬¡æ–¹ï¼Œä¸”æœ€å¤§å€¼ä¸èƒ½è¶…è¿‡2çš„30æ¬¡æ–¹ã€‚</p>
<p><strong>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹HashMapä¸­ç”¨çš„æœ€å¤šçš„ä¸¤ä¸ªæ–¹æ³•putå’Œgetçš„æºç </strong></p>
<blockquote>
<p>get()ï¼š</p>
</blockquote>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–keyå¯¹åº”çš„value</span></span><br><span class="line">    <span class="keyword">public</span> V <span class="built_in">get</span>(<span class="keyword">Object</span> <span class="built_in">key</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">key</span> == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> getForNullKey();</span><br><span class="line">        <span class="comment">// è·å–keyçš„hashå€¼</span></span><br><span class="line">        <span class="built_in">int</span> hash = hash(<span class="built_in">key</span>.hashCode());</span><br><span class="line">        <span class="comment">// åœ¨â€œè¯¥hashå€¼å¯¹åº”çš„é“¾è¡¨â€ä¸ŠæŸ¥æ‰¾â€œé”®å€¼ç­‰äºkeyâ€çš„å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;K, V&gt; e = table[indexFor(hash, table.length)]; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">            <span class="keyword">Object</span> k;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­keyæ˜¯å¦ç›¸åŒ</span></span><br><span class="line">            <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.<span class="built_in">key</span>) == <span class="built_in">key</span> || <span class="built_in">key</span>.equals(k)))</span><br><span class="line">                <span class="keyword">return</span> e.value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ²¡æ‰¾åˆ°åˆ™è¿”å›null</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–â€œkeyä¸ºnullâ€çš„å…ƒç´ çš„å€¼ï¼ŒHashMapå°†â€œkeyä¸ºnullâ€çš„å…ƒç´ å­˜å‚¨åœ¨table[0]ä½ç½®ï¼Œä½†ä¸ä¸€å®šæ˜¯è¯¥é“¾è¡¨çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼</span></span><br><span class="line">    <span class="keyword">private</span> V getForNullKey() &#123;</span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;K, V&gt; e = table[<span class="number">0</span>]; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e.<span class="built_in">key</span> == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span> e.value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œå¦‚æœkeyä¸ºnullï¼Œåˆ™ç›´æ¥ä»å“ˆå¸Œè¡¨çš„ç¬¬ä¸€ä¸ªä½ç½®table[0]å¯¹åº”çš„é“¾è¡¨ä¸ŠæŸ¥æ‰¾ã€‚è®°ä½ï¼Œkeyä¸ºnullçš„é”®å€¼å¯¹æ°¸è¿œéƒ½æ”¾åœ¨ä»¥table[0]ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨ä¸­ï¼Œå½“ç„¶ä¸ä¸€å®šæ˜¯å­˜æ”¾åœ¨å¤´ç»“ç‚¹table[0]ä¸­ã€‚å¦‚æœkeyä¸ä¸ºnullï¼Œåˆ™å…ˆæ±‚çš„keyçš„hashå€¼ï¼Œæ ¹æ®hashå€¼æ‰¾åˆ°åœ¨tableä¸­çš„ç´¢å¼•ï¼Œåœ¨è¯¥ç´¢å¼•å¯¹åº”çš„å•é“¾è¡¨ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰é”®å€¼å¯¹çš„keyä¸ç›®æ ‡keyç›¸ç­‰ï¼Œæœ‰å°±è¿”å›å¯¹åº”çš„valueï¼Œæ²¡æœ‰åˆ™è¿”å›nullã€‚</p>
<blockquote>
<p>put()ï¼š<br></p>
</blockquote>
<figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line">// å°†<span class="built_in">â€œkey</span>-<span class="keyword">value</span>â€æ·»åŠ åˆ°HashMapä¸­</span><br><span class="line">    public V put(K<span class="built_in"> key</span>, V <span class="keyword">value</span>) &#123;</span><br><span class="line">        // è‹¥<span class="built_in">â€œkey</span>ä¸ºnullâ€ï¼Œåˆ™å°†è¯¥é”®å€¼å¯¹æ·»åŠ åˆ°table[<span class="number">0</span>]ä¸­ã€‚</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">(key</span> == null)</span><br><span class="line">            <span class="keyword">return</span> putForNullKey(<span class="keyword">value</span>);</span><br><span class="line">        // è‹¥<span class="built_in">â€œkey</span>ä¸ä¸ºnullâ€ï¼Œåˆ™è®¡ç®—<span class="built_in">è¯¥key</span>çš„å“ˆå¸Œå€¼ï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°è¯¥å“ˆå¸Œå€¼å¯¹åº”çš„é“¾è¡¨ä¸­ã€‚</span><br><span class="line">        int hash = hash<span class="built_in">(key</span>.hashCode());</span><br><span class="line">        int i = indexFor(hash, table.length);</span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;K, V&gt; e = table[i]; e != null; e = e.<span class="keyword">next</span>) &#123;</span><br><span class="line">            Object k;</span><br><span class="line">            // è‹¥â€œ<span class="built_in">è¯¥key</span>â€å¯¹åº”çš„é”®å€¼å¯¹å·²ç»å­˜åœ¨ï¼Œåˆ™ç”¨æ–°çš„<span class="keyword">value</span>å–ä»£æ—§çš„<span class="keyword">value</span>ã€‚ç„¶åé€€å‡ºï¼</span><br><span class="line">            <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e<span class="built_in">.key</span>) ==<span class="built_in"> key</span> ||<span class="built_in"> key</span>.equals(k))) &#123;</span><br><span class="line">                V oldValue = e.<span class="keyword">value</span>;</span><br><span class="line">                e.<span class="keyword">value</span> = <span class="keyword">value</span>;</span><br><span class="line">                e.recordAccess(this);</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // è‹¥â€œ<span class="built_in">è¯¥key</span>â€å¯¹åº”çš„é”®å€¼å¯¹ä¸å­˜åœ¨ï¼Œåˆ™å°†<span class="built_in">â€œkey</span>-<span class="keyword">value</span>â€æ·»åŠ åˆ°tableä¸­</span><br><span class="line">        modCount++;</span><br><span class="line">        // <span class="built_in">å°†key</span>-<span class="keyword">value</span>æ·»åŠ åˆ°table[i]å¤„</span><br><span class="line">        addEntry(hash,<span class="built_in"> key</span>, <span class="keyword">value</span>, i);</span><br><span class="line">        <span class="keyword">return</span> null;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœkeyä¸ºnullï¼Œåˆ™å°†å…¶æ·»åŠ åˆ°table[0]å¯¹åº”çš„é“¾è¡¨ä¸­ï¼Œå¦‚æœkeyä¸ä¸ºnullï¼Œåˆ™åŒæ ·å…ˆæ±‚å‡ºkeyçš„hashå€¼ï¼Œæ ¹æ®hashå€¼å¾—å‡ºåœ¨tableä¸­çš„ç´¢å¼•ï¼Œè€Œåéå†å¯¹åº”çš„å•é“¾è¡¨ï¼Œå¦‚æœå•é“¾è¡¨ä¸­å­˜åœ¨ä¸ç›®æ ‡keyç›¸ç­‰çš„é”®å€¼å¯¹ï¼Œåˆ™å°†æ–°çš„valueè¦†ç›–æ—§çš„valueï¼Œä¸”å°†æ—§çš„valueè¿”å›ï¼Œå¦‚æœæ‰¾ä¸åˆ°ä¸ç›®æ ‡keyç›¸ç­‰çš„é”®å€¼å¯¹ï¼Œæˆ–è€…è¯¥å•é“¾è¡¨ä¸ºç©ºï¼Œåˆ™å°†è¯¥é”®å€¼å¯¹æ’å…¥åˆ°å•é“¾è¡¨çš„å¤´ç»“ç‚¹ä½ç½®ï¼ˆæ¯æ¬¡æ–°æ’å…¥çš„èŠ‚ç‚¹éƒ½æ˜¯æ”¾åœ¨å¤´ç»“ç‚¹çš„ä½ç½®ï¼‰ï¼Œè¯¥æ“ä½œæ˜¯æœ‰addEntryæ–¹æ³•å®ç°çš„ï¼Œå®ƒçš„æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–°å¢Entryã€‚å°†â€œkey-valueâ€æ’å…¥æŒ‡å®šä½ç½®ï¼ŒbucketIndexæ˜¯ä½ç½®ç´¢å¼•ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addEntry</span>(<span class="params"><span class="keyword">int</span> hash, K key, V <span class="keyword">value</span>, <span class="keyword">int</span> bucketIndex</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¿å­˜â€œbucketIndexâ€ä½ç½®çš„å€¼åˆ°â€œeâ€ä¸­</span></span><br><span class="line">        Entry&lt;K, V&gt; e = table[bucketIndex];</span><br><span class="line">        <span class="comment">// è®¾ç½®â€œbucketIndexâ€ä½ç½®çš„å…ƒç´ ä¸ºâ€œæ–°Entryâ€ï¼Œ</span></span><br><span class="line">        <span class="comment">// è®¾ç½®â€œeâ€ä¸ºâ€œæ–°Entryçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹â€</span></span><br><span class="line">        table[bucketIndex] = <span class="keyword">new</span> Entry&lt;K, V&gt;(hash, key, <span class="keyword">value</span>, e);</span><br><span class="line">        <span class="comment">// è‹¥HashMapçš„å®é™…å¤§å° ä¸å°äº â€œé˜ˆå€¼â€ï¼Œåˆ™è°ƒæ•´HashMapçš„å¤§å°</span></span><br><span class="line">        <span class="keyword">if</span> (size++ &gt;= threshold)</span><br><span class="line">            resize(<span class="number">2</span> * table.length);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„è¿™é‡Œå€’æ•°ç¬¬ä¸‰è¡Œçš„æ„é€ æ–¹æ³•ï¼Œå°†key-valueé”®å€¼å¯¹èµ‹ç»™table[bucketIndex]ï¼Œå¹¶å°†å…¶nextæŒ‡å‘å…ƒç´ eï¼Œè¿™ä¾¿å°†key-valueæ”¾åˆ°äº†å¤´ç»“ç‚¹ä¸­ï¼Œå¹¶å°†ä¹‹å‰çš„å¤´ç»“ç‚¹æ¥åœ¨äº†å®ƒçš„åé¢ã€‚è¯¥æ–¹æ³•ä¹Ÿè¯´æ˜ï¼Œæ¯æ¬¡puté”®å€¼å¯¹çš„æ—¶å€™ï¼Œæ€»æ˜¯å°†æ–°çš„è¯¥é”®å€¼å¯¹æ”¾åœ¨table[bucketIndex]å¤„ï¼ˆå³å¤´ç»“ç‚¹å¤„ï¼‰ã€‚ä¸¤å¤–æ³¨æ„æœ€åä¸¤è¡Œä»£ç ï¼Œæ¯æ¬¡åŠ å…¥é”®å€¼å¯¹æ—¶ï¼Œéƒ½è¦åˆ¤æ–­å½“å‰å·²ç”¨çš„æ§½çš„æ•°ç›®æ˜¯å¦å¤§äºç­‰äºé˜€å€¼ï¼ˆå®¹é‡*åŠ è½½å› å­ï¼‰ï¼Œå¦‚æœå¤§äºç­‰äºï¼Œåˆ™è¿›è¡Œæ‰©å®¹ï¼Œå°†å®¹é‡æ‰©ä¸ºåŸæ¥å®¹é‡çš„2å€ã€‚</p>
<font color="#008080"><strong>æ¥ä¸‹æ¥é‡ç‚¹æ¥åˆ†æä¸‹æ±‚hashå€¼å’Œç´¢å¼•å€¼çš„æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¾¿æ˜¯HashMapè®¾è®¡çš„æœ€ä¸ºæ ¸å¿ƒçš„éƒ¨åˆ†ï¼ŒäºŒè€…ç»“åˆèƒ½ä¿è¯å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ å°½å¯èƒ½å‡åŒ€åœ°æ•£åˆ—ã€‚</strong></font>

<blockquote>
<p>ç”±hashå€¼æ‰¾åˆ°å¯¹åº”ç´¢å¼•çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexFor</span><span class="params">(<span class="keyword">int</span> h, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> h &amp; (length<span class="number">-1</span>);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºå®¹é‡åˆå§‹è¿˜æ˜¯è®¾å®šéƒ½ä¼šè½¬åŒ–ä¸º2çš„å¹‚æ¬¡ã€‚æ•…å¯ä»¥ä½¿ç”¨é«˜æ•ˆçš„ä½ä¸è¿ç®—æ›¿ä»£æ¨¡è¿ç®—ã€‚</p>
<blockquote>
<p>è®¡ç®—hashå€¼çš„æ–¹æ³•å¦‚ä¸‹:</p>
</blockquote>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">static</span> int hash(int h) &#123;</span><br><span class="line">           <span class="attribute">h</span><span class="regexp"> ^=</span> (h &gt;&gt;&gt; <span class="number">20</span>)<span class="regexp"> ^</span> (h &gt;&gt;&gt; <span class="number">12</span>);</span><br><span class="line">           <span class="attribute">return</span> h<span class="regexp"> ^</span> (h &gt;&gt;&gt; <span class="number">7</span>)<span class="regexp"> ^</span> (h &gt;&gt;&gt; <span class="number">4</span>);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>JDK çš„ HashMap ä½¿ç”¨äº†ä¸€ä¸ª hash æ–¹æ³•å¯¹hashå€¼ä½¿ç”¨ä½çš„æ“ä½œï¼Œä½¿hashå€¼çš„è®¡ç®—æ•ˆç‡å¾ˆé«˜ã€‚ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿä¸»è¦æ˜¯å› ä¸ºå¦‚æœç›´æ¥ä½¿ç”¨hashcodeå€¼ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªintå€¼ï¼ˆ8ä¸ª16è¿›åˆ¶æ•°ï¼Œå…±32ä½ï¼‰ï¼Œintå€¼çš„èŒƒå›´æ­£è´Ÿ21äº¿å¤šï¼Œä½†æ˜¯hashè¡¨æ²¡æœ‰é‚£ä¹ˆé•¿ï¼Œä¸€èˆ¬æ¯”å¦‚åˆå§‹16ï¼Œè‡ªç„¶æ•£åˆ—åœ°å€éœ€è¦å¯¹hashè¡¨é•¿åº¦å–æ¨¡è¿ç®—ï¼Œå¾—åˆ°çš„ä½™æ•°æ‰æ˜¯åœ°å€ä¸‹æ ‡ã€‚å‡è®¾æŸä¸ªkeyçš„hashcodeæ˜¯0AAA0000ï¼Œhashæ•°ç»„é•¿é»˜è®¤16ï¼Œå¦‚æœä¸ç»è¿‡hashå‡½æ•°å¤„ç†ï¼Œè¯¥é”®å€¼å¯¹ä¼šè¢«å­˜æ”¾åœ¨hashæ•°ç»„ä¸­ä¸‹æ ‡ä¸º0å¤„ï¼Œå› ä¸º0AAA0000 &amp; (16-1) = 0ã€‚è¿‡äº†ä¸€ä¼šå„¿åˆå­˜å‚¨å¦å¤–ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå…¶keyçš„hashcodeæ˜¯0BBB0000ï¼Œå¾—åˆ°æ•°ç»„ä¸‹æ ‡ä¾ç„¶æ˜¯0ï¼Œè¿™å°±è¯´æ˜è¿™æ˜¯ä¸ªå®ç°å¾—å¾ˆå·®çš„hashç®—æ³•ï¼Œå› ä¸ºhashcodeçš„1ä½å…¨é›†ä¸­åœ¨å‰16ä½äº†ï¼Œå¯¼è‡´ç®—å‡ºæ¥çš„æ•°ç»„ä¸‹æ ‡ä¸€ç›´æ˜¯0ã€‚<font color="red">äºæ˜¯æ˜æ˜keyç›¸å·®å¾ˆå¤§çš„é”®å€¼å¯¹ï¼Œå´å­˜æ”¾åœ¨äº†åŒä¸€ä¸ªé“¾è¡¨é‡Œï¼Œå¯¼è‡´ä»¥åæŸ¥è¯¢èµ·æ¥æ¯”è¾ƒæ…¢ï¼ˆèœ•åŒ–ä¸ºäº†é¡ºåºæŸ¥æ‰¾ï¼‰ã€‚æ•…JDKçš„è®¾è®¡è€…ä½¿ç”¨hashå‡½æ•°çš„è‹¥å¹²æ¬¡çš„ç§»ä½ã€å¼‚æˆ–æ“ä½œï¼ŒæŠŠhashcodeçš„â€œ1ä½â€å˜å¾—â€œæ¾æ•£â€ï¼Œéå¸¸å·§å¦™ã€‚</font></p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>é›†åˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>nginx åŸºæœ¬å…¥é—¨(è‡³ä»Šä¸ºæ­¢è§è¿‡æœ€å¥½çš„ nginx å…¥é—¨æ–‡ç« ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚)</title>
    <url>/2017/02/18/nginx-%E5%9F%BA%E6%9C%AC%E5%85%A5%E9%97%A8-%E8%87%B3%E4%BB%8A%E4%B8%BA%E6%AD%A2%E8%A7%81%E8%BF%87%E6%9C%80%E5%A5%BD%E7%9A%84-nginx-%E5%85%A5%E9%97%A8%E6%96%87%E7%AB%A0%EF%BC%8C%E6%B2%A1%E6%9C%89%E4%B9%8B%E4%B8%80%E3%80%82/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><blockquote>
<p>æœ¬æ–‡è½¬è‡ª<a href="http://www.jianshu.com/p/93ac21161ac6" target="_blank" rel="noopener">StuQ</a> </p>
</blockquote>
<p><br><br>è¿™ç¯‡æ•™ç¨‹ç®€å•ä»‹ç»äº† nginx å¹¶ä¸”è®²è§£äº†ä¸€äº› nginx å¯ä»¥è§£å†³çš„ç®€å•ä»»åŠ¡ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å‡è®¾ nginx å·²ç»å®‰è£…åœ¨è¯»è€…çš„æœºå™¨ä¸Šã€‚å¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹å¦‚ä½•å®‰è£… nginxã€‚è¿™ç¯‡æ•™ç¨‹ä¸»è¦è®²è§£çš„æ˜¯å¦‚æœå¯ç”¨å’Œåœæ­¢ ngixnï¼Œå’Œé‡æ–°åŠ è½½é…ç½®ï¼Œæè¿°é…ç½®æ–‡ä»¶çš„åŸºæœ¬ç»“æ„å’Œæ€æ ·æ­å»ºä¸€ä¸ª nginx é™æ€è¾…åŠ©å™¨ï¼Œæ€æ ·é…ç½® nginx ä½œä¸ºä¸€ä¸ªä»£ç†æœåŠ¡å™¨æ¥ã€‚ nginx æœ‰ä¸€ä¸ªä¸»è¿›ç¨‹å’Œå…¶ä»–å­è¿›ç¨‹ã€‚ä¸»è¿›ç¨‹çš„ä¸»è¦å·¥ä½œæ˜¯åŠ è½½å’Œæ‰§è¡Œé…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”é©»ç•™å­è¿›ç¨‹ã€‚å­è¿›ç¨‹ç”¨æ¥ä½œä¸ºå®é™…çš„è¯·æ±‚å¤„ç†ã€‚nginx é‡‡å–åŸºäºäº‹ä»¶çš„æ¨¡å‹å’Œ OS ä¾èµ–çš„æœºåˆ¶ï¼Œåœ¨å¤šä¸ªå­è¿›ç¨‹ä¹‹é—´é«˜æ•ˆçš„åˆ†é…è¯·æ±‚ã€‚å­è¿›ç¨‹çš„ä¸ªæ•°ä¼šç›´æ¥å†™åœ¨é…ç½®æ–‡ä»¶ä¸­å¹¶ä¸”ï¼Œå¯¹äºç»™å®šçš„é…ç½®å¯ä»¥æ˜¯å›ºå®šçš„ï¼Œæˆ–è€…æ ¹æ®å¯ç”¨çš„ CPU æ ¸æ•°è‡ªåŠ¨çš„è¿›è¡Œè°ƒæ•´ï¼ˆå‚è€ƒå­è¿›ç¨‹ï¼‰ã€‚ nginx å’Œå®ƒæ¨¡å—çš„å·¥ä½œæ–¹å¼æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­å†™å¥½çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶é€šå¸¸å‘½åä¸º nginx.conf å¹¶ä¸”ä¼šæ”¾ç½®åœ¨ /usr/local/nginx/confï¼Œ/etc/nginxï¼Œæˆ–è€… /usr/local/etc/nginxã€‚<br><a id="more"></a><br>å¯ç”¨ï¼Œåœæ­¢å’Œé‡è½½é…ç½®</p>
<p>è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶å°±å¯ä»¥å¼€å¯ nginxï¼Œæ¯”å¦‚:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="comment">// -c ä¸º nginx çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">nginx -c/usr/<span class="keyword">local</span>/nginx/<span class="keyword">conf</span>/nginx.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœï¼Œnginx å·²ç»å¼€å¯ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥é€šè¿‡ä½¿ç”¨ -s å‚æ•°çš„å¯æ‰§è¡Œå‘½ä»¤æ§åˆ¶ã€‚ä½¿ç”¨ä¸‹åˆ—æ ¼å¼ï¼š</p>
<figure class="highlight qml"><table><tr><td class="code"><pre><span class="line">nginx -s <span class="keyword">signal</span><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>signal å¯ä»¥ä¸ºä¸‹åˆ—å‘½ä»¤ä¹‹ä¸€ï¼š</p>
<p>stop â€” ç›´æ¥å…³é—­ nginx</p>
<p>quit â€” ä¼šåœ¨å¤„ç†å®Œå½“å‰æ­£åœ¨çš„è¯·æ±‚åé€€å‡ºï¼Œä¹Ÿå«ä¼˜é›…å…³é—­</p>
<p>reload â€” é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œç›¸å½“äºé‡å¯</p>
<p>reopen â€” é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ æ¯”å¦‚ï¼Œç­‰å¾…å½“å‰å­è¿›ç¨‹å¤„ç†å®Œæ­£åœ¨æ‰§è¡Œçš„è¯·æ±‚åï¼Œç»“æŸ nginx è¿›ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤ï¼š</p>
<figure class="highlight cos"><table><tr><td class="code"><pre><span class="line">nginx -<span class="keyword">s</span> <span class="keyword">quit</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè¯¥å‘½ä»¤çš„ç”¨æˆ·éœ€è¦å’Œå¯åŠ¨çš„ nginx çš„ç”¨æˆ·ä¸€è‡´ã€‚ å¦‚æœé‡è½½é…ç½®æ–‡ä»¶çš„å‘½ä»¤æ²¡æœ‰ä¼ é€’ç»™ nginx æˆ–è€… nginx æ²¡æœ‰é‡å¯ï¼Œé‚£ä¹ˆé…ç½®æ–‡ä»¶çš„æ”¹åŠ¨æ˜¯ä¸ä¼šè¢«ä½¿ç”¨çš„ã€‚é‡è½½é…ç½®æ–‡ä»¶çš„å‘½ä»¤å¯ä»¥ä½¿ç”¨ï¼š</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nginx -s reload</span></span><br></pre></td></tr></table></figure>
<p>ä¸€æ—¦ä¸»è¿›ç¨‹æ¥æ”¶åˆ°é‡è½½é…ç½®æ–‡ä»¶çš„å‘½ä»¤åï¼Œå®ƒä¼šå…ˆæ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•çš„åˆæ³•æ€§ï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™ä¼šé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™ä¸»è¿›ç¨‹ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹å¹¶ä¸”å‘é€å…³é—­è¯·æ±‚ç»™ä»¥å‰çš„å­è¿›ç¨‹ã€‚å¦‚æœæ²¡æœ‰æˆåŠŸï¼Œä¸»è¿›ç¨‹ä¼šå›æ»šæ”¹åŠ¨å¹¶ä¸”ç»§ç»­ä½¿ç”¨ä»¥å‰çš„é…ç½®ã€‚è€çš„å­è¿›ç¨‹åœ¨æ¥å—å…³é—­çš„å‘½ä»¤åï¼Œä¼šåœæ­¢æ¥å—æ–°çš„è¯·æ±‚å¹¶ä¸”ç»§ç»­å¤„ç†å½“å‰çš„è¯·æ±‚ï¼Œç›´åˆ°å¤„ç†å®Œæ¯•ã€‚ä¹‹åï¼Œè¯¥å­è¿›ç¨‹å°±ç›´æ¥é€€å‡ºäº†ã€‚ åœ¨ Unix å·¥å…·çš„å¸®åŠ©ä¸‹ï¼Œæ¯”å¦‚ä½¿ç”¨ kill å·¥å…·ï¼Œè¯¥ä¿¡å·ä¼šè¢«å‘é€ç»™ nginx è¿›ç¨‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¿¡å·ä¼šè¢«ç›´æ¥å‘é€ç»™å¸¦æœ‰è¿›ç¨‹ ID çš„è¿›ç¨‹ã€‚nginx çš„ä¸»è¿›ç¨‹çš„è¿›ç¨‹ ID æ˜¯å†™æ­»åœ¨ nginx.pid æ–‡ä»¶ä¸­çš„ã€‚è¯¥æ–‡ä»¶é€šå¸¸æ”¾åœ¨ /usr/local/nginx/logs æˆ–è€… /var/run ç›®å½•ä¸‹ã€‚æ¯”å¦‚ï¼Œå¦‚æœä¸»è¿›ç¨‹çš„ ID æ˜¯ 1628ï¼Œä¸ºäº†å‘é€ QUIT ä¿¡å·æ¥ä½¿ nginx ä¼˜é›…é€€å‡ºï¼Œå¯ä»¥æ‰§è¡Œï¼škill -s QUIT 1628</p>
<p>ä¸ºäº†å¾—åˆ°æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ nginx è¿›ç¨‹ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨åˆ° ps å·¥å…·ï¼Œæ¯”å¦‚ï¼Œåƒä¸‹åˆ—çš„æ–¹å¼ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">ps</span> <span class="string">-ax</span> <span class="string">|</span> <span class="string">grep</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">ç»“æœä¸ºï¼šï¼ˆä¸‹é¢æ˜¯å•æ ¸</span> <span class="string">CPU</span> <span class="string">çš„æƒ…å†µï¼‰</span> </span><br><span class="line"></span><br><span class="line"><span class="number">516</span> <span class="string">pts/0</span>    <span class="string">D+</span>    <span class="number">0</span><span class="string">:00</span> <span class="string">grep</span> <span class="string">--color=auto</span> <span class="string">nginx</span> </span><br><span class="line"></span><br><span class="line"><span class="number">1156</span> <span class="string">?</span>        <span class="attr">S      1:22 nginx:</span> <span class="string">worker</span> <span class="string">process</span></span><br><span class="line"></span><br><span class="line"><span class="number">27999</span> <span class="string">?</span>        <span class="attr">Ss    0:00 nginx:</span> <span class="string">master</span> <span class="string">process</span> <span class="string">./nginx</span></span><br></pre></td></tr></table></figure>
<p>æ›´å¤šå…³äºå‘é€ä¿¡å·ç»™ nginxï¼Œå¯ä»¥å‚è€ƒ<a href="https://link.zhihu.com/?target=http://nginx.org/en/docs/ngx_core_module.html#worker_processes" target="_blank" rel="noopener">nginx æ§åˆ¶</a>ã€‚<br><br><br><strong><h2>é…ç½®æ–‡ä»¶ç»“æ„</h2></strong></p>
<p>nginx æ˜¯ç”±ä¸€äº›æ¨¡å—ç»„æˆï¼Œæˆ‘ä»¬ä¸€èˆ¬åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ä¸€äº›å…·ä½“çš„æŒ‡ä»¤æ¥æ§åˆ¶å®ƒä»¬ã€‚æŒ‡ä»¤è¢«åˆ†ä¸ºç®€å•æŒ‡ä»¤å’Œå—çº§å‘½ä»¤ã€‚ä¸€ä¸ªç®€å•çš„æŒ‡ä»¤æ˜¯ç”±åå­—å’Œå‚æ•°ç»„æˆï¼Œä¸­é—´ç”¨ç©ºæ ¼åˆ†å¼€ï¼Œå¹¶ä»¥åˆ†å·ç»“å°¾ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">//</span> ç®€å•æŒ‡ä»¤</span><br><span class="line"></span><br><span class="line">root <span class="regexp">/data/</span>www;</span><br></pre></td></tr></table></figure>
<p>å—çº§æŒ‡ä»¤å’Œç®€å•æŒ‡ä»¤ä¸€æ ·æœ‰ç€ç±»ä¼¼çš„ç»“æ„ï¼Œä½†æ˜¯æœ«å°¾ä¸æ˜¯åˆ†å·è€Œæ˜¯ç”¨ {å’Œ} å¤§æ‹¬å·åŒ…è£¹çš„é¢å¤–æŒ‡ä»¤é›†ã€‚å¦‚æœä¸€ä¸ªå—çº§æŒ‡ä»¤çš„å¤§æ‹¬å·é‡Œæœ‰å…¶ä»–æŒ‡ä»¤ï¼Œåˆ™å®ƒè¢«å«åšä¸€ä¸ªä¸Šä¸‹æ–‡ï¼ˆæ¯”å¦‚ï¼š<a href="http://nginx.org/en/docs/ngx_core_module.html#events" target="_blank" rel="noopener">events</a>ï¼Œ<a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#httph" target="_blank" rel="noopener">Module ngx_http_core_module</a>ï¼Œ<a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#servers" target="_blank" rel="noopener">server</a>ï¼Œå’Œ<a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#location" target="_blank" rel="noopener">location</a>ï¼‰ã€‚ åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæ²¡æœ‰æ”¾åœ¨ä»»ä½•ä¸Šä¸‹æ–‡ä¸­çš„æŒ‡ä»¤éƒ½æ˜¯å¤„åœ¨ä¸»ä¸Šä¸‹æ–‡ä¸­ã€‚events å’Œ http çš„æŒ‡ä»¤æ˜¯æ”¾åœ¨ä¸»ä¸Šä¸‹æ–‡ä¸­ï¼Œserver æ”¾åœ¨ http ä¸­, location æ”¾åœ¨ server ä¸­ã€‚</p>
<p>ä»¥ # å¼€å¤´çš„è¡Œï¼Œä¼šè¢«å½“åšæ³¨é‡Šã€‚</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># this is a comment</span></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;  </span><br><span class="line"></span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">4096</span>;  <span class="comment">## Default: 1024</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;    </span><br><span class="line"></span><br><span class="line">        <span class="section">server</span> &#123;          </span><br><span class="line"></span><br><span class="line">                <span class="attribute">listen</span>      <span class="number">80</span>;        </span><br><span class="line"></span><br><span class="line">                <span class="attribute">server_name</span>  domain1.com www.domain1.com;        </span><br><span class="line"></span><br><span class="line">                <span class="attribute">access_log</span>  logs/domain1.access.log  main;        </span><br><span class="line"></span><br><span class="line">                <span class="attribute">root</span>        html;        </span><br><span class="line"></span><br><span class="line">                <span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;          </span><br><span class="line"></span><br><span class="line">                    <span class="attribute">fastcgi_pass</span>  <span class="number">127.0.0.1:1025</span>;        </span><br><span class="line"></span><br><span class="line">                &#125;    </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br><br><strong><h2>é™æ€æœåŠ¡å™¨</h2></strong></p>
<p>ä¸€ä¸ªé‡è¦çš„ç½‘ç»œæœåŠ¡å™¨çš„ä»»åŠ¡æ˜¯å¤„ç†æ–‡ä»¶ï¼ˆæ¯”å¦‚å›¾ç‰‡æˆ–è€…é™æ€ HTML æ–‡ä»¶ï¼‰ã€‚è¿™é‡Œï¼Œä½ ä¼šå®è·µä¸€ä¸ªä¾‹å­ï¼Œæ–‡ä»¶ä¼šä»ä¸åŒçš„ç›®å½•ä¸­æ˜ å°„ï¼ˆå–å†³äºè¯·æ±‚ï¼‰ï¼š/data/wwwï¼ˆæ”¾ç½® HTML æ–‡ä»¶ï¼‰å’Œ /data/imagesï¼ˆæ”¾ç½®å›¾ç‰‡ï¼‰ã€‚è¿™éœ€è¦é…ç½®ä¸€ä¸‹æ–‡ä»¶ï¼Œå°†å¸¦æœ‰ä¸¤ä¸ª location çš„æŒ‡ä»¤çš„ server çš„å—çº§å‘½ä»¤æ”¾åœ¨ server æŒ‡ä»¤ä¸­ã€‚ é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª /data/www ç›®å½•ï¼Œç„¶åæ”¾ç½®ä¸€ä¸ªäº‹å…ˆå†™å¥½å†…å®¹çš„ index.html æ–‡ä»¶ã€‚æ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ª /data/images ç›®å½•ï¼Œç„¶åæ”¾ç½®ä¸€äº›å›¾ç‰‡ã€‚ ä¸‹ä¸€æ­¥ï¼Œæ‰“å¼€é…ç½®æ–‡ä»¶ã€‚é»˜è®¤çš„é…ç½®æ–‡ä»¶å·²ç»åŒ…å«äº†ä¸€äº›å…³äº server æŒ‡ä»¤çš„æ ·å¼ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ç›´æ¥æŠŠä»–ä»¬ç»™æ³¨é‡Šæ‰ã€‚ç°åœ¨ï¼Œæ³¨é‡Šæ‰å…¶ä»–çš„åŒºå—ï¼Œç„¶åå†™ä¸€ä¸ªæ–°çš„ server åŒºå—ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">http &#123;    </span><br><span class="line"></span><br><span class="line">       <span class="built_in"> server </span>&#123;    </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šå¸¸ï¼Œè¯¥é…ç½®æ–‡ä»¶å¯èƒ½ä¼šåŒ…å«å¤šä¸ª server æŒ‡ä»¤ã€‚è¿™äº› server æŒ‡ä»¤ç›‘å¬ä¸åŒçš„ç«¯å£å’ŒæœåŠ¡å™¨åã€‚ä¸€æ—¦ nginx å†³å®šå“ªä¸ªæœåŠ¡è¿›ç¨‹å¤„ç†è¯·æ±‚ï¼Œå®ƒä¼šæ ¹æ®åœ¨ server å—çº§æŒ‡ä»¤ä¸­å®šä¹‰å¥½çš„ location æŒ‡ä»¤çš„å‚æ•°ï¼Œæ¥åŒ¹é…è¯·æ±‚å¤´ä¸­æŒ‡å®šçš„ URIã€‚ å°†ä¸‹åˆ— location æŒ‡ä»¤æ·»åŠ åˆ° server æŒ‡ä»¤ä¸­ï¼š</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">/ &#123;    </span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">        root</span> /data/www;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥ location æŒ‡ä»¤ç›¸å¯¹äºè¯·æ±‚ä¸­çš„ URI æ‰§è¡Œäº† â€œ/â€ çš„å‰ç¼€ã€‚ä¸ºäº†åŒ¹é…è¯·æ±‚ï¼ŒURI ä¼šè¢«æ·»åŠ åˆ° root å‘½ä»¤æŒ‡å®šçš„è·¯å¾„åï¼Œå³ /data/wwwï¼Œå¾—åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­è¯·æ±‚æ–‡ä»¶çš„è·¯å¾„ã€‚å¦‚æœï¼Œæœ‰å‡ ä¸ª location åŒ¹é…åˆ°ï¼Œé‚£ä¹ˆ nginx ä¼šé€‰æ‹©æœ€é•¿çš„å‰ç¼€ã€‚ä¸Šé¢çš„ location æä¾›äº†é•¿åº¦ä¸º 1 çš„å‰ç¼€ï¼Œæ‰€ä»¥ï¼Œä»…å½“å…¶ä»–çš„ location åŒ¹é…å¤±è´¥åï¼Œè¯¥æŒ‡ä»¤æ‰ä¼šä½¿ç”¨ã€‚ æ¥ç€ï¼Œæ·»åŠ ç¬¬äºŒä¸ª location åŒºå—ï¼š</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">/images</span>/ &#123;    </span><br><span class="line"></span><br><span class="line">        root /data;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ƒä¼šåŒ¹é…åˆ°ä»¥ /images/ å¼€å¤´çš„è¯·æ±‚ï¼ˆlocation / ä¹Ÿä¼šåŒ¹é…åˆ°è¯¥è¯·æ±‚ï¼Œåªæ˜¯å‰ç¼€æ›´çŸ­ï¼‰ server å—çº§å‘½ä»¤çš„é…ç½®ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">server &#123;   </span><br><span class="line"></span><br><span class="line">        <span class="keyword">location</span> <span class="title">/ &#123;       </span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">                root</span> /data/www;   </span><br><span class="line"></span><br><span class="line">        &#125;   </span><br><span class="line"></span><br><span class="line">        <span class="keyword">location</span> <span class="title">/images</span>/ &#123;       </span><br><span class="line"></span><br><span class="line">                root /data;   </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å·²ç»æ˜¯ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡å™¨é…ç½®ï¼Œå®ƒç›‘å¬æ ‡å‡†çš„ 80 ç«¯å£å¹¶ä¸”å¯ä»¥åœ¨æœ¬åœ°ä¸Šé€šè¿‡ <a href="http://localhost/" target="_blank" rel="noopener">http://localhost/</a> è®¿é—®ã€‚å¯¹äº URI ä»¥ /images/ å¼€å¤´çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šä» /data/images ç›®å½•ä¸­ï¼Œè¿”å›å¯¹åº”çš„æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œnginx ä¼šè¿”å› /data/images/example.png æ–‡ä»¶ï¼Œå½“æ¥æ”¶åˆ° <a href="http://localhost/images/example.png" target="_blank" rel="noopener">http://localhost/images/example.png</a> çš„è¯·æ±‚å“åº”æ—¶ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œnginx ä¼šè¿”å›ä¸€ä¸ª 404 é”™è¯¯çš„å“åº”ã€‚æ²¡æœ‰ä»¥ /images/ å¼€å¤´çš„ URI çš„è¯·æ±‚ï¼Œå°†ä¼šç›´æ¥æ˜ å°„åˆ° /data/www ç›®å½•ä¸­ã€‚æ¯”å¦‚ï¼Œå“åº” <a href="http://localhost/some/example.html" target="_blank" rel="noopener">http://localhost/some/example.html</a> çš„è¯·æ±‚ï¼Œnginx ä¼šå‘é€ /data/www/some/example.html æ–‡ä»¶ã€‚ ä¸ºäº†ä½¿ç”¨æ–°çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœè¿˜æ²¡å¼€å¯ nginx éœ€è¦å…ˆå¼€å¯ï¼Œç„¶åå°†é‡è½½ä¿¡å·å‘é€ç»™ nginx çš„ä¸»è¿›ç¨‹ï¼Œé€šè¿‡æ‰§è¡Œï¼š</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nginx -s reload</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ å‘ç°æœ‰äº›åœ°æ–¹å‡ºäº†é—®é¢˜ï¼Œä½ å¯ä»¥åœ¨ /usr/local/nginx/logs æˆ–è€… /var/log/nginx ç›®å½•ä¸‹çš„ access.log å’Œ error.log æ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ°åŸå› ã€‚<br><br><br><strong><h2>æ­å»ºä¸€ä¸ªç®€æ˜“çš„ä»£ç†æœåŠ¡</h2></strong></p>
<p>nginx å¸¸å¸¸ç”¨æ¥ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œè¿™ä»£è¡¨ç€æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼Œç„¶åå°†å®ƒä»¬ä¼ é€’ç»™è¢«ä»£ç†æœåŠ¡å™¨ï¼Œå¾—åˆ°è¯·æ±‚çš„å“åº”ï¼Œå†å°†å®ƒä»¬å‘é€ç»™å®¢æˆ·ç«¯ã€‚ æˆ‘ä»¬å°†é…ç½®ä¸€ä¸ªåŸºæœ¬çš„ä»£ç†æœåŠ¡å™¨ï¼Œå®ƒä¼šå¤„ç†æœ¬åœ°å›¾ç‰‡æ–‡ä»¶çš„è¯·æ±‚å¹¶è¿”å›å…¶ä»–çš„è¯·æ±‚ç»™è¢«ä»£ç†çš„æœåŠ¡å™¨ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸¤ä¸ªæœåŠ¡å™¨éƒ½ä¼šå®šä¹‰åœ¨ä¸€ä¸ª nginx å®ä¾‹ä¸­ã€‚ é¦–å…ˆï¼Œé€šè¿‡åœ¨ nginx é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦ä¸€ä¸ª server åŒºå—ï¼Œæ¥å®šä¹‰ä¸€ä¸ªè¢«ä»£ç†çš„æœåŠ¡å™¨ï¼Œåƒä¸‹é¢çš„é…ç½®ï¼š</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;   </span><br><span class="line"></span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8080</span>;   </span><br><span class="line"></span><br><span class="line">        <span class="attribute">root</span> /data/up1;   </span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;   </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢å°±æ˜¯ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬åœ¨ 8080 ç«¯å£ï¼ˆä¹‹å‰ï¼Œlisten å¹¶æ²¡è¢«å®šä¹‰ï¼Œæ˜¯å› ä¸ºé»˜è®¤ç›‘å¬çš„ 80 ç«¯å£ï¼‰å¹¶ä¸”ä¼šæ˜ å°„æ‰€æœ‰çš„è¯·æ±‚ç»™ æœ¬åœ°æ–‡ä»¶ç›®å½• /data/up1ã€‚åˆ›å»ºè¯¥ç›®å½•ï¼Œç„¶åæ·»åŠ  index.html æ–‡ä»¶ã€‚æ³¨æ„ï¼Œroot æŒ‡ä»¤æ˜¯æ”¾åœ¨ server ä¸Šä¸‹æ–‡ä¸­ã€‚å½“å“åº”è¯·æ±‚çš„ location åŒºå—ä¸­ï¼Œæ²¡æœ‰è‡ªå·±çš„ root æŒ‡ä»¤ï¼Œä¸Šè¿°çš„ root æŒ‡ä»¤æ‰ä¼šè¢«ä½¿ç”¨ã€‚ æ¥ç€ï¼Œä½¿ç”¨å‰é¢ç« èŠ‚ä¸­çš„ server é…ç½®ï¼Œç„¶åå°†å®ƒæ”¹ä¸ºä¸€ä¸ªä»£ç†æœåŠ¡é…ç½®ã€‚åœ¨ç¬¬ä¸€ä¸ª location åŒºå—ä¸­ï¼Œæ”¾ç½®å·²ç»æ·»åŠ è¢«ä»£ç†æœåŠ¡å™¨çš„åè®®ï¼Œåå­—å’Œç«¯å£ç­‰å‚æ•°çš„proxy_passæŒ‡ä»¤ï¼ˆåœ¨è¿™é‡Œï¼Œå°±æ˜¯ <a href="http://localhost:8080ï¼‰" target="_blank" rel="noopener">http://localhost:8080ï¼‰</a>:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">server &#123;   </span><br><span class="line"></span><br><span class="line">        <span class="keyword">location</span> <span class="title">/ &#123;</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">                proxy_pass</span> http://localhost:<span class="number">8080</span>;   </span><br><span class="line"></span><br><span class="line">        &#125;   </span><br><span class="line"></span><br><span class="line">        <span class="keyword">location</span> <span class="title">/images</span>/ &#123;</span><br><span class="line"></span><br><span class="line">               root /data;   </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†ä¿®æ”¹ç¬¬äºŒä¸ª location åŒºå—ï¼Œä½¿ä»–è¿”å›ä¸€äº›å…¸å‹åç¼€çš„å›¾ç‰‡æ–‡ä»¶è¯·æ±‚ï¼Œç°åœ¨å®ƒåªä¼šæ˜ å°„å¸¦æœ‰ /images/ å‰ç¼€çš„è¯·æ±‚åˆ° /data/images ç›®å½•ä¸‹ã€‚ä¿®æ”¹åçš„ location æŒ‡ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">~ \.(gif</span>|jpg|png)$&#123;</span><br><span class="line"></span><br><span class="line">        root/data/images;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥å‚æ•°æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œå®ƒä¼šåŒ¹é…æ‰€æœ‰ä»¥ .gifï¼Œ.jpg æˆ–è€… .png ç»“å°¾çš„ URIsã€‚ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼éœ€è¦ä»¥ ~ å¼€å¤´ã€‚åŒ¹é…åˆ°çš„è¯·æ±‚ä¼šè¢«æ˜ å°„åˆ° /data/images ç›®å½•ä¸‹ã€‚ å½“ nginx åœ¨é€‰æ‹© location å»å“åº”ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒä¼šå…ˆæ£€æµ‹å¸¦æœ‰å‰ç¼€çš„ location æŒ‡ä»¤ï¼Œè®°ä½å…ˆæ˜¯æ£€æµ‹å¸¦æœ‰æœ€é•¿å‰ç¼€çš„ locationï¼Œç„¶åæ£€æµ‹æ­£åˆ™è¡¨è¾¾å¼ã€‚å¦‚æœæœ‰ä¸€ä¸ªæ­£åˆ™çš„åŒ¹é…çš„è§„åˆ™ï¼Œnginx ä¼šé€‰æ‹©è¯¥ locationï¼Œå¦åˆ™ï¼Œä¼šé€‰æ‹©ä¹‹å‰ç¼“å­˜çš„è§„åˆ™ã€‚ æœ€ç»ˆï¼Œä¸€ä¸ªä»£ç†æœåŠ¡å™¨çš„é…ç½®ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"></span><br><span class="line">        location<span class="class">/&#123;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="symbol">                proxy_passhttp:</span><span class="comment">//localhost:8080/;</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        location~\.(gif|jpg|png)$&#123;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                root<span class="meta-keyword">/data/</span>images;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure>
<p>è¯¥æœåŠ¡å™¨ä¼šé€‰æ‹©ä»¥ .gifï¼Œ.jpgï¼Œæˆ–è€… .png ç»“æŸçš„è¯·æ±‚å¹¶ä¸”æ˜ å°„åˆ° /data/images ç›®å½•ï¼ˆé€šè¿‡æ·»åŠ  URI ç»™ root æŒ‡ä»¤çš„å‚æ•°ï¼‰ï¼Œæ¥ç€å°†å…¶ä»–æ‰€æœ‰çš„è¯·æ±‚æ˜ å°„åˆ°ä¸Šè¿°è¢«ä»£ç†çš„æœåŠ¡å™¨ã€‚ ä¸ºäº†ä½¿ç”¨æ–°çš„é…ç½®ï¼Œåƒå‰å‡ ä¸ªç« èŠ‚æè¿°çš„ä¸€æ ·ï¼Œéœ€è¦å‘ nginx å‘é€é‡è½½ä¿¡å·ã€‚ è¿™è¿˜æœ‰å¾ˆå¤š<a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html" target="_blank" rel="noopener">å…¶ä»–çš„æŒ‡ä»¤</a>ï¼Œå¯ä»¥ç”¨äºè¿›ä¸€æ­¥é…ç½®ä»£ç†è¿æ¥ã€‚</p>
]]></content>
      <categories>
        <category>WebWebWeb</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaæ³›å‹æ€»ç»“</title>
    <url>/2017/02/18/Java%E6%B3%9B%E5%9E%8B%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><strong>ä¸€. æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹ï¼Ÿ</strong></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸‹é¢è¿™æ®µç®€çŸ­çš„ä»£ç :</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTest</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        List <span class="built_in">list</span> = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        <span class="built_in">list</span>.add(<span class="string">"justdoit"</span>);</span><br><span class="line">        <span class="built_in">list</span>.add(<span class="string">"core"</span>);</span><br><span class="line">        <span class="built_in">list</span>.add(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">list</span>.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">String</span> name = (<span class="keyword">String</span>) <span class="built_in">list</span>.<span class="built_in">get</span>(i); <span class="comment">// 1</span></span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">"name:"</span> + name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªListç±»å‹çš„é›†åˆï¼Œå…ˆå‘å…¶ä¸­åŠ å…¥äº†ä¸¤ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼ï¼ŒéšååŠ å…¥ä¸€ä¸ªIntegerç±»å‹çš„å€¼ã€‚è¿™æ˜¯å®Œå…¨å…è®¸çš„ï¼Œå› ä¸ºæ­¤æ—¶listé»˜è®¤çš„ç±»å‹ä¸ºObjectç±»å‹ã€‚åœ¨ä¹‹åçš„å¾ªç¯ä¸­ï¼Œç”±äºå¿˜è®°äº†ä¹‹å‰åœ¨listä¸­ä¹ŸåŠ å…¥äº†Integerç±»å‹çš„å€¼æˆ–å…¶ä»–ç¼–ç åŸå› ï¼Œå¾ˆå®¹æ˜“å‡ºç°ç±»ä¼¼äº//1ä¸­çš„é”™è¯¯ã€‚å› ä¸ºç¼–è¯‘é˜¶æ®µæ­£å¸¸ï¼Œè€Œè¿è¡Œæ—¶ä¼šå‡ºç°â€œjava.lang.ClassCastExceptionâ€å¼‚å¸¸ã€‚å› æ­¤ï¼Œå¯¼è‡´æ­¤ç±»é”™è¯¯ç¼–ç è¿‡ç¨‹ä¸­ä¸æ˜“å‘ç°ã€‚</p>
<p> <strong>åœ¨å¦‚ä¸Šçš„ç¼–ç è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°ä¸»è¦å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</strong></p>
<p>1.å½“æˆ‘ä»¬å°†ä¸€ä¸ªå¯¹è±¡æ”¾å…¥é›†åˆä¸­ï¼Œé›†åˆä¸ä¼šè®°ä½æ­¤å¯¹è±¡çš„ç±»å‹ï¼Œå½“å†æ¬¡ä»é›†åˆä¸­å–å‡ºæ­¤å¯¹è±¡æ—¶ï¼Œæ”¹å¯¹è±¡çš„ç¼–è¯‘ç±»å‹å˜æˆäº†Objectç±»å‹ï¼Œä½†å…¶è¿è¡Œæ—¶ç±»å‹ä»»ç„¶ä¸ºå…¶æœ¬èº«ç±»å‹ã€‚</p>
<p>2.å› æ­¤ï¼Œ//1å¤„å–å‡ºé›†åˆå…ƒç´ æ—¶éœ€è¦äººä¸ºçš„å¼ºåˆ¶ç±»å‹è½¬åŒ–åˆ°å…·ä½“çš„ç›®æ ‡ç±»å‹ï¼Œä¸”å¾ˆå®¹æ˜“å‡ºç°â€œjava.lang.ClassCastExceptionâ€å¼‚å¸¸ã€‚</p>
<font color="#008080"><strong>é‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥ä½¿é›†åˆèƒ½å¤Ÿè®°ä½é›†åˆå†…å…ƒç´ å„ç±»å‹ï¼Œä¸”èƒ½å¤Ÿè¾¾åˆ°åªè¦ç¼–è¯‘æ—¶ä¸å‡ºç°é—®é¢˜ï¼Œè¿è¡Œæ—¶å°±ä¸ä¼šå‡ºç°â€œjava.lang.ClassCastExceptionâ€å¼‚å¸¸å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä½¿ç”¨æ³›å‹ã€‚</strong></font>

<p><strong>äºŒ.ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ</strong></p>
<p>æ³›å‹ï¼Œå³â€œå‚æ•°åŒ–ç±»å‹â€ã€‚ä¸€æåˆ°å‚æ•°ï¼Œæœ€ç†Ÿæ‚‰çš„å°±æ˜¯å®šä¹‰æ–¹æ³•æ—¶æœ‰å½¢å‚ï¼Œç„¶åè°ƒç”¨æ­¤æ–¹æ³•æ—¶ä¼ é€’å®å‚ã€‚é‚£ä¹ˆå‚æ•°åŒ–ç±»å‹æ€ä¹ˆç†è§£å‘¢ï¼Ÿé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†ç±»å‹ç”±åŸæ¥çš„å…·ä½“çš„ç±»å‹å‚æ•°åŒ–ï¼Œç±»ä¼¼äºæ–¹æ³•ä¸­çš„å˜é‡å‚æ•°ï¼Œæ­¤æ—¶ç±»å‹ä¹Ÿå®šä¹‰æˆå‚æ•°å½¢å¼ï¼ˆå¯ä»¥ç§°ä¹‹ä¸ºç±»å‹å½¢å‚ï¼‰ï¼Œç„¶ååœ¨ä½¿ç”¨/è°ƒç”¨æ—¶ä¼ å…¥å…·ä½“çš„ç±»å‹ï¼ˆç±»å‹å®å‚ï¼‰ã€‚</p>
<p>è¿™æ ·è¯´æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¸Šé¢é‚£ä¸ªä¾‹å­é‡‡ç”¨æ³›å‹çš„å†™æ³•:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTest_2</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        List list = new ArrayList();</span></span><br><span class="line"><span class="comment">        list.add("justdoit");</span></span><br><span class="line"><span class="comment">        list.add("core");</span></span><br><span class="line"><span class="comment">        list.add(100);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        List&lt;<span class="keyword">String</span>&gt; <span class="built_in">list</span> = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">String</span>&gt;();</span><br><span class="line">        <span class="built_in">list</span>.add(<span class="string">"justdoit"</span>);</span><br><span class="line">        <span class="built_in">list</span>.add(<span class="string">"core"</span>);</span><br><span class="line">        <span class="comment">//list.add(100);   // 1  æç¤ºç¼–è¯‘é”™è¯¯</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">list</span>.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">String</span> name = <span class="built_in">list</span>.<span class="built_in">get</span>(i); <span class="comment">// 2</span></span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">"name:"</span> + name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‡‡ç”¨æ³›å‹å†™æ³•åï¼Œåœ¨//1å¤„æƒ³åŠ å…¥ä¸€ä¸ªIntegerç±»å‹çš„å¯¹è±¡æ—¶ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ï¼Œé€šè¿‡List&lt; String&gt;ï¼Œç›´æ¥é™å®šäº†listé›†åˆä¸­åªèƒ½å«æœ‰Stringç±»å‹çš„å…ƒç´ ï¼Œä»è€Œåœ¨//2å¤„æ— é¡»è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå› ä¸ºæ­¤æ—¶ï¼Œé›†åˆèƒ½å¤Ÿè®°ä½å…ƒç´ çš„ç±»å‹ä¿¡æ¯ï¼Œç¼–è¯‘å™¨å·²ç»èƒ½å¤Ÿç¡®è®¤å®ƒæ˜¯Stringç±»å‹äº†ã€‚</p>
<p>ç»“åˆä¸Šé¢çš„æ³›å‹å®šä¹‰ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨List&lt; String&gt;ä¸­ï¼ŒStringæ˜¯ç±»å‹å®å‚ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç›¸åº”çš„Listæ¥å£ä¸­è‚¯å®šå«æœ‰ç±»å‹å½¢å‚ã€‚ä¸”get()æ–¹æ³•çš„è¿”å›ç»“æœä¹Ÿç›´æ¥æ˜¯æ­¤å½¢å‚ç±»å‹ï¼ˆä¹Ÿå°±æ˜¯å¯¹åº”çš„ä¼ å…¥çš„ç±»å‹å®å‚ï¼‰ã€‚ä¸‹é¢å°±æ¥çœ‹çœ‹Listæ¥å£çš„çš„å…·ä½“å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    Object[] toArray();</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; T[] toArray(T[] a);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">containsAll</span><span class="params">(Collection&lt;?&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(<span class="keyword">int</span> index, Collection&lt;? extends E&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">removeAll</span><span class="params">(Collection&lt;?&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">retainAll</span><span class="params">(Collection&lt;?&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lastIndexOf</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ListIterator&lt;E&gt; <span class="title">listIterator</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ListIterator&lt;E&gt; <span class="title">listIterator</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;E&gt; <span class="title">subList</span><span class="params">(<span class="keyword">int</span> fromIndex, <span class="keyword">int</span> toIndex)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨Listæ¥å£ä¸­é‡‡ç”¨æ³›å‹åŒ–å®šä¹‰ä¹‹åï¼Œ&lt; E&gt;ä¸­çš„Eè¡¨ç¤ºç±»å‹å½¢å‚ï¼Œå¯ä»¥æ¥æ”¶å…·ä½“çš„ç±»å‹å®å‚ï¼Œå¹¶ä¸”æ­¤æ¥å£å®šä¹‰ä¸­ï¼Œå‡¡æ˜¯å‡ºç°Eçš„åœ°æ–¹å‡è¡¨ç¤ºç›¸åŒçš„æ¥å—è‡ªå¤–éƒ¨çš„ç±»å‹å®å‚ã€‚</p>
<p>è‡ªç„¶çš„ï¼ŒArrayListä½œä¸ºListæ¥å£çš„å®ç°ç±»ï¼Œå…¶å®šä¹‰å½¢å¼æ˜¯:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;E&gt; <span class="title">extends</span> <span class="title">AbstractList</span>&lt;E&gt; </span></span><br><span class="line"><span class="class">        <span class="title">implements</span> <span class="title">List</span>&lt;E&gt;, <span class="title">RandomAccess</span>, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> &#123;</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        ensureCapacityInternal(<span class="built_in">size</span> + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">        elementData[<span class="built_in">size</span>++] = e;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        rangeCheck(index);</span><br><span class="line">        checkForComodification();</span><br><span class="line">        <span class="keyword">return</span> ArrayList.<span class="keyword">this</span>.elementData(offset + index);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//...çœç•¥æ‰å…¶ä»–å…·ä½“çš„å®šä¹‰è¿‡ç¨‹</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä»æºä»£ç è§’åº¦æ˜ç™½äº†ä¸ºä»€ä¹ˆ//1å¤„åŠ å…¥Integerç±»å‹å¯¹è±¡ç¼–è¯‘é”™è¯¯ï¼Œä¸”//2å¤„get()åˆ°çš„ç±»å‹ç›´æ¥å°±æ˜¯Stringç±»å‹äº†ã€‚</p>
<p><strong>ä¸‰.è‡ªå®šä¹‰æ³›å‹æ¥å£ã€æ³›å‹ç±»å’Œæ³›å‹æ–¹æ³•</strong></p>
<p>ä»ä¸Šé¢çš„å†…å®¹ä¸­ï¼Œå¤§å®¶å·²ç»æ˜ç™½äº†æ³›å‹çš„å…·ä½“è¿ä½œè¿‡ç¨‹ã€‚ä¹ŸçŸ¥é“äº†æ¥å£ã€ç±»å’Œæ–¹æ³•ä¹Ÿéƒ½å¯ä»¥ä½¿ç”¨æ³›å‹å»å®šä¹‰ï¼Œä»¥åŠç›¸åº”çš„ä½¿ç”¨ã€‚æ˜¯çš„ï¼Œåœ¨å…·ä½“ä½¿ç”¨æ—¶ï¼Œå¯ä»¥åˆ†ä¸ºæ³›å‹æ¥å£ã€æ³›å‹ç±»å’Œæ³›å‹æ–¹æ³•ã€‚</p>
<p>è‡ªå®šä¹‰æ³›å‹æ¥å£ã€æ³›å‹ç±»å’Œæ³›å‹æ–¹æ³•ä¸ä¸Šè¿°Javaæºç ä¸­çš„Listã€ArrayListç±»ä¼¼ã€‚å¦‚ä¸‹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªæœ€ç®€å•çš„æ³›å‹ç±»å’Œæ–¹æ³•å®šä¹‰ï¼š</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_5;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTest_3</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Box&lt;<span class="keyword">String</span>&gt; name = <span class="keyword">new</span> Box&lt;<span class="keyword">String</span>&gt;(<span class="string">"core"</span>);</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"name:"</span> + name.getData());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Box</span>&lt;T&gt; &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Box</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Box</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ³›å‹æ¥å£ã€æ³›å‹ç±»å’Œæ³›å‹æ–¹æ³•çš„å®šä¹‰è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸è§çš„å¦‚Tã€Eã€Kã€Vç­‰å½¢å¼çš„å‚æ•°å¸¸ç”¨äºè¡¨ç¤ºæ³›å‹å½¢å‚ï¼Œç”±äºæ¥æ”¶æ¥è‡ªå¤–éƒ¨ä½¿ç”¨æ—¶å€™ä¼ å…¥çš„ç±»å‹å®å‚ã€‚é‚£ä¹ˆå¯¹äºä¸åŒä¼ å…¥çš„ç±»å‹å®å‚ï¼Œç”Ÿæˆçš„ç›¸åº”å¯¹è±¡å®ä¾‹çš„ç±»å‹æ˜¯ä¸æ˜¯ä¸€æ ·çš„å‘¢ï¼Ÿ</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_5;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTest_4</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Box&lt;<span class="keyword">String</span>&gt; name = <span class="keyword">new</span> Box&lt;<span class="keyword">String</span>&gt;(<span class="string">"core"</span>);</span><br><span class="line">        Box&lt;Integer&gt; age = <span class="keyword">new</span> Box&lt;Integer&gt;(<span class="number">712</span>);</span><br><span class="line"></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"name class:"</span> + name.getClass());      <span class="comment">// CoreJava.day_5.Box</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"age class:"</span> + age.getClass());        <span class="comment">// CoreJava.day_5.Box</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(name.getClass() == age.getClass());    <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±æ­¤ï¼Œæˆ‘ä»¬å‘ç°ï¼Œåœ¨ä½¿ç”¨æ³›å‹ç±»æ—¶ï¼Œè™½ç„¶ä¼ å…¥äº†ä¸åŒçš„æ³›å‹å®å‚ï¼Œä½†å¹¶æ²¡æœ‰çœŸæ­£æ„ä¹‰ä¸Šç”Ÿæˆä¸åŒçš„ç±»å‹ï¼Œä¼ å…¥ä¸åŒæ³›å‹å®å‚çš„æ³›å‹ç±»åœ¨å†…å­˜ä¸Šåªæœ‰ä¸€ä¸ªï¼Œå³è¿˜æ˜¯åŸæ¥çš„æœ€åŸºæœ¬çš„ç±»å‹ï¼ˆæœ¬å®ä¾‹ä¸­ä¸ºBoxï¼‰ï¼Œå½“ç„¶ï¼Œåœ¨é€»è¾‘ä¸Šæˆ‘ä»¬å¯ä»¥ç†è§£æˆå¤šä¸ªä¸åŒçš„æ³›å‹ç±»å‹ã€‚</p>
<p>ç©¶å…¶åŸå› ï¼Œåœ¨äºJavaä¸­çš„æ³›å‹è¿™ä¸€æ¦‚å¿µæå‡ºçš„ç›®çš„ï¼Œå¯¼è‡´å…¶åªæ˜¯ä½œç”¨äºä»£ç ç¼–è¯‘é˜¶æ®µï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå¯¹äºæ­£ç¡®æ£€éªŒæ³›å‹ç»“æœåï¼Œä¼šå°†æ³›å‹çš„ç›¸å…³ä¿¡æ¯æ“¦å‡ºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæˆåŠŸç¼–è¯‘è¿‡åçš„classæ–‡ä»¶ä¸­æ˜¯ä¸åŒ…å«ä»»ä½•æ³›å‹ä¿¡æ¯çš„ã€‚æ³›å‹ä¿¡æ¯ä¸ä¼šè¿›å…¥åˆ°è¿è¡Œæ—¶é˜¶æ®µã€‚</p>
<font color="#008080"><strong>å¯¹æ­¤æ€»ç»“æˆä¸€å¥è¯ï¼šæ³›å‹ç±»å‹åœ¨é€»è¾‘ä¸Šçœ‹ä»¥çœ‹æˆæ˜¯å¤šä¸ªä¸åŒçš„ç±»å‹ï¼Œå®é™…ä¸Šéƒ½æ˜¯ç›¸åŒçš„åŸºæœ¬ç±»å‹ã€‚</strong></font>


<p><strong>å››.ç±»å‹é€šé…ç¬¦</strong></p>
<p>æ¥ç€ä¸Šé¢çš„ç»“è®ºï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒBox&lt; Number&gt;å’ŒBox&lt; Integer&gt;å®é™…ä¸Šéƒ½æ˜¯Boxç±»å‹ï¼Œç°åœ¨éœ€è¦ç»§ç»­æ¢è®¨ä¸€ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆåœ¨é€»è¾‘ä¸Šï¼Œç±»ä¼¼äºBox&lt; Number&gt;å’ŒBox&lt; Integer&gt;æ˜¯å¦å¯ä»¥çœ‹æˆå…·æœ‰çˆ¶å­å…³ç³»çš„æ³›å‹ç±»å‹å‘¢ï¼Ÿ</p>
<p>ä¸ºäº†å¼„æ¸…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ä¸‹ä¸‹é¢è¿™ä¸ªä¾‹å­:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_5;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTest_6</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Box&lt;Number&gt; name = <span class="keyword">new</span> Box&lt;Number&gt;(<span class="number">99</span>);</span><br><span class="line">        Box&lt;Integer&gt; age = <span class="keyword">new</span> Box&lt;Integer&gt;(<span class="number">712</span>);</span><br><span class="line"></span><br><span class="line">        getData(name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//The method getData(Box&lt;Number&gt;) in the type GenericTest is</span></span><br><span class="line">        <span class="comment">//not applicable for the arguments (Box&lt;Integer&gt;)</span></span><br><span class="line">        getData(age);   <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">(Box&lt;Number&gt; data)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"data :"</span> + data.getData());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°ï¼Œåœ¨ä»£ç //1å¤„å‡ºç°äº†é”™è¯¯æç¤ºä¿¡æ¯ï¼šThe method getData(Box&lt; Number&gt;) in the t ype GenericTest is not applicable for the arguments (Box&lt; Integer&gt;)ã€‚æ˜¾ç„¶ï¼Œé€šè¿‡æç¤ºä¿¡æ¯ï¼Œæˆ‘ä»¬çŸ¥é“Box&lt; Number&gt;åœ¨é€»è¾‘ä¸Šä¸èƒ½è§†ä¸ºBox&lt; Integer&gt;çš„çˆ¶ç±»ã€‚é‚£ä¹ˆï¼ŒåŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_5;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTest_5</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Box&lt;Integer&gt; a = <span class="keyword">new</span> Box&lt;Integer&gt;(<span class="number">712</span>);</span><br><span class="line">        Box&lt;Number&gt; b = a;  <span class="comment">// 1</span></span><br><span class="line">        Box&lt;Float&gt; f = <span class="keyword">new</span> Box&lt;Float&gt;(<span class="number">3.14f</span>);</span><br><span class="line">        b.setData(f);        <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">(Box&lt;Number&gt; data)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"data :"</span> + data.getData());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Box</span>&lt;T&gt; &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Box</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Box</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        setData(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ˜¾ç„¶//1å’Œ//2å¤„è‚¯å®šä¼šå‡ºç°é”™è¯¯æç¤ºçš„ã€‚åœ¨æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åè¯æ³•æ¥è¿›è¡Œè¯´æ˜ã€‚</p>
<p>å‡è®¾Box&lt; Number&gt;åœ¨é€»è¾‘ä¸Šå¯ä»¥è§†ä¸ºBox&lt; Integer&gt;çš„çˆ¶ç±»ï¼Œé‚£ä¹ˆ//1å’Œ//2å¤„å°†ä¸ä¼šæœ‰é”™è¯¯æç¤ºäº†ï¼Œé‚£ä¹ˆé—®é¢˜å°±å‡ºæ¥äº†ï¼Œé€šè¿‡getData()æ–¹æ³•å–å‡ºæ•°æ®æ—¶åˆ°åº•æ˜¯ä»€ä¹ˆç±»å‹å‘¢ï¼ŸInteger? Float? è¿˜æ˜¯Numberï¼Ÿä¸”ç”±äºåœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­çš„é¡ºåºä¸å¯æ§æ€§ï¼Œå¯¼è‡´åœ¨å¿…è¦çš„æ—¶å€™å¿…é¡»è¦è¿›è¡Œç±»å‹åˆ¤æ–­ï¼Œä¸”è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸æ³›å‹çš„ç†å¿µçŸ›ç›¾ï¼Œå› æ­¤ï¼Œ<font color="#008080"><strong>åœ¨é€»è¾‘ä¸ŠBox&lt; Number&gt;ä¸èƒ½è§†ä¸ºBox&lt; Integer&gt;çš„çˆ¶ç±»ã€‚</strong></font></p>
<p>å¥½ï¼Œé‚£æˆ‘ä»¬å›è¿‡å¤´æ¥ç»§ç»­çœ‹â€œç±»å‹é€šé…ç¬¦â€ä¸­çš„ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çŸ¥é“å…¶å…·ä½“çš„é”™è¯¯æç¤ºçš„æ·±å±‚æ¬¡åŸå› äº†ã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢ï¼Ÿæ€»ä¸èƒ½å†å®šä¹‰ä¸€ä¸ªæ–°çš„å‡½æ•°å§ã€‚è¿™å’ŒJavaä¸­çš„å¤šæ€ç†å¿µæ˜¾ç„¶æ˜¯è¿èƒŒçš„ï¼Œ<font color="#008080"><strong>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåœ¨é€»è¾‘ä¸Šå¯ä»¥ç”¨æ¥è¡¨ç¤ºåŒæ—¶æ˜¯Box&lt; Integer&gt;å’ŒBox&lt; Number&gt;çš„çˆ¶ç±»çš„ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œç”±æ­¤ï¼Œç±»å‹é€šé…ç¬¦åº”è¿è€Œç”Ÿã€‚</strong></font></p>
<p>ç±»å‹é€šé…ç¬¦ä¸€èˆ¬æ˜¯ä½¿ç”¨ ? ä»£æ›¿å…·ä½“çš„ç±»å‹å®å‚ã€‚æ³¨æ„äº†ï¼Œæ­¤å¤„æ˜¯ç±»å‹å®å‚ï¼Œè€Œä¸æ˜¯ç±»å‹å½¢å‚ï¼ä¸”Box&lt;?&gt;åœ¨é€»è¾‘ä¸Šæ˜¯Box&lt; Integer&gt;ã€Box&lt; Number&gt;â€¦ç­‰æ‰€æœ‰Box&lt;å…·ä½“ç±»å‹å®å‚&gt;çš„çˆ¶ç±»ã€‚ç”±æ­¤ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥å®šä¹‰æ³›å‹æ–¹æ³•ï¼Œæ¥å®Œæˆæ­¤ç±»éœ€æ±‚ã€‚</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_5;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTest_7</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Box&lt;<span class="keyword">String</span>&gt; name = <span class="keyword">new</span> Box&lt;<span class="keyword">String</span>&gt;(<span class="string">"core"</span>);</span><br><span class="line">        Box&lt;Integer&gt; age = <span class="keyword">new</span> Box&lt;Integer&gt;(<span class="number">712</span>);</span><br><span class="line">        Box&lt;Number&gt; number = <span class="keyword">new</span> Box&lt;Number&gt;(<span class="number">314</span>);</span><br><span class="line"></span><br><span class="line">        getData(name);</span><br><span class="line">        getData(age);</span><br><span class="line">        getData(number);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">(Box&lt;?&gt; data)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"data :"</span> + data.getData());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰æ—¶å€™ï¼Œ<font color="#008080"><strong>æˆ‘ä»¬è¿˜å¯èƒ½å¬åˆ°ç±»å‹é€šé…ç¬¦ä¸Šé™å’Œç±»å‹é€šé…ç¬¦ä¸‹é™</strong>ã€‚å…·ä½“æœ‰æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</font></p>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœéœ€è¦å®šä¹‰ä¸€ä¸ªåŠŸèƒ½ç±»ä¼¼äºgetData()çš„æ–¹æ³•ï¼Œä½†å¯¹ç±»å‹å®å‚åˆæœ‰è¿›ä¸€æ­¥çš„é™åˆ¶ï¼šåªèƒ½æ˜¯Numberç±»åŠå…¶å­ç±»ã€‚æ­¤æ—¶ï¼Œéœ€è¦ç”¨åˆ°ç±»å‹é€šé…ç¬¦ä¸Šé™ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_5;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> GenericTest_8 &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> main(<span class="built_in">String</span>[] args) &#123;</span><br><span class="line"></span><br><span class="line">        Box&lt;<span class="built_in">String</span>&gt; name = <span class="keyword">new</span> Box&lt;<span class="built_in">String</span>&gt;(<span class="string">"core"</span>);</span><br><span class="line">        Box&lt;Integer&gt; age = <span class="keyword">new</span> Box&lt;Integer&gt;(<span class="number">712</span>);</span><br><span class="line">        Box&lt;<span class="built_in">Number</span>&gt; <span class="built_in">number</span> = <span class="keyword">new</span> Box&lt;<span class="built_in">Number</span>&gt;(<span class="number">314</span>);</span><br><span class="line"></span><br><span class="line">        getData(name);</span><br><span class="line">        getData(age);</span><br><span class="line">        getData(<span class="built_in">number</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//getUpperNumberData(name); // 1</span></span><br><span class="line">        getUpperNumberData(age);    <span class="comment">// 2</span></span><br><span class="line">        getUpperNumberData(<span class="built_in">number</span>); <span class="comment">// 3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> getData(Box&lt;?&gt; data) &#123;</span><br><span class="line">        System.out.println(<span class="string">"data :"</span> + data.getData());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> getUpperNumberData(Box&lt;? <span class="keyword">extends</span> <span class="built_in">Number</span>&gt; data) &#123;</span><br><span class="line">        System.out.println(<span class="string">"data :"</span> + data.getData());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼Œæ˜¾ç„¶ï¼Œåœ¨ä»£ç //1å¤„è°ƒç”¨å°†å‡ºç°é”™è¯¯æç¤ºï¼Œè€Œ//2 //3å¤„è°ƒç”¨æ­£å¸¸ã€‚</p>
<font color="#008080"><strong>ç±»å‹é€šé…ç¬¦ä¸Šé™é€šè¿‡å½¢å¦‚Box&lt; ? extends Number&gt;å½¢å¼å®šä¹‰ï¼Œç›¸å¯¹åº”çš„ï¼Œç±»å‹é€šé…ç¬¦ä¸‹é™ä¸ºBox&lt; ? super Number&gt;å½¢å¼ï¼Œå…¶å«ä¹‰ä¸ç±»å‹é€šé…ç¬¦ä¸Šé™æ­£å¥½ç›¸å</strong>ï¼Œ</font>åœ¨æ­¤ä¸ä½œè¿‡å¤šé˜è¿°äº†ã€‚<br><br><br><br><strong>äº”.è¯å¤–ç¯‡</strong><br><br>æœ¬æ–‡ä¸­çš„ä¾‹å­ä¸»è¦æ˜¯ä¸ºäº†é˜è¿°æ³›å‹ä¸­çš„ä¸€äº›æ€æƒ³è€Œç®€å•ä¸¾å‡ºçš„ï¼Œå¹¶ä¸ä¸€å®šæœ‰ç€å®é™…çš„å¯ç”¨æ€§ã€‚å¦å¤–ï¼Œä¸€æåˆ°æ³›å‹ï¼Œç›¸ä¿¡å¤§å®¶ç”¨åˆ°æœ€å¤šçš„å°±æ˜¯åœ¨é›†åˆä¸­ï¼Œå…¶å®ï¼Œåœ¨å®é™…çš„ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œè‡ªå·±å¯ä»¥ä½¿ç”¨æ³›å‹å»ç®€åŒ–å¼€å‘ï¼Œä¸”èƒ½å¾ˆå¥½çš„ä¿è¯ä»£ç è´¨é‡ã€‚å¹¶ä¸”è¿˜è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒJavaä¸­æ²¡æœ‰æ‰€è°“çš„æ³›å‹æ•°ç»„ä¸€è¯´ã€‚<br><br><font color="red"><strong>å¯¹äºæ³›å‹ï¼Œæœ€ä¸»è¦çš„è¿˜æ˜¯éœ€è¦ç†è§£å…¶èƒŒåçš„æ€æƒ³å’Œç›®çš„ã€‚</strong></font>





]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>æ³›å‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Java 8 æœ€ä½³æŠ€å·§</title>
    <url>/2017/02/18/Java-8-%E6%9C%80%E4%BD%B3%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><blockquote>
<p>ç¿»è¯‘æ–‡ç« <br>è½¬è‡ª<a href="https://muyinchen.github.io/2016/12/13/Java%208%20%E6%9C%80%E4%BD%B3%E6%8A%80%E5%B7%A7/#more" target="_blank" rel="noopener">ä¸€å¶çŸ¥ç§‹</a></p>
</blockquote>
<p><br><br>åœ¨è¿‡å»çš„å‡ å¹´ä¸­ï¼Œæˆ‘ä¸€ç›´ä½¿ç”¨Java 8 è¿›è¡Œäº†å¾ˆå¤šçš„ç¼–ç å·¥ä½œï¼Œç”¨äºå¼€å‘ <a href="http://trishagee.github.io/presentation/java8_in_anger/" target="_blank" rel="noopener">æ–°åº”ç”¨</a> å’Œ <a href="http://trishagee.github.io/presentation/refactoring_to_java_8/" target="_blank" rel="noopener">è¿ç§»é—ç•™åº”ç”¨</a> ï¼Œæˆ‘è§‰å¾—æ˜¯æ—¶å€™å†™ä¸€äº›æœ‰ç”¨çš„â€æœ€ä½³å®è·µâ€ã€‚æˆ‘ä¸ªäººä¸å–œæ¬¢â€æœ€ä½³å®è·µâ€è¿™ä¸ªæœ¯è¯­ï¼Œå› ä¸ºå®ƒæ„å‘³ç€â€œä¸€åˆ€åˆ‡â€çš„è§£å†³æ–¹æ¡ˆï¼Œå½“ç„¶ç¼–ç å·¥ä½œæ˜¯ä¸ä¼šè¿™æ ·çš„â€“è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¼€å‘äººå‘˜ä¼šæƒ³å‡ºé€‚åˆæˆ‘ä»¬çš„æ–¹æ¡ˆã€‚ä½†æˆ‘å‘ç°æˆ‘å¯¹Java8ç‰¹åˆ«çš„å–œæ¬¢ï¼Œå®ƒè®©æˆ‘çš„ç”Ÿæ´»æ›´è½»æ¾ä¸€ç‚¹ï¼Œæ‰€ä»¥æˆ‘æƒ³å°±æ­¤è¯é¢˜å±•å¼€è®¨è®ºã€‚<br><a id="more"></a><br>Optional</p>
<p>Optionalæ˜¯ä¸€ä¸ªè¢«ä¸¥é‡ä½ä¼°çš„åŠŸèƒ½, å®ƒæ¶ˆé™¤äº†å¾ˆå¤šå›°æ‰°ç€æˆ‘ä»¬çš„ NullPointerExceptionsã€‚å®ƒåœ¨ä»£ç è¾¹ç•Œï¼ˆåŒ…æ‹¬ä½ è°ƒç”¨å’Œæä¾› APIï¼‰å¤„ç†ä¸Šç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸ä½ å’Œä½ è°ƒç”¨çš„ä»£ç è¯´æ˜ç¨‹åºè¿è¡Œçš„æœŸæœ›ç»“æœã€‚</p>
<p>ç„¶è€Œï¼Œå¦‚æœæ²¡æœ‰å¿…è¦çš„æ€è€ƒå’Œè®¾è®¡ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´ä¸€ä¸ªå°å˜åŒ–è€Œå½±å“å¤§é‡çš„ç±»ï¼Œä¹Ÿä¼šå¯¼è‡´å¯è¯»æ€§å˜å·®ã€‚è¿™é‡Œæœ‰ä¸€äº›å…³äºå¦‚ä½•é«˜æ•ˆä½¿ç”¨Optionalçš„æç¤ºã€‚<br><br><br>Optional <strong>åº”è¯¥åªç”¨äºè¿”å›ç±»å‹</strong></p>
<p>â€¦ä¸èƒ½æ˜¯å‚æ•°å’Œå±æ€§. é˜…è¯» <a href="http://blog.joda.org/2015/08/java-se-8-optional-pragmatic-approach.html" target="_blank" rel="noopener">è¿™ä¸ªåšå®¢</a> äº†è§£æ€æ ·ä½¿ç”¨ Optionalã€‚ å¹¸è¿çš„æ˜¯, IntelliJ IDEA åœ¨æ‰“å¼€ <a href="https://www.jetbrains.com/help/idea/2016.2/code-inspection.html" target="_blank" rel="noopener">inspection</a> åŠŸèƒ½çš„æƒ…å†µä¸‹ä¼šæ£€æŸ¥ä½ æ˜¯å¦éµå¾ªäº†è¿™äº›å»ºè®®ã€‚</p>
<p><img src="http://img.blog.csdn.net/20161214162906891" alt></p>
<p>å¯é€‰å€¼åº”è¯¥åœ¨ä½¿ç”¨çš„åœ°æ–¹è¿›è¡Œå¤„ç†.IntelliJ IDEA çš„å»ºè®®å¯ä»¥é˜²æ­¢ä½ ä¸æ°å½“çš„ä½¿ç”¨Optional, æ‰€ä»¥ä½ åº”è¯¥ç«‹å³å¤„ç†ä½ å‘ç°çš„ä¸æ°å½“ä½¿ç”¨Optionalã€‚(æ ¹æ®è‡ªå·±çš„ç†è§£ç¿»è¯‘)</p>
<p><img src="http://img.blog.csdn.net/20161214163003908" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p><br><br><strong>ä½ ä¸åº”è¯¥ç®€å•çš„è°ƒç”¨</strong> get()<br>Optionalçš„ç›®çš„æ˜¯ä¸ºäº†è¡¨ç¤ºæ­¤å€¼æœ‰å¯èƒ½ä¸ºç©ºï¼Œä¸”è®©ä½ æœ‰èƒ½åŠ›æ¥åº”ä»˜è¿™ç§æƒ…å†µã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨å€¼ä¹‹å‰è¿›è¡Œæ£€æŸ¥æ˜¯éå¸¸é‡è¦çš„ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ç®€å•çš„è°ƒç”¨get()è€Œæ²¡æœ‰å…ˆä½¿ç”¨isPresent()è¿›è¡Œæ£€æŸ¥æ˜¯ä¸€æ ·ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆé—®é¢˜ã€‚å¹¸è¿çš„æ˜¯ï¼ŒIntelliJ IDEA ä»»ç„¶ä¼šæ£€æŸ¥å‡ºè¿™ä¸ªé—®é¢˜å¹¶è­¦å‘Šä½ ã€‚</p>
<p><img src="http://img.blog.csdn.net/20161214163211900" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"><br><br><br><strong>æœ‰å¯èƒ½æ˜¯ä¸€ä¸ªæ›´ä¼˜é›…çš„æ–¹å¼</strong></p>
<p>isPresent() ä¸  get() ç»“åˆ ä½¿ç”¨çš„æŠ€å·§ â€¦</p>
<p><img src="http://img.blog.csdn.net/20161214163327369" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>â€¦ä½†è¿˜æœ‰æ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚ä½ å¯ä»¥ä½¿ç”¨ orElseæ–¹æ³•æ¥ä½¿å¾—å½“å®ƒä¸ºnullæ—¶ç»™å‡ºä¸€ä¸ªä»£æ›¿çš„å€¼ã€‚</p>
<p><img src="http://img.blog.csdn.net/20161214163422572" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>â€¦æˆ–è€…ä½¿ç”¨ orElseGetæ–¹æ³•æ¥å¤„ç†ä¸Šè¿°ç›¸åŒæƒ…å†µã€‚è¿™ä¸ªä¾‹å­å’Œä¸Šé¢çš„çœ‹èµ·æ¥å¥½åƒä¸€æ ·ï¼Œä½†æœ¬ä¾‹æ˜¯å¯ä»¥è°ƒç”¨ supplier æ¥å£çš„ å®ç° ,ï¼Œå› æ­¤å¦‚æœå®ƒæ˜¯ä¸€ä¸ªé«˜å¼€é”€çš„æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ lambda è¡¨è¾¾å¼æ¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<p><img src="http://img.blog.csdn.net/20161214163525758" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p><strong>ä½¿ç”¨Lambdaè¡¨è¾¾å¼</strong></p>
<p>Lambda è¡¨è¾¾å¼ æ˜¯ Java 8 çš„å–ç‚¹ä¹‹ä¸€.ã€‚å³ä½¿ä½ è¿˜æ²¡æœ‰ä½¿ç”¨è¿‡Java 8ï¼Œ åˆ°ç›®å‰ä½ ä¹Ÿå¯èƒ½æœ‰ä¸€äº›åŸºæœ¬çš„äº†è§£ã€‚ä½†åœ¨Javaç¼–ç¨‹ä¸­è¿˜æ˜¯ä¸€ç§æ–°çš„æ–¹å¼ï¼Œå®ƒä¹Ÿä¸æ˜¯æ˜æ˜¾çš„â€æœ€ä½³å®è·µâ€ ã€‚ è¿™é‡Œæœ‰ä¸€äº›æˆ‘éµå¾ªçš„æŒ‡å—ã€‚</p>
<p><strong>ä¿æŒç®€çŸ­</strong></p>
<p>å‡½æ•°å¼ç¨‹åºå‘˜æ›´æ„¿æ„ä½¿ç”¨è¾ƒé•¿çš„lambda è¡¨è¾¾å¼ï¼Œä½†æˆ‘ä»¬è¿™äº›ä»…ä»…ä½¿ç”¨Javaå¾ˆå¤šå¹´çš„ç¨‹åºå‘˜æ¥è¯´æ›´å®¹æ˜“ä¿æŒlambda è¡¨è¾¾å¼çš„çŸ­å°ã€‚ä½ ç”šè‡³æ›´å–œæ¬¢æŠŠå®ƒä»¬é™åˆ¶åœ¨ä¸€è¡Œï¼Œæ›´å®¹æ˜“æŠŠè¾ƒé•¿çš„è¡¨è¾¾å¼ é‡æ„ åˆ°ä¸€ä¸ªæ–¹æ³•ä¸­ã€‚</p>
<p><img src="http://img.blog.csdn.net/20161214163709620" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>æŠŠå®ƒä»¬å˜æˆä¸€ä¸ªæ–¹æ³•å¼•ç”¨ï¼Œ æ–¹æ³•å¼•ç”¨çœ‹èµ·æ¥æœ‰ä¸€ç‚¹é™Œç”Ÿï¼Œä½†å´å€¼å¾—è¿™æ ·åšï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µæœ‰åŠ©äºæé«˜å¯è¯»æ€§ï¼Œåé¢æˆ‘å†è°ˆå¯è¯»æ€§ã€‚</p>
<p><img src="http://img.blog.csdn.net/20161214163740278" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p><strong>æ˜ç¡®çš„</strong><br>(ä½œè€…åº”è¯¥æƒ³è¦è¡¨è¾¾çš„æ˜¯: å‚æ•°å‘½åè§„èŒƒï¼Œè¦æœ‰æ„ä¹‰ï¼›æœ‰æ›´å¥½çš„ç¿»è¯‘è¯·ä¿®æ­£)</p>
<p>lambda è¡¨è¾¾å¼ä¸­ç±»å‹ä¿¡æ¯å·²ç»ä¸¢å¤±äº†ï¼Œå› æ­¤ä½ ä¼šå‘ç°åŒ…å«ç±»å‹ä¿¡æ¯çš„å‚æ•°ä¼šæ›´æœ‰ç”¨ã€‚</p>
<p><img src="http://img.blog.csdn.net/20161214163826731" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>å¦‚ä½ æ‰€è§ï¼Œè¿™æ ·ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚å› æ­¤æˆ‘æ›´å–œæ¬¢ç»™å‚æ•°ä¸€ä¸ªæ›´æœ‰æ„ä¹‰çš„å‘½åã€‚å½“ç„¶ï¼Œä½ åšä¸å¦ï¼Œ IntelliJ IDEA éƒ½ä¼šè®©ä½ çœ‹åˆ°å‚æ•°çš„ç±»å‹ä¿¡æ¯ã€‚</p>
<p><img src="http://img.blog.csdn.net/20161214163910185" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>å³ä½¿æ˜¯åœ¨å‡½æ•°å¼æ¥å£çš„lambda è¡¨è¾¾å¼ä¸­:</p>
<p><img src="http://img.blog.csdn.net/20161214163951076" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p><strong>é’ˆå¯¹ Lambda è¡¨è¾¾å¼è¿›è¡Œè®¾è®¡</strong></p>
<p>æˆ‘è®¤ä¸ºlambdaè¡¨è¾¾å¼æœ‰ç‚¹åƒ æ³›å‹ â€“ æ³›å‹,æˆ‘ä»¬ç»å¸¸ä½¿ç”¨å®ƒä»¬ (ä¾‹å¦‚, ç»™ List&lt;&gt; æ·»åŠ ç±»å‹ä¿¡æ¯ )ï¼Œä½†ä¸å¸¸è§çš„æ˜¯æˆ‘ä»¬æŠŠä¸€ä¸ªæ–¹æ³•æˆ–ç±»æ³›å‹åŒ– (å¦‚:  Person&lt;â€™T&gt; )ã€‚åŒæ ·çš„, å®ƒå°±åƒæˆ‘ä»¬ä½¿ç”¨é€šè¿‡lambdasåŒ…è£…çš„ Streams APIï¼Œä½†å¯¹æˆ‘ä»¬æ¥è¯´æ›´ç½•è§çš„æ˜¯åˆ›å»ºä¸€ä¸ªéœ€è¦ lambda è¡¨è¾¾å¼å‚æ•°çš„æ–¹æ³•ã€‚</p>
<p><strong>IntelliJ IDEA å¯ä»¥å¸®åŠ©ä½ å¼•å…¥ä¸€ä¸ªå‡½æ•°åŒ–çš„å‚æ•°</strong></p>
<p>è¿™é‡Œè®©ä½ å¯ä»¥ä½¿ç”¨ Lambda è¡¨è¾¾å¼è€Œéå¯¹è±¡æ¥ <a href="https://www.jetbrains.com/help/idea/2016.1/extract-functional-parameter.html" target="_blank" rel="noopener">åˆ›å»ºä¸€ä¸ªå‚æ•°</a> ã€‚è¿™ä¸ªåŠŸèƒ½çš„å¥½å¤„åœ¨äºå…¶å»ºè®®ä½¿ç”¨ä¸€ä¸ªå·²æœ‰çš„ <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/FunctionalInterface.html" target="_blank" rel="noopener">å‡½æ•°æ¥å£</a> æ¥åŒ¹é…è¿™ä¸ªè§„èŒƒã€‚</p>
<p><img src="http://img.blog.csdn.net/20161214164320297" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>è¿™ä¸ªå°†å¼•å¯¼æˆ‘ä»¬</p>
<p><strong>ä½¿ç”¨å·²æœ‰çš„å‡½æ•°æ¥å£</strong></p>
<p>å½“å¼€å‘è€…è¶Šæ¥è¶Šç†Ÿæ‚‰ Java 8 ä»£ç æ—¶ï¼Œæˆ‘ä»¬ä¼šçŸ¥é“ä½¿ç”¨ä¾‹å¦‚ Supplier å’Œ Consumer è¿™æ ·çš„æ¥å£ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä½†æ˜¯å•ç‹¬å†åˆ›å»ºä¸€ä¸ª ErrorMessageCreator ä¼šè®©æˆ‘ä»¬å¾ˆè¯§å¼‚å¹¶ä¸”å¾ˆæµªè´¹æ—¶é—´ã€‚ä½ å¯ä»¥ç¿»é˜… function package æ¥æŸ¥çœ‹ç³»ç»Ÿæœ¬èº«å·²ç»ç»™æˆ‘ä»¬å‡†å¤‡äº†ä»€ä¹ˆã€‚</p>
<p><strong>ä¸ºå‡½æ•°æ¥å£æ·»åŠ  @FunctionalInterface æ³¨è§£</strong></p>
<p>å¦‚æœä½ çœŸçš„éœ€è¦åˆ›å»ºè‡ªå·±çš„å‡½æ•°æ¥å£ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨è¿™ä¸ª  @FunctionalInterface  æ³¨è§£ã€‚è¿™ä¸ªæ³¨è§£ä¼¼ä¹æ²¡å¤šå¤§ç”¨å¤„ï¼Œä½†æ˜¯  IntelliJ IDEA  ä¼šåœ¨æ¥å£ä¸æ»¡è¶³è¿™ä¸ªæ³¨è§£è¦æ±‚çš„æƒ…å†µä¸‹äºˆä»¥æç¤ºã€‚ä¾‹å¦‚ä½ æ²¡æœ‰æŒ‡å®šè¦ç»§æ‰¿çš„æ–¹æ³•ï¼š</p>
<p><img src="http://img.blog.csdn.net/20161214164518523" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>æŒ‡å®šå¤ªå¤šçš„æ–¹æ³•ï¼š</p>
<p><img src="http://img.blog.csdn.net/20161214164547695" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>åœ¨ç±»ä¸­ä½¿ç”¨æ³¨è§£è€Œä¸æ˜¯åœ¨æ¥å£ï¼š</p>
<p><img src="http://img.blog.csdn.net/20161214164619204" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>Lambda è¡¨è¾¾å¼å¯ç”¨äºä»»æ„åªåŒ…å«å•ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ä¸­ï¼Œä½†æ˜¯ä¸èƒ½ç”¨äºæ»¡è¶³è¯¥è¦æ±‚çš„æŠ½è±¡ç±»ã€‚çœ‹ä¼¼ä¸ç¬¦åˆé€»è¾‘ï¼Œä½†å®é™…è¦æ±‚å¿…é¡»å¦‚æ­¤ã€‚</p>
<p><br><br><strong>Streams</strong></p>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html" target="_blank" rel="noopener">Stream</a> API æ˜¯Java 8çš„å¦ä¸€å¤§å–ç‚¹, æˆ‘è®¤ä¸ºåˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»ç„¶ä¸çŸ¥é“è¿™ä¼šå¯¹æˆ‘ä»¬çš„ç¼–ç æ–¹å¼æœ‰å¤šå¤§æ”¹å˜ï¼ä½†æˆ‘å‘ç°è¿™æ˜¯ä¸€ä¸ªå¥½åå‚åŠçš„åŠŸèƒ½ã€‚</p>
<p><strong>æµå¼é£æ ¼</strong></p>
<p>å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæ›´å–œæ¬¢ä½¿ç”¨æµå¼é£æ ¼ï¼å½“ç„¶ä½ ä¸å¿…ä¹Ÿè¿™ä¹ˆåš, ä½†æˆ‘å‘ç°å®ƒå¸®åŠ©äº†æˆ‘ï¼š</p>
<p>  Â·ä¸€çœ¼å°±èƒ½çœ‹å‡ºæœ‰å“ªäº›æ“ä½œï¼Œå®ƒçš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆ<br>Â·æ›´æ–¹ä¾¿è°ƒè¯•ï¼ˆè™½ç„¶IntelliJ IDEAæä¾›äº† <a href="https://www.youtube.com/watch?v=rimzOolGguo&amp;feature=youtu.be&amp;t=3s" target="_blank" rel="noopener">åœ¨åŒ…å«lambdaè¡¨è¾¾å¼çš„è¡Œä¸Šè®¾ç½®æ–­ç‚¹çš„èƒ½åŠ›</a> ï¼Œä¸ºäº†æ›´æ–¹ä¾¿è°ƒè¯•ï¼ŒæŠŠå®ƒæ‹†åˆ†åˆ°ä¸åŒçš„è¡Œä¸Šï¼‰* åœ¨æµ‹è¯•çš„æ—¶å€™å…è®¸å–æ¶ˆä¸€ä¸ªæ“ä½œ<br>Â·åœ¨è°ƒè¯•æˆ–æµ‹è¯•æ˜¯ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ’å…¥peek()</p>
<p><img src="http://img.blog.csdn.net/20161214165029299" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>åœ¨æˆ‘çœ‹æ¥è¿™æ ·å†™å¾ˆç®€æ´ã€‚ä½†æ˜¯ä½¿ç”¨è¿™ç§æ–¹æ³•å¹¶æ²¡æœ‰ç»™æˆ‘ä»¬èŠ‚çœå¤šå°‘ä»£ç è¡Œã€‚ä½ å¯èƒ½éœ€è¦è°ƒæ•´ä»£ç æ ¼å¼åŒ–è®¾ç½®è®©ä»£ç çœ‹èµ·æ¥æ›´åŠ æ¸…æ™°ã€‚</p>
<p><img src="http://img.blog.csdn.net/20161214165143409" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p><br><br><strong>ä½¿ç”¨æ–¹æ³•å¼•ç”¨</strong></p>
<p>æ˜¯çš„ï¼Œä½ éœ€è¦ä¸€ç‚¹æ—¶é—´æ¥é€‚åº”è¿™ä¸ªå¥‡æ€ªçš„è¯­æ³•ã€‚ä½†å¦‚æœä½¿ç”¨æ°å½“ï¼ŒçœŸçš„å¯ä»¥æå‡ä»£ç çš„å¯è¯»æ€§ï¼Œçœ‹çœ‹ä¸‹é¢ä»£ç ï¼š</p>
<p><img src="http://img.blog.csdn.net/20161214165247861" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>ä»¥åŠä½¿ç”¨ Objects ç±»çš„è¾…åŠ©æ–¹æ³•ï¼š</p>
<p><img src="http://img.blog.csdn.net/20161214165331410" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>åé¢ä¸€æ®µä»£ç æ›´åŠ çš„æ˜ç¡®å¯è¯»ã€‚IntelliJ IDEA é€šå¸¸ä¼šçŸ¥é“æ€ä¹ˆå°†ä¸€ä¸ª Lambda è¡¨è¾¾å¼è¿›è¡ŒæŠ˜å ã€‚</p>
<p><img src="http://img.blog.csdn.net/20161214165408051" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p><strong>å½“å¯¹é›†åˆè¿›è¡Œå…ƒç´ è¿­ä»£æ—¶ï¼Œå°½å¯èƒ½çš„ä½¿ç”¨ Streams API</strong></p>
<p>â€¦æˆ–è€…ç”¨æ–°çš„é›†åˆæ–¹æ³•ï¼Œä¾‹å¦‚ forEach . IntelliJ IDEA ä¼šå»ºè®®ä½ è¿™ä¹ˆåšï¼š</p>
<p><img src="http://img.blog.csdn.net/20161214165535504" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>ä¸€èˆ¬æ¥è¯´ä½¿ç”¨ Streams API æ¯”èµ·å¾ªç¯å’Œ if è¯­å¥ç»„åˆæ¥å¾—æ›´åŠ ç›´è§‚ï¼Œä¾‹å¦‚ï¼š</p>
<p><img src="http://img.blog.csdn.net/20161214165613194" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>IntelliJ IDEA ä¼šå»ºè®®è¿™æ ·çš„å†™æ³•è¿›è¡Œé‡æ„ï¼š</p>
<p><img src="http://img.blog.csdn.net/20161214165649927" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>æˆ‘åšè¿‡çš„æ€§èƒ½æµ‹è¯•æ˜¾ç¤ºè¿™ç§é‡æ„å¸¦æ¥çš„ç»“æœæ¯”è¾ƒå¥‡æ€ªï¼Œéš¾ä»¥é¢„æµ‹ï¼Œæœ‰æ—¶å€™å¥½ï¼Œæœ‰æ—¶å€™åï¼Œæœ‰æ—¶å€™æ²¡åŒºåˆ«ã€‚ä¸€å¦‚æ—¢å¾€çš„ï¼Œå¦‚æœä½ çš„åº”ç”¨å¯¹æ€§èƒ½é—®é¢˜éå¸¸åœ¨æ„ï¼Œè¯·è®¤çœŸçš„è¿›è¡Œè¡¡é‡ã€‚</p>
<p><strong>éå†æ•°ç»„æ—¶è¯·ç”¨ for å¾ªç¯</strong></p>
<p>ç„¶åï¼Œä½¿ç”¨ Java 8 å¹¶ä¸æ„å‘³ç€ä½ ä¸€å®šè¦ä½¿ç”¨æµ API ä»¥åŠé›†åˆçš„æ–°æ–¹æ³•ã€‚IntelliJ IDEA ä¼šå»ºè®®ä¸€äº›åšæ³•æ”¹ç”¨æµçš„æ–¹å¼é‡æ„ï¼Œä½†ä½ ä¸ä¸€å®šéå¾—æ¥å— (è®°ä½ <a href="https://www.jetbrains.com/help/idea/2016.2/suppressing-inspections.html" target="_blank" rel="noopener">inspections can be suppressed</a> æˆ–è€… <a href="https://www.jetbrains.com/help/idea/2016.2/disabling-and-enabling-inspections.html" target="_blank" rel="noopener">turned off</a> ).</p>
<p>ç‰¹åˆ«æ˜¯å¯¹ä¸€ä¸ªåŸå§‹ç±»å‹çš„å°æ•°ç»„æ—¶ï¼Œä½¿ç”¨ for å¾ªç¯çš„æ€§èƒ½æ˜¯æœ€å¥½çš„ï¼Œè€Œä¸”ä»£ç æ›´å…·å¯è¯»æ€§ï¼ˆè‡³å°‘å¯¹ Streams API çš„æ–°æ‰‹æ¥è¯´æ˜¯è¿™æ ·ï¼‰ï¼š</p>
<p><img src="http://img.blog.csdn.net/20161214165851697" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>ä»»ä½•çš„æŠ€å·§å’Œæç¤ºéƒ½ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œä½ åº”è¯¥è‡ªå·±å†³å®šå“ªé‡Œéœ€è¦ä½¿ç”¨ Streams API ï¼Œè€Œå“ªé‡Œè¿˜ç”¨å¾ªç¯æ“ä½œã€‚</p>
<p><strong>æœ€å</strong></p>
<p>æˆ‘æ¯å¤©éƒ½åœ¨å‘ç°ä¸€äº›æ–°çš„ä¸œè¥¿ï¼Œæœ‰æ—¶å€™æˆ‘çš„åå¥½ä¼šæœ‰æ‰€å˜åŒ–ã€‚ä¾‹å¦‚æˆ‘è¿‡å»ä¼šè®¨åŒæ–¹æ³•çš„å¼•ç”¨ã€‚éå¸¸æœŸå¾…å€¾å¬ä½ çš„å»ºè®®ã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Loggerçº§åˆ«</title>
    <url>/2017/02/18/Logger%E7%BA%A7%E5%88%AB/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æ—¥å¿—è®°å½•å™¨(Logger)æ˜¯æ—¥å¿—å¤„ç†çš„æ ¸å¿ƒç»„ä»¶ã€‚log4jå…·æœ‰5ç§æ­£å¸¸çº§åˆ«(Level)ã€‚æ—¥å¿—è®°å½•å™¨(Logger)çš„å¯ç”¨çº§åˆ«Level (ä¸åŒ…æ‹¬è‡ªå®šä¹‰çº§åˆ« Level)ï¼Œ <a id="more"></a>ä»¥ä¸‹å†…å®¹å°±æ˜¯æ‘˜è‡ªlog4j API (<a href="http://jakarta.apache.org/log4j/docs/api/index.html)" target="_blank" rel="noopener">http://jakarta.apache.org/log4j/docs/api/index.html)</a>:<br><br><strong>static Level DEBUG</strong><br><br>DEBUG LevelæŒ‡å‡ºç»†ç²’åº¦ä¿¡æ¯äº‹ä»¶å¯¹è°ƒè¯•åº”ç”¨ç¨‹åºæ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚<br><strong>static Level INFO</strong><br><br>INFO levelè¡¨æ˜ æ¶ˆæ¯åœ¨ç²—ç²’åº¦çº§åˆ«ä¸Šçªå‡ºå¼ºè°ƒåº”ç”¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ã€‚<br><strong>static Level WARN</strong><br><br>WARN levelè¡¨æ˜ä¼šå‡ºç°æ½œåœ¨é”™è¯¯çš„æƒ…å½¢ã€‚<br><strong>static Level ERROR</strong><br><br>ERROR levelæŒ‡å‡ºè™½ç„¶å‘ç”Ÿé”™è¯¯äº‹ä»¶ï¼Œä½†ä»ç„¶ä¸å½±å“ç³»ç»Ÿçš„ç»§ç»­è¿è¡Œã€‚<br><strong>static Level FATAL</strong><br><br>FATAL levelæŒ‡å‡ºæ¯ä¸ªä¸¥é‡çš„é”™è¯¯äº‹ä»¶å°†ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºçš„é€€å‡ºã€‚<br>å¦å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªå¯ç”¨çš„ç‰¹åˆ«çš„æ—¥å¿—è®°å½•çº§åˆ«: (ä»¥ä¸‹æè¿°æ¥è‡ªlog4j API <a href="http://jakarta.apache.org/log4j/docs/api/index.html)" target="_blank" rel="noopener">http://jakarta.apache.org/log4j/docs/api/index.html)</a>:<br><br><strong>static Level ALL</strong><br><br>ALL Levelæ˜¯æœ€ä½ç­‰çº§çš„ï¼Œç”¨äºæ‰“å¼€æ‰€æœ‰æ—¥å¿—è®°å½•ã€‚<br><strong>static Level OFF</strong><br><br>OFF Levelæ˜¯æœ€é«˜ç­‰çº§çš„ï¼Œç”¨äºå…³é—­æ‰€æœ‰æ—¥å¿—è®°å½•ã€‚<br>æ—¥å¿—è®°å½•å™¨ï¼ˆLoggerï¼‰çš„è¡Œä¸ºæ˜¯åˆ†ç­‰çº§çš„ã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š<br>åˆ†ä¸ºOFFã€FATALã€ERRORã€WARNã€INFOã€DEBUGã€ALLæˆ–è€…æ‚¨å®šä¹‰çš„çº§åˆ«ã€‚<font color="red">Log4jå»ºè®®åªä½¿ç”¨å››ä¸ªçº§åˆ«ï¼Œä¼˜å…ˆçº§ä»é«˜åˆ°ä½åˆ†åˆ«æ˜¯ ERRORã€WARNã€INFOã€DEBUGã€‚</font>é€šè¿‡åœ¨è¿™é‡Œå®šä¹‰çš„çº§åˆ«ï¼Œæ‚¨å¯ä»¥æ§åˆ¶åˆ°åº”ç”¨ç¨‹åºä¸­ç›¸åº”çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯çš„å¼€å…³ã€‚<font color="red">æ¯”å¦‚åœ¨è¿™é‡Œå®šä¹‰äº†INFOçº§åˆ«ï¼Œåˆ™åº”ç”¨ç¨‹åºä¸­æ‰€æœ‰DEBUGçº§åˆ«çš„æ—¥å¿—ä¿¡æ¯å°†ä¸è¢«æ‰“å°å‡ºæ¥ï¼Œä¹Ÿæ˜¯è¯´å¤§äºç­‰äºçš„çº§åˆ«çš„æ—¥å¿—æ‰è¾“å‡ºã€‚</font></p>
<font color="red">æ—¥å¿—è®°å½•çš„çº§åˆ«æœ‰ç»§æ‰¿æ€§ï¼Œå­ç±»ä¼šè®°å½•çˆ¶ç±»çš„æ‰€æœ‰çš„æ—¥å¿—çº§åˆ«ã€‚</font>]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Logger</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaæ¥å£æ˜¯å¸¸é‡å­˜æ”¾çš„æœ€ä½³åœ°ç‚¹å—ï¼Ÿ</title>
    <url>/2017/02/18/Java%E6%8E%A5%E5%8F%A3%E6%98%AF%E5%B8%B8%E9%87%8F%E5%AD%98%E6%94%BE%E7%9A%84%E6%9C%80%E4%BD%B3%E5%9C%B0%E7%82%B9%E5%90%97%EF%BC%9F/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä»Šå¤©å¶ç„¶çœ‹åˆ°æ¥å£ä¸­ä¸èƒ½åŒ…å«<strong>å®ä¾‹åŸŸ</strong>æˆ–<strong>é™æ€æ–¹æ³•</strong>ï¼Œä½†æ˜¯å´å¯ä»¥åŒ…å«<strong>å¸¸é‡</strong>ã€‚<br><br>å…¶å®åœ¨ä¹‹å‰ï¼Œå°±çŸ¥é“è¿™ä¹ˆå›äº‹ï¼Œä½†æ˜¯ä¸€ç›´åªæ˜¯å½“åšçŸ¥é“è€Œå·²ï¼Œç°åœ¨å›è¿‡å¤´æ¥å·©å›ºåŸºç¡€ï¼Œè§‰å¾—æœ‰å¿…è¦å¤šæƒ³æƒ³ã€‚<br><a id="more"></a><br>é¦–å…ˆï¼Œç”±äºjavaçš„æ¥å£ä¸­å£°æ˜çš„å­—æ®µåœ¨ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨åŠ ä¸Šstatic finalçš„ä¿®é¥°ç¬¦ï¼Œå³å£°æ˜ä¸ºå¸¸é‡ã€‚å› è€Œæ¥å£é€šå¸¸æ˜¯å­˜æ”¾å¸¸é‡çš„æœ€ä½³åœ°ç‚¹ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥çœå»å¾ˆå¤šä¿®é¥°ç¬¦å˜›ï¼Œç„¶è€Œåœ¨javaçš„å®é™…åº”ç”¨æ—¶å´ä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ã€‚<br></p>
<p>é—®é¢˜çš„èµ·å› ä¸ªäººè§‰å¾—æœ‰ä¸¤ä¸ª:<br><br>ç¬¬ä¸€ï¼Œæ˜¯æˆ‘ä»¬æ‰€ä½¿ç”¨çš„å¸¸é‡å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œè€Œæ˜¯ç›¸å¯¹äºå˜é‡ä¸èƒ½èµ‹å€¼æ”¹å˜ã€‚ä¾‹å¦‚æˆ‘ä»¬åœ¨ä¸€ä¸ªé¡¹ç›®åˆæœŸå®šä¹‰å¸¸é‡Ï€ï¼3.14ï¼Œè€Œç”±äºè®¡ç®—ç²¾åº¦çš„æé«˜æˆ‘ä»¬å¯èƒ½ä¼šé‡æ–°å®šä¹‰Ï€ï¼3.14159ï¼Œæ­¤æ—¶æ•´ä¸ªé¡¹ç›®å¯¹æ­¤å¸¸é‡çš„å¼•ç”¨éƒ½åº”è¯¥åšå‡ºæ”¹å˜ã€‚<br><br>ç¬¬äºŒï¼Œjavaæ˜¯åŠ¨æ€è¯­è¨€ã€‚ä¸c++ä¹‹ç±»çš„é™æ€è¯­è¨€ä¸åŒ,javaå¯¹ä¸€äº›å­—æ®µçš„å¼•ç”¨å¯ä»¥åœ¨è¿è¡ŒæœŸåŠ¨æ€è¿›è¡Œï¼Œè¿™ç§çµæ´»æ€§æ˜¯javaè¿™æ ·çš„åŠ¨æ€è¯­è¨€çš„ä¸€å¤§ä¼˜åŠ¿ã€‚ä¹Ÿå°±ä½¿å¾—æˆ‘ä»¬åœ¨javaé¡¹ç›®ä¸­æœ‰æ—¶éƒ¨åˆ†å†…å®¹çš„æ”¹å˜ä¸ç”¨é‡æ–°ç¼–è¯‘æ•´ä¸ªé¡¹ç›®ï¼Œè€Œåªéœ€ç¼–è¯‘æ”¹å˜çš„éƒ¨åˆ†é‡æ–°å‘å¸ƒå°±å¯ä»¥æ”¹å˜æ•´ä¸ªåº”ç”¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªinterface Aï¼Œä¸€ä¸ªclass Bï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> interface A&#123;</span><br><span class="line">	<span class="keyword">String</span> name = <span class="string">"bright"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span>&#123;</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span></span>&#123;</span><br><span class="line">		System.out.<span class="built_in">println</span>(<span class="string">"Class A's name = "</span> + A.name);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘Aå’ŒBã€‚<br><br>è¿è¡Œï¼Œè¾“å…¥java Bï¼Œæ˜¾ç„¶ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight monkey"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">A</span>'<span class="title">s</span> <span class="title">name</span> = <span class="title">bright</span></span></span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬ç°åœ¨ä¿®æ”¹Aå¦‚ä¸‹ï¼š<br><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">public<span class="built_in"> interface </span>A&#123;</span><br><span class="line">	String name = <span class="string">"bright sea"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç¼–è¯‘Aåé‡æ–°è¿è¡ŒBï¼Œè¾“å…¥java Bï¼Œæ³¨æ„ï¼šç»“æœå¦‚ä¸‹<br><figure class="highlight monkey"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">A</span>'<span class="title">s</span> <span class="title">name</span> = <span class="title">bright</span></span></span><br></pre></td></tr></table></figure></p>
<p>ä¸ºä»€ä¹ˆä¸æ˜¯â€Class Aâ€™s name = bright seaâ€ï¼Ÿè®©æˆ‘ä»¬ä½¿ç”¨jdkæä¾›çš„åç¼–è¯‘å·¥å…·javapåç¼–è¯‘B.classçœ‹ä¸ªç©¶ç«Ÿï¼Œè¾“å…¥ï¼šjavap -c B ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight monkey"><table><tr><td class="code"><pre><span class="line">Compiled from B.java</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Object</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span> B();</span><br><span class="line">    <span class="keyword">public</span> static void main(java.lang.String[]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">Method</span> <span class="title">B</span>(</span>)</span><br><span class="line">   <span class="number">0</span> aload_0</span><br><span class="line">   <span class="number">1</span> invokespecial<span class="meta"> #1 &lt;Method java.lang.Object()&gt;</span></span><br><span class="line">   <span class="number">4</span> <span class="keyword">return</span></span><br><span class="line"><span class="function"><span class="keyword">Method</span> <span class="title">void</span> <span class="title">main</span>(</span>java.lang.String[])</span><br><span class="line">   <span class="number">0</span> getstatic<span class="meta"> #2 &lt;Field java.io.PrintStream out&gt;</span></span><br><span class="line">   <span class="number">3</span> ldc<span class="meta"> #3 &lt;String "Class A's name = bright"&gt;</span></span><br><span class="line">   <span class="number">5</span> invokevirtual<span class="meta"> #4 &lt;Method void println(java.lang.String)&gt;</span></span><br><span class="line">   <span class="number">8</span> <span class="keyword">return</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°æ ‡å·3çš„ä»£ç äº†å—ï¼Ÿç”±äºå¼•ç”¨äº†ä¸€ä¸ªstatic final çš„å­—æ®µï¼Œç¼–è¯‘å™¨å·²ç»å°†interface Aä¸­nameçš„å†…å®¹ç¼–è¯‘è¿›äº†class Bä¸­ï¼Œè€Œä¸æ˜¯å¯¹interface Aä¸­çš„nameçš„å¼•ç”¨ã€‚å› æ­¤é™¤éæˆ‘ä»¬é‡æ–°ç¼–è¯‘class Bï¼Œinterface Aä¸­nameå‘ç”Ÿçš„å˜åŒ–æ— æ³•åœ¨class Bä¸­åæ˜ ã€‚å¦‚æœè¿™æ ·å»åšé‚£ä¹ˆjavaçš„åŠ¨æ€ä¼˜åŠ¿å°±æ¶ˆå¤±æ®†å°½ã€‚<br></p>
<p>è§£å†³æ–¹æ¡ˆï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ³•ã€‚<br><br>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä¸å†ä½¿ç”¨å¸¸é‡ï¼Œå°†æ‰€éœ€å­—æ®µæ”¾å…¥classä¸­å£°æ˜ï¼Œå¹¶å»æ‰finalä¿®é¥°ç¬¦ã€‚ä½†è¿™ç§æ–¹æ³•å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œç”±äºä¸å†æ˜¯å¸¸é‡ç€å› è€Œåœ¨ç³»ç»Ÿè¿è¡Œæ—¶æœ‰å¯èƒ½è¢«å…¶ä»–ç±»ä¿®æ”¹å…¶å€¼è€Œå‘ç”Ÿé”™è¯¯ï¼Œä¹Ÿå°±è¿èƒŒäº†æˆ‘ä»¬è®¾ç½®å®ƒä¸ºå¸¸é‡çš„åˆè¡·ï¼Œå› è€Œä¸æ¨èä½¿ç”¨ã€‚<br><br>ç¬¬äºŒç§æ–¹æ³•ï¼Œå°†å¸¸é‡æ”¾å…¥classä¸­å£°æ˜ï¼Œä½¿ç”¨classæ–¹æ³•æ¥å¾—åˆ°æ­¤å¸¸é‡çš„å€¼ã€‚ä¸ºäº†ä¿æŒå¯¹æ­¤å¸¸é‡å¼•ç”¨çš„ç®€å•æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé™æ€æ–¹æ³•ã€‚æˆ‘ä»¬å°†A.javaå’ŒB.javaä¿®æ”¹å¦‚ä¸‹ï¼š<br><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> name = <span class="string">"bright"</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span>&#123;</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span></span>&#123;</span><br><span class="line">		System.out.<span class="built_in">println</span>(<span class="string">"Class A's name = "</span> + A.getName());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åŒæ ·æˆ‘ä»¬ç¼–è¯‘Aå’ŒBã€‚è¿è¡Œclass Bï¼Œè¾“å…¥java Bï¼Œæ˜¾ç„¶ç»“æœå¦‚ä¸‹ï¼š<br>Class Aâ€™s name = bright<br>ç°åœ¨æˆ‘ä»¬ä¿®æ”¹Aå¦‚ä¸‹ï¼š<br><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> name = <span class="string">"bright"</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å†æ¬¡ç¼–è¯‘Aåé‡æ–°è¿è¡ŒBï¼Œè¾“å…¥java Bï¼šç»“æœå¦‚ä¸‹<br><figure class="highlight monkey"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">A</span>'<span class="title">s</span> <span class="title">name</span> = <span class="title">bright</span> <span class="title">sea</span></span></span><br></pre></td></tr></table></figure></p>
<p>ç»ˆäºå¾—åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡åç¼–è¯‘Bçœ‹çœ‹class Bçš„æ”¹å˜ï¼Œè¾“å…¥<br>javap -c B,ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">Compiled from B.java</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Object</span> </span>&#123;</span><br><span class="line">    public B();</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> main(java.lang.<span class="built_in">String</span>[]);</span><br><span class="line">&#125;</span><br><span class="line">Method B()</span><br><span class="line">   <span class="number">0</span> aload_0</span><br><span class="line">   <span class="number">1</span> invokespecial #<span class="number">1</span> &lt;Method java.lang.<span class="built_in">Object</span>()&gt;</span><br><span class="line">   <span class="number">4</span> <span class="keyword">return</span></span><br><span class="line">Method <span class="keyword">void</span> main(java.lang.<span class="built_in">String</span>[])</span><br><span class="line">   <span class="number">0</span> getstatic #<span class="number">2</span> &lt;Field java.io.PrintStream out&gt;</span><br><span class="line">   <span class="number">3</span> <span class="keyword">new</span> #<span class="number">3</span> &lt;Class java.lang.<span class="built_in">StringBuffer</span>&gt;</span><br><span class="line">   <span class="number">6</span> dup</span><br><span class="line">   <span class="number">7</span> invokespecial #<span class="number">4</span> &lt;Method java.lang.<span class="built_in">StringBuffer</span>()&gt;</span><br><span class="line">  <span class="number">10</span> ldc #<span class="number">5</span> &lt;<span class="built_in">String</span> <span class="string">"Class A's name = "</span>&gt;</span><br><span class="line">  <span class="number">12</span> invokevirtual #<span class="number">6</span> &lt;Method java.lang.<span class="built_in">StringBuffer</span> append(java.lang.<span class="built_in">String</span>)&gt;</span><br><span class="line">  <span class="number">15</span> invokestatic #<span class="number">7</span> &lt;Method java.lang.<span class="built_in">String</span> getName()&gt;</span><br><span class="line">  <span class="number">18</span> invokevirtual #<span class="number">6</span> &lt;Method java.lang.<span class="built_in">StringBuffer</span> append(java.lang.<span class="built_in">String</span>)&gt;</span><br><span class="line">  <span class="number">21</span> invokevirtual #<span class="number">8</span> &lt;Method java.lang.<span class="built_in">String</span> toString()&gt;</span><br><span class="line">  <span class="number">24</span> invokevirtual #<span class="number">9</span> &lt;Method <span class="keyword">void</span> println(java.lang.<span class="built_in">String</span>)&gt;</span><br><span class="line">  <span class="number">27</span> <span class="keyword">return</span></span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„æ ‡å·10è‡³15è¡Œçš„ä»£ç ï¼Œclass Bä¸­å·²ç»å˜ä¸ºå¯¹A classçš„getName()æ–¹æ³•çš„å¼•ç”¨ï¼Œå½“å¸¸é‡nameçš„å€¼æ”¹å˜æ—¶æˆ‘ä»¬åªéœ€å¯¹class Aä¸­çš„å¸¸é‡åšä¿®æ”¹å¹¶é‡æ–°ç¼–è¯‘ï¼Œæ— éœ€ç¼–è¯‘æ•´ä¸ªé¡¹ç›®å·¥ç¨‹æˆ‘ä»¬å°±èƒ½æ”¹å˜æ•´ä¸ªåº”ç”¨å¯¹æ­¤å¸¸é‡çš„å¼•ç”¨ï¼Œå³ä¿æŒäº†javaåŠ¨æ€ä¼˜åŠ¿åˆä¿æŒäº†æˆ‘ä»¬ä½¿ç”¨å¸¸é‡çš„åˆè¡·ï¼Œå› è€Œæ–¹æ³•äºŒæ˜¯ä¸€ä¸ªæœ€ä½³è§£å†³æ–¹æ¡ˆã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>æ¥å£</tag>
        <tag>å¸¸é‡</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaåå°„å­¦ä¹ æ€»ç»“ï¼ˆäº”ï¼‰</title>
    <url>/2017/02/18/Java%E5%8F%8D%E5%B0%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%88%E4%BA%94%EF%BC%89/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><strong>ä½¿ç”¨åå°„å®ä¾‹å¯¹è±¡</strong></p>
<p>ä½¿ç”¨åå°„æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ç±»å¹¶ä¸”å®ä¾‹åŒ–å¯¹è±¡ï¼Œæ“ä½œå¯¹è±¡çš„æ–¹æ³•ã€æ”¹å˜ç±»æˆå‘˜çš„å€¼ï¼Œç”šè‡³è¿˜å¯ä»¥æ”¹å˜ç§æœ‰ï¼ˆprivateï¼‰æˆå‘˜çš„å€¼ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨ Class çš„ newInstance() æ–¹æ³•æ¥å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œå®ä¾‹åŒ–çš„å¯¹è±¡æ˜¯ä»¥ Object ä¼ å›çš„ï¼Œä¾‹å¦‚ï¼š<br><a id="more"></a><br><figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Class</span> c = <span class="keyword">Class</span>.forName(className);</span><br><span class="line"><span class="keyword">Object</span> obj = c.newInstance();</span><br></pre></td></tr></table></figure></p>
<p>ä¸‹é¢èŒƒä¾‹åŠ¨æ€åŠ è½½listæ¥å£çš„ç±»ï¼š</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewInstanceDemo</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">            List <span class="built_in">list</span> = (List) c.newInstance();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                <span class="built_in">list</span>.add(<span class="string">"element "</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Object o : <span class="built_in">list</span>.toArray()) &#123;</span><br><span class="line">                System.out.<span class="built_in">println</span>(o);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">"æ‰¾ä¸åˆ°æŒ‡å®šçš„ç±»"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">java CoreJava.day_2.NewInstanceDemo java.util.ArrayList</span><br><span class="line"><span class="keyword">element</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">element</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">element</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">element</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">element</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šå¦‚æœæƒ³è¦ä½¿ç”¨åå°„æ¥åŠ¨æ€åŠ è½½ç±»ï¼Œé€šå¸¸æ˜¯å¯¹å¯¹è±¡çš„æ¥å£æˆ–ç±»åˆ«éƒ½ä¸€æ— æ‰€çŸ¥ï¼Œä¹Ÿå°±æ— æ³•åƒä¸Šé¢å¯¹ newInstance() ä¼ å›çš„å¯¹è±¡è¿›è¡Œæ¥å£è½¬æ¢ã€‚</p>
<p>å¦‚æœåŠ è½½çš„ç±»ä¸­å…·å¤‡æ— å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œåˆ™å¯ä»¥æ— å‚æ•°çš„ newInstance() æ¥æ„é€ ä¸€ä¸ªä¸æŒ‡å®šåˆå§‹åŒ–çš„å¼•ç”¨ï¼Œå¦‚æœè¦åœ¨åŠ¨æ€åŠ è½½åŠç”Ÿæˆå¯¹è±¡æ—¶æŒ‡å®šå¯¹è±¡çš„å¼•ç”¨ï¼Œåˆ™è¦å…ˆæŒ‡å®šå‚æ•°ç±»å‹ã€å–å¾— Constructor å¯¹è±¡ã€ä½¿ç”¨ Constructor çš„ newInstance() å¹¶æŒ‡å®šå‚æ•°ã€‚</p>
<p>å¯ä»¥ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ï¼Œå…ˆå®šä¹‰ä¸€ä¸ªstudentç±»:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> score;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        name = <span class="string">"N/A"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(<span class="keyword">String</span> name, <span class="keyword">int</span> score)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.score = score;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="keyword">String</span> name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScore</span><span class="params">(<span class="keyword">int</span> score)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.score = score;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getScore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> score;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name + <span class="string">":"</span> + score;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ç”¨ Class.forName() æ¥åŠ è½½ Student ï¼Œå¹¶ä½¿ç”¨ç¬¬äºŒä¸ªæœ‰å‚æ•°çš„æ„é€ æ–¹æ³•æ¥æ„é€ Student å®ä¾‹ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> NewInstanceDemo2 &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> main(<span class="built_in">String</span>[] args) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æŒ‡å®šå‚æ•°</span></span><br><span class="line">            Class[] params = <span class="keyword">new</span> Class[<span class="number">2</span>];</span><br><span class="line">            <span class="comment">// ç¬¬ä¸€ä¸ªæ˜¯String</span></span><br><span class="line">            params[<span class="number">0</span>] = <span class="built_in">String</span>.class;</span><br><span class="line">            <span class="comment">// ç¬¬äºŒä¸ªæ˜¯int</span></span><br><span class="line">            params[<span class="number">1</span>] = Integer.TYPE;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å–å¾—å¯¹åº”çš„æ„é€ æ–¹æ³•</span></span><br><span class="line">            Constructor <span class="keyword">constructor</span> =</span><br><span class="line">                    c.getConstructor(<span class="params">params</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æŒ‡å®šå¼•ç”¨å†…å®¹</span></span><br><span class="line">            <span class="built_in">Object</span>[] argObjs = <span class="keyword">new</span> <span class="built_in">Object</span>[<span class="number">2</span>];</span><br><span class="line">            argObjs[<span class="number">0</span>] = <span class="string">"caterpillar"</span>;</span><br><span class="line">            argObjs[<span class="number">1</span>] = <span class="keyword">new</span> Integer(<span class="number">90</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç»™å®šå¼•ç”¨å¹¶åˆå§‹åŒ–</span></span><br><span class="line">            <span class="built_in">Object</span> obj = <span class="keyword">constructor</span>.newInstance(<span class="params">argObjs</span>);</span><br><span class="line">            <span class="comment">// toString()æŸ¥çœ‹</span></span><br><span class="line">            System.out.println(obj);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"æ‰¾ä¸åˆ°ç±»"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"æ²¡æœ‰æ‰€æŒ‡å®šçš„æ–¹æ³•"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">java</span> <span class="selector-tag">NewInstanceDemo2</span> <span class="selector-tag">CoreJava</span><span class="selector-class">.day_2</span><span class="selector-class">.Student</span></span><br><span class="line"><span class="selector-tag">caterpillar</span><span class="selector-pseudo">:90</span></span><br></pre></td></tr></table></figure>
<p><strong>è°ƒç”¨æ–¹æ³•</strong></p>
<p>ä½¿ç”¨åå°„å¯ä»¥å–å›ç±»ä¸Šæ–¹æ³•çš„å¯¹è±¡ä»£è¡¨ï¼Œæ–¹æ³•çš„ç‰©ä»¶ä»£è¡¨æ˜¯ java.lang.reflect.Method çš„å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒçš„ invoke() æ–¹æ³•æ¥åŠ¨æ€è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•ï¼Œä¾‹å¦‚è°ƒç”¨ä¸Šé¢ Student ä¸Šçš„ setName() ç­‰æ–¹æ³•ï¼š</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> InvokeMethodDemo &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">Class</span> c = <span class="keyword">Class</span>.forName(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="comment">// ä½¿ç”¨æ— å‚æ„é€ æ–¹æ³•å®ä¾‹å¯¹è±¡</span></span><br><span class="line">            Object targetObj = c.newInstance();</span><br><span class="line">            <span class="comment">// è®¾ç½®å‚æ•°ç±»å‹</span></span><br><span class="line">            <span class="keyword">Class</span>[] param1 = &#123;String.<span class="keyword">class</span>&#125;;</span><br><span class="line">            <span class="comment">// æ ¹æ®å‚æ•°å–å›æ–¹æ³•</span></span><br><span class="line">            Method setNameMethod = c.getMethod(<span class="string">"setName"</span>, param1);</span><br><span class="line">            <span class="comment">// è®¾ç½®å¼•ç”¨</span></span><br><span class="line">            Object[] argObjs1 = &#123;<span class="string">"caterpillar"</span>&#125;;</span><br><span class="line">            <span class="comment">// ç»™å¼•ç”¨è°ƒç”¨æŒ‡å®šå¯¹è±¡çš„æ–¹æ³•æ–¹æ³•</span></span><br><span class="line">            setNameMethod.invoke(targetObj, argObjs1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">Class</span>[] param2 = &#123;Integer.TYPE&#125;;</span><br><span class="line">            Method setScoreMethod =</span><br><span class="line">                    c.getMethod(<span class="string">"setScore"</span>, param2);</span><br><span class="line"></span><br><span class="line">            Object[] argObjs2 = &#123;<span class="keyword">new</span> Integer(<span class="number">90</span>)&#125;;</span><br><span class="line">            setScoreMethod.invoke(targetObj, argObjs2);</span><br><span class="line">            <span class="comment">// æ˜¾ç¤ºç±»æè¿°</span></span><br><span class="line">            System.out.<span class="keyword">println</span>(targetObj);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"æ‰¾ä¸åˆ°ç±»"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"æ²¡æœ‰è¿™ä¸ªæ–¹æ³•"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥æŒ‡å®šåŠ è½½ Student ç±»å¹¶ç”Ÿæˆå®ä¾‹ï¼Œæ¥ç€å¯ä»¥åŠ¨æ€è°ƒç”¨ setName() å’Œ setScore() æ–¹æ³•ï¼Œç”±äºè°ƒç”¨setName() å’Œ setScore() æ‰€è®¾ç½®çš„å‚æ•°æ˜¯ â€œcaterpillarâ€ å’Œ90ã€‚</p>
<p>åœ¨å¾ˆå°‘çš„æƒ…æ³ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦çªç ´ Java çš„å­˜å–é™åˆ¶æ¥è°ƒç”¨å—ä¿æŠ¤çš„ï¼ˆprotectedï¼‰æˆ–ç§æœ‰ï¼ˆprivateï¼‰çš„æ–¹æ³•ï¼ˆä¾‹å¦‚æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªç»„ä»¶ï¼ˆComponentï¼‰ï¼Œä½†æˆ‘ä»¬æ²¡æ³•ä¿®æ”¹å®ƒçš„åŸå§‹ç æ¥æ”¹å˜æŸä¸ªç§æœ‰æ–¹æ³•çš„æƒé™ï¼Œè€Œæˆ‘ä»¬åˆä¸€å®šè¦è°ƒç”¨æŸä¸ªç§æœ‰æ–¹æ³•ï¼‰ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°„æœºåˆ¶ä¾†è¾¾åˆ°ç›®çš„ï¼Œä¸€ä¸ªå­˜å–ç§æœ‰æ–¹æ³•çš„ä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">Method</span> <span class="title">privateMethod</span> = </span></span><br><span class="line"><span class="function">            <span class="title">c</span>.<span class="title">getDeclaredMethod</span><span class="params">("somePrivateMethod", <span class="keyword">new</span> <span class="keyword">Class</span>[0])</span>;</span></span><br><span class="line">privateMethod.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">privateMethod.invoke(targetObj, argObjs);</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨åå°„æ¥åŠ¨æ€è°ƒç”¨æ–¹æ³•çš„å®ä¾‹ä¾‹å­ä¹‹ä¸€æ˜¯åœ¨ JavaBean çš„è®¾å®šï¼Œä¾‹å¦‚åœ¨ JSP/Servlet ä¸­ï¼Œå¯ä»¥æ ¹æ®ä½¿ç”¨è€…çš„è¯·æ±‚åå’Œ JavaBean çš„å±æ€§è‡ªåŠ¨å¯¹æ¯”ï¼Œå°†è¯·æ±‚å€¼è®¾ç½®åˆ°æŒ‡å®šçš„ JavaBean ä¸Šï¼Œå¹¶è‡ªåŠ¨æ ¹æ®å‚æ•°ç±»å‹è½¬æ¢ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªmapçš„å°ä¾‹å­ï¼š</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> class CommandUtil &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">Object</span> getCommand(Map requestMap,</span><br><span class="line">                                    <span class="keyword">String</span> commandClass)</span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class c = Class.forName(commandClass);</span><br><span class="line">        <span class="keyword">Object</span> o = c.newInstance();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> updateCommand(requestMap, o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨reflectionè‡ªåŠ¨æ‰¾å‡ºè¦æ›´æ–°çš„å±æ€§</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">Object</span> updateCommand(</span><br><span class="line">            Map requestMap,</span><br><span class="line">            <span class="keyword">Object</span> command)</span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Method[] methods =</span><br><span class="line">                command.getClass().getDeclaredMethods();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; methods.length; i++) &#123;</span><br><span class="line">            <span class="comment">// ç•¥è¿‡privateã€protectedæˆå‘˜</span></span><br><span class="line">            <span class="comment">// ä¸”æ‰¾å‡ºå¿…é¡»æ˜¯setå¼€å¤´çš„æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">if</span> (!Modifier.isPrivate(methods[i].getModifiers()) &amp;&amp;</span><br><span class="line">                    !Modifier.isProtected(methods[i].getModifiers()) &amp;&amp;</span><br><span class="line">                    methods[i].getName().startsWith(<span class="string">"set"</span>)) &#123;</span><br><span class="line">                <span class="comment">// å–å¾—ä¸åŒ…æ‹¬setæ–¹æ³•</span></span><br><span class="line">                <span class="keyword">String</span> name = methods[i].getName()</span><br><span class="line">                        .substring(<span class="number">3</span>)</span><br><span class="line">                        .toLowerCase();</span><br><span class="line">                <span class="comment">// å¦‚æœsetteråç§°é”®å€¼å¯¹ç›¸åŒ</span></span><br><span class="line">                <span class="comment">// è°ƒç”¨å¯¹åº”çš„setterå¹¶ç»™å€¼</span></span><br><span class="line">                <span class="keyword">if</span> (requestMap.containsKey(name)) &#123;</span><br><span class="line">                    <span class="keyword">String</span> param = (<span class="keyword">String</span>) requestMap.<span class="built_in">get</span>(name);</span><br><span class="line">                    <span class="keyword">Object</span>[] values = findOutParamValues(</span><br><span class="line">                            param, methods[i]);</span><br><span class="line">                    methods[i].invoke(command, values);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> command;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢å¯¹åº”ç±»å‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">Object</span>[] findOutParamValues(</span><br><span class="line">            <span class="keyword">String</span> param, Method method) &#123;</span><br><span class="line">        Class[] params = method.getParameterTypes();</span><br><span class="line">        <span class="keyword">Object</span>[] objs = <span class="keyword">new</span> <span class="keyword">Object</span>[params.length];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; params.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (params[i] == <span class="keyword">String</span>.class) &#123;</span><br><span class="line">                objs[i] = param;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (params[i] == Short.TYPE) &#123;</span><br><span class="line">                <span class="keyword">short</span> number = Short.parseShort(param);</span><br><span class="line">                objs[i] = <span class="keyword">new</span> Short(number);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (params[i] == Integer.TYPE) &#123;</span><br><span class="line">                <span class="built_in">int</span> number = Integer.parseInt(param);</span><br><span class="line">                objs[i] = <span class="keyword">new</span> Integer(number);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (params[i] == Long.TYPE) &#123;</span><br><span class="line">                <span class="keyword">long</span> number = Long.parseLong(param);</span><br><span class="line">                objs[i] = <span class="keyword">new</span> Long(number);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (params[i] == Float.TYPE) &#123;</span><br><span class="line">                <span class="built_in">float</span> number = Float.parseFloat(param);</span><br><span class="line">                objs[i] = <span class="keyword">new</span> Float(number);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (params[i] == Double.TYPE) &#123;</span><br><span class="line">                <span class="keyword">double</span> number = Double.parseDouble(param);</span><br><span class="line">                objs[i] = <span class="keyword">new</span> Double(number);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (params[i] == Boolean.TYPE) &#123;</span><br><span class="line">                <span class="built_in">boolean</span> bool = Boolean.parseBoolean(param);</span><br><span class="line">                objs[i] = <span class="keyword">new</span> Boolean(bool);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> objs;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Map&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; request = </span><br><span class="line">                  <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt;();</span><br><span class="line">        request.put(<span class="string">"name"</span>, <span class="string">"caterpillar"</span>);</span><br><span class="line">        request.put(<span class="string">"score"</span>, <span class="string">"90"</span>);</span><br><span class="line">        <span class="keyword">Object</span> obj = CommandUtil.getCommand(request, args[<span class="number">0</span>]);</span><br><span class="line">        System.out.<span class="built_in">println</span>(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CommandUtil å¯ä»¥è‡ªåŠ¨æ ¹æ®æ–¹æ³•ä¸Šçš„å‚æ•°ç±»å‹ï¼Œå°†Map ä¸­çš„valueè½¬æ¢æˆç›¸åº”çš„ç±»å‹ï¼Œç›®å‰å®ƒå¯ä»¥è½¬æ¢åŸºæœ¬ç±»å‹å’Œ Stringã€‚</p>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">java</span> <span class="selector-tag">CommandUtilDemo</span> <span class="selector-tag">CoreJava</span><span class="selector-class">.day_2</span><span class="selector-class">.Student</span></span><br><span class="line"><span class="selector-tag">caterpillar</span><span class="selector-pseudo">:90</span></span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ä¿®æ”¹<strong>æˆå‘˜å˜é‡</strong>ï¼Œå°½ç®¡ç›´æ¥è¯»å–ç±»çš„æˆå‘˜å±æ€§ï¼ˆFieldï¼‰æ˜¯ä¸è¢«é¼“åŠ±çš„ï¼Œä½†æˆ‘ä»¬ä»æ˜¯å¯ä»¥ç›´æ¥å­˜å–å…¬å…±çš„ï¼ˆpublicï¼‰æˆå‘˜å±æ€§çš„ï¼Œè€Œæˆ‘ä»¬ç”šè‡³ä¹Ÿå¯ä»¥é€šè¿‡åå°„æœºåˆ¶æ¥è¯»å–ç§ç”¨æˆå‘˜å˜é‡ï¼Œä»¥ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ï¼š</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestField</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> testInt;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span> testString;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> testInt + <span class="string">":"</span> + testString;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶ååˆ©ç”¨åå°„æœºåˆ¶åŠ¨æ€çš„è¯»å–æˆå‘˜å˜é‡ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">package <span class="type">CoreJava</span>.day_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AssignFieldDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="type">String</span>[] args) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="built_in">c</span> = <span class="type">Class</span>.forName(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="type">Object</span> targetObj = <span class="built_in">c</span>.newInstance();</span><br><span class="line"></span><br><span class="line">            <span class="type">Field</span> testInt = <span class="built_in">c</span>.getField(<span class="string">"testInt"</span>);</span><br><span class="line">            testInt.setInt(targetObj, <span class="number">99</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">Field</span> testString = <span class="built_in">c</span>.getField(<span class="string">"testString"</span>);</span><br><span class="line">            testString.<span class="keyword">set</span>(targetObj, <span class="string">"caterpillar"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">System</span>.out.<span class="built_in">println</span>(targetObj);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="type">ArrayIndexOutOfBoundsException</span> e) &#123;</span><br><span class="line">            <span class="type">System</span>.out.<span class="built_in">println</span>(<span class="string">"æ²¡æœ‰æŒ‡å®šç±»"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="type">ClassNotFoundException</span> e) &#123;</span><br><span class="line">            <span class="type">System</span>.out.<span class="built_in">println</span>(<span class="string">"æ‰¾ä¸åˆ°æŒ‡å®šçš„ç±»"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="type">SecurityException</span> e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="type">NoSuchFieldException</span> e) &#123;</span><br><span class="line">            <span class="type">System</span>.out.<span class="built_in">println</span>(<span class="string">"æ‰¾ä¸åˆ°æŒ‡å®šçš„æˆå‘˜å˜é‡"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="type">InstantiationException</span> e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="type">IllegalAccessException</span> e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">java</span> <span class="selector-tag">AssignFieldDemo</span> <span class="selector-tag">CoreJava</span><span class="selector-class">.day_2</span><span class="selector-class">.TestField</span></span><br><span class="line">99<span class="selector-pseudo">:caterpillar</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åå°„æœºåˆ¶æ¥è¯»å–ç§æœ‰çš„æˆå‘˜å˜é‡ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">Field privateField = <span class="keyword">c</span>.getDeclaredField(<span class="string">"privateField"</span>)<span class="comment">; </span></span><br><span class="line"><span class="comment">privateField.setAccessible(true);</span></span><br><span class="line"><span class="comment">privateField.setInt(targetObj, 99);</span></span><br></pre></td></tr></table></figure>
<p><strong>æ•°ç»„</strong><br>åœ¨ Java ä¸­æ•°ç»„ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿä¼šæœ‰ä¸€ä¸ª Class å®ä¾‹æ¥è¡¨ç¤ºå®ƒï¼Œæˆ‘ä»¬ç”¨å‡ ä¸ªåŸºæœ¬ç±»å‹å’ŒStringæ¥è¿›è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayDemo</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        short[] sArr = <span class="keyword">new</span> short[<span class="number">5</span>];</span><br><span class="line">        <span class="keyword">int</span>[] iArr = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">5</span>];</span><br><span class="line">        <span class="keyword">long</span>[] lArr = <span class="keyword">new</span> <span class="keyword">long</span>[<span class="number">5</span>];</span><br><span class="line">        <span class="keyword">float</span>[] fArr = <span class="keyword">new</span> <span class="keyword">float</span>[<span class="number">5</span>];</span><br><span class="line">        <span class="keyword">double</span>[] dArr = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">5</span>];</span><br><span class="line">        <span class="keyword">byte</span>[] bArr = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">5</span>];</span><br><span class="line">        <span class="keyword">boolean</span>[] zArr = <span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">5</span>];</span><br><span class="line">        <span class="keyword">String</span>[] strArr = <span class="keyword">new</span> <span class="keyword">String</span>[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"short æ•°ç»„ï¼š"</span> + sArr.getClass());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"int æ•°ç»„ï¼š"</span> + iArr.getClass());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"long æ•°ç»„ï¼š"</span> + lArr.getClass());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"float æ•°ç»„ï¼š"</span> + fArr.getClass());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"double æ•°ç»„ï¼š"</span> + dArr.getClass());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"byte æ•°ç»„ï¼š"</span> + bArr.getClass());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"boolean æ•°ç»„ï¼š"</span> + zArr.getClass());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"String æ•°ç»„ï¼š"</span> + strArr.getClass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">short æ•°ç»„ï¼š<span class="class"><span class="keyword">class</span> [<span class="title">S</span></span></span><br><span class="line">int æ•°ç»„ï¼š<span class="class"><span class="keyword">class</span> [<span class="title">I</span></span></span><br><span class="line">long æ•°ç»„ï¼š<span class="class"><span class="keyword">class</span> [<span class="title">J</span></span></span><br><span class="line">float æ•°ç»„ï¼š<span class="class"><span class="keyword">class</span> [<span class="title">F</span></span></span><br><span class="line">double æ•°ç»„ï¼š<span class="class"><span class="keyword">class</span> [<span class="title">D</span></span></span><br><span class="line">byte æ•°ç»„ï¼š<span class="class"><span class="keyword">class</span> [<span class="title">B</span></span></span><br><span class="line">boolean æ•°ç»„ï¼š<span class="class"><span class="keyword">class</span> [<span class="title">Z</span></span></span><br><span class="line">String æ•°ç»„ï¼š<span class="class"><span class="keyword">class</span> [<span class="title">Ljava</span>.<span class="title">lang</span>.<span class="title">String</span>;</span></span><br><span class="line"></span><br><span class="line">Process finished <span class="keyword">with</span> exit code <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>è¦ä½¿ç”¨<strong>åå°„æœºåˆ¶åŠ¨æ€ç”Ÿæˆæ•°ç»„</strong>çš„è¯ï¼Œä¹Ÿå¯ä»¥è¿™æ ·ï¼š</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.<span class="keyword">Array</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> class NewArrayDemo &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args) &#123;</span><br><span class="line">        Class c = <span class="keyword">String</span>.class;</span><br><span class="line">        <span class="keyword">Object</span> objArr = <span class="keyword">Array</span>.newInstance(c, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">Array</span>.<span class="built_in">set</span>(objArr, i, i + <span class="string">""</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.<span class="built_in">print</span>(<span class="keyword">Array</span>.<span class="built_in">get</span>(objArr, i) + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.<span class="built_in">println</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">String</span>[] strs = (<span class="keyword">String</span>[]) objArr;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">String</span> s : strs) &#123;</span><br><span class="line">            System.out.<span class="built_in">print</span>(s + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Array.newInstance() çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æŒ‡å®šå‚æ•°ç±»å‹ï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨æ¥æŒ‡å®šæ•°ç»„é•¿åº¦çš„ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"><span class="symbol">0 </span><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ˜¯äºŒç»´æ•°ç»„ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.<span class="keyword">Array</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> class NewArrayDemo2 &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args) &#123;</span><br><span class="line">        Class c = <span class="keyword">String</span>.class;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰“ç®—å»ºç«‹ä¸€ä¸ª3*4æ•°ç»„</span></span><br><span class="line">        <span class="built_in">int</span>[] dim = <span class="keyword">new</span> <span class="built_in">int</span>[]&#123;<span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line">        <span class="keyword">Object</span> objArr = <span class="keyword">Array</span>.newInstance(c, dim);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">Object</span> row = <span class="keyword">Array</span>.<span class="built_in">get</span>(objArr, i);</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">Array</span>.<span class="built_in">set</span>(row, j, <span class="string">""</span> + (i + <span class="number">1</span>) * (j + <span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">Object</span> row = <span class="keyword">Array</span>.<span class="built_in">get</span>(objArr, i);</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">                System.out.<span class="built_in">print</span>(<span class="keyword">Array</span>.<span class="built_in">get</span>(row, j) + <span class="string">" "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.<span class="built_in">println</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="number">2</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"><span class="symbol">2 </span><span class="number">4</span> <span class="number">6</span> <span class="number">8</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">6</span> <span class="number">9</span> <span class="number">12</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæƒ³è¦çŸ¥é“æ•°ç»„å…ƒç´ çš„ç±»å‹ï¼Œå¯ä»¥åœ¨å–å¾—æ•°ç»„çš„ Class å®ä¾‹ä¹‹åï¼Œä½¿ç”¨ Class å®ä¾‹çš„ getComponentType() æ–¹æ³•ï¼Œæ‰€å–å›çš„æ˜¯å…ƒç´ çš„ Class å®ä¾‹ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span>[] iArr = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">5</span>];</span><br><span class="line">System.out.<span class="built_in">println</span>(iArr.getClass().getComponentType());</span><br></pre></td></tr></table></figure>
<p>å¯¹åå°„çš„æ€»ç»“å·®ä¸å¤šå°±å†™åˆ°è¿™é‡Œäº†ï¼ŒæŸ¥é˜…äº†å¾ˆå¤šèµ„æ–™ï¼Œç½‘ç»œä¸Šå†™çš„ä¹Ÿæ˜¯å‚å·®ä¸é½çš„ï¼Œåœ¨æ‰‹å†™çš„å‡ åä¸ªdemoæ”¯æ’‘ä¸‹ï¼Œå¾—å‡ºçš„ä¸€ç‚¹å…³äºåå°„çš„ä¸œè¥¿ï¼Œè‚¯å®šä¸èƒ½è¯´å…¨éƒ¨æ­£ç¡®ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥æä¾›ä¸€äº›å¸®åŠ©çš„  -ã€‚-</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>åå°„</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaåå°„å­¦ä¹ æ€»ç»“ï¼ˆå››ï¼‰</title>
    <url>/2017/02/18/Java%E5%8F%8D%E5%B0%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%88%E5%9B%9B%EF%BC%89/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><strong>ç±»åŠ è½½å™¨</strong></p>
<p>Javaåœ¨éœ€è¦ä½¿ç”¨ç±»çš„æ—¶å€™ï¼Œæ‰ä¼šå°†ç±»åŠ è½½ï¼ŒJavaçš„ç±»åŠ è½½æ˜¯ç”±ç±»åŠ è½½å™¨ï¼ˆClass loaderï¼‰æ¥å®Œæˆçš„ã€‚<br>å½“æˆ‘ä»¬åœ¨å‘½ä»¤æ¨¡å¼ä¸‹æ‰§è¡Œjava xxxæŒ‡ä»¤åï¼ŒJavaæ‰§è¡Œç¨‹åºä¼šå°è¯•æ‰¾åˆ°jreå®‰è£…çš„æ‰€åœ¨ç›®å½•ï¼Œç„¶åæ‰¾åˆ°jvm.dllï¼ˆå‡è®¾åœ¨jreç›®å½•ä¸‹çš„bin\clientä¸‹ï¼‰ï¼Œæ¥ç€å¯åŠ¨jvmå¹¶è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œæ¥ç€ä¼šäº§ç”Ÿbootstrap loaderï¼Œbootstrap loaderåˆ™ä¼šåŠ è½½ extended loaderï¼Œå¹¶è®¾å®š extended loaderçš„parentä¸ºbootstrap loaderï¼Œæ¥ç€bootstrap loaderä¼šåŠ è½½system loaderï¼Œå¹¶å°†system loaderçš„parentè®¾ä¸º extended loaderã€‚<br><a id="more"></a><br>bootstrap loaderé€šå¸¸æ˜¯ç”±cå†™çš„ï¼Œ extended loaderæ˜¯ç”±Javaå†™çš„ï¼Œå®é™…è¿™ä¸ªå¯¹åº”ç€sun.misc.Launcher\$ExtClassLoaderï¼ˆLauncher ä¸­çš„å†…éƒ¨ç±»ï¼‰ï¼›system loader æ˜¯ç”± Javaå†™çš„ï¼Œå®é™…å¯¹åº”sun.misc. Launcher\$AppClassLoaderï¼ˆLauncher ä¸­çš„å†…éƒ¨ç±»ï¼‰ã€‚</p>
<p><strong>æµç¨‹å¦‚ä¸‹å›¾ï¼š</strong><br><img src="http://img.blog.csdn.net/20161205220032526" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>Bootstrap Loader ä¼šæŸ¥æ‰¾ç³»ç»Ÿå‚æ•° sun.boot.class.path ä¸­æŒ‡å®šä½ç½®çš„ç±»ï¼Œå‡è®¾æ˜¯ JRE classes ä¸‹ä¹‹æ–‡ä»¶ï¼Œæˆ– lib ç›®å½•ä¸‹ .jar æ–‡ä»¶ä¸­ï¼ˆä¾‹å¦‚ rt.jarï¼‰çš„ç±»å¹¶åŠ è½½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ System.getProperty(â€œsun.boot.class.pathâ€) æ¥æ˜¾ç¤º sun.boot.class.path ä¸­æŒ‡å®šçš„è·¯åŠ²ï¼Œä¾‹å¦‚åœ¨æˆ‘çš„ç»ˆç«¯æ˜¾ç¤ºçš„æ˜¯ä»¥ä¸‹çš„è·¯åŠ²ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1<span class="number">.8</span><span class="number">.0</span>_65.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/jre/</span>lib<span class="regexp">/resources.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_65.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>rt.<span class="string">jar:</span><span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1<span class="number">.8</span><span class="number">.0</span>_65.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/jre/</span>lib<span class="regexp">/sunrsasign.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_65.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>jsse.<span class="string">jar:</span><span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1<span class="number">.8</span><span class="number">.0</span>_65.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/jre/</span>lib<span class="regexp">/jce.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_65.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>charsets.<span class="string">jar:</span><span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1<span class="number">.8</span><span class="number">.0</span>_65.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/jre/</span>lib<span class="regexp">/jfr.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_65.jdk/</span>Contents<span class="regexp">/Home/</span>jre/classes</span><br></pre></td></tr></table></figure>
<p>Extended Loaderï¼ˆsun.misc.Launcher$ExtClassLoaderï¼‰æ˜¯ç”± Java å†™çš„ï¼Œä¼šæŸ¥æ‰¾ç³»ç»Ÿå‚æ•°java.ext.dirs ä¸­æŒ‡å®šä½ç½®çš„ç±»ï¼Œå‡è®¾æ˜¯ JRE ç›®å½•ä¸‹çš„ lib\ext\classes ç›®å½•ä¸‹çš„ .class æ–‡ä»¶ï¼Œæˆ– lib\ext ç›®å½•ä¸‹çš„ .jar æ–‡ä»¶ä¸­ï¼ˆä¾‹å¦‚ rt.jarï¼‰çš„ç±»å¹¶åŠ è½½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ System.getProperty(â€œjava.ext.dirsâ€) æ¥æ˜¾ç¤ºæŒ‡å®šçš„è·¯åŠ²:</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/Users/</span>lizhi<span class="regexp">/Library/</span>Java<span class="regexp">/Extensions:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_65.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span><span class="string">ext:</span><span class="regexp">/Library/</span>Java<span class="regexp">/Extensions:/</span>Network<span class="regexp">/Library/</span>Java<span class="regexp">/Extensions:/</span>System<span class="regexp">/Library/</span>Java<span class="regexp">/Extensions:/</span>usr<span class="regexp">/lib/</span>java</span><br></pre></td></tr></table></figure>
<p>System Loaderï¼ˆsun.misc.Launcher$AppClassLoaderï¼‰æ˜¯ç”± Java å†™çš„ï¼Œä¼šæŸ¥æ‰¾ç³»ç»Ÿå‚ java.class.path ä¸­æŒ‡å®šä½ç½®çš„ç±»ï¼Œä¹Ÿå°±æ˜¯ Classpath æ‰€æŒ‡å®šçš„è·¯å¾„ï¼Œå‡è®¾æ˜¯ç›®å‰å·¥ä½œè·¯å¾„ä¸‹çš„ .class æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ System.getProperty(â€œjava.class.pathâ€) æ¥æ˜¾ç¤º java.class.path ä¸­æŒ‡å®šçš„è·¯å¾„ï¼Œåœ¨ä½¿ç”¨ java æ‰§è¡Œç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åŠ ä¸Š -cp ä¾†è¦†ç›–åŸæœ‰çš„ Classpath è®¾ç½®ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">java</span> â€“<span class="meta">cp</span> ./classes SomeClass</span><br></pre></td></tr></table></figure>
<p>Bootstrap Loader ä¼šåœ¨ JVM å¯åŠ¨ä¹‹åç”Ÿæˆï¼Œä¹‹åå®ƒä¼šåŠ è½½ Extended Loader å¹¶å°†å…¶ parent è®¾ä¸º Bootstrap Loaderï¼Œç„¶åBootstrap Loader å†åŠ è½½ System Loader å¹¶å°†å…¶ parent è®¾ä¸º ExtClassLoaderï¼Œæ¥ç€System Loader å¼€å§‹åŠ è½½æˆ‘ä»¬æŒ‡å®šçš„ç±»ï¼Œåœ¨åŠ è½½ç±»æ—¶ï¼Œæ¯ä¸ªç±»åŠ è½½å™¨ä¼šå…ˆå°†åŠ è½½ç±»çš„ä»»åŠ¡è®²ç»™ä»–çš„parentï¼Œå¦‚æœ parent æ‰¾ä¸åˆ°ï¼Œæ‰ç”±è‡ªå·±è´Ÿè´£åŠ è½½ï¼Œæ‰€ä»¥åœ¨åŠ è½½ç±»æ—¶ï¼Œä¼šä»¥ Bootstrap Loaderâ†’Extended Loaderâ†’System Loader çš„é¡ºåºå¼€æŸ¥æ‰¾ç±»ï¼Œå¦‚æœéƒ½æ‰¾ä¸åˆ°ï¼Œå°±ä¼šæŠ›å‡º NoClassDefFoundErrorã€‚</p>
<p>ç±»åŠ è½½å™¨åœ¨ Java ä¸­æ˜¯ä»¥ java.lang.ClassLoader å½¢å¼å­˜åœ¨ï¼Œæ¯ä¸€ä¸ªç±»è¢«åŠ è½½åï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ª Class çš„å®ä¾‹æ¥ä»£è¡¨ï¼Œè€Œæ¯ä¸ª Class çš„å®ä¾‹éƒ½ä¼šè®°å¾—è‡ªå·±æ˜¯ç”±å“ªä¸ª ClassLoader åŠ è½½çš„ï¼Œå¯ä»¥ç”± Class çš„ getClassLoader() å–å¾—åŠ è½½è¯¥ç±»çš„ ClassLoaderï¼Œè€Œä» ClassLoader çš„ getParent() æ–¹æ³•å¯ä»¥å–å¾—è‡ªå·±çš„ parentã€‚</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å»ºç«‹SomeClasså®ä¾‹</span></span><br><span class="line">        SomeClass some = <span class="keyword">new</span> SomeClass();</span><br><span class="line">        <span class="comment">// å–å¾—SomeClassçš„Classå®ä¾‹</span></span><br><span class="line">        Class c = some.getClass();</span><br><span class="line">        <span class="comment">// å–å¾—ClassLoader</span></span><br><span class="line">        ClassLoader loader = c.getClassLoader();</span><br><span class="line">        System.out.<span class="built_in">println</span>(loader);</span><br><span class="line">        <span class="comment">// å–å¾—çˆ¶ClassLoader</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(loader.getParent());</span><br><span class="line">        <span class="comment">// å†å–å¾—çˆ¶ClassLoader</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(loader.getParent().getParent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sun.misc.Launcher<span class="variable">$AppClassLoader</span>@<span class="number">60</span>e53b93</span><br><span class="line">sun.misc.Launcher<span class="variable">$ExtClassLoader</span>@<span class="number">66</span>d3c617</span><br><span class="line">null</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>CoreJava.day_2.SomeClass æ˜¯ä¸ªè‡ªå®šä¹‰ç±»ï¼Œæˆ‘ä»¬åœ¨ç›®å‰çš„ç›®å½•ä¸‹æ‰§è¡Œç¨‹åºï¼Œé¦–å…ˆ AppClassLoader ä¼šå°†åŠ è½½ç±»çš„ä»»åŠ¡äº¤çµ¦ ExtClassLoaderï¼Œè€Œ ExtClassLoader å°†ä¼šæŠŠåŠ è½½ç±»çš„ä»»åŠ¡äº¤ç»™ Bootstrap Loaderï¼Œç”±äºBootstrap Loader åœ¨å®ƒçš„è·¯å¾„ï¼ˆsun.boot.class.pathï¼‰ä¸‹æ‰¾ä¸åˆ°ç±»ï¼Œæ‰€ä»¥ç”± ExtClassLoader æ¥å°è¯•æŸ¥æ‰¾ï¼Œè€Œ ExtClassLoader åœ¨å®ƒçš„è·¯å¾„è®¾ç½®ï¼ˆjava.ext.dirsï¼‰ä¸‹ä¹Ÿæ‰¾ä¸åˆ°ç±»ï¼Œæ‰€ä»¥ç”± AppClassLoader æ¥å°è¯•æŸ¥æ‰¾ï¼ŒAppClassLoader æœ€ååœ¨ Classpathï¼ˆjava.class.pathï¼‰è®¾ç½®ä¸‹æ‰¾åˆ°æŒ‡å®šçš„ç±»å¹¶åŠ è½½ã€‚</p>
<p>åœ¨è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°ï¼ŒåŠ è½½ SomeClass çš„ ClassLoader æ˜¯ AppClassLoaderï¼Œè€Œ AppClassLoader çš„ parent æ˜¯ ExtClassLoaderï¼Œè€Œ ExtClassLoader çš„ parent æ˜¯ nullï¼Œnull å¹¶ä¸æ˜¯è¡¨ç¤º ExtClassLoader æ²¡æœ‰è®¾ç½® parentï¼Œè€Œæ˜¯å› ä¸º Bootstrap Loader é€šå¸¸ç”± C å†™çš„ï¼Œåœ¨ Java ä¸­å¹¶æ²¡æœ‰ä¸€ä¸ªç±»æ¥è¡¨ç¤ºå®ƒï¼Œæ‰€ä»¥æ‰ä¼šæ˜¾ç¤ºä¸ºnullã€‚</p>
<p>å¦‚æœæŠŠ SomeClass çš„ .class æ–‡ä»¶ç§»è‡³ JRE ç›®å½•ä¸‹çš„ lib\ext\classesä¸‹ï¼Œå¹¶é‡æ–°ï¼ˆä»»ä½•ç›®å½•ä¸‹ï¼‰æ‰§è¡Œç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">null</span></span><br><span class="line"><span class="selector-tag">Exception</span> <span class="selector-tag">in</span> <span class="selector-tag">thread</span> "<span class="selector-tag">main</span>" <span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.NullPointerException</span></span><br><span class="line">        <span class="selector-tag">at</span> <span class="selector-tag">CoreJava</span><span class="selector-class">.day_2</span><span class="selector-class">.SomeClass</span><span class="selector-class">.main</span>(<span class="selector-tag">SomeClass</span><span class="selector-class">.java</span><span class="selector-pseudo">:13)</span></span><br></pre></td></tr></table></figure>
<p>ç”±äº SomeClass è¿™æ¬¡å¯ä»¥åœ¨ Bootstrap Loader çš„è®¾ç½®è·¯å¾„ä¸‹æ‰¾åˆ°ï¼Œæ‰€ä»¥ä¼šç”± Bootstrap Loader æ¥åŠ è½½ SomeClass ç±»ï¼ŒBootstrap Loader é€šå¸¸ç”± C å†™çš„ï¼Œåœ¨ Java ä¸­æ²¡æœ‰ä¸€ä¸ªå®é™…ç±»æ¥è¡¨ç¤ºï¼Œæ‰€ä»¥æ˜¾ç¤ºä¸º nullï¼Œå› ä¸ºè¡¨ç¤ºä¸ºnullï¼Œæ‰€ä»¥å†ç”± null ä¸Šå°è¯•è°ƒç”¨ getParent() æ–¹æ³•å°±ä¼šæŠ›å‡º NullPointerException å¼‚å¸¸ã€‚</p>
<p>å–å¾— ClassLoader çš„å®ä¾‹ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒçš„ loadClass() æ–¹æ³•æ¥åŠ è½½ç±»ï¼Œä½¿ç”¨ loadClass() æ–¹æ³•åŠ è½½ç±»æ—¶ï¼Œä¸ä¼šæ‰§è¡Œé™æ€ä»£ç å—ï¼Œé™æ€ä»£ç å—çš„æ‰§è¡Œä¼šç­‰åˆ°çœŸæ­£ä½¿ç”¨ç±»æ—¶æ¥å»ºç«‹å®ä¾‹ï¼š<br><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ææ™º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2016/12/4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClass2</span> &#123;</span></span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"[æ‰§è¡Œé™æ€ä»£ç å—]"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br><br><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> ForNameDemoV3 &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"åŠ è½½TestClass2"</span>);</span><br><span class="line">            ClassLoader loader = ForNameDemoV3.<span class="keyword">class</span>.getClassLoader();</span><br><span class="line">            <span class="keyword">Class</span> c = loader.loadClass(<span class="string">"CoreJava.day_2.TestClass2"</span>);</span><br><span class="line"></span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"TestClass2å£°æ˜"</span>);</span><br><span class="line">            TestClass2 test = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"TestClass2å®ä¾‹å¯¹è±¡"</span>);</span><br><span class="line">            test = <span class="keyword">new</span> TestClass2();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"æ‰¾ä¸åˆ°æŒ‡å®šçš„ç±»"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">åŠ è½½TestClass2</span><br><span class="line">TestClass2å£°æ˜</span><br><span class="line">TestClass2å®ä¾‹å¯¹è±¡</span><br><span class="line">[æ‰§è¡Œé™æ€ä»£ç å—]</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼ŒloadClass() ä¸ä¼šåœ¨åŠ è½½ç±»æ—¶æ‰§è¡Œé™æ€ä»£ç å—ï¼Œè€Œä¼šåœ¨ä½¿ç”¨ç±»newå¯¹è±¡æ—¶æ‰æ‰§è¡Œé™æ€ä»£ç å—ä»£ç ã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>åå°„</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaåå°„å­¦ä¹ æ€»ç»“ï¼ˆä¸‰ï¼‰</title>
    <url>/2017/02/18/Java%E5%8F%8D%E5%B0%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%89%EF%BC%89/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>Classå¯¹è±¡è¡¨ç¤ºæ‰€åŠ è½½çš„ç±»ï¼Œå–å¾—Classå¯¹è±¡åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„å–å¾—ä¸ç±»ç›¸å…³çš„ä¿¡æ¯äº†ï¼Œå°±åƒåŒ…ï¼ˆpackage,packageä¹Ÿæ˜¯ç±»åçš„ä¸€éƒ¨åˆ†å“¦~ï¼‰ï¼Œæ„é€ æ–¹æ³•ï¼Œæ–¹æ³•ï¼Œå±æ€§ç­‰ä¿¡æ¯ï¼Œè€Œæ¯ä¸€ä¸ªä¿¡æ¯ï¼Œä¹Ÿä¼šæœ‰ç›¸åº”çš„ç±»åˆ«å½¢æ€ï¼Œæ¯”å¦‚åŒ…å¯¹åº”çš„æ˜¯ java.lang.Packageï¼Œæ„é€ æ–¹æ³•å¯¹åº”çš„æ˜¯java.lang.reflect.Constructorï¼Œæˆå‘˜æ–¹æ³•å¯¹åº”çš„æ˜¯ java.lang.reflect.Methodï¼Œå±æ€§å¯¹åº”çš„æ˜¯ java.lang.reflect.Fieldç­‰ã€‚<br><a id="more"></a><br>å…ˆæ¥ä¸ªç®€å•çš„ä¾‹å­å§ï¼Œè·å–ä¸€ä¸‹åŒ…åï¼š</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> ClassInfoDemo &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">Class</span> c = <span class="keyword">Class</span>.forName(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">Package</span> p = c.getPackage();</span><br><span class="line">            System.out.<span class="keyword">println</span>(p.getName());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ArrayIndexOutOfBoundsException e) &#123;</span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"æ²¡æœ‰æŒ‡å®šç±»"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"æ‰¾ä¸åˆ°æŒ‡å®šç±»"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">java</span> <span class="selector-tag">ClassInfoDemo</span> <span class="selector-tag">java</span><span class="selector-class">.util</span><span class="selector-class">.ArrayList</span></span><br><span class="line"><span class="selector-tag">java</span><span class="selector-class">.util</span></span><br></pre></td></tr></table></figure>
<p>ç”¨ç›¸åº”çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†åˆ«å–å¾— Fieldã€Constructorã€Methodç­‰å¯¹è±¡ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæˆ‘ä¹‹å‰å†™çš„å¯ä»¥è·å–æŸäº›ç±»ä¿¡æ¯çš„ä¸€ä¸ªdemoï¼š</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectTest</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">String</span> name;</span><br><span class="line">        <span class="keyword">if</span> (args.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            name = args[<span class="number">0</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Scanner in = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">"è¾“å…¥ç±»å:(ä¾‹å¦‚:java.util.Date)"</span>);</span><br><span class="line">            name = in.next();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class c1 = Class.forName(name);</span><br><span class="line">            Class superc1 = c1.getSuperclass();</span><br><span class="line">            <span class="keyword">String</span> modifiers = Modifier.toString(c1.<span class="built_in">getModifiers</span>());</span><br><span class="line">            <span class="keyword">if</span> (modifiers.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.<span class="built_in">print</span>(modifiers + <span class="string">""</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.<span class="built_in">print</span>(<span class="string">"class "</span> + name);</span><br><span class="line">            <span class="keyword">if</span> (superc1 != null &amp;&amp; superc1 != Object.class) &#123;</span><br><span class="line">                System.out.<span class="built_in">print</span>(<span class="string">" extends"</span> + superc1.getName());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.<span class="built_in">print</span>(<span class="string">"\n&#123;\n"</span>);</span><br><span class="line">            printConstructors(c1);</span><br><span class="line">            System.out.<span class="built_in">println</span>();</span><br><span class="line">            printMethods(c1);</span><br><span class="line">            System.out.<span class="built_in">println</span>();</span><br><span class="line">            printFields(c1);</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">"&#125;"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printConstructors</span><span class="params">(Class c1)</span> </span>&#123;</span><br><span class="line">        Constructor[] constructors = c1.getDeclaredConstructors();</span><br><span class="line">        <span class="keyword">for</span> (Constructor c : constructors) &#123;</span><br><span class="line">            <span class="keyword">String</span> name = c.getName();</span><br><span class="line">            System.out.<span class="built_in">print</span>(<span class="string">""</span>);</span><br><span class="line">            <span class="keyword">String</span> modifers = Modifier.toString(c.<span class="built_in">getModifiers</span>());</span><br><span class="line">            <span class="keyword">if</span> (modifers.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.<span class="built_in">print</span>(modifers + <span class="string">" "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.<span class="built_in">print</span>(name + <span class="string">"("</span>);</span><br><span class="line">            Class[] paramTypes = c.getParameterTypes();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; paramTypes.length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    System.out.<span class="built_in">print</span>(<span class="string">","</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.<span class="built_in">print</span>(paramTypes[j].getName());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">");"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printMethods</span><span class="params">(Class c1)</span> </span>&#123;</span><br><span class="line">        Method[] methods = c1.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method m : methods) &#123;</span><br><span class="line">            Class retType = m.getReturnType();</span><br><span class="line">            <span class="keyword">String</span> name = m.getName();</span><br><span class="line"></span><br><span class="line">            System.out.<span class="built_in">print</span>(<span class="string">" "</span>);</span><br><span class="line">            <span class="keyword">String</span> modifiers = Modifier.toString(m.<span class="built_in">getModifiers</span>());</span><br><span class="line">            <span class="keyword">if</span> (modifiers.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.<span class="built_in">print</span>(modifiers + <span class="string">" "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.<span class="built_in">print</span>(retType.getName() + <span class="string">" "</span> + <span class="string">"("</span>);</span><br><span class="line">            Class[] paramTypes = m.getParameterTypes();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; paramTypes.length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    System.out.<span class="built_in">print</span>(<span class="string">","</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.<span class="built_in">print</span>(paramTypes[j].getName());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">");"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printFields</span><span class="params">(Class c1)</span> </span>&#123;</span><br><span class="line">        Field[] fields = c1.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field f : fields) &#123;</span><br><span class="line">            Class type = f.getType();</span><br><span class="line">            <span class="keyword">String</span> name = f.getName();</span><br><span class="line">            System.out.<span class="built_in">print</span>(<span class="string">" "</span>);</span><br><span class="line">            <span class="keyword">String</span> modifiers = Modifier.toString(f.<span class="built_in">getModifiers</span>());</span><br><span class="line">            <span class="keyword">if</span> (modifiers.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.<span class="built_in">print</span>(modifiers + <span class="string">" "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.<span class="built_in">println</span>(type.getName() + <span class="string">" "</span> + name + <span class="string">";"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ç±»å:(ä¾‹å¦‚:java.util.Date)</span><br><span class="line">java.util.Date</span><br><span class="line">publicclass java.util.Date</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> java.util.Date(java.lang.<span class="keyword">String</span>);</span><br><span class="line"><span class="keyword">public</span> java.util.Date(<span class="built_in">int</span>,<span class="built_in">int</span>,<span class="built_in">int</span>,<span class="built_in">int</span>,<span class="built_in">int</span>,<span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">public</span> java.util.Date(<span class="built_in">int</span>,<span class="built_in">int</span>,<span class="built_in">int</span>,<span class="built_in">int</span>,<span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">public</span> java.util.Date();</span><br><span class="line"><span class="keyword">public</span> java.util.Date(<span class="keyword">long</span>);</span><br><span class="line"><span class="keyword">public</span> java.util.Date(<span class="built_in">int</span>,<span class="built_in">int</span>,<span class="built_in">int</span>);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">boolean</span> (java.lang.<span class="keyword">Object</span>);</span><br><span class="line"> <span class="keyword">public</span> java.lang.<span class="keyword">String</span> ();</span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">int</span> ();</span><br><span class="line"> <span class="keyword">public</span> java.lang.<span class="keyword">Object</span> ();</span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">int</span> (java.util.Date);</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="built_in">int</span> (java.lang.<span class="keyword">Object</span>);</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">void</span> (java.io.ObjectInputStream);</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">void</span> (java.io.ObjectOutputStream);</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> sun.util.calendar.BaseCalendar$Date ();</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> sun.util.calendar.BaseCalendar$Date (sun.util.calendar.BaseCalendar$Date);</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> (java.lang.<span class="keyword">String</span>);</span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">boolean</span> (java.util.Date);</span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">boolean</span> (java.util.Date);</span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">int</span> ();</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> (<span class="built_in">int</span>);</span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">int</span> ();</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> (<span class="built_in">int</span>);</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> (<span class="built_in">int</span>);</span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">int</span> ();</span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">int</span> ();</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> (<span class="built_in">int</span>);</span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">int</span> ();</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> (<span class="built_in">int</span>);</span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">int</span> ();</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> (<span class="built_in">int</span>);</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> ();</span><br><span class="line"> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> (java.util.Date);</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> java.lang.StringBuilder (java.lang.StringBuilder,java.lang.<span class="keyword">String</span>);</span><br><span class="line"> <span class="keyword">public</span> java.lang.<span class="keyword">String</span> ();</span><br><span class="line"> <span class="keyword">public</span> java.lang.<span class="keyword">String</span> ();</span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">int</span> ();</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> sun.util.calendar.BaseCalendar$Date ();</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.util.calendar.BaseCalendar (sun.util.calendar.BaseCalendar$Date);</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.util.calendar.BaseCalendar (<span class="keyword">long</span>);</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.util.calendar.BaseCalendar (<span class="built_in">int</span>);</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">synchronized</span> sun.util.calendar.BaseCalendar ();</span><br><span class="line"> <span class="keyword">public</span> java.time.Instant ();</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> (<span class="built_in">int</span>,<span class="built_in">int</span>,<span class="built_in">int</span>,<span class="built_in">int</span>,<span class="built_in">int</span>,<span class="built_in">int</span>);</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> java.util.Date (java.time.Instant);</span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">int</span> ();</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> (<span class="keyword">long</span>);</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">long</span> ();</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.util.calendar.BaseCalendar gcal;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> sun.util.calendar.BaseCalendar jcal;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">long</span> fastTime;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">transient</span> sun.util.calendar.BaseCalendar$Date cdate;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> defaultCenturyStart;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> [Ljava.lang.<span class="keyword">String</span>; wtb;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> [I ttb;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Process finished with <span class="built_in">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>è¾“å…¥ä¸€ä¸ªç±»ï¼ˆå®Œæ•´çš„ç±»åï¼‰ï¼Œå³å¯æ‰“å°è¯¥ç±»çš„ç•¥ä¸ºå®Œæ•´ä¿¡æ¯ã€‚å½“ç„¶è¿˜æœ‰ä¸€äº›ä¸çŸ¥é“çš„ï¼Œå¯ä»¥æŸ¥çœ‹APIæ¥å®Œæˆã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>åå°„</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaåå°„å­¦ä¹ æ€»ç»“ï¼ˆäºŒï¼‰</title>
    <url>/2017/02/18/Java%E5%8F%8D%E5%B0%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><strong>ä½¿ç”¨ Class.forName() åŠ è½½ç±»</strong></p>
<p>åœ¨ä¸€äº›åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬æ— æ³•äº‹å…ˆçŸ¥é“ä½¿ç”¨è€…å°†ä¼šåŠ è½½ä»€ä¹ˆç±»ï¼Œè€Œå¿…é¡»è®©ä½¿ç”¨è€…æŒ‡å®šç±»åç±»åŠ è½½ç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨Classçš„é™æ€forName()æ–¹æ³•æ¥å®ç°åŠ¨æ€åŠ è½½ç±»ï¼Œå¦‚ä¸‹ï¼š<br><a id="more"></a><br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">package <span class="type">CoreJava</span>.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForNameDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="type">String</span>[] args) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="built_in">c</span> = <span class="type">Class</span>.forName(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="type">System</span>.out.<span class="built_in">println</span>(<span class="string">"ç±»åï¼š"</span> +</span><br><span class="line">                    <span class="built_in">c</span>.getName());</span><br><span class="line">            <span class="type">System</span>.out.<span class="built_in">println</span>(<span class="string">"æ˜¯å¦ä¸ºæ¥å£ï¼š"</span> +</span><br><span class="line">                    <span class="built_in">c</span>.isInterface());</span><br><span class="line">            <span class="type">System</span>.out.<span class="built_in">println</span>(<span class="string">"æ˜¯å¦ä¸ºåŸºæœ¬ç±»å‹ï¼š"</span> +</span><br><span class="line">                    <span class="built_in">c</span>.isPrimitive());</span><br><span class="line">            <span class="type">System</span>.out.<span class="built_in">println</span>(<span class="string">"æ˜¯å¦ä¸ºæ•°ç»„ï¼š"</span> + <span class="built_in">c</span>.isArray());</span><br><span class="line">            <span class="type">System</span>.out.<span class="built_in">println</span>(<span class="string">"çˆ¶ç±»åï¼š"</span> +</span><br><span class="line">                    <span class="built_in">c</span>.getSuperclass().getName());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="type">ArrayIndexOutOfBoundsException</span> e) &#123;</span><br><span class="line">            <span class="type">System</span>.out.<span class="built_in">println</span>(<span class="string">"æ²¡æœ‰æŒ‡å®šçš„ç±»å"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="type">ClassNotFoundException</span> e) &#123;</span><br><span class="line">            <span class="type">System</span>.out.<span class="built_in">println</span>(<span class="string">"æ‰¾ä¸åˆ°æŒ‡å®šç±»"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¾“å‡º:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">java</span> <span class="selector-tag">ForNameDemo</span> <span class="selector-tag">java</span><span class="selector-class">.util</span><span class="selector-class">.String</span></span><br><span class="line">ç±»åï¼š<span class="selector-tag">java</span><span class="selector-class">.util</span><span class="selector-class">.Scanner</span></span><br><span class="line">æ˜¯å¦ä¸ºæ¥å£ï¼š<span class="selector-tag">false</span></span><br><span class="line">æ˜¯å¦ä¸ºåŸºæœ¬ç±»å‹ï¼š<span class="selector-tag">false</span></span><br><span class="line">æ˜¯å¦ä¸ºæ•°ç»„ï¼š<span class="selector-tag">false</span></span><br><span class="line">çˆ¶ç±»åï¼š<span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.Object</span></span><br></pre></td></tr></table></figure>
<p>Classçš„é™æ€æ–¹æ³•forName()æ–¹æ³•æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸Šé¢æ‰€ç¤ºçš„æ˜¯æŒ‡å®šç±»åç‰ˆæœ¬ï¼Œè¿˜ä¸€ä¸ªç‰ˆæœ¬å¯ä»¥è®©æˆ‘ä»¬æŒ‡å®šç±»åï¼ŒåŠ è½½æ—¶æ˜¯å¦æ‰§è¡Œé™æ€ä»£ç å—ï¼ŒæŒ‡å®šç±»çš„åŠ è½½å™¨ï¼ˆClass loaderï¼‰:</p>
<figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">Class</span> forName(<span class="keyword">String</span> <span class="keyword">name</span>, boolean initialize, ClassLoader loader)</span><br></pre></td></tr></table></figure>
<p><a href="http://justdoitlee.com/javafan-she-xue-xi-bi-ji/" target="_blank"><br>ä¸Šä¸€ç¯‡</a>å†™åˆ°è¿‡ï¼Œå‡è®¾åœ¨åŠ è½½ç±»çš„æ—¶å€™ï¼Œå¦‚æœç±»ä¸­æœ‰å®šä¹‰é™æ€ä»£ç å—åˆ™ä¼šæ‰§è¡Œå®ƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨forNameçš„ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œå°†initializeè®¾ä¸ºfalseï¼Œå¦‚æœåœ¨åŠ è½½ç±»æ—¶å¹¶ä¸ä¼šé©¬ä¸Šæ‰§è¡Œé™æ€ä»£ç å—çš„ä»£ç ï¼Œè€Œä¼šåœ¨ä½¿ç”¨ç±»å®ä¾‹å¯¹è±¡æ—¶æ‰æ‰§è¡Œé™æ€ä»£ç å—ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€ä¸‹æµ‹è¯•ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ææ™º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2016/12/4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClass2</span> &#123;</span></span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"[æ‰§è¡Œé™æ€ä»£ç å—]"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬åªå®šä¹‰äº†é™æ€ä»£ç å—æ˜¾ç¤ºä¸€æ®µä¿¡æ¯ï¼Œæ¥è§‚å¯Ÿé™æ€ä»£ç å—ä½•æ—¶è¢«æ‰§è¡Œã€‚å…ˆç”¨ç¬¬ä¸€ä¸ªç‰ˆæœ¬æ¥æµ‹è¯•ï¼š</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> ForNameDemoV1 &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"åŠ è½½TestClass2"</span>);</span><br><span class="line">            <span class="keyword">Class</span> c = <span class="keyword">Class</span>.forName(<span class="string">"TestClass2"</span>);</span><br><span class="line"></span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"TestClass2å£°æ˜"</span>);</span><br><span class="line">            TestClass2 test = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"TestClass2å®ä¾‹å¯¹è±¡"</span>);</span><br><span class="line">            test = <span class="keyword">new</span> TestClass2();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"æ‰¾ä¸åˆ°æŒ‡å®šçš„ç±»"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">åŠ è½½TestClass2</span><br><span class="line">[æ‰§è¡Œé™æ€ä»£ç å—]</span><br><span class="line">TestClass2å£°æ˜</span><br><span class="line">TestClass2å®ä¾‹å¯¹è±¡</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ä»ç»“æœçœ‹å‡ºï¼Œç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„forName()æ–¹æ³•åœ¨åŠ è½½ç±»ä¹‹åï¼Œä¼šé©¬ä¸Šæ‰§è¡Œé™æ€ä»£ç å—ï¼Œå†çœ‹çœ‹ç¬¬äºŒç§ç»“æœæ€ä¹ˆæ ·ï¼š</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> ForNameDemoV2 &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"åŠ è½½TestClass2"</span>);</span><br><span class="line">            <span class="keyword">Class</span> c = <span class="keyword">Class</span>.forName(</span><br><span class="line">                    <span class="string">"CoreJava.day_2.TestClass2"</span>,</span><br><span class="line">                    <span class="keyword">false</span>, <span class="comment">// åŠ è½½ç±»æ—¶ä¸æ‰§è¡Œé™æ€ä»£ç å—ä»£ç </span></span><br><span class="line">                    Thread.currentThread().getContextClassLoader());</span><br><span class="line"></span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"TestClass2å£°æ˜"</span>);</span><br><span class="line">            TestClass2 test = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"TestClass2å®ä¾‹å¯¹è±¡"</span>);</span><br><span class="line">            test = <span class="keyword">new</span> TestClass2();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            System.out.<span class="keyword">println</span>(<span class="string">"æ‰¾ä¸åˆ°æŒ‡å®šçš„ç±»"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š<br><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">åŠ è½½TestClass2</span><br><span class="line">TestClass2å£°æ˜</span><br><span class="line">TestClass2å®ä¾‹å¯¹è±¡</span><br><span class="line">[æ‰§è¡Œé™æ€ä»£ç å—]</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>ç”±äºåœ¨ç¬¬äºŒä¸ªç‰ˆæœ¬çš„forName()æ–¹æ³•ä¸­ï¼ŒæŠŠinitializeè®¾ä¸ºäº†falseï¼Œæ‰€ä»¥åŠ è½½ç±»æ—¶å¹¶ä¸ä¼šé©¬ä¸Šæ‰§è¡Œé™æ€ä»£ç å—ï¼Œè€Œä¼šåœ¨ç±»å®ä¾‹å¯¹è±¡æ—¶æ‰å»æ‰§è¡Œé™æ€ä»£ç å—ä»£ç ï¼Œç¬¬äºŒä¸ªç‰ˆæœ¬çš„forName()æ–¹æ³•éœ€è¦ä¸€ä¸ªç±»åŠ è½½å™¨ï¼ˆClass loaderï¼‰ã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>åå°„</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaåå°„å­¦ä¹ æ€»ç»“ï¼ˆä¸€)</title>
    <url>/2017/02/18/Java%E5%8F%8D%E5%B0%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%80/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>Javaæä¾›çš„åå°„æœºåˆ¶å…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶æœŸåŠ¨æ€åŠ è½½ç±»ï¼Œæ£€æµ‹å’Œä¿®æ”¹å®ƒæœ¬èº«çŠ¶æ€æˆ–è¡Œä¸ºï¼Œè¦ä¸¾åå°„æœºåˆ¶çš„ä¸€ä¸ªå®ä¾‹çš„è¯ï¼Œå°±æ˜¯åœ¨æ•´åˆå¼€å‘ç¯å¢ƒä¸­æ‰€æä¾›çš„æ–¹æ³•æç¤ºæˆ–è€…ç±»çš„æ£€æŸ¥å·¥å…·ï¼Œå¦å¤–åƒjspä¸­çš„javabeanè‡ªåŠ¨æ”¶é›†è¯·æ±‚ä¹Ÿç”¨åˆ°äº†åå°„ï¼Œè¿˜æœ‰æˆ‘ä»¬ç»å¸¸ç”¨çš„æ¡†æ¶ä¹Ÿå¯ä»¥çœ‹åˆ°åå°„æœºåˆ¶çš„ä½¿ç”¨ï¼Œè¿™æ ·å¯ä»¥è¾¾åˆ°åŠ¨æ€åŠ è½½ä½¿ç”¨è€…è‡ªå·±å®šä¹‰çš„ç±»çš„ç›®çš„ã€‚<br><a id="more"></a><br>åœ¨æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªç±»æ—¶ï¼Œå³ä½¿å¯¹å®ƒä¸€æ— æ‰€çŸ¥ï¼Œä½†æ˜¯å…¶å®ä»–æœ¬èº«å°±åŒ…æ‹¬äº†å¾ˆå¤šä¿¡æ¯ï¼ŒJavaåœ¨éœ€è¦ä½¿ç”¨æŸä¸ªç±»æ—¶æ‰ä¼šå°†ç±»åŠ è½½ï¼Œå¹¶åœ¨jvmä¸­ä»¥ä¸€ä¸ª<strong>java.lang.Class</strong>çš„å®ä¾‹å­˜åœ¨ï¼Œä»Classå®ä¾‹å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥è·å–ç±»çš„ä¿¡æ¯ã€‚</p>
<p><strong>Classç±»çš„åŠ è½½</strong></p>
<p>Javaåœ¨çœŸæ­£éœ€è¦ä½¿ç”¨ä¸€ä¸ªç±»çš„æ—¶å€™æ‰ä¼šè¿›è¡ŒåŠ è½½ï¼Œè€Œä¸æ˜¯åœ¨ç¨‹åºå¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰çš„ç±»ï¼Œå› ä¸ºå¤§å¤šæ•°äººéƒ½åªä½¿ç”¨åˆ°åº”ç”¨ç¨‹åºçš„éƒ¨åˆ†èµ„æºï¼Œåœ¨éœ€è¦æŸäº›åŠŸèƒ½æ—¶åœ¨åŠ è½½æŸäº›èµ„æºï¼Œè¿™æ ·å¯ä»¥è®©ç³»ç»Ÿçš„èµ„æºè¿ç”¨æ›´æœ‰æ•ˆç‡ã€‚</p>
<p>ä¸€ä¸ªjava.lang.Classä»£è¡¨äº†Javaç¨‹åºä¸­è¿è¡Œæ—¶åŠ è½½ç±»æˆ–è€…æ¥å£çš„å®ä¾‹ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è¡¨è¾¾enumï¼ˆæšä¸¾ï¼‰ï¼Œannotationï¼ˆæ³¨è§£ï¼‰ï¼Œæ•°ç»„ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼›Classç±»æ²¡æœ‰publicæ„é€ æ–¹æ³•ï¼ŒClassæ˜¯ç”±jvmè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ¯å½“ä¸€ä¸ªç±»è¢«åŠ è½½æ—¶ï¼Œjvmå°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªClasså®ä¾‹ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡Objectçš„getClass()æ–¹æ³•æ¥å–å¾—æ¯ä¸€ä¸ªå¯¹è±¡å¯¹åº”Classå®ä¾‹ï¼Œæˆ–è€…é€šè¿‡â€classâ€å¸¸é‡ï¼Œåœ¨å–å¾—Classå®ä¾‹ä¹‹åï¼Œæ“ä½œClasså®ä¾‹ä¸Šçš„ä¸€äº›æ–¹æ³•æ¥å–å¾—ç±»çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassDemo</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">String</span> name = <span class="string">"justdoitlee"</span>;</span><br><span class="line">        Class stringClass = name.getClass();</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"ç±»åç§°ï¼š"</span> +</span><br><span class="line">                stringClass.getName());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"æ˜¯å¦ä¸ºæ¥å£ï¼š"</span> +</span><br><span class="line">                stringClass.isInterface());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"æ˜¯å¦ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼š"</span> +</span><br><span class="line">                stringClass.isPrimitive());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"æ˜¯å¦ä¸ºæ•°ç»„ï¼š"</span> +</span><br><span class="line">                stringClass.isArray());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"çˆ¶ç±»åç§°ï¼š"</span> +</span><br><span class="line">                stringClass.getSuperclass().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ç±»åç§°ï¼šjava.lang.String</span><br><span class="line">æ˜¯å¦ä¸ºå€Ÿå£ï¼šfalse</span><br><span class="line">æ˜¯å¦ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼šfalse</span><br><span class="line">æ˜¯å¦ä¸ºæ•°ç»„ï¼šfalse</span><br><span class="line">çˆ¶ç±»åç§°ï¼šjava.lang.Object</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç®€å•çš„çš„ä½¿ç”¨ getClass() æ–¹æ³•æ¥å–å¾— String ç±»çš„ Class å®ä¾‹ï¼Œå¹¶ä»ä¸­å¾—åˆ° String çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ã€‚</p>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼æ¥å–å¾—Stringç±»çš„Classå¯¹è±¡ï¼š</p>
<figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Class</span> stringClass = <span class="keyword">String</span>.<span class="keyword">class</span>;</span><br></pre></td></tr></table></figure>
<p>Javaåœ¨çœŸæ­£éœ€è¦ç±»æ—¶æ‰ä¼šåŠ è½½è¿™ä¸ªç±»ï¼Œæ‰€è°“çš„<strong>çœŸæ­£éœ€è¦</strong>é€šå¸¸æŒ‡çš„æ˜¯è¦ä½¿ç”¨æŒ‡å®šçš„ç±»ç”Ÿæˆå¯¹è±¡æ—¶ï¼Œæˆ–è€…ä½¿ç”¨æŒ‡å®šè¦åŠ è½½çš„ç±»æ—¶ï¼Œä¾‹å¦‚ä½¿ç”¨Class.forName()åŠ è½½ç±»ï¼Œæˆ–è€…ä½¿ç”¨ClassLoaderçš„loadClass()åŠ è½½ç±»ï¼Œå£°æ˜ç±»å¹¶ä¸ä¼šå¯¼è‡´ç±»çš„åŠ è½½ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå°æµ‹è¯•æ¥éªŒè¯ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ææ™º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2016/12/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> &#123;</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"ç±»è¢«åŠ è½½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªé™æ€ä»£ç å—ï¼Œå‡è®¾åœ¨ç±»ç¬¬ä¸€æ¬¡è¢«åŠ è½½æ—¶ä¼šæ‰§è¡Œé™æ€ä»£ç å—ï¼ˆè¯´å‡è®¾æ˜¯å› ä¸ºï¼Œå¯ä»¥è®¾ç½®åŠ è½½ç±»æ—¶ä¸æ‰§è¡Œé™æ€ä»£ç å—ï¼Œä½¿Classç”Ÿæˆå¯¹è±¡æ—¶æ‰æ‰§è¡Œé™æ€ä»£ç å—ï¼‰ï¼Œçœ‹è¾“å‡ºä¿¡æ¯å¯ä»¥çœ‹å‡ºç±»ä½•æ—¶è¢«åŠ è½½(å¦‚ä¸‹LoadClassTest)ã€‚</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author ææ™º</span></span><br><span class="line"><span class="comment"> * @date 2016/12/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoadClassTest</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        TestClass test = null;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"å£°æ˜TestClass"</span>);</span><br><span class="line">        test = <span class="keyword">new</span> TestClass();</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"ç”ŸæˆTestClasså®ä¾‹"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">å£°æ˜TestClass</span><br><span class="line">ç±»è¢«åŠ è½½</span><br><span class="line">ç”ŸæˆTestClasså®ä¾‹</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>ä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œå£°æ˜ç±»å¹¶ä¸ä¼šå¯¼è‡´TestClassè¢«åŠ è½½ï¼Œè€Œæ˜¯åœ¨ä½¿ç”¨newç”Ÿæˆå¯¹è±¡æ—¶æ‰ä¼šè¢«åŠ è½½ç±»ã€‚</p>
<p>Classçš„ä¿¡æ¯æ˜¯åœ¨ç¼–è¯‘æ—¶æœŸå°±è¢«åŠ å…¥è‡³.classæ–‡ä»¶çš„ï¼Œè¿™æ˜¯Javaæ‰§è¡Œæ—¶æœŸè¢«è¾¨åˆ«ï¼ˆRTTIï¼ŒRun-Time Type Informationæˆ–Run-Time Type Identificationï¼‰çš„ä¸€ç§æ–¹å¼ï¼Œåœ¨ç¼–è¯‘æ—¶æœŸç¼–è¯‘å™¨ä¼šå…ˆæ£€æŸ¥å¯¹åº”çš„.classæ–‡ä»¶ï¼Œè€Œæ‰§è¡Œæ—¶æœŸjvmåœ¨ä½¿ç”¨ç±»æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥å¯¹åº”çš„Classæ˜¯å¦å·²ç»è¢«åŠ è½½ï¼Œå¦‚æœæ²¡æœ‰åŠ è½½ï¼Œåˆ™ä¼šå¯»æ‰¾å¯¹åº”çš„,classæ–‡ä»¶å¹¶åŠ è½½ï¼Œä¸€ä¸ªç±»åœ¨jvmä¸­åªä¼šæœ‰ä¸€ä¸ªClasså®ä¾‹ï¼Œæ¯ä¸ªç±»çš„å®ä¾‹éƒ½ä¼šè®°å¾—è‡ªå·±æ˜¯ç”±å“ªä¸ªClasså®ä¾‹æ‰€ç”Ÿæˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨getClass()æˆ–.classæ¥å–å¾—Classå®ä¾‹ã€‚</p>
<p>å¦å¤–ï¼Œåœ¨Javaä¸­ï¼Œæ•°ç»„å¯¹è±¡ä¹Ÿæœ‰å¯¹åº”çš„Classå®ä¾‹ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ç”±å…·æœ‰ç›¸åŒå…ƒç´ ä¸ç»´åº¦çš„æ•°ç»„æ‰€å…±ç”¨ï¼Œè€ŒåŸºæœ¬ç±»å‹åƒæ˜¯ boolean, byte, char, short, int, long, float, double ä»¥åŠå…³é”®å­— voidï¼ˆä»¥å‰éƒ½ä¸çŸ¥é“æœ‰è¿™ä¸ªå‘¢ï¼ï¼ï¼‰ï¼Œä¹Ÿéƒ½å…·æœ‰å¯¹åº”çš„Classå¯¹è±¡ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨ç±»å¸¸é‡ï¼ˆClass literalï¼‰æ¥è·å–è¿™äº›å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> CoreJava.day_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ææ™º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2016/12/4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassDemo2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">boolean</span><span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(<span class="keyword">void</span><span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] iarr = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">        System.out.println(iarr.getClass().toString());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">double</span>[] darr = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">10</span>];</span><br><span class="line">        System.out.println(darr.getClass().toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">boolean</span><br><span class="line">void</span><br><span class="line">class [I</span><br><span class="line">class [D</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>åœ¨Javaä¸­ æ•°ç»„ç¡®å®æ˜¯ä»¥å¯¹è±¡çš„å½¢å¼å­˜åœ¨çš„ï¼Œå…¶å¯¹åº”çš„ç±»éƒ½æ˜¯æœ‰jvmè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå½“æˆ‘ä»¬æ˜¯ç”¨toString()æ¥æ˜¾ç¤ºæ•°ç»„å¯¹è±¡çš„æè¿°æ—¶ï¼Œ[è¡¨ç¤ºä¸ºæ•°ç»„ç±»å‹ï¼Œå¹¶ä¸”åŠ ä¸Šä¸€ä¸ªç±»å‹ä»£è¡¨å­—ï¼Œä¸Šé¢çš„Iè¡¨ç¤ºæ˜¯ä¸€ä¸ªIntçš„æ•°ç»„ï¼Œdæ˜¯ä¸€ä¸ªdoubleæ•°ç»„ã€‚</p>
<p>è¿™é‡Œå°±å…ˆè®²ä¸€ä¸‹Classç±»çš„åŠ è½½å§ï¼Œåé¢çš„å†æ€»ç»“ã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>åå°„</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨Springï¼ŒSpringMVC</title>
    <url>/2017/02/18/%E6%88%91%E4%BB%AC%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8Spring%EF%BC%8CSpringMVC/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä»Šå¤©è¢«å…¬å¸æ´¾åˆ°åˆ«çš„å…¬å¸è°ˆé¡¹ç›®ï¼Œåˆšå»å°±å…ˆè¢«é¢è¯•äº†ä¸€æ³¢ï¼ˆåŸæ¥æ˜¯æŠŠæˆ‘å¤–åŒ…åˆ°åˆ«çš„å…¬å¸åšé¡¹ç›®äº† -ã€‚-ï¼‰ï¼Œé¢è¯•æ—¶å€™é—®äº†æˆ‘ä¸€ä¸ªé—®é¢˜ï¼Œå¾ˆç®€å•ï¼Œå°±æ˜¯é—®æˆ‘javaå¼€å‘webé¡¹ç›®ä¸ºä»€ä¹ˆè¦ç”¨spring,springmvcï¼Ÿ<br><br>å¥½å§ï¼Œå½“æ—¶æˆ‘äººç›´æ¥æ‡µé€¼äº†ï¼Œä»€ä¹ˆé¬¼é—®æˆ‘è¿™ä¸ªï¼ï¼ä¸å°±æ˜¯å¯ä»¥çœå»å¾ˆå¤šåŠŸå¤«è®©æˆ‘ä»¬è¸è¸å®å®å†™ä¸šåŠ¡ä»£ç å˜›? <br><br><a id="more"></a><br>å½“æ—¶å°±éšä¾¿å›ç­”äº†ä¸€äº›ï¼Œå›åˆ°å…¬å¸ä»”ç»†æƒ³æƒ³ï¼Œå‘ç°è¿˜æœ‰æŒºå¤šå¯ä»¥æƒ³ï¼Œå¯ä»¥è®²çš„ã€‚æˆ‘æƒ³èµ·äº†ä¹‹å‰é¡¹ç›®çš„æ§åˆ¶å±‚ä»struts2è½¬åˆ°springmvcï¼Œæˆ‘å°±åœ¨æƒ³ä¸ºä»€ä¹ˆæˆ‘ä»¬ç°åœ¨åšjavawebå¼€å‘ï¼Œè¦ç”¨struts2æˆ–è€…springMVCè¿™æ ·çš„æ¡†æ¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨servletåŠ jspè¿™æ ·çš„æŠ€æœ¯å‘¢ï¼Ÿç‰¹åˆ«æ˜¯ç°åœ¨æˆ‘ä»¬webçš„å‰ç«¯é¡µé¢éƒ½æ˜¯ä½¿ç”¨freemakerè¿™æ ·çš„æ¨¡æ¿è¯­è¨€è¿›è¡Œå¼€å‘ï¼ŒæŠ›å¼ƒäº†jspï¼Œè¿™æ ·çš„é€‰æ‹©åˆä¼šç»™æˆ‘ä»¬javawebå¼€å‘å¸¦æ¥ä»€ä¹ˆæ ·çš„å¥½å¤„ï¼Œå»¶ç€è¿™ä¸ªé—®é¢˜çš„æ€è·¯ï¼Œæˆ‘åˆå‘ç°æ–°çš„ç–‘é—®ï¼Œä¸ºä»€ä¹ˆç°åœ¨å¾ˆå¤šjavaä¼ä¸šçº§å¼€å‘éƒ½ä¼šå»é€‰æ‹©springæ¡†æ¶ï¼Œspringæ¡†æ¶ç»™æˆ‘ä»¬å¼€å‘çš„åº”ç”¨å¸¦æ¥äº†ä»€ä¹ˆï¼Ÿè¿™ä¹ˆä¸€æƒ³æˆ‘äººæ›´åŠ ç³Šæ¶‚äº†ï¼Œå¾ˆéš¾æ‰¾å¸¦è®©è‡ªå·±å®Œå…¨ä¿¡æœçš„ç­”æ¡ˆã€‚<br><br>æœ€ç»ˆæˆ‘å‘ç°ï¼Œè¿™äº›æˆ‘è®¤ä¸º<strong>â€œç”¨â€</strong>çš„å¾ˆç†Ÿæ‚‰æŠ€æœ¯ï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šè®©æˆ‘é™Œç”Ÿä¸è§£çš„åœ°æ–¹ï¼Œè¿™äº›é™Œç”Ÿå’Œä¸è§£çš„åœ°æ–¹ä¹Ÿæ­£æ˜¯æˆ‘æ˜¯å¦èƒ½æ›´é«˜å±‚æ¬¡ä½¿ç”¨å®ƒä»¬çš„å…³é”®ã€‚</p>
<p> é¦–å…ˆï¼Œè½¯ä»¶é‡Œæœ‰å¾ˆå¤šä¼˜ç§€çš„æ¡†æ¶ï¼Œæœ‰ä¸€ç§ç±»å‹çš„æ¡†æ¶ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å»ºç«‹åœ¨ä¸€ä¸ªç°æœ‰æŠ€æœ¯çš„åŸºç¡€ä¸Šï¼Œæä¾›å’Œç°æœ‰æŠ€æœ¯ä¸€æ ·ä¸šåŠ¡åŠŸèƒ½çš„æŠ€æœ¯æ¡†æ¶ï¼Œè¿™ä¸ªæ–°çš„æŠ€æœ¯æ¡†æ¶æ¯”åŸæŠ€æœ¯æ›´åŠ æ˜“ç”¨ï¼Œæ›´åŠ å¥å£®åŒæ—¶åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œä¾‹å¦‚å¸¸ç”¨çš„jQueryï¼Œä»¥åŠä¸Šé¢æåˆ°çš„springå’ŒspringMVCï¼ˆå…¶å®æ˜¯ä¸€ä¸ªå•¦ï¼‰ï¼Œæ·±ç©¶è¿™äº›æ¡†æ¶éƒ½æ˜¯å¾ˆå¤æ‚çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„ä¼˜ç‚¹å…¶å®åªæœ‰ä¸€ä¸ªï¼š<strong>å°±æ˜¯è®©ä½¿ç”¨è€…åªå…³å¿ƒæ ¸å¿ƒä¸šåŠ¡çš„å¼€å‘ï¼Œæ¡†æ¶å¸®ä½ å±è”½åŸæœ‰æŠ€æœ¯è·Ÿä¸šåŠ¡å¼€å‘æ— å…³çš„å„ç±»æŠ€æœ¯é—®é¢˜</strong>ã€‚åƒjQueryï¼ŒspringMVCè¿™ç±»æ¡†æ¶ä¹‹æ‰€ä»¥ä¼˜ç§€ï¼Œå°±æ˜¯å®ƒä»¬åœ¨è¿™ç‚¹ä¸Šåšçš„å¤ªå¥½äº†ï¼Œä»¥è‡³äºå¾ˆå¤šä½¿ç”¨å®ƒçš„ç¨‹åºå‘˜éƒ½å·²ç»ä¸æ¸…æ¥šåŸæœ‰æŠ€æœ¯çš„çœŸå®é¢ç›®ï¼Œå› æ­¤æˆ‘ä»¬è¦å°†springmvcç†è§£çš„æ›´å¥½ï¼Œä½¿ç”¨çš„æ›´åŠ ç†Ÿç»ƒå’Œæ·±å…¥ï¼Œè¿™é‡Œæˆ‘ä»¬å°±è¦è·³å‡ºspringmvcçš„æŠ€æœ¯ï¼Œåˆ°springmvcæŠ€æœ¯çš„æºå¤´servletï¼Œä»”ç»†ç ”ç©¶ä¸‹servletçš„ç‰¹ç‚¹ï¼Œåªæœ‰è¿™æ ·æˆ‘ä»¬æ‰èƒ½æŠŠspringmvcæ¡†æ¶å­¦çš„æ›´å¥½ï¼ˆæ‰€ä»¥æ‰é‚£ä¹ˆå¤šäººçœ‹springmvcçš„æºç å­¦ä¹ å§ï¼‰ã€‚</p>
<p>å…ˆè®²è®²servletå§ï¼Œservletçš„ä½œç”¨å°±æ˜¯æ˜¯æ¥æ”¶æµè§ˆå™¨ä¼ ç»™æœåŠ¡ç«¯çš„è¯·æ±‚ï¼ˆrequestï¼‰ï¼Œå¹¶å°†æœåŠ¡ç«¯å¤„ç†å®Œçš„å“åº”ï¼ˆresponseï¼‰è¿”å›ç»™ç”¨æˆ·çš„æµè§ˆå™¨ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡ç«¯ä¹‹é—´é€šè¿‡httpåè®®è¿›è¡Œæ²Ÿé€šï¼Œå…¶è¿‡ç¨‹æ˜¯æµè§ˆå™¨æ ¹æ®ç”¨æˆ·çš„é€‰æ‹©å°†ç›¸å…³ä¿¡æ¯æŒ‰httpåè®®æŠ¥æ–‡çš„è§„èŒƒç»„è£…è¯·æ±‚çš„httpæŠ¥æ–‡ï¼ŒæŠ¥æ–‡é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°æŒ‡å®šçš„æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨é€šè¿‡ç‰¹å®šçš„webå®¹å™¨æ¥æ”¶è¿™ä¸ªæŠ¥æ–‡ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼štomcatï¼Œjettyï¼Œjbossè¿™æ ·çš„webå®¹å™¨ï¼Œwebå®¹å™¨ä¼šå°†httpæŠ¥æ–‡è§£æå‡ºæ¥ï¼Œå¦‚æœæ˜¯ç”¨æˆ·è¯·æ±‚ï¼Œæœ€ç»ˆè§£æå‡ºæ¥çš„æŠ¥æ–‡ä¿¡æ¯ä¼šç”¨ä¸€ä¸ªrequestå¯¹è±¡å­˜å‚¨èµ·æ¥ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨è¿™ä¸ªrequeståšå®Œç›¸åº”çš„å¤„ç†åï¼ŒæœåŠ¡ç«¯ç¨‹åºå°†ç»“æœä¿¡æ¯å°è£…åˆ°responseå¯¹è±¡é‡Œï¼Œç„¶åå°†responseå¯¹è±¡äº¤ç»™webå®¹å™¨ï¼Œwebå®¹å™¨åˆ™æŠŠè¿™ä¸ªresponseå¯¹è±¡è½¬å˜ä¸ºhttpåè®®çš„æŠ¥æ–‡ï¼Œå¹¶å°†æŠ¥æ–‡å›ä¼ ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æœ€åè§£æè¿™ä¸ªå“åº”æŠ¥æ–‡ï¼Œå°†æœ€ç»ˆç»“æœå±•ç¤ºç»™ç”¨æˆ·ã€‚</p>
<p>è€ŒWebå®¹å™¨åˆ›é€ äº†servletæ¥å£ï¼Œservletæ¥å£å°±æ˜¯å¼€å‘äººå‘˜è‡ªå·±å®ç°ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ï¼Œç¨‹åºå‘˜å¼€å‘servletå°±å¥½æ¯”åšå¡«ç©ºé¢˜ï¼Œè€Œå¡«ç©ºé¢˜çš„è¯­å¢ƒæˆ–è€…è¯´ä¸Šä¸‹æ–‡æç¤ºå°±æ˜¯ç”±requestå’Œresponseå¯¹è±¡ï¼Œä½†æ˜¯javaEEè§„èŒƒé‡Œçš„servletæ¥å£å¾ˆç®€å•ï¼Œå°±ä¸‰ä¸ªæ–¹æ³•initï¼Œserviceå’Œdestoryï¼Œä½†æ˜¯è¿™ä¸ªæ¥å£å¤ªç¬¼ç»Ÿäº†ï¼Œæ‰€ä»¥è§„èŒƒé‡Œè¿˜æä¾›äº†ä¸€ä¸ªHttpServletç±»ï¼Œè¿™ä¸ªç±»æ ¹æ®httpè¯·æ±‚ç±»å‹æä¾›äº†doGetï¼ŒdoPostç­‰æ–¹æ³•ï¼Œservletæ¥å£æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯æ ¹æ®httpåè®®çš„ç‰¹ç‚¹è¿›è¡Œå®šä¹‰ï¼Œå› æ­¤åšservletå¼€å‘æ—¶å€™å¦‚æœä½¿ç”¨è€…å¯¹httpåè®®ç‰¹ç‚¹ä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰ï¼Œéƒ½ä¼šç¢°åˆ°æˆ–å¤šæˆ–å°‘ä»¤äººè¿·æƒ‘çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯ç¢°åˆ°ä¸€äº›å¤æ‚ç‰¹æ®Šçš„è¯·æ±‚æ—¶å€™ï¼šä¾‹å¦‚æ–‡ä»¶ä¸Šä¼ ï¼Œè¿”å›ç‰¹æ®Šçš„æ–‡ä»¶æ ¼å¼åˆ°æµè§ˆå™¨ï¼Œè¿™æ—¶å€™ä½¿ç”¨servletå¼€å‘å°±ä¸æ˜¯å¾ˆæ–¹ä¾¿äº†ï¼Œservletå¼€å‘è¿˜æœ‰ä¸ªé—®é¢˜å¯èƒ½å¤§å®¶å¸¸å¸¸è¢«å¿½è§†ï¼Œå°±æ˜¯è¯·æ±‚çš„æ•°æ®çš„ç±»å‹è½¬åŒ–ï¼Œhttpåè®®ä¼ è¾“éƒ½æ˜¯æ–‡æœ¬å½¢å¼ï¼Œåˆ°äº†webå®¹å™¨è§£æåä¹Ÿæ˜¯æ–‡æœ¬ç±»å‹ï¼Œå¦‚æœç¢°åˆ°è´§å¸ï¼Œæ•°å­—ï¼Œæ—¥æœŸè¿™æ ·çš„ç±»å‹éœ€è¦æˆ‘ä»¬æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè½¬åŒ–ï¼Œå¦‚æœé¡µé¢ä¼ é€çš„ä¿¡æ¯éå¸¸å¤šï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸åšå¤§é‡ç±»å‹è½¬åŒ–ï¼Œè¿™ç§å·¥ä½œæ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯å«é‡ï¼Œæ˜¯ä¸ªä½“åŠ›æ´»è€Œä¸”å¾ˆå®¹æ˜“å¯¼è‡´ç¨‹åºé”™è¯¯ã€‚</p>
<p>servletå¦ä¸€ä¸ªä½œç”¨å°±æ˜¯æ„é€ responseå¯¹è±¡ï¼Œè®©é¡µé¢è·å¾—æ­£ç¡®çš„å“åº”ï¼Œå…¶å®ç°ä»£çš„æµè§ˆå™¨æ˜¯ä¸€ä¸ªå¤šåª’ä½“å·¥å…·ï¼Œæ–‡å­—ï¼Œå›¾ç‰‡ï¼Œè§†å±ç­‰ç­‰ä¸œè¥¿éƒ½å¯ä»¥åœ¨æµè§ˆå™¨é‡Œæ˜¾ç¤ºï¼Œèµ„æºçš„ä¸åŒå°±ä¼šå¯¼è‡´httpå“åº”æŠ¥æ–‡çš„å·®åˆ«ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨servletå¼€å‘å°±è¦æ ¹æ®èµ„æºçš„ä¸åŒåœ¨javaç¨‹åºé‡Œç”¨ç¡¬ç¼–ç çš„å½¢å¼å¤„ç†ï¼Œè¿™æ ·çš„ç¨‹åºå¾ˆéš¾å¤ç”¨ï¼Œè€Œä¸”å¦‚æœç¨‹åºå‘˜å¯¹æŸç§èµ„æºçš„å¤„ç†ç†è§£ä¸åˆ°ä½ï¼Œå°±ä¼šå¯¼è‡´é—®é¢˜çš„å‡ºç°ã€‚</p>
<p>è€Œåœ¨SpringMVC ä¸­ï¼Œæ§åˆ¶å™¨Controller è´Ÿè´£å¤„ç†ç”±DispatcherServlet åˆ†å‘çš„è¯·æ±‚ï¼Œå®ƒæŠŠç”¨æˆ·è¯·æ±‚çš„æ•°æ®ç»è¿‡ä¸šåŠ¡å¤„ç†å±‚å¤„ç†ä¹‹åå°è£…æˆä¸€ä¸ªModel ï¼Œç„¶åå†æŠŠè¯¥Model è¿”å›ç»™å¯¹åº”çš„View è¿›è¡Œå±•ç¤ºã€‚åœ¨SpringMVC ä¸­æä¾›äº†ä¸€ä¸ªéå¸¸ç®€ä¾¿çš„å®šä¹‰Controller çš„æ–¹æ³•ï¼Œä½ æ— éœ€ç»§æ‰¿ç‰¹å®šçš„ç±»æˆ–å®ç°ç‰¹å®šçš„æ¥å£ï¼Œåªéœ€ä½¿ç”¨@Controller æ ‡è®°ä¸€ä¸ªç±»æ˜¯Controller ï¼Œç„¶åä½¿ç”¨@RequestMapping å’Œ@RequestParam ç­‰ä¸€äº›æ³¨è§£ç”¨ä»¥å®šä¹‰URL è¯·æ±‚å’ŒController æ–¹æ³•ä¹‹é—´çš„æ˜ å°„ï¼Œè¿™æ ·çš„Controller å°±èƒ½è¢«å¤–ç•Œè®¿é—®åˆ°ã€‚æ­¤å¤–Controller ä¸ä¼šç›´æ¥ä¾èµ–äºHttpServletRequest å’ŒHttpServletResponse ç­‰HttpServlet å¯¹è±¡ï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡Controller çš„æ–¹æ³•å‚æ•°çµæ´»çš„è·å–åˆ°ã€‚</p>
<p>servleté‡Œè¿˜æœ‰ä¸¤ä¸ªé‡è¦çš„æŠ€æœ¯ï¼šç›‘å¬å™¨å’Œè¿‡æ»¤å™¨ï¼Œå¯¹äºç›‘å¬å™¨åœ¨webå¼€å‘é‡Œä½¿ç”¨çš„åœºæ™¯æ¯”è¾ƒå°‘ï¼Œéƒ½æ˜¯ä¸€äº›ååˆ†ç‰¹åˆ«çš„æƒ…å†µæ‰ä¼šä½¿ç”¨ï¼Œå¤§éƒ¨åˆ†webå¼€å‘é‡Œå¯ä»¥å¿½ç•¥å®ƒçš„ä½¿ç”¨ï¼Œæˆ‘ä»¬ç”¨çš„æœ€å¤šçš„ç›‘å¬å™¨å¯èƒ½å°±æ˜¯å¯¹ServletContextåˆ›å»ºå’Œé”€æ¯çš„ç›‘å¬å™¨ï¼ŒServletContextæ˜¯æ•´ä¸ªwebåº”ç”¨çš„å…¨å±€å¯¹è±¡ï¼Œå®ƒå’ŒWebåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šåœ¨ä¸€èµ·ï¼Œå› æ­¤ä½¿ç”¨è¿™ä¸ªç›‘å¬å™¨å¯¹Webåº”ç”¨çš„å…¨å±€ä¿¡æ¯è¿›è¡Œåˆå§‹åŒ–å’Œé”€æ¯æ“ä½œï¼Œä¾‹å¦‚springå®¹å™¨çš„åˆå§‹åŒ–æ“ä½œã€‚è€Œè¿‡æ»¤å™¨æ–¹é¢ï¼Œä½¿ç”¨SpringMVCæ‹¦æˆªå™¨å’ŒStruts2ä¸€æ ·ï¼ŒSpring MVCä¹Ÿå¯ä»¥ä½¿ç”¨æ‹¦æˆªå™¨å¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªå¤„ç†ï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰æ‹¦æˆªå™¨æ¥å®ç°ç‰¹å®šçš„åŠŸèƒ½ï¼Œè‡ªå®šä¹‰çš„æ‹¦æˆªå™¨å¿…é¡»å®ç°HandlerInterceptoræ¥å£ã€‚</p>
<p><strong>ä¸‹é¢å†è°ˆè°ˆspring</strong><br><br>springæŠ€æœ¯å¯ä»¥è¯´æ˜¯javaä¼ä¸šå¼€å‘é‡Œæœ€é‡è¦çš„æŠ€æœ¯ï¼Œä¸è¿‡çœŸçš„ç†è§£springçš„ä½œç”¨å’Œæ„ä¹‰è¿˜çœŸæ˜¯ä¸€ä»¶éº»çƒ¦çš„äº‹æƒ…ï¼Œå¾ˆå¤šäººå¯¹springç†è§£å…¶å®éƒ½æ˜¯åœç•™åœ¨ä½¿ç”¨é˜¶æ®µï¼ˆä¾‹å¦‚ï¼šå£°æ˜å¼äº‹åŠ¡å¾ˆå¥½ç”¨ç­‰ç­‰ï¼‰ï¼Œå½“ä»Šçš„springæŠ€æœ¯ç”Ÿæ€ç¯å¢ƒé‡Œå¯è°“æ˜¯è”šä¸ºå£®è§‚ï¼Œspringå·²ç»åŒ…ç½—ä¸‡è±¡ï¼Œå®ƒçš„å†…å®¹ä¹‹å¤šå®Œå…¨ä¸äºšäºå®ƒçš„æœ¬æºjavaè¯­è¨€äº†ï¼Œè€Œspringè¿™ä¹ˆå¤§çš„æ¡†éƒ½æ˜¯å»ºç«‹åœ¨iocå’ŒaopæŠ€æœ¯ä¹‹ä¸Šï¼Œåªæœ‰æ·±å…¥ç†è§£äº†è¿™ä¸¤ä¸ªæŠ€æœ¯æˆ‘ä»¬æ‰èƒ½æ˜ç™½ä¸ºä»€ä¹ˆspringè¿™ä¸ªæ¡†èƒ½è£…çš„ä¸‹é‚£ä¹ˆå¤šä¸œè¥¿äº†ã€‚</p>
<p>é¦–å…ˆæ˜¯iocï¼ŒiocæŠ€æœ¯ç¬¬ä¸€ä¸ªè§£é‡Šå«åšæ§åˆ¶åè½¬ï¼Œå®ƒè¿˜æœ‰ä¸ªè§£é‡Šå°±æ˜¯ä¾èµ–æ³¨å…¥ï¼Œè¿™ä¸¤ä¸ªåå­—å¾ˆéš¾ä»å­—é¢ç†è§£ï¼Œä½†æ˜¯å½“ä½ ç†è§£å®ƒçš„åŸç†åå°±ä¼šå‘ç°å®ƒä»¬çš„æè¿°æ˜¯ä½•ç­‰å‡†ç¡®ã€‚IocæŠ€æœ¯çš„æœ¬è´¨å°±æ˜¯æ„å»ºå¯¹è±¡çš„æŠ€æœ¯æ¢å¥è¯è¯´å°±æ˜¯å°†ä¸€ä¸ªç±»å®ä¾‹åŒ–æˆå¯¹è±¡çš„æŠ€æœ¯ï¼Œåœ¨javaé‡Œå®ä¾‹åŒ–ç±»é€šè¿‡newå…³é”®å­—è¿›è¡Œçš„ï¼Œæ¯æ¬¡newä¸€ä¸ªç±»éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å®ä¾‹å¯¹è±¡ï¼Œè¿™ä¹ˆåšè§†ä¹å¾ˆæµªè´¹ï¼Œæœ‰æ—¶è¿™ç§æµªè´¹è¿˜æŒºå±é™©ï¼Œå› ä¸ºåœ¨ç¨‹åºå¼€å‘æ—¶å€™æˆ‘ä»¬å¸¸å¸¸åªéœ€è¦æŸä¸ªç±»æ°¸è¿œåªèƒ½äº§ç”Ÿä¸€ä¸ªçš„å®ä¾‹å¯¹è±¡è¿™ä¸ªæ—¶å€™å°±å¾—ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œæ­¤å¤–åœ¨è®¾è®¡æ¨¡å¼é‡Œè¿˜å¯ä»¥é€šè¿‡å·¥å‚æ–¹å¼äº§ç”Ÿå¯¹è±¡ï¼Œä½¿ç”¨è¿‡springçš„äººçœ‹åˆ°ä¸Šé¢çš„æ–‡å­—å°±çŸ¥é“äº†ï¼Œspringé‡Œbeançš„å®šä¹‰å°±å’Œä¸Šé¢çš„å†…å®¹ä¸€ä¸€å¯¹åº”ï¼Œscopeå±æ€§singleäº§ç”Ÿå•ä¾‹å¯¹è±¡ï¼Œprototypeäº§ç”Ÿæ–°å¯¹è±¡ï¼Œbeanè¿˜å¯ä»¥é€šè¿‡å·¥å‚æ–¹å¼äº§ç”Ÿå¯¹è±¡ï¼Œå¯ä»¥è¯´springçš„beanå°±æ˜¯åˆ¶é€ å¯¹è±¡çš„å·¥å…·ã€‚é¢å‘å¯¹è±¡ç¼–ç¨‹é‡Œå¯¹è±¡ç›¸å½“äºæ˜¾ç¤ºç”Ÿæ´»ä¸­çš„ä¸€ä¸ªå®ä½“ï¼Œä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸ªå¯¹è±¡ä½œç”¨æ˜¯å®Œæˆæ‰“çŒçš„æ“ä½œï¼Œé‚£ä¹ˆæ‰“çŒè¿™ä¸ªå¯¹è±¡å†…éƒ¨åŒ…å«ä¸¤ä¸ªè¾…åŠ©å¯¹è±¡ï¼šäººå’Œæªï¼Œåªæœ‰äººå’Œæªèµ‹äºˆäº†æ‰“çŒè¿™ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆæ‰“çŒå¯¹è±¡æ‰èƒ½å®Œæˆæ‰“çŒçš„æ“ä½œï¼Œä½†æ˜¯æ„å»ºä¸€ä¸ªäººå’Œæªçš„å¯¹è±¡å¹¶ä¸æ˜¯çœ‹èµ·æ¥é‚£ä¹ˆç®€å•ï¼Œè¿™é‡Œä»¥æªä¸ºä¾‹ï¼Œè¦åˆ›é€ ä¸€æŠŠæªæˆ‘ä»¬éœ€è¦é‡‘å±ï¼Œéœ€è¦æœºåºŠï¼Œéœ€è¦å­å¼¹ï¼Œè€ŒæœºåºŠå’Œå­å¼¹åˆæ˜¯ä¸¤ä¸ªæ–°å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ä¸€ä¸ªä¸ªç›¸äº’åµŒå¥—ç›¸äº’å…³è”ï¼Œå¤§ä¼™è¯•æƒ³ä¸‹å¦‚æœæˆ‘ä»¬åœ¨javaä»£ç é‡Œæ„å»ºä¸€ä¸ªæªçš„å¯¹è±¡é‚£æ˜¯ä½•å…¶çš„å¤æ‚ï¼Œå‡å¦‚æˆ‘ä»¬è¦æ„é€ çš„ä¸æ˜¯ç®€å•çš„æªå¯¹è±¡è€Œæ˜¯æ›´åŠ å¤æ‚çš„èˆªç©ºæ¯èˆ°ï¼Œé‚£ä¹ˆæ„é€ è¿™ä¸ªå¯¹è±¡çš„æˆæœ¬ä¹‹é«˜æ˜¯è®©äººéš¾ä»¥æƒ³è±¡çš„ï¼Œæ€ä¹ˆæ¥æ¶ˆé™¤è¿™ç§å¯¹è±¡ç›¸äº’åµŒå¥—ç›¸äº’ä¾èµ–çš„å…³ç³»äº†ï¼Ÿspringæä¾›äº†ä¸€ç§æ–¹å¼ï¼Œè¿™ç§æ–¹å¼å°±æ˜¯springæä¾›ä¸€ä¸ªå®¹å™¨ï¼Œæˆ‘ä»¬åœ¨xmlæ–‡ä»¶é‡Œå®šä¹‰å„ä¸ªå¯¹è±¡çš„ä¾èµ–å…³ç³»ï¼Œç”±å®¹å™¨å®Œæˆå¯¹è±¡çš„æ„å»ºï¼Œå½“æˆ‘ä»¬javaä»£ç é‡Œéœ€è¦ä½¿ç”¨æŸä¸ªå®ä¾‹çš„æ—¶å€™å°±å¯ä»¥ä»å®¹å™¨é‡Œè·å–ï¼Œé‚£ä¹ˆå¯¹è±¡çš„æ„å»ºæ“ä½œå°±è¢«springå®¹å™¨æ¥ç®¡ï¼Œæ‰€ä»¥å®ƒè¢«ç§°ä¸ºæ§åˆ¶åè½¬ï¼Œæ§åˆ¶åè½¬çš„æ„æ€å°±æ˜¯æœ¬æ¥å±äºjavaç¨‹åºé‡Œæ„å»ºå¯¹è±¡çš„åŠŸèƒ½äº¤ç”±å®¹å™¨æ¥ç®¡ï¼Œä¾èµ–æ³¨å…¥å°±æ˜¯å½“ç¨‹åºè¦ä½¿ç”¨æŸä¸ªå¯¹è±¡æ—¶å€™ï¼Œå®¹å™¨ä¼šæŠŠå®ƒæ³¨å…¥åˆ°ç¨‹åºé‡Œï¼Œè¿™å°±å«åšä¾èµ–æ³¨å…¥ã€‚åœ¨javaå¼€å‘é‡Œæˆ‘ä»¬æƒ³ä½¿ç”¨æŸä¸ªç±»æä¾›çš„åŠŸèƒ½ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§å°±æ˜¯æ„é€ ä¸€ä¸ªæ–°çš„ç±»ï¼Œæ–°çš„ç±»ç»§æ‰¿è¯¥ç±»ï¼Œå¦ä¸€ç§æ–¹å¼åˆ™æ˜¯å°†æŸä¸ªç±»å®šä¹‰åœ¨æ–°ç±»é‡Œï¼Œé‚£ä¹ˆä¸¤ä¸ªç±»ä¹‹é—´å°±å»ºç«‹ä¸€ç§å…³è”å…³ç³»ï¼Œspringçš„iocå®¹å™¨å°±æ˜¯å®ç°äº†è¿™ç§å…³è”å…³ç³»ï¼ˆè®°ä½ä¸æ˜¯ç»§æ‰¿å…³ç³»å“¦ï¼‰ï¼Œé‚£ä¹ˆæŸä¸ªç±»è¦è¢«èµ‹äºˆåˆ°æ–°ç±»æœ‰å“ªäº›åŠæ³•äº†ï¼Ÿä¸€èˆ¬åªæœ‰ä¸¤ç§ï¼šä¸€ç§å°±æ˜¯é€šè¿‡æ„é€ å‡½æ•°ï¼Œä¸€ç§å°±æ˜¯é€šè¿‡setXXXæ–¹å¼ï¼Œè¿™ä¹Ÿæ˜¯springå®¹å™¨ä½¿ç”¨åˆ°äº†ä¸¤ç§æ ‡å‡†çš„æ³¨å…¥æ–¹å¼ã€‚</p>
<p>ä¸ç®¡æ˜¯ä¸Šé¢è¯´çš„ç»§æ‰¿æ–¹å¼ï¼Œè¿˜æ˜¯å…³è”æ–¹å¼å…¶å®éƒ½æ˜¯å¢å¼ºç›®æ ‡å¯¹è±¡èƒ½åŠ›çš„å¼€å‘æ‰‹æ®µï¼Œåœ¨è®¾è®¡æ¨¡å¼é‡Œæœ‰ä¸€ç§ä»£ç†æ¨¡å¼ï¼Œä»£ç†æ¨¡å¼å°†ç»§æ‰¿æ¨¡å¼å’Œå…³è”æ¨¡å¼ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œä»£ç†æ¨¡å¼å°±æ˜¯ç»§æ‰¿æ¨¡å¼å’Œå…³è”æ¨¡å¼çš„ç»¼åˆä½“ï¼Œä¸è¿‡è¿™ä¸ªç»¼åˆä½“çš„ä½œç”¨å€’ä¸æ˜¯è§£å†³å¯¹è±¡æ³¨å…¥çš„é—®é¢˜ï¼Œè€Œæ˜¯ä¸ºå…·ä½“æ“ä½œå¯¹è±¡æ‰¾åˆ°ä¸€ä¸ªä¿å§†æˆ–è€…æ˜¯ç§˜ä¹¦ï¼Œè¿™å°±å’Œå°è¯´é‡Œçš„äºŒå·é¦–é•¿ä¸€æ ·ï¼Œè¿™ä¸ªäºŒå·é¦–é•¿å¯¹å¤–ä»£è¡¨äº†å…·ä½“çš„å®ä¾‹å¯¹è±¡ï¼Œå®ä¾‹å¯¹è±¡çš„å…¥å£å’Œå‡ºå£éƒ½æ˜¯é€šè¿‡è¿™ä¸ªäºŒå·é¦–é•¿ï¼Œå› ä¸ºå…·ä½“çš„å®ä¾‹å¯¹è±¡æ˜¯ä¸€å·é¦–é•¿ï¼Œä¸€å·é¦–é•¿æ˜¯è¦å¹²å¤§äº‹çš„ï¼Œæ‰€ä»¥ä¸€äº›äº‹åŠ¡æ€§ï¼Œé‡å¤æ€§çš„å·¥ä½œä¾‹å¦‚æ³¡èŒ¶ï¼Œå®‰æ’è½¦å­ï¼Œè¿™æ ·çš„å·¥ä½œæ˜¯ä¸ç”¨åŠ³çƒ¦ä¸€å·é¦–é•¿çš„å¤§é©¾ï¼Œè€Œæ˜¯äºŒå·é¦–é•¿å¸®å¿™è§£å†³çš„ï¼Œè¿™å°±æ˜¯aopçš„æ€æƒ³ï¼Œaopè§£å†³ç¨‹åºå¼€å‘é‡Œäº‹åŠ¡æ€§ï¼Œå’Œæ ¸å¿ƒä¸šåŠ¡æ— å…³çš„é—®é¢˜ï¼Œä½†è¿™äº›é—®é¢˜å¯¹äºä¸šåŠ¡åœºæ™¯çš„å®ç°æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œåœ¨å®é™…å¼€å‘é‡Œaopä¹Ÿæ˜¯èŠ‚çœä»£ç çš„ä¸€ç§æ–¹å¼ã€‚</p>
<p>Springçš„æ ¸å¿ƒæŠ€æœ¯çš„ä½œç”¨æœ¬è´¨å°±æ˜¯ä¸€ä¸ª æ²Ÿé€šæœºåˆ¶ï¼Œspringæ€»æ˜¯å°½å…¨åŠ›çš„è®©æ²Ÿé€šçš„åŒæ–¹ä¿¡æ¯ç•…é€šï¼ŒåŒæ—¶é™ä½åŒæ–¹çš„æ²Ÿé€šæˆæœ¬ï¼Œåœ¨ç°å®æœºæ„é‡Œä¸€ä¸ªå–„äºæ²Ÿé€šçš„äººè‚¯å®šæ˜¯è¯¥å…¬å¸çš„é¢†å¯¼ï¼Œå¾ˆä¼šæ²Ÿé€šçš„é¢†å¯¼èƒ½è°ƒåŠ¨èµ·å„ç§èµ„æºçš„ç§¯ææ€§ï¼Œå–„äºæ²Ÿé€šçš„é¢†å¯¼å°±ä¼šåšåˆ°æµ·çº³ç™¾å·ï¼Œè®©å„ç§ä¸åŒäººè¿½éšä»–ï¼Œæ‰€ä»¥å½“ä»Šçš„springå°±æ˜¯ä¸€ä¸ªå¤§æ¡†ï¼Œä»€ä¹ˆéƒ½å¯ä»¥å¾€é‡Œè£…ã€‚</p>
<p>Springå¾ˆåƒé“¶è¡Œï¼Œå®ƒä¸èƒ½ç›´æ¥åˆ›é€ ç‰©è´¨è´¢å¯Œï¼Œä½†æ˜¯ä¸€åˆ‡èµ„æºéƒ½è¦é€šè¿‡å®ƒè¿›è¡Œæµé€šï¼Œå®ƒèƒ½æ§åˆ¶ç»æµå‘å±•çš„èµ°å‘ï¼Œå›åˆ°ç¨‹åºçš„ä¸–ç•Œï¼Œspringçš„ä½œç”¨æ˜¯è¢«æ ‡æ¦œä¸ºç¨‹åºä¹‹é—´çš„è§£è€¦ï¼Œspringèƒ½é™ä½ä¸åŒæ¨¡å—ä¹‹é—´çš„è€¦åˆåº¦ï¼ŒåŸå› å°±æ˜¯åœ¨ç¨‹åºå¼€å‘é‡Œä¸åŒæ¨¡å—ä¹‹é—´ä¿¡æ¯çš„æ²Ÿé€šæ˜¯é€šè¿‡å¯¹è±¡ä¼ é€’å®Œæˆçš„ï¼Œè€Œå¯¹è±¡èƒ½å¦é¡ºåˆ©ä¼ é€’å°±æ˜¯è¦åˆç†çš„æ„å»ºå¥½å¯¹è±¡ï¼Œè€Œç®¡ç†å¥½å¯¹è±¡çš„æ„å»ºæ–¹å¼å°±èƒ½ç®¡ç†å¥½å¯¹è±¡ä¼ é€’ï¼Œè¿™å°±æ˜¯springç»™ç³»ç»Ÿæ¶æ„è®¾è®¡å¸¦æ¥çš„å¥½å¤„ã€‚</p>
<p>å†™å•Šå†™ï¼Œæ‰¾å•Šæ‰¾ï¼ŒæŠ„å•ŠæŠ„ï¼Œç»“æœæäº†è¿™ä¹ˆå¤šã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaçš„é™æ€/åŠ¨æ€ç»‘å®š</title>
    <url>/2017/02/18/Java%E7%9A%84%E9%9D%99%E6%80%81-%E5%8A%A8%E6%80%81%E7%BB%91%E5%AE%9A/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä»Šå¤©çœ‹åˆ°ã€ŠJavaæ ¸å¿ƒæŠ€æœ¯Iã€‹ä¹¦ä¸Šçš„åŠ¨æ€ç»‘å®šï¼Œæ„æ€å°±æ˜¯å½“å­ç±»å’Œçˆ¶ç±»å­˜åœ¨åŒä¸€ä¸ªæ–¹æ³•ï¼Œå­ç±»é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œç¨‹åºåœ¨è¿è¡Œæ—¶è°ƒç”¨æ–¹æ³•æ˜¯è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•è¿˜æ˜¯å­ç±»çš„é‡å†™æ–¹æ³•å‘¢ï¼Ÿç¨‹åºä¼šåœ¨è¿è¡Œçš„æ—¶å€™è‡ªåŠ¨é€‰æ‹©è°ƒç”¨æŸä¸ªæ–¹æ³•ï¼ˆæ ¹æ®æ–¹æ³•è¡¨ï¼‰ã€‚<br>çœ‹å®Œè¿™é‡Œä¸ç”±è‡ªä¸»çš„æƒ³åˆ°ï¼Œæœ‰åŠ¨æ€è‚¯å®šä¹Ÿå°±æœ‰é™æ€å§ï¼Œäºæ˜¯å»æ±‚åŠ©äº†ä¸‹googleï¼Œé¦–å…ˆçœ‹äº†ä¸‹ä»€ä¹ˆæ˜¯<strong>ç»‘å®š</strong>:<br>ç»‘å®šæŒ‡çš„æ˜¯ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨ä¸æ–¹æ³•æ‰€åœ¨çš„ç±»(æ–¹æ³•ä¸»ä½“)å…³è”èµ·æ¥ã€‚å¯¹javaæ¥è¯´ï¼Œç»‘å®šåˆ†ä¸ºé™æ€ç»‘å®šå’ŒåŠ¨æ€ç»‘å®šï¼›æˆ–è€…å«åšå‰æœŸç»‘å®šå’ŒåæœŸç»‘å®šã€‚<br><a id="more"></a><br>ç„¶åæˆ‘ä»¬åˆ†åˆ«çœ‹çœ‹ä¸¤è€…ä¹‹é—´å«ä¹‰ä»¥åŠå·®åˆ«<br><br><strong>åŠ¨æ€ç»‘å®š</strong>ï¼šåœ¨è¿è¡Œæ—¶æ ¹æ®å…·ä½“å¯¹è±¡çš„ç±»å‹è¿›è¡Œç»‘å®šã€‚è‹¥ä¸€ç§è¯­è¨€å®ç°äº†åæœŸç»‘å®šï¼ŒåŒæ—¶å¿…é¡»æä¾›ä¸€äº›æœºåˆ¶ï¼Œå¯åœ¨è¿è¡ŒæœŸé—´åˆ¤æ–­å¯¹è±¡çš„ç±»å‹ï¼Œå¹¶åˆ†åˆ«è°ƒç”¨é€‚å½“çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘å™¨æ­¤æ—¶ä¾ç„¶ä¸çŸ¥é“å¯¹è±¡çš„ç±»å‹ï¼Œä½†æ–¹æ³•è°ƒç”¨æœºåˆ¶èƒ½è‡ªå·±å»è°ƒæŸ¥ï¼Œæ‰¾åˆ°æ­£ç¡®çš„æ–¹æ³•ä¸»ä½“ã€‚ä¸åŒçš„è¯­è¨€å¯¹åæœŸç»‘å®šçš„å®ç°æ–¹æ³•æ˜¯æœ‰æ‰€åŒºåˆ«çš„ã€‚ä½†æˆ‘ä»¬è‡³å°‘å¯ä»¥è¿™æ ·è®¤ä¸ºï¼šå®ƒä»¬éƒ½è¦åœ¨å¯¹è±¡ä¸­å®‰æ’æŸäº›ç‰¹æ®Šç±»å‹çš„ä¿¡æ¯ã€‚</p>
<p><strong>åŠ¨æ€ç»‘å®šçš„è¿‡ç¨‹</strong>ï¼š<br><br>è™šæ‹Ÿæœºæå–å¯¹è±¡çš„å®é™…ç±»å‹çš„æ–¹æ³•è¡¨ï¼›â€“&gt;<br>è™šæ‹Ÿæœºæœç´¢æ–¹æ³•ç­¾åï¼›â€“&gt;<br>è°ƒç”¨æ–¹æ³•ã€‚</p>
<p><strong>é™æ€ç»‘å®š</strong>ï¼šåœ¨ç¨‹åºæ‰§è¡Œå‰æ–¹æ³•å·²ç»è¢«ç»‘å®šï¼ˆä¹Ÿå°±æ˜¯è¯´åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å°±å·²ç»çŸ¥é“è¿™ä¸ªæ–¹æ³•åˆ°åº•æ˜¯å“ªä¸ªç±»ä¸­çš„æ–¹æ³•ï¼‰ï¼Œæ­¤æ—¶ç”±ç¼–è¯‘å™¨æˆ–å…¶å®ƒè¿æ¥ç¨‹åºå®ç°ã€‚é’ˆå¯¹javaï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºç¨‹åºç¼–è¯‘æœŸçš„ç»‘å®šï¼›è¿™é‡Œè¦ç‰¹åˆ«è¯´æ˜ä¸€ç‚¹ï¼Œjavaå½“ä¸­çš„æ–¹æ³•åªæœ‰finalï¼Œstaticï¼Œprivateå’Œæ„é€ æ–¹æ³•æ˜¯å‰æœŸç»‘å®šã€‚</p>
<p><strong>å·®åˆ«</strong>ï¼šå…¶å®ä¸Šè¿°è§£é‡Šå¯ä»¥çœ‹å‡ºå¾ˆå¤šä¸œè¥¿äº†ã€‚<br><br>ï¼ˆ1ï¼‰é™æ€ç»‘å®šå‘ç”Ÿåœ¨ç¼–è¯‘æ—¶æœŸï¼ŒåŠ¨æ€ç»‘å®šå‘ç”Ÿåœ¨è¿è¡Œæ—¶<br><br>ï¼ˆ2ï¼‰ä½¿ç”¨privateæˆ–staticæˆ–finalä¿®é¥°çš„å˜é‡æˆ–è€…æ–¹æ³•ï¼Œä½¿ç”¨é™æ€ç»‘å®šã€‚è€Œè™šæ–¹æ³•ï¼ˆå¯ä»¥è¢«å­ç±»é‡å†™çš„æ–¹æ³•ï¼‰åˆ™ä¼šæ ¹æ®è¿è¡Œæ—¶çš„å¯¹è±¡è¿›è¡ŒåŠ¨æ€ç»‘å®šã€‚<br><br>ï¼ˆ3ï¼‰é™æ€ç»‘å®šä½¿ç”¨ç±»ä¿¡æ¯æ¥å®Œæˆï¼Œè€ŒåŠ¨æ€ç»‘å®šåˆ™éœ€è¦ä½¿ç”¨å¯¹è±¡ä¿¡æ¯æ¥å®Œæˆã€‚<br><br>ï¼ˆ4ï¼‰é‡è½½(Overload)çš„æ–¹æ³•ä½¿ç”¨é™æ€ç»‘å®šå®Œæˆï¼Œè€Œé‡å†™(Override)çš„æ–¹æ³•åˆ™ä½¿ç”¨åŠ¨æ€ç»‘å®šå®Œæˆã€‚</p>
<p><strong>ä¸‹é¢å¼€å§‹ä»£ç æµ‹è¯•</strong>ï¼š</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> &#123;</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">String</span> str = <span class="keyword">new</span> <span class="keyword">String</span>();</span><br><span class="line">      Lee lee = <span class="keyword">new</span> Lee();</span><br><span class="line">      lee.say(str);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Lee</span> &#123;</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">          System.out.<span class="built_in">println</span>(<span class="string">"è¿™æ˜¯ä¸ªObject"</span>);</span><br><span class="line">      &#125;   </span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">(<span class="keyword">String</span> str)</span> </span>&#123;</span><br><span class="line">          System.out.<span class="built_in">println</span>(<span class="string">"è¿™æ˜¯ä¸ªString"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ‰§è¡Œç»“æœ</strong>ï¼š<br><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">$ java <span class="keyword">Test</span></span><br><span class="line">è¿™æ˜¯ä¸ª<span class="keyword">String</span></span><br></pre></td></tr></table></figure></p>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œleeæ–¹æ³•å­˜åœ¨ä¸¤ä¸ªé‡è½½çš„å®ç°ï¼Œä¸€ä¸ªæ˜¯æ¥æ”¶Objectç±»å‹çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯æ¥æ”¶Stringç±»å‹çš„å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚è€Œstræ˜¯ä¸€ä¸ªStringå¯¹è±¡ï¼Œæ‰€æœ‰æ¥æ”¶Stringç±»å‹å‚æ•°çš„callæ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚è€Œè¿™é‡Œçš„ç»‘å®šå°±æ˜¯åœ¨ç¼–è¯‘æ—¶æœŸæ ¹æ®å‚æ•°ç±»å‹è¿›è¡Œçš„é™æ€ç»‘å®šã€‚</p>
<p><strong>æ¥ç€æˆ‘ä»¬åç¼–è¯‘éªŒè¯ä¸€ä¸‹</strong>:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">javap</span> <span class="string">-c</span> <span class="string">Test</span>    </span><br><span class="line"><span class="string">Compiled</span> <span class="string">from</span> <span class="string">"Test.java"</span></span><br><span class="line"><span class="string">public</span> <span class="string">class</span> <span class="string">CoreJava.day_2.Test</span> <span class="string">&#123;</span></span><br><span class="line">  <span class="string">public</span> <span class="string">CoreJava.day_2.Test();</span></span><br><span class="line">    <span class="attr">Code:</span></span><br><span class="line">       <span class="attr">0:</span> <span class="string">aload_0</span></span><br><span class="line">       <span class="attr">1:</span> <span class="string">invokespecial</span> <span class="comment">#1                  // Method java/lang/Object."&lt;init&gt;":()V</span></span><br><span class="line">       <span class="attr">4:</span> <span class="string">return</span></span><br><span class="line"></span><br><span class="line">  <span class="string">public</span> <span class="string">static</span> <span class="string">void</span> <span class="string">main(java.lang.String[]);</span></span><br><span class="line">    <span class="attr">Code:</span></span><br><span class="line">       <span class="attr">0:</span> <span class="string">new</span>           <span class="comment">#2                  // class java/lang/String</span></span><br><span class="line">       <span class="attr">3:</span> <span class="string">dup</span></span><br><span class="line">       <span class="attr">4:</span> <span class="string">invokespecial</span> <span class="comment">#3                  // Method java/lang/String."&lt;init&gt;":()V</span></span><br><span class="line">       <span class="attr">7:</span> <span class="string">astore_1</span></span><br><span class="line">       <span class="attr">8:</span> <span class="string">new</span>           <span class="comment">#4                  // class CoreJava/day_2/Test$Lee</span></span><br><span class="line">      <span class="attr">11:</span> <span class="string">dup</span></span><br><span class="line">      <span class="attr">12:</span> <span class="string">invokespecial</span> <span class="comment">#5                  // Method CoreJava/day_2/Test$Lee."&lt;init&gt;":()V</span></span><br><span class="line">      <span class="attr">15:</span> <span class="string">astore_2</span></span><br><span class="line">      <span class="attr">16:</span> <span class="string">aload_2</span></span><br><span class="line">      <span class="attr">17:</span> <span class="string">aload_1</span></span><br><span class="line">      <span class="attr">18:</span> <span class="string">invokevirtual</span> <span class="comment">#6                  // Method CoreJava/day_2/Test$Lee.call:(Ljava/lang/String;)V</span></span><br><span class="line">      <span class="attr">21:</span> <span class="string">return</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°äº†è¿™ä¸€è¡Œ18: invokevirtual #6                  // Method CoreJava/day_2/Test$Lee.call:(Ljava/lang/String;)Vç¡®å®æ˜¯å‘ç”Ÿäº†é™æ€ç»‘å®šï¼Œç¡®å®šäº†è°ƒç”¨äº†æ¥æ”¶Stringå¯¹è±¡ä½œä¸ºå‚æ•°çš„sayæ–¹æ³•ã€‚</p>
<p><strong>ç°åœ¨å¯ä»¥æ”¹å†™ä¸€ä¸‹</strong>ï¼š</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span>&#123;</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">String</span> str = <span class="keyword">new</span> <span class="keyword">String</span>();</span><br><span class="line">      Lee lee = <span class="keyword">new</span> SecLee();</span><br><span class="line">      lee.say(str);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Lee</span> &#123;</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">(<span class="keyword">String</span> str)</span> </span>&#123;</span><br><span class="line">          System.out.<span class="built_in">println</span>(<span class="string">"è¿™æ˜¯ä¸ªString"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SecLee</span> <span class="title">extends</span> <span class="title">Lee</span> &#123;</span></span><br><span class="line">      @Override</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">(<span class="keyword">String</span> str)</span> </span>&#123;</span><br><span class="line">          System.out.<span class="built_in">println</span>(<span class="string">"è¿™æ˜¯ç¬¬äºŒæçš„String"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç»“æœä¸º</strong>ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">$ java <span class="keyword">Test</span></span><br><span class="line">è¿™æ˜¯ç¬¬äºŒæçš„<span class="keyword">String</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ï¼Œç”¨SecLeeç»§æ‰¿äº†Leeï¼Œå¹¶ä¸”é‡å†™äº†sayæ–¹æ³•ã€‚æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªLeeç±»å‹çš„å˜é‡leeï¼Œä½†æ˜¯è¿™ä¸ªå˜é‡æŒ‡å‘çš„æ˜¯ä»–çš„å­ç±»SecLeeã€‚æ ¹æ®ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå…¶è°ƒç”¨äº†SecLeeçš„sayæ–¹æ³•å®ç°ï¼Œè€Œä¸æ˜¯Leeçš„sayæ–¹æ³•ã€‚è¿™ä¸€ç»“æœçš„äº§ç”Ÿçš„åŸå› æ˜¯å› ä¸ºåœ¨è¿è¡Œæ—¶å‘ç”Ÿäº†åŠ¨æ€ç»‘å®šï¼Œåœ¨ç»‘å®šè¿‡ç¨‹ä¸­éœ€è¦ç¡®å®šè°ƒç”¨å“ªä¸ªç‰ˆæœ¬çš„sayæ–¹æ³•å®ç°ã€‚</p>
<p><strong>å†çœ‹çœ‹åç¼–è¯‘çš„ç»“æœ</strong>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">javap</span> <span class="string">-c</span> <span class="string">Test</span></span><br><span class="line"><span class="string">è­¦å‘Š:</span> <span class="string">äºŒè¿›åˆ¶æ–‡ä»¶TeståŒ…å«CoreJava.day_2.Test</span></span><br><span class="line"><span class="string">Compiled</span> <span class="string">from</span> <span class="string">"Test.java"</span></span><br><span class="line"><span class="string">public</span> <span class="string">class</span> <span class="string">CoreJava.day_2.Test</span> <span class="string">&#123;</span></span><br><span class="line">  <span class="string">public</span> <span class="string">CoreJava.day_2.Test();</span></span><br><span class="line">    <span class="attr">Code:</span></span><br><span class="line">       <span class="attr">0:</span> <span class="string">aload_0</span></span><br><span class="line">       <span class="attr">1:</span> <span class="string">invokespecial</span> <span class="comment">#1                  // Method java/lang/Object."&lt;init&gt;":()V</span></span><br><span class="line">       <span class="attr">4:</span> <span class="string">return</span></span><br><span class="line"></span><br><span class="line">  <span class="string">public</span> <span class="string">static</span> <span class="string">void</span> <span class="string">main(java.lang.String[]);</span></span><br><span class="line">    <span class="attr">Code:</span></span><br><span class="line">       <span class="attr">0:</span> <span class="string">new</span>           <span class="comment">#2                  // class java/lang/String</span></span><br><span class="line">       <span class="attr">3:</span> <span class="string">dup</span></span><br><span class="line">       <span class="attr">4:</span> <span class="string">invokespecial</span> <span class="comment">#3                  // Method java/lang/String."&lt;init&gt;":()V</span></span><br><span class="line">       <span class="attr">7:</span> <span class="string">astore_1</span></span><br><span class="line">       <span class="attr">8:</span> <span class="string">new</span>           <span class="comment">#4                  // class CoreJava/day_2/Test$SecLee</span></span><br><span class="line">      <span class="attr">11:</span> <span class="string">dup</span></span><br><span class="line">      <span class="attr">12:</span> <span class="string">invokespecial</span> <span class="comment">#5                  // Method CoreJava/day_2/Test$SecLee."&lt;init&gt;":()V</span></span><br><span class="line">      <span class="attr">15:</span> <span class="string">astore_2</span></span><br><span class="line">      <span class="attr">16:</span> <span class="string">aload_2</span></span><br><span class="line">      <span class="attr">17:</span> <span class="string">aload_1</span></span><br><span class="line">      <span class="attr">18:</span> <span class="string">invokevirtual</span> <span class="comment">#6                  // Method CoreJava/day_2/Test$Lee.say:(Ljava/lang/String;)V</span></span><br><span class="line">      <span class="attr">21:</span> <span class="string">return</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>æ­£å¦‚ä¸Šé¢çš„ç»“æœï¼Œ18: invokevirtual #6                  // Method CoreJava/day_2/Test Lee.say:(Ljava/lang/String;)Vè¿™é‡Œæ˜¯TestLee.sayè€ŒéTest$SecLee.sayï¼Œå› ä¸ºç¼–è¯‘æœŸæ— æ³•ç¡®å®šè°ƒç”¨å­ç±»è¿˜æ˜¯çˆ¶ç±»çš„å®ç°ï¼Œæ‰€ä»¥åªèƒ½ä¸¢ç»™è¿è¡Œæ—¶çš„åŠ¨æ€ç»‘å®šæ¥å¤„ç†ã€‚</p>
<p>æ—¢ç„¶é‡å†™æµ‹è¯•äº†ï¼Œ<strong>é‚£æˆ‘ä»¬å†è¯•è¯•é‡è½½</strong>ï¼š</p>
<p>ä¸‹é¢çš„ä¾‹å­æ›´å¤æ‚ï¼Leeç±»ä¸­å­˜åœ¨sayæ–¹æ³•çš„ä¸¤ç§é‡è½½ï¼Œæ›´å¤æ‚çš„æ˜¯SecLeeé›†æˆLeeå¹¶ä¸”é‡å†™äº†è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚å…¶å®è¿™ç§æƒ…å†µæ˜¯ä¸Šé¢ä¸¤ç§æƒ…å†µçš„å¤åˆæƒ…å†µã€‚<br>ä¸‹é¢çš„ä»£ç é¦–å…ˆä¼šå‘ç”Ÿé™æ€ç»‘å®šï¼Œç¡®å®šè°ƒç”¨å‚æ•°ä¸ºStringå¯¹è±¡çš„sayæ–¹æ³•ï¼Œç„¶ååœ¨è¿è¡Œæ—¶è¿›è¡ŒåŠ¨æ€ç»‘å®šç¡®å®šæ‰§è¡Œå­ç±»è¿˜æ˜¯çˆ¶ç±»çš„sayå®ç°ã€‚</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> &#123;</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">String</span> str = <span class="keyword">new</span> <span class="keyword">String</span>();</span><br><span class="line">      Lee lee = <span class="keyword">new</span> SecLee();</span><br><span class="line">      lee.say(str);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Lee</span> &#123;</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">          System.out.<span class="built_in">println</span>(<span class="string">"è¿™æ˜¯Object"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">(<span class="keyword">String</span> str)</span> </span>&#123;</span><br><span class="line">          System.out.<span class="built_in">println</span>(<span class="string">"è¿™æ˜¯String"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SecLee</span> <span class="title">extends</span> <span class="title">Lee</span> &#123;</span></span><br><span class="line">      @Override</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">          System.out.<span class="built_in">println</span>(<span class="string">"è¿™æ˜¯ç¬¬äºŒæçš„Object"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      @Override</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">(<span class="keyword">String</span> str)</span> </span>&#123;</span><br><span class="line">          System.out.<span class="built_in">println</span>(<span class="string">"è¿™æ˜¯ç¬¬äºŒæçš„String"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç»“æœ</strong>:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">$ java <span class="keyword">Test</span></span><br><span class="line">è¿™æ˜¯ç¬¬äºŒæçš„<span class="keyword">String</span></span><br></pre></td></tr></table></figure>
<p>ç»“æœåœ¨æ„æ–™ä¹‹ä¸­ï¼Œå°±ä¸å¤šè¯´äº†ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ<font color="red"><strong>éåŠ¨æ€ç»‘å®šä¸å¯ä¹ˆï¼Ÿ</strong></font><br>å…¶å®æŸäº›æ–¹æ³•çš„ç»‘å®šä¹Ÿå¯ä»¥ç”±é™æ€ç»‘å®šå®ç°ï¼Œæ¯”å¦‚è¯´ï¼š</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args) &#123;</span><br><span class="line">      <span class="keyword">String</span> <span class="built_in">str</span> = <span class="keyword">new</span> <span class="keyword">String</span>();</span><br><span class="line">      <span class="keyword">final</span> Lee lee = <span class="keyword">new</span> SecLee();</span><br><span class="line">      lee.say(<span class="built_in">str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡ŒleeæŒæœ‰SecLeeçš„å¯¹è±¡å¹¶ä¸”leeå˜é‡ä¸ºfinalï¼Œç«‹å³æ‰§è¡Œäº†sayæ–¹æ³•ï¼Œç¼–è¯‘å™¨ç†è®ºä¸Šé€šè¿‡è¶³å¤Ÿçš„åˆ†æä»£ç ï¼Œæ˜¯å¯ä»¥çŸ¥é“åº”è¯¥è°ƒç”¨SecLeeçš„sayæ–¹æ³•ã€‚</p>
<p><strong>ç»“è®ºï¼š</strong><br>ç”±äºåŠ¨æ€ç»‘å®šéœ€è¦åœ¨è¿è¡Œæ—¶ç¡®å®šæ‰§è¡Œå“ªä¸ªç‰ˆæœ¬çš„æ–¹æ³•å®ç°æˆ–è€…å˜é‡ï¼Œæ¯”èµ·é™æ€ç»‘å®šèµ·æ¥è¦è€—æ—¶ï¼Œæ‰€ä»¥æ­£å¦‚ä¹¦ä¸Šæ‰€è¯´çš„ï¼Œæœ‰äº›ç¨‹åºå‘˜è®¤ä¸ºï¼Œé™¤éæœ‰è¶³å¤Ÿçš„ç†ç”±ä½¿ç”¨å¤šæ€æ€§ï¼Œåº”è¯¥æŠŠæ‰€æœ‰çš„æ–¹æ³•éƒ½å£°æ˜ä¸ºfinalï¼Œprivateæˆ–è€…staticè¿›è¡Œä¿®é¥°ã€‚æˆ‘è§‰å¾—è¿™ä¸ªæœ‰ç‚¹åæ¿€äº†ï¼Œå…·ä½“ä½¿ç”¨ä»è€…è§ä»ï¼Œæ™ºè€…è§æ™ºå§ã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>é™æ€åŠ¨æ€ç»‘å®š</tag>
      </tags>
  </entry>
  <entry>
    <title>mysql å¦‚ä½•æ’å…¥ä¸€åˆ—è‡ªå¢åºå·</title>
    <url>/2017/02/18/mysql-%E5%A6%82%E4%BD%95%E6%8F%92%E5%85%A5%E4%B8%80%E5%88%97%E8%87%AA%E5%A2%9E%E5%BA%8F%E5%8F%B7/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä»Šå¤©çœ‹åˆ°æœ‹å‹é—®çš„ä¸€ä¸ªé—®é¢˜ï¼Œâ€œmysql åŠ ä¸€åˆ— å«åºå· ç„¶ååºå·è‡ªå¢ æ€ä¹ˆæï¼Ÿâ€,ç”±äºä»–ä¸»è¦ç”¨çš„æ˜¯oracleï¼Œæ‰€ä»¥ä¸å¤ªäº†è§£mysqlçš„ç”¨æ³•ï¼Œç„¶åæˆ‘å°±å‘Šè¯‰ä»–ç”¨rownumå°±å¥½äº†ï¼Œä½†æ˜¯ä»–è¯´ç”¨äº†è¿™ä¸ªæ²¡å¾—åˆ°æ•ˆæœã€‚<br><a id="more"></a><br>æˆ‘æƒ³äº†ä¸€ä¸‹ æ²¡å•¥å•Šã€‚ä»–è¯´ä»–å°±æƒ³åœ¨æŸ¥è¯¢ç»“æœä¸­åŠ ä¸€ä¸ªåºå·åˆ— å®ç°è‡ªå¢ï¼Œäºæ˜¯æˆ‘è‡ªå·±å»ºäº†å¼ è¡¨å®éªŒä¸€ä¸‹ã€‚</p>
<p><img src="http://img.blog.csdn.net/20161124164205404" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>åªç»™äº†idå’Œnameä¸¤ä¸ªå­—æ®µï¼Œæ–¹ä¾¿æµ‹è¯•ã€‚</p>
<p><img src="http://img.blog.csdn.net/20161124164414499" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>éšä¾¿æ’å…¥äº†å‡ æ¡æ•°æ®ï¼ˆè®¾ç½®äº†utf-8çš„æ ¼å¼è¾“å…¥ä¸­æ–‡å°±ç›´æ¥???äº† ä¸çŸ¥é“æ€ä¹ˆå›äº‹ï¼Œä¼°è®¡æ˜¯æ•°æ®åº“ç¼–ç æœ‰ç‚¹é—®é¢˜ï¼Œå…ˆç”¨è‹±æ–‡å‡‘åˆä¸€ä¸‹ã€‚ï¼‰</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> @rd := @rd+<span class="number">1</span>  <span class="keyword">as</span> <span class="keyword">rownum</span>, b.name <span class="keyword">from</span> (<span class="keyword">select</span> @rd:=<span class="number">0</span>, <span class="keyword">name</span> <span class="keyword">from</span> <span class="keyword">test</span>) b</span><br></pre></td></tr></table></figure>
<p>å–å‡ºnameå±æ€§ï¼Œç„¶åç»™å˜é‡rdè‡ªå¢1èµ‹ç»™rownumï¼Œçœ‹ç»“æœï¼š</p>
<p><img src="http://img.blog.csdn.net/20161124164635603" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>ç„¶åï¼Œç„¶åå°±è¿™ä¹ˆæˆäº† -ã€‚- ç”¨å˜é‡ç´¯åŠ ï¼Œæ’å…¥æœ‰è‡ªå¢å­—æ®µçš„ä¸´æ—¶è¡¨ä¸­ã€å¦‚æœæœ‰å”¯ä¸€æ ‡è¯†çš„å­—æ®µï¼Œä¹Ÿå¯ä»¥ç”¨æŸ¥è¯¢è§£å†³ã€‚</p>
]]></content>
      <categories>
        <category>æ•°æ®åº“é‚£ç‚¹äº‹</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>è‡ªå¢åºå·</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºAjaxçš„cacheå‚æ•°çš„æµ‹è¯•</title>
    <url>/2017/02/18/%E5%85%B3%E4%BA%8EAjax%E7%9A%84cache%E5%8F%82%E6%95%B0%E7%9A%84%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>&nbsp;&nbsp;å…¶å®è¿™æ¬¡åšè¿™ä¸ªæµ‹è¯•æ˜¯å› ä¸ºå’ŒåŒå­¦è°ˆè®º@requestbodyæ—¶å¼•å‘çš„ä¸€ä¸ªç¬‘è¯ï¼Œæˆ‘ä¹‹å‰ä¸€ç›´ä»¥ä¸ºajaxä¸­çš„<code>dataType: &#39;json&#39;</code>æ˜¯ä¼ è¾“å»åå°çš„æ•°æ®æ ¼å¼ï¼Œåæ¥åˆ†åˆ†é’Ÿè¢«æ‰“è„¸ï¼ŒæŸ¥äº†ä¸€ä¸‹ç™¾åº¦ï¼Œæ‰çŸ¥é“åŸæ¥<code>dataType: &#39;json&#39;</code>æ˜¯æœŸæœ›è¿”å›çš„æ•°æ®ç±»å‹ï¼Œç”±æ­¤æ‰å‘ç°åŸæ¥ajaxå¹¶æ²¡æœ‰å¹³å¸¸ç”¨çš„é‚£ä¹ˆç®€å•ã€‚<br><a id="more"></a><br>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯Ajaxï¼š<br>AJAX = å¼‚æ­¥ JavaScript å’Œ XMLã€‚<br>AJAX æ˜¯ä¸€ç§ç”¨äºåˆ›å»ºå¿«é€ŸåŠ¨æ€ç½‘é¡µçš„æŠ€æœ¯ã€‚<br>é€šè¿‡åœ¨åå°ä¸æœåŠ¡å™¨è¿›è¡Œå°‘é‡æ•°æ®äº¤æ¢ï¼ŒAJAX å¯ä»¥ä½¿ç½‘é¡µå®ç°å¼‚æ­¥æ›´æ–°ã€‚è¿™æ„å‘³ç€å¯ä»¥åœ¨ä¸é‡æ–°åŠ è½½æ•´ä¸ªç½‘é¡µçš„æƒ…å†µä¸‹ï¼Œå¯¹ç½‘é¡µçš„æŸéƒ¨åˆ†è¿›è¡Œæ›´æ–°ã€‚<br>ä¼ ç»Ÿçš„ç½‘é¡µï¼ˆä¸ä½¿ç”¨ AJAXï¼‰å¦‚æœéœ€è¦æ›´æ–°å†…å®¹ï¼Œå¿…éœ€é‡è½½æ•´ä¸ªç½‘é¡µé¢ã€‚<br>æœ‰å¾ˆå¤šä½¿ç”¨ AJAX çš„åº”ç”¨ç¨‹åºæ¡ˆä¾‹ï¼šæ–°æµªå¾®åšã€Google åœ°å›¾ã€å¼€å¿ƒç½‘ç­‰ç­‰ã€‚(ä»¥ä¸Šæ¥è‡ªw3cschool)</p>
<p>åœ¨çœ‹è¿™äº›èµ„æ–™çš„è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªå‚æ•°å¼•èµ·äº†æˆ‘çš„æ³¨æ„ï¼š<strong>cache</strong> è¿™ä¸ªcacheæœ‰trueå’Œfalseä¸¤ä¸ªæ–¹å‘ï¼Œ<font color="red">æ˜¾å¼çš„è¦æ±‚å¦‚æœå½“å‰è¯·æ±‚æœ‰ç¼“å­˜çš„è¯ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜ã€‚å¦‚æœè¯¥å±æ€§è®¾ç½®ä¸º falseï¼Œåˆ™æ¯æ¬¡éƒ½ä¼šå‘æœåŠ¡å™¨è¯·æ±‚</font>ã€‚ç”±æ­¤æˆ‘åšäº†ä¸‹é¢çš„æµ‹è¯•ï¼š</p>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªservletï¼Œç”¨æ¥æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚</p>
<p>AjaxServlet.java</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">AjaxServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void doGet(<span class="type">HttpServletRequest</span> req, <span class="type">HttpServletResponse</span> resp) <span class="keyword">throws</span> <span class="type">ServletException</span>, <span class="type">IOException</span> &#123;</span><br><span class="line">        <span class="type">System</span>.out.println(<span class="string">"è¿›å…¥äº†servlet!"</span>);</span><br><span class="line">        resp.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> out = resp.getWriter();</span><br><span class="line">        int a = <span class="number">1</span>;</span><br><span class="line">        out.print(a);</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void doPost(<span class="type">HttpServletRequest</span> req, <span class="type">HttpServletResponse</span> resp) <span class="keyword">throws</span> <span class="type">ServletException</span>, <span class="type">IOException</span> &#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œåšå‡ºäº†æ ‡è®°ï¼Œå¦‚æœè¯·æ±‚è¿›æ¥äº†ï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºâ€è¿›å…¥äº†servletâ€</p>
<p>ç„¶ååˆ›å»ºä¸€ä¸ªJspç”¨æ¥å‘å‡ºè¯·æ±‚ï¼š<br>ajaxTest.jsp</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">contentType</span>=<span class="string">"text/html;charset=UTF-8"</span> <span class="attr">language</span>=<span class="string">"java"</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">String</span> <span class="attr">path</span> = <span class="string">request.getContextPath();</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"ajaxBtn"</span> <span class="attr">value</span>=<span class="string">"ç‚¹æˆ‘è¯•è¯•~"</span>&gt;</span>ç‚¹æˆ‘è¯•è¯•~<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="string">"#ajaxBtn"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="actionscript">            url: <span class="string">"&lt;%=path%&gt;/AjaxServlet"</span>,</span></span><br><span class="line"><span class="actionscript">            type: <span class="string">'get'</span>,</span></span><br><span class="line"><span class="actionscript">            cache: <span class="literal">true</span>,</span></span><br><span class="line"><span class="actionscript">            success: <span class="function"><span class="keyword">function</span> <span class="params">(data)</span> </span>&#123;</span></span><br><span class="line">                alert(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç‚¹å‡»è¿™ä¸ªæŒ‰é’®å¯ä»¥å‡ºå‘ä¸€ä¸ªgetè¯·æ±‚ï¼Œæˆ‘ä»¬æŠŠcacheè®¾ç½®ä¸ºäº†trueï¼Œè¿™æ ·ä¼šåœ¨æµè§ˆå™¨ç¼“å­˜ä¸­åŠ è½½è¯·æ±‚ä¿¡æ¯ã€‚</p>
<p><img src="http://img.blog.csdn.net/20161123204951948" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p><img src="http://img.blog.csdn.net/20161123205002870" alt><br></p>
<p>å¯ä»¥çœ‹å‡ºç¬¬ä¸€æ¬¡æˆåŠŸè¿›å…¥äº†servletï¼Œå‰å°ä¹Ÿalertå‡ºäº†è¿™ä¸ªè¿”å›çš„å€¼ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬ç‚¹å‡»ç¬¬äºŒæ¬¡ï¼Œå‘ç°å±…ç„¶è¿˜æ˜¯è¿›å…¥äº†servlet!!!!!<br><br><img src="http://img.blog.csdn.net/20161123205119785" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"><br><br><br>è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ æ²¡åŠæ³•åªèƒ½ç»§ç»­è¸ä¸Šç™¾åº¦è°·æ­Œä¹‹è·¯ï¼Œç»è¿‡æŸ¥æ‰¾å‘ç°ï¼Œåœ¨IEæµè§ˆå™¨ä¸‹ï¼Œå¯ä»¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œç‚¹å‡»ä¸¤æ¬¡ï¼Œç¬¬äºŒæ¬¡å°±ä¸å†è¿›å…¥servletäº†ã€‚<br><br><img src="http://img.blog.csdn.net/20161123205002870" alt><br><br><br>ä¸è¿‡ï¼Œå¹¶ä¸é¼“åŠ±ä½¿ç”¨cache:true,å› ä¸ºajaxæ˜¯å®æ—¶è·å–æ•°æ®çš„ï¼Œæ‰€ä»¥ä¸å¤ªé€‚åˆä»ç¼“å­˜ä¸­åŠ è½½ä¿¡æ¯ï¼Œæˆ‘æƒ³ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™ä¸ªåŸå› ï¼Œè°·æ­Œ safariæµè§ˆå™¨å®ç°ä¸äº†è¿™ä¸ªåŠŸèƒ½å§ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ä¸ºä»€ä¹ˆieè¿˜å¯ä»¥è¿™ä¹ˆåšæŒºï¼Ÿï¼ˆæ—¥å¸¸åæ§½ï¼‰ã€‚</p>
<p>é™„ï¼šajaxå…¶ä»–å‚æ•°<br><br><strong>å‚æ•°ï¼š</strong><br>url: è¦æ±‚ä¸ºStringç±»å‹çš„å‚æ•°ï¼Œï¼ˆé»˜è®¤ä¸ºå½“å‰é¡µåœ°å€ï¼‰å‘é€è¯·æ±‚çš„åœ°å€ã€‚<br>type: è¦æ±‚ä¸ºStringç±»å‹çš„å‚æ•°ï¼Œè¯·æ±‚æ–¹å¼ï¼ˆpostæˆ–getï¼‰é»˜è®¤ä¸ºgetã€‚æ³¨æ„å…¶ä»–httpè¯·æ±‚æ–¹æ³•ï¼Œä¾‹å¦‚putå’Œdeleteä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†ä»…éƒ¨åˆ†æµè§ˆå™¨æ”¯æŒã€‚<br>timeout: è¦æ±‚ä¸ºNumberç±»å‹çš„å‚æ•°ï¼Œè®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚æ­¤è®¾ç½®å°†è¦†ç›–$.ajaxSetup()æ–¹æ³•çš„å…¨å±€è®¾ç½®ã€‚<br>asyncï¼šè¦æ±‚ä¸ºBooleanç±»å‹çš„å‚æ•°ï¼Œé»˜è®¤è®¾ç½®ä¸ºtrueï¼Œæ‰€æœ‰è¯·æ±‚å‡ä¸ºå¼‚æ­¥è¯·æ±‚ã€‚å¦‚æœéœ€è¦å‘é€åŒæ­¥è¯·æ±‚ï¼Œè¯·å°†æ­¤é€‰é¡¹è®¾ç½®ä¸ºfalseã€‚æ³¨æ„ï¼ŒåŒæ­¥è¯·æ±‚å°†é”ä½æµè§ˆå™¨ï¼Œç”¨æˆ·å…¶ä»–æ“ä½œå¿…é¡»ç­‰å¾…è¯·æ±‚å®Œæˆæ‰å¯ä»¥æ‰§è¡Œã€‚<br>cacheï¼šè¦æ±‚ä¸ºBooleanç±»å‹çš„å‚æ•°ï¼Œé»˜è®¤ä¸ºtrueï¼ˆå½“dataTypeä¸ºscriptæ—¶ï¼Œé»˜è®¤ä¸ºfalseï¼‰ã€‚è®¾ç½®ä¸ºfalseå°†ä¸ä¼šä»æµè§ˆå™¨ç¼“å­˜ä¸­åŠ è½½è¯·æ±‚ä¿¡æ¯ã€‚<br>data: è¦æ±‚ä¸ºObjectæˆ–Stringç±»å‹çš„å‚æ•°ï¼Œå‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®ã€‚å¦‚æœå·²ç»ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå°†è‡ªåŠ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼ã€‚getè¯·æ±‚ä¸­å°†é™„åŠ åœ¨urlåã€‚é˜²æ­¢è¿™ç§è‡ªåŠ¨è½¬æ¢ï¼Œå¯ä»¥æŸ¥çœ‹processDataé€‰é¡¹ã€‚å¯¹è±¡å¿…é¡»ä¸ºkey/valueæ ¼<br> å¼ï¼Œä¾‹å¦‚{foo1:â€bar1â€,foo2:â€bar2â€}è½¬æ¢ä¸º&amp;foo1=bar1&amp;foo2=bar2ã€‚å¦‚æœæ˜¯æ•°ç»„ï¼ŒJQueryå°†è‡ªåŠ¨ä¸ºä¸åŒå€¼å¯¹åº”åŒä¸€ä¸ªåç§°ã€‚ä¾‹å¦‚{foo:[â€œbar1â€,â€bar2â€]}è½¬æ¢ä¸º&amp;foo=bar1&amp;foo=bar2ã€‚<br>dataType: è¦æ±‚ä¸ºStringç±»å‹çš„å‚æ•°ï¼Œé¢„æœŸæœåŠ¡å™¨è¿”å›çš„æ•°æ®ç±»å‹ã€‚å¦‚æœä¸æŒ‡å®šï¼ŒJQueryå°†è‡ªåŠ¨æ ¹æ®httpåŒ…mimeä¿¡æ¯è¿”å›responseXMLæˆ–responseTextï¼Œå¹¶ä½œä¸ºå›è°ƒå‡½æ•°å‚æ•°ä¼ é€’ã€‚<br>          å¯ç”¨çš„ç±»å‹å¦‚ä¸‹ï¼š<br><br>          xmlï¼šè¿”å›XMLæ–‡æ¡£ï¼Œå¯ç”¨JQueryå¤„ç†ã€‚<br><br>          htmlï¼šè¿”å›çº¯æ–‡æœ¬HTMLä¿¡æ¯ï¼›åŒ…å«çš„scriptæ ‡ç­¾ä¼šåœ¨æ’å…¥DOMæ—¶æ‰§è¡Œã€‚<br><br>          scriptï¼šè¿”å›çº¯æ–‡æœ¬JavaScriptä»£ç ã€‚ä¸ä¼šè‡ªåŠ¨ç¼“å­˜ç»“æœã€‚é™¤éè®¾ç½®äº†cacheå‚æ•°ã€‚æ³¨æ„åœ¨è¿œç¨‹è¯·æ±‚æ—¶ï¼ˆä¸åœ¨åŒä¸€ä¸ªåŸŸä¸‹ï¼‰ï¼Œæ‰€æœ‰postè¯·æ±‚éƒ½å°†è½¬ä¸ºgetè¯·æ±‚ã€‚<br><br>          jsonï¼šè¿”å›JSONæ•°æ®ã€‚<br><br>          jsonpï¼šJSONPæ ¼å¼ã€‚ä½¿ç”¨SONPå½¢å¼è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¾‹å¦‚myurl?callback=?ï¼ŒJQueryå°†è‡ªåŠ¨æ›¿æ¢åä¸€ä¸ªâ€œ?â€ä¸ºæ­£ç¡®çš„å‡½æ•°åï¼Œä»¥æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚<br><br>          textï¼šè¿”å›çº¯æ–‡æœ¬å­—ç¬¦ä¸²ã€‚<br>beforeSendï¼šè¦æ±‚ä¸ºFunctionç±»å‹çš„å‚æ•°ï¼Œå‘é€è¯·æ±‚å‰å¯ä»¥ä¿®æ”¹XMLHttpRequestå¯¹è±¡çš„å‡½æ•°ï¼Œä¾‹å¦‚æ·»åŠ è‡ªå®šä¹‰ã€‚<br>            HTTPå¤´ã€‚åœ¨beforeSendä¸­å¦‚æœè¿”å›falseå¯ä»¥å–æ¶ˆæœ¬æ¬¡ajaxè¯·æ±‚ã€‚XMLHttpRequestå¯¹è±¡æ˜¯æƒŸä¸€çš„å‚æ•°ã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>Ajax</tag>
        <tag>cache</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMå¸¸é‡æ± åŠå­—ç¬¦ä¸²==æ¯”è¾ƒåˆ†æ</title>
    <url>/2017/02/18/JVM%E5%B8%B8%E9%87%8F%E6%B1%A0%E5%8F%8A%E5%AD%97%E7%AC%A6%E4%B8%B2-%E6%AF%94%E8%BE%83%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>javaä¸­çš„å¸¸é‡æ± æŠ€æœ¯ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿å¿«æ·åœ°åˆ›å»ºæŸäº›å¯¹è±¡è€Œå‡ºç°çš„ï¼Œå½“éœ€è¦ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå°±å¯ä»¥ä»æ± ä¸­å–ä¸€ä¸ªå‡ºæ¥ï¼ˆå¦‚æœæ± ä¸­æ²¡æœ‰çš„è¯å°±åˆ›å»ºä¸€ä¸ªï¼‰ï¼Œè¿™æ ·åœ¨æˆ‘ä»¬éœ€è¦é‡å¤åˆ›å»ºç›¸ç­‰å˜é‡èŠ‚çœäº†å¾ˆå¤šæ—¶é—´ã€‚<br><br>&nbsp;&nbsp;å¸¸é‡æ± å…¶å®ä¹Ÿå°±æ˜¯ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œä¸åŒäºä½¿ç”¨newå…³é”®å­—åˆ›å»ºçš„å¯¹è±¡æ‰€åœ¨çš„å †ç©ºé—´ã€‚Stringç±»æ˜¯javaä¸­ç”¨çš„æ¯”è¾ƒå¤šçš„ç±»ï¼ŒåŒæ ·ä¸ºäº†åˆ›å»ºStringå¯¹è±¡çš„æ–¹ä¾¿ï¼Œè¯¥ç±»ä¹Ÿå®ç°äº†å¸¸é‡æ± çš„æŠ€æœ¯ã€‚<br><br><a id="more"></a><br>åœ¨è®²è¿°å¸¸é‡æ± ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å…ˆè¯´è¯´<font color="red">JVMè¿è¡Œæ—¶æ•°æ®åŒºçš„å†…å­˜æ¨¡å‹</font>ã€‚<br><br>JVMè¿è¡Œæ—¶æ•°æ®åŒºçš„å†…å­˜æ¨¡å‹ç”±äº”éƒ¨åˆ†ç»„æˆ:<br><br>1.æ–¹æ³•åŒº<br>2.å †<br>3.JAVAæ ˆ<br>4.PCå¯„å­˜å™¨<br>5.æœ¬åœ°æ–¹æ³•æ ˆ</p>
<p>ä¾‹å¦‚å¯¹äº<figure class="highlight plain"><figcaption><span>s </span></figcaption><table><tr><td class="code"><pre><span class="line">```</span><br><span class="line">0:   ldc     #16; //String haha    </span><br><span class="line">2:   astore_1 </span><br><span class="line">3:   return</span><br></pre></td></tr></table></figure></p>
<p>ä»ä¸Šé¢çš„ldcæŒ‡ä»¤çš„æ‰§è¡Œè¿‡ç¨‹å¯ä»¥å¾—å‡ºï¼šsçš„å€¼æ˜¯æ¥è‡ªè¢«æ‹˜ç•™Stringå¯¹è±¡ï¼ˆç”±è§£æè¯¥å…¥å£çš„è¿›ç¨‹äº§ç”Ÿï¼‰çš„å¼•ç”¨ï¼Œå³å¯ä»¥ç†è§£ä¸ºæ˜¯ä»è¢«æ‹˜ç•™Stringå¯¹è±¡çš„å¼•ç”¨å¤åˆ¶è€Œæ¥çš„ï¼Œæ•…æˆ‘ä¸ªäººçš„ç†è§£æ˜¯sçš„å€¼æ˜¯å­˜åœ¨æ ˆå½“ä¸­ã€‚ä¸Šé¢æ˜¯å¯¹äºså€¼å¾—åˆ†æï¼Œæ¥ç€æ˜¯å¯¹äºâ€hahaâ€å€¼çš„åˆ†æ,æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºString s = â€œhahaâ€ å…¶ä¸­â€hahaâ€å€¼åœ¨JAVAç¨‹åºç¼–è¯‘æœŸå°±ç¡®å®šä¸‹æ¥äº†çš„ã€‚ç®€å•ä¸€ç‚¹è¯´ï¼Œå°±æ˜¯hahaçš„å€¼åœ¨ç¨‹åºç¼–è¯‘æˆclassæ–‡ä»¶åï¼Œå°±åœ¨classæ–‡ä»¶ä¸­ç”Ÿæˆäº†ã€‚æ‰§è¡ŒJAVAç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œç¬¬ä¸€æ­¥æ˜¯classæ–‡ä»¶ç”Ÿ æˆï¼Œç„¶åè¢«JVMè£…è½½åˆ°å†…å­˜æ‰§è¡Œã€‚é‚£ä¹ˆJVMè£…è½½è¿™ä¸ªclassåˆ°å†…å­˜ä¸­ï¼Œå…¶ä¸­çš„hahaè¿™ä¸ªå€¼ï¼Œåœ¨å†…å­˜ä¸­æ˜¯æ€ä¹ˆä¸ºå…¶å¼€è¾Ÿç©ºé—´å¹¶å­˜å‚¨åœ¨å“ªä¸ªåŒºåŸŸä¸­å‘¢ï¼Ÿ</p>
<p>&nbsp;&nbsp;é¦–å…ˆæˆ‘ä»¬ä¸å¦¨å…ˆæ¥äº†è§£ä¸€ä¸‹JVMå¸¸é‡æ± è¿™ä¸ªç»“æ„,è¿™é‡Œæˆ‘æŸ¥è¯¢äº†ä¸€äº›èµ„æ–™,åœ¨èµ„æ–™ä¸­è¿™æ ·æè¿°<strong>å¸¸é‡æ± </strong>:<br><br>è™šæ‹Ÿæœºå¿…é¡»ä¸ºæ¯ä¸ªè¢«è£…è½½çš„ç±»å‹ç»´æŠ¤ä¸€ä¸ªå¸¸é‡æ± ã€‚å¸¸é‡æ± å°±æ˜¯è¯¥ç±»å‹æ‰€ç”¨åˆ°å¸¸é‡çš„ä¸€ä¸ªæœ‰åºé›†å’Œï¼ŒåŒ…æ‹¬ç›´æ¥å¸¸é‡ï¼ˆstring,integerå’Œ floating pointå¸¸é‡ï¼‰å’Œå¯¹å…¶ä»–ç±»å‹ï¼Œå­—æ®µå’Œæ–¹æ³•çš„ç¬¦å·å¼•ç”¨ã€‚å¯¹äºStringå¸¸é‡ï¼Œå®ƒçš„å€¼æ˜¯åœ¨å¸¸é‡æ± ä¸­çš„ã€‚è€ŒJVMä¸­çš„å¸¸é‡æ± åœ¨å†…å­˜å½“ä¸­æ˜¯ä»¥è¡¨çš„å½¢å¼å­˜åœ¨çš„ï¼Œå¯¹äºStringç±»å‹ï¼Œæœ‰ä¸€å¼ å›ºå®šé•¿åº¦çš„CONSTANT_String_infoè¡¨ç”¨æ¥å­˜å‚¨æ–‡å­—å­—ç¬¦ä¸²å€¼ï¼Œæ³¨æ„ï¼šè¯¥è¡¨åªå­˜å‚¨æ–‡å­—å­—ç¬¦ä¸²å€¼ï¼Œä¸å­˜å‚¨ç¬¦å·å¼•ç”¨ã€‚è¯´åˆ°è¿™é‡Œï¼Œå¯¹å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²å€¼çš„å­˜å‚¨ä½ç½®åº”è¯¥æœ‰ä¸€ä¸ªæ¯”è¾ƒæ˜äº†çš„ç†è§£äº†ã€‚</p>
<p>ä¸‹é¢è®²è®²<strong>å…«ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¯¹è±¡æ± </strong></p>
<p>Javaä¸­åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»çš„å¤§éƒ¨åˆ†éƒ½å®ç°äº†å¸¸é‡æ± æŠ€æœ¯ï¼Œè¿™äº›ç±»æ˜¯ Byte,Short,Integer,Long,Character,Boolean,å¦å¤–ä¸¤ç§æµ®ç‚¹æ•°ç±»å‹çš„åŒ…è£…ç±»åˆ™æ²¡æœ‰å®ç°ã€‚å¦å¤– Byte,Short,Integer,Long,Characterè¿™5ç§æ•´å‹çš„åŒ…è£…ç±»ä¹Ÿåªæ˜¯åœ¨å¯¹åº”å€¼å°äºç­‰äº127æ—¶æ‰å¯ä½¿ç”¨å¯¹è±¡æ± ï¼Œä¹Ÿå³å¯¹è±¡ä¸è´Ÿè´£åˆ›å»ºå’Œç®¡ç†å¤§äº127çš„è¿™äº›ç±»çš„å¯¹è±¡ã€‚ä¸€äº›å¯¹åº”çš„æµ‹è¯•ä»£ç ï¼š<br><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> Test &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) &#123;</span><br><span class="line"><span class="comment">//5ç§æ•´å½¢çš„åŒ…è£…ç±»Byte,Short,Integer,Long,Characterçš„å¯¹è±¡ï¼Œ</span></span><br><span class="line"><span class="comment">//åœ¨å€¼å°äº127æ—¶å¯ä»¥ä½¿ç”¨å¸¸é‡æ± </span></span><br><span class="line">        Integer i1 = <span class="number">127</span>;</span><br><span class="line">        Integer i2 = <span class="number">127</span>;</span><br><span class="line">        Sstem.out.<span class="keyword">println</span>(i1 == i2); <span class="comment">//è¾“å‡ºtrue  </span></span><br><span class="line"><span class="comment">//å€¼å¤§äº127æ—¶ï¼Œä¸ä¼šä»å¸¸é‡æ± ä¸­å–å¯¹è±¡</span></span><br><span class="line">        Integer i3 = <span class="number">128</span>;</span><br><span class="line">        Integer i4 = <span class="number">128</span>;</span><br><span class="line">        System.out.<span class="keyword">println</span>(i3 == i4); <span class="comment">//è¾“å‡ºfalse  </span></span><br><span class="line"><span class="comment">//Booleanç±»ä¹Ÿå®ç°äº†å¸¸é‡æ± æŠ€æœ¯</span></span><br><span class="line">        <span class="keyword">Boolean</span> bool1 = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">Boolean</span> bool2 = <span class="keyword">true</span>;</span><br><span class="line">        System.out.<span class="keyword">println</span>(bool1 == bool2); <span class="comment">//è¾“å‡ºtrue  </span></span><br><span class="line"><span class="comment">//æµ®ç‚¹ç±»å‹çš„åŒ…è£…ç±»æ²¡æœ‰å®ç°å¸¸é‡æ± æŠ€æœ¯</span></span><br><span class="line">        <span class="keyword">Double</span> d1 = <span class="number">1.0</span>;</span><br><span class="line">        <span class="keyword">Double</span> d2 = <span class="number">1.0</span>;</span><br><span class="line">        System.out.<span class="keyword">println</span>(d1 == d2); <span class="comment">//è¾“å‡ºfalse  </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>å¯¹Integerå¯¹è±¡çš„ä»£ç è¡¥å……</strong><br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">valueOf</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">final</span> <span class="keyword">int</span> offset = <span class="number">128</span>;</span><br><span class="line">       <span class="keyword">if</span> (i &gt;= <span class="number">-128</span> &amp;&amp; i &lt;= <span class="number">127</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> IntegerCache.cache[i + offset];</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Integer(i);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>å½“ä½ ç›´æ¥ç»™ä¸€ä¸ªIntegerå¯¹è±¡ä¸€ä¸ªintå€¼çš„æ—¶å€™ï¼Œå…¶å®å®ƒè°ƒç”¨äº†valueOfæ–¹æ³•ï¼Œç„¶åä½ èµ‹çš„è¿™ä¸ªå€¼å¾ˆç‰¹åˆ«ï¼Œæ˜¯128ï¼Œé‚£ä¹ˆæ²¡æœ‰è¿›è¡Œcacheæ–¹æ³•ï¼Œç›¸å½“äºnewäº†ä¸¤ä¸ªæ–°å¯¹è±¡ã€‚æ‰€ä»¥é—®é¢˜ä¸­å®šä¹‰aã€bçš„ä¸¤å¥ä»£ç å°±ç±»ä¼¼äºï¼š</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Integer</span> a = <span class="literal">new</span> <span class="built_in">Integer</span>(<span class="number">128</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Integer</span> b = <span class="literal">new</span> <span class="built_in">Integer</span>(<span class="number">128</span>);</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ—¶å€™å†é—®ä½ ï¼Œè¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿä½ å°±çŸ¥é“æ˜¯falseäº†ã€‚å¦‚æœæŠŠè¿™ä¸ªæ•°æ¢æˆ127ï¼Œå†æ‰§è¡Œï¼š</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">Integer <span class="attr">a</span> = <span class="number">127</span>;</span><br><span class="line"></span><br><span class="line">Integer <span class="attr">b</span> = <span class="number">127</span>;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="attr">a</span> == b);</span><br><span class="line"></span><br><span class="line">ç»“æœå°±æ˜¯ï¼š<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>è¿›è¡Œå¯¹è±¡æ¯”è¾ƒæ—¶æœ€å¥½è¿˜æ˜¯ä½¿ç”¨equalsï¼Œä¾¿äºæŒ‰ç…§è‡ªå·±çš„ç›®çš„è¿›è¡Œæ§åˆ¶ã€‚è¿™é‡Œå¼•å‡ºequals()å’Œ= =,equalsæ¯”è¾ƒçš„æ˜¯å­—ç¬¦ä¸²å­—é¢å€¼å³æ¯”è¾ƒå†…å®¹,==æ¯”è¾ƒå¼•ç”¨ã€‚</p>
<p><strong>çœ‹ä¸€ä¸‹IntegerCacheè¿™ä¸ªç±»é‡Œé¢çš„å†…å®¹ï¼š</strong><br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IntegerCache</span> &#123;</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">IntegerCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> Integer cache[] = <span class="keyword">new</span> Integer[-(<span class="number">-128</span>) + <span class="number">127</span> + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cache.length; i++)</span><br><span class="line">                cache[i] = <span class="keyword">new</span> Integer(i - <span class="number">128</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>ç”±äºcache[]åœ¨IntegerCacheç±»ä¸­æ˜¯é™æ€æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯åªéœ€è¦åˆå§‹åŒ–ä¸€æ¬¡ï¼Œå³static{â€¦â€¦}éƒ¨åˆ†ï¼Œæ‰€ä»¥ï¼Œå¦‚æœInteger å¯¹è±¡åˆå§‹åŒ–æ—¶æ˜¯-128~127çš„èŒƒå›´ï¼Œå°±ä¸éœ€è¦å†é‡æ–°å®šä¹‰ç”³è¯·ç©ºé—´ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡â€”åœ¨IntegerCache.cacheä¸­ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜æ•ˆç‡ã€‚</p>
<p><strong>é’ˆå¯¹Stringæ–¹é¢çš„è¡¥å……</strong></p>
<p>åœ¨åŒåŒ…åŒç±»ä¸‹,å¼•ç”¨è‡ªåŒä¸€Stringå¯¹è±¡.<br><br>åœ¨åŒåŒ…ä¸åŒç±»ä¸‹,å¼•ç”¨è‡ªåŒä¸€Stringå¯¹è±¡.<br><br>åœ¨ä¸åŒåŒ…ä¸åŒç±»ä¸‹,ä¾ç„¶å¼•ç”¨è‡ªåŒä¸€Stringå¯¹è±¡.<br><br>åœ¨ç¼–è¯‘æˆ.classæ—¶èƒ½å¤Ÿè¯†åˆ«ä¸ºåŒä¸€å­—ç¬¦ä¸²çš„,è‡ªåŠ¨ä¼˜åŒ–æˆå¸¸é‡,æ‰€ä»¥ä¹Ÿå¼•ç”¨è‡ªåŒä¸€Stringå¯¹è±¡.<br><br>åœ¨è¿è¡Œæ—¶åˆ›å»ºçš„å­—ç¬¦ä¸²å…·æœ‰ç‹¬ç«‹çš„å†…å­˜åœ°å€,æ‰€ä»¥ä¸å¼•ç”¨è‡ªåŒä¸€Stringå¯¹è±¡.<br><br>Stringçš„intern()æ–¹æ³•ä¼šæŸ¥æ‰¾åœ¨å¸¸é‡æ± ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä»½equalç›¸ç­‰çš„å­—ç¬¦ä¸²,<br><br>å¦‚æœæœ‰åˆ™è¿”å›ä¸€ä¸ªå¼•ç”¨,æ²¡æœ‰åˆ™æ·»åŠ è‡ªå·±çš„å­—ç¬¦ä¸²è¿›å…¥å¸¸é‡æ± ï¼Œæ³¨æ„ï¼šåªæ˜¯å­—ç¬¦ä¸²éƒ¨åˆ†ã€‚ æ‰€ä»¥è¿™æ—¶ä¼šå­˜åœ¨2ä»½æ‹·è´ï¼Œå¸¸é‡æ± çš„éƒ¨åˆ†è¢«Stringç±»ç§æœ‰å¹¶ç®¡ç†ï¼Œè‡ªå·±çš„é‚£ä»½æŒ‰å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»§ç»­ä½¿ç”¨ã€‚</p>
<p>åœ¨ä»‹ç»å®ŒJVMå¸¸é‡æ± çš„ç›¸å…³æ¦‚å¿µåï¼Œæ¥ç€è°ˆå¼€å§‹æåˆ°çš„â€hahaâ€çš„å€¼çš„å†…å­˜åˆ†å¸ƒçš„ä½ç½®ã€‚å¯¹äºhahaçš„å€¼ï¼Œå®é™…ä¸Šæ˜¯åœ¨classæ–‡ä»¶è¢«JVMè£…è½½åˆ°å†…å­˜ å½“ä¸­å¹¶è¢«å¼•æ“åœ¨è§£ældcæŒ‡ä»¤å¹¶æ‰§è¡ŒldcæŒ‡ä»¤ä¹‹å‰ï¼ŒJVMå°±å·²ç»ä¸ºhahaè¿™ä¸ªå­—ç¬¦ä¸²åœ¨å¸¸é‡æ± çš„CONSTANT_String_infoè¡¨ä¸­åˆ†é…äº†ç©º é—´æ¥å­˜å‚¨hahaè¿™ä¸ªå€¼ã€‚æ—¢ç„¶hahaè¿™ä¸ªå­—ç¬¦ä¸²å¸¸é‡å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ï¼Œæ ¹æ®ã€Šæ·±å…¥JAVAè™šæ‹Ÿæœºã€‹ä¹¦ä¸­æè¿°ï¼šå¸¸é‡æ± æ˜¯å±äºç±»å‹ä¿¡æ¯çš„ä¸€éƒ¨åˆ†ï¼Œç±»å‹ä¿¡æ¯ä¹Ÿå°± æ˜¯æ¯ä¸€ä¸ªè¢«è½¬è½½çš„ç±»å‹ï¼Œè¿™ä¸ªç±»å‹åæ˜ åˆ°JVMå†…å­˜æ¨¡å‹ä¸­æ˜¯å¯¹åº”å­˜åœ¨äºJVMå†…å­˜æ¨¡å‹çš„æ–¹æ³•åŒºä¸­ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªç±»å‹ä¿¡æ¯ä¸­çš„å¸¸é‡æ± æ¦‚å¿µæ˜¯å­˜åœ¨äºåœ¨æ–¹æ³•åŒºä¸­ï¼Œè€Œ æ–¹æ³•åŒºæ˜¯åœ¨JVMå†…å­˜æ¨¡å‹ä¸­çš„å †ä¸­ç”±JVMæ¥åˆ†é…çš„ã€‚æ‰€ä»¥ï¼Œhahaçš„å€¼æ˜¯åº”è¯¥æ˜¯å­˜åœ¨å †ç©ºé—´ä¸­çš„ã€‚</p>
<p>è€Œå¯¹äº<figure class="highlight plain"><figcaption><span>s </span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>0:   new     #16; //class String<br>3:   dup<br>4:   ldc     #18; //String haha<br>6:   invokespecial   #20; //Methodjava/lang/String.â€â€:(Ljava/lang/String;)V<br>9:   astore_1<br>10:  return<br><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">&lt;br&gt;</span><br><span class="line">é€šè¿‡ä¸Šé¢<span class="number">6</span>ä¸ªæŒ‡ä»¤ï¼Œå¯ä»¥çœ‹å‡ºï¼Œ<span class="keyword">String</span> s = <span class="keyword">new</span> <span class="keyword">String</span>(<span class="string">"haha"</span>);ä¸­çš„hahaå­˜å‚¨åœ¨å †ç©ºé—´ä¸­ï¼Œè€Œsåˆ™æ˜¯åœ¨æ“ä½œæ•°æ ˆä¸­ã€‚ </span><br><span class="line">ä¸Šé¢æ˜¯å¯¹så’Œhahaå€¼çš„å†…å­˜æƒ…å†µçš„åˆ†æå’Œç†è§£ï¼›é‚£å¯¹äº<span class="keyword">String</span> s = <span class="keyword">new</span> <span class="keyword">String</span>(<span class="string">"haha"</span>);è¯­å¥,åˆ°åº•åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡å‘¢? </span><br><span class="line">æˆ‘çš„ç†è§£ï¼šè¿™é‡Œ<span class="string">"haha"</span>æœ¬èº«å°±æ˜¯å¸¸é‡æ± ä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œåœ¨è¿è¡Œæ—¶æ‰§è¡Œ<span class="keyword">new</span> <span class="keyword">String</span>()æ—¶ï¼Œå°†å¸¸é‡æ± ä¸­çš„å¯¹è±¡å¤åˆ¶ä¸€ä»½æ”¾åˆ°å †ä¸­ï¼Œå¹¶ä¸”æŠŠå †ä¸­çš„è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨äº¤ç»™sæŒæœ‰ã€‚æ‰€ä»¥è¿™æ¡è¯­å¥å°±åˆ›å»ºäº†<span class="number">2</span>ä¸ª<span class="keyword">String</span>å¯¹è±¡ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;br&gt;</span><br><span class="line">&lt;img src=<span class="string">"http://static.open-open.com/lib/uploadImg/20121021/20121021191840_830.jpg"</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**<span class="keyword">String</span> å¸¸é‡æ± é—®é¢˜çš„å‡ ä¸ªä¾‹å­ï¼š**&lt;br&gt;</span><br><span class="line">ã€<span class="number">1</span>ã€‘</span><br></pre></td></tr></table></figure></p>
<p>String a = â€œa1â€;<br>String b = â€œaâ€ + 1;<br>System.out.println((a == b)); //result = true<br>String a = â€œatrueâ€;<br>String b = â€œaâ€ + â€œtrueâ€;<br>System.out.println((a == b)); //result = true<br>String a = â€œa3.4â€;<br>String b = â€œaâ€ + 3.4;<br>System.out.println((a == b)); //result = true<br><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">åˆ†æï¼šJVMå¯¹äºå­—ç¬¦ä¸²å¸¸é‡çš„<span class="string">"+"</span>å·è¿æ¥ï¼Œå°†ç¨‹åºç¼–è¯‘æœŸï¼ŒJVMå°±å°†å¸¸é‡å­—ç¬¦ä¸²çš„<span class="string">"+"</span>è¿æ¥ä¼˜åŒ–ä¸ºè¿æ¥åçš„å€¼ï¼Œæ‹¿<span class="string">"a"</span> + <span class="number">1</span>æ¥è¯´ï¼Œç»ç¼–è¯‘å™¨ä¼˜åŒ–ååœ¨<span class="class"><span class="keyword">class</span>ä¸­å°±å·²ç»æ˜¯<span class="title">a1</span>ã€‚åœ¨ç¼–è¯‘æœŸå…¶å­—ç¬¦ä¸²å¸¸é‡çš„å€¼å°±ç¡®å®šä¸‹æ¥ï¼Œæ•…ä¸Šé¢ç¨‹åºæœ€ç»ˆçš„ç»“æœéƒ½ä¸º<span class="title">true</span>ã€‚&lt;br&gt;</span></span><br><span class="line"></span><br><span class="line">ã€<span class="number">2</span>ã€‘</span><br></pre></td></tr></table></figure></p>
<p>String a = â€œabâ€;<br>String bb = â€œbâ€;<br>String b = â€œaâ€ + bb;<br>System.out.println((a == b)); //result = false<br><figure class="highlight smalltalk"><table><tr><td class="code"><pre><span class="line">åˆ†æï¼š<span class="type">JVM</span>å¯¹äºå­—ç¬¦ä¸²å¼•ç”¨ï¼Œç”±äºåœ¨å­—ç¬¦ä¸²çš„<span class="comment">"+"</span>è¿æ¥ä¸­ï¼Œæœ‰å­—ç¬¦ä¸²å¼•ç”¨å­˜åœ¨ï¼Œè€Œå¼•ç”¨çš„å€¼åœ¨ç¨‹åºç¼–è¯‘æœŸæ˜¯æ— æ³•ç¡®å®šçš„ï¼Œå³<span class="comment">"a"</span> + bbæ— æ³•è¢«ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œåªæœ‰åœ¨ç¨‹åºè¿è¡ŒæœŸæ¥åŠ¨æ€åˆ†é…å¹¶å°†è¿æ¥åçš„æ–°åœ°å€èµ‹ç»™bã€‚æ‰€ä»¥ä¸Šé¢ç¨‹åºçš„ç»“æœä¹Ÿå°±ä¸º<span class="keyword">false</span>ã€‚</span><br><span class="line"></span><br><span class="line">ã€<span class="number">3</span>ã€‘</span><br></pre></td></tr></table></figure></p>
<p>String a = â€œabâ€;<br>final String bb = â€œbâ€;<br>String b = â€œaâ€ + bb;<br>System.out.println((a == b)); //result = true<br><figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line">åˆ†æï¼šå’Œ[<span class="number">3</span>]ä¸­å”¯ä¸€ä¸åŒçš„æ˜¯bbå­—ç¬¦ä¸²åŠ äº†<span class="keyword">final</span>ä¿®é¥°ï¼Œå¯¹äº<span class="keyword">final</span>ä¿®é¥°çš„å˜é‡ï¼Œå®ƒåœ¨ç¼–è¯‘æ—¶è¢«è§£æä¸ºå¸¸é‡å€¼çš„ä¸€ä¸ªæœ¬åœ°æ‹·è´å­˜å‚¨åˆ°è‡ªå·±çš„å¸¸é‡æ± ä¸­æˆ– åµŒå…¥åˆ°å®ƒçš„å­—èŠ‚ç æµä¸­ã€‚æ‰€ä»¥æ­¤æ—¶çš„<span class="string">"a"</span> + bbå’Œ<span class="string">"a"</span> + <span class="string">"b"</span>æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚æ•…ä¸Šé¢ç¨‹åºçš„ç»“æœä¸º<span class="literal">true</span>ã€‚</span><br><span class="line"></span><br><span class="line">ã€<span class="number">4</span>ã€‘</span><br></pre></td></tr></table></figure></p>
<p>String a = â€œabâ€;<br>final String bb = getBB();<br>String b = â€œaâ€ + bb;<br>System.out.println((a == b)); //result = false<br>private static String getBB() {<br>return â€œbâ€;<br>}<br><figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">åˆ†æï¼šJVMå¯¹äºå­—ç¬¦ä¸²å¼•ç”¨bbï¼Œå®ƒçš„å€¼åœ¨ç¼–è¯‘æœŸæ— æ³•ç¡®å®šï¼Œåªæœ‰åœ¨ç¨‹åºè¿è¡ŒæœŸè°ƒç”¨æ–¹æ³•åï¼Œå°†æ–¹æ³•çš„è¿”å›å€¼å’Œ<span class="string">"a"</span>æ¥åŠ¨æ€è¿æ¥å¹¶åˆ†é…åœ°å€ä¸ºbï¼Œæ•…ä¸Šé¢ç¨‹åºçš„ç»“æœä¸º<span class="keyword">false</span>ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">é€šè¿‡ä¸Šé¢<span class="number">4</span>ä¸ªä¾‹å­å¯ä»¥å¾—å‡ºå¾—çŸ¥ï¼š&lt;<span class="keyword">br</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>String  s  =  â€œaâ€ + â€œbâ€ + â€œcâ€;ç­‰ä»·äºString s = â€œabcâ€</p>
<p>è¿™ä¸ªå°±ä¸ä¸€æ ·äº†ï¼Œæœ€ç»ˆç»“æœç­‰äº:<br>StringBuffer temp = new StringBuffer();<br>temp.append(a).append(b).append(c);<br>String s = temp.toString();<br><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">ç”±ä¸Šé¢çš„åˆ†æç»“æœï¼Œå¯å°±ä¸éš¾æ¨æ–­å‡º<span class="keyword">String</span> é‡‡ç”¨è¿æ¥è¿ç®—ç¬¦ï¼ˆ+ï¼‰æ•ˆç‡ä½ä¸‹åŸå› åˆ†æï¼Œå½¢å¦‚è¿™æ ·çš„ä»£ç ï¼š</span><br></pre></td></tr></table></figure></p>
<p> public static void main(String args[]) {<br>        String s = null;<br>        for (int i = 0; i &lt; 100; i++) {<br>            s += â€œaâ€;<br>        }<br>    }<br><figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">æ¯åšä¸€æ¬¡ + å°±äº§ç”Ÿä¸ªStringBuilderå¯¹è±¡ï¼Œç„¶å<span class="built_in">append</span>åå°±æ‰”æ‰ã€‚ä¸‹æ¬¡å¾ªç¯å†åˆ°è¾¾æ—¶é‡æ–°äº§ç”Ÿä¸ªStringBuilderå¯¹è±¡ï¼Œç„¶å <span class="built_in">append</span> å­—ç¬¦ä¸²ï¼Œå¦‚æ­¤å¾ªç¯ç›´è‡³ç»“æŸã€‚ å¦‚æœæˆ‘ä»¬ç›´æ¥é‡‡ç”¨ StringBuilder å¯¹è±¡è¿›è¡Œ <span class="built_in">append</span> çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥èŠ‚çœ N - <span class="number">1</span> æ¬¡åˆ›å»ºå’Œé”€æ¯å¯¹è±¡çš„æ—¶é—´ã€‚æ‰€ä»¥å¯¹äºåœ¨å¾ªç¯ä¸­è¦è¿›è¡Œå­—ç¬¦ä¸²è¿æ¥çš„åº”ç”¨ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨StringBufferæˆ–StringBuliderå¯¹è±¡æ¥è¿›è¡Œ <span class="built_in">append</span>æ“ä½œã€‚</span><br><span class="line"></span><br><span class="line">æœ€åè´´ä¸€ä¸ª<span class="keyword">String</span>å¯¹è±¡çš„internæ–¹æ³•ç†è§£å’Œåˆ†æï¼Œè¿™æ˜¯ä»Šå¤©åœ¨ç¾¤é‡Œçœ‹åˆ°çš„ä¸€ä¸ªé¢˜ç›®ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯è¿™ç¯‡åšå®¢çš„å°å­å§ï¼š</span><br></pre></td></tr></table></figure></p>
<p>public class Test {<br>    private static String a = â€œabâ€;<br>    public static void main(String[] args) {<br>        String s1 = â€œaâ€;<br>        String s2 = â€œbâ€;<br>        String s = s1 + s2;<br>        System.out.println(s == a);//false<br>        System.out.println(s.intern() == a);//true<br>    }<br>}<br><code>`</code></p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å­—ç¬¦ä¸²</tag>
        <tag>å¸¸é‡æ± </tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºå¤šçº¿ç¨‹çš„é¥¥é¥¿å’Œå…¬å¹³</title>
    <url>/2017/02/18/%E5%85%B3%E4%BA%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E9%A5%A5%E9%A5%BF%E5%92%8C%E5%85%AC%E5%B9%B3/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>å¶ç„¶å­¦ä¹ åˆ°å¤šçº¿ç¨‹ï¼Œçœ‹åˆ°å¤šçº¿ç¨‹çš„é¥¥é¥¿å’Œå…¬å¹³ï¼Œè§‰å¾—å¯ä»¥å†™ç‚¹ä»€ä¹ˆã€‚<br><br>ä»€ä¹ˆæ˜¯é¥¥é¥¿ä»€ä¹ˆæ˜¯å…¬å¹³å‘¢ï¼Ÿå¦‚æœä¸€ä¸ªçº¿ç¨‹å› ä¸ºCPUè¿è¡Œæ—¶é—´å…¨éƒ¨è¢«å…¶ä»–çº¿ç¨‹æŠ¢èµ°è€Œå¾—ä¸åˆ°CPUè¿è¡Œæ—¶é—´ï¼Œè¿™ç§çŠ¶æ€è¢«ç§°ä¹‹ä¸ºâ€œé¥¥é¥¿â€ã€‚è€Œè¯¥çº¿ç¨‹è¢«â€œé¥¥é¥¿è‡´æ­»â€æ­£æ˜¯å› ä¸ºå®ƒå¾—ä¸åˆ°CPUè¿è¡Œæ—¶é—´çš„æœºä¼šã€‚è§£å†³é¥¥é¥¿çš„æ–¹æ¡ˆè¢«ç§°ä¹‹ä¸ºâ€œå…¬å¹³æ€§â€ï¼Œå³æ‰€æœ‰çº¿ç¨‹å‡èƒ½å…¬å¹³åœ°è·å¾—è¿è¡Œæœºä¼šã€‚<br><br><a id="more"></a><br>&nbsp;&nbsp;<strong>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼Œä»€ä¹ˆåŸå› å¯¼è‡´äº†â€œé¥¥é¥¿â€ï¼Ÿåœ¨Javaæ–¹é¢æˆ‘è§‰çš„åˆ†ä¸ºäº†ä¸‰ç§æƒ…å†µ:</strong><br><br>&nbsp;&nbsp;â‘ .çº¿ç¨‹ä¸­é«˜ä¼˜å…ˆçº§çš„åå™¬æ‰€æœ‰çš„ä½ä¼˜å…ˆçº§çš„CPUæ—¶é—´ã€‚<br><br>&nbsp;&nbsp;ä½ èƒ½ä¸ºæ¯ä¸ªçº¿ç¨‹è®¾ç½®ç‹¬è‡ªçš„çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§è¶Šé«˜çš„çº¿ç¨‹è·å¾—çš„CPUæ—¶é—´è¶Šå¤šï¼Œçº¿ç¨‹ä¼˜å…ˆçº§å€¼è®¾ç½®åœ¨1åˆ°10ä¹‹é—´ï¼Œè€Œè¿™äº›ä¼˜å…ˆçº§å€¼æ‰€è¡¨ç¤ºè¡Œä¸ºçš„å‡†ç¡®è§£é‡Šåˆ™ä¾èµ–äºä½ çš„åº”ç”¨è¿è¡Œå¹³å°ã€‚æ‰€ä»¥å¯¹å¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œä½ æœ€å¥½æ˜¯ä¸è¦æ”¹å˜å…¶ä¼˜å…ˆçº§å€¼ã€‚<br><br>&nbsp;&nbsp;â‘¡çº¿ç¨‹è¢«æ°¸ä¹…å µå¡åœ¨ä¸€ä¸ªç­‰å¾…è¿›å…¥åŒæ­¥å—çš„çŠ¶æ€<br><br>&nbsp;&nbsp;Javaçš„åŒæ­¥ä»£ç åŒºä¹Ÿæ˜¯ä¸€ä¸ªå¯¼è‡´é¥¥é¥¿çš„å› ç´ ã€‚Javaçš„åŒæ­¥ä»£ç åŒºå¯¹å“ªä¸ªçº¿ç¨‹å…è®¸è¿›å…¥çš„æ¬¡åºæ²¡æœ‰ä»»ä½•ä¿éšœã€‚è¿™å°±æ„å‘³ç€ç†è®ºä¸Šå­˜åœ¨ä¸€ä¸ªè¯•å›¾è¿›å…¥è¯¥åŒæ­¥åŒºçš„çº¿ç¨‹å¤„äºè¢«æ°¸ä¹…å µå¡çš„é£é™©ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹æ€»æ˜¯èƒ½æŒç»­åœ°å…ˆäºå®ƒè·å¾—è®¿é—®ï¼Œè¿™å³æ˜¯â€œé¥¥é¥¿â€é—®é¢˜ï¼Œè€Œä¸€ä¸ªçº¿ç¨‹è¢«â€œé¥¥é¥¿è‡´æ­»â€æ­£æ˜¯å› ä¸ºå®ƒå¾—ä¸åˆ°CPUè¿è¡Œæ—¶é—´çš„æœºä¼šã€‚<br><br>&nbsp;&nbsp;â‘¢.çº¿ç¨‹è¢«æ°¸ä¹…å µå¡åœ¨ä¸€ä¸ªç­‰å¾…è¿›å…¥åŒæ­¥å—çš„çŠ¶æ€<br><br>&nbsp;&nbsp;å¦‚æœå¤šä¸ªçº¿ç¨‹å¤„åœ¨wait()æ–¹æ³•æ‰§è¡Œä¸Šï¼Œè€Œå¯¹å…¶è°ƒç”¨notify()ä¸ä¼šä¿è¯å“ªä¸€ä¸ªçº¿ç¨‹ä¼šè·å¾—å”¤é†’ï¼Œä»»ä½•çº¿ç¨‹éƒ½æœ‰å¯èƒ½å¤„äºç»§ç»­ç­‰å¾…çš„çŠ¶æ€ã€‚å› æ­¤å­˜åœ¨è¿™æ ·ä¸€ä¸ªé£é™©ï¼šä¸€ä¸ªç­‰å¾…çº¿ç¨‹ä»æ¥å¾—ä¸åˆ°å”¤é†’ï¼Œå› ä¸ºå…¶ä»–ç­‰å¾…çº¿ç¨‹æ€»æ˜¯èƒ½è¢«è·å¾—å”¤é†’ã€‚</p>
<p>&nbsp;&nbsp;<strong>å¦‚ä½•åœ¨Javaä¸­å®ç°å…¬å¹³ï¼Ÿ</strong><br>æ— è®ºå“ªé‡Œéƒ½ä¸å¯èƒ½å®ç°100%å…¬å¹³ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½æå‡ºæ¯”è¾ƒå¥½çš„æ–¹æ¡ˆæ¥è¾¾åˆ°ç›®çš„ï¼Œé¦–å…ˆå¯ä»¥é€šè¿‡åŒæ­¥ç»“æ„æ¥å®ç°å…¬å¹³æ€§çš„æé«˜ã€‚<br><br>å…ˆæ¥ä¸€æ®µç®€å•çš„ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Synchronizer</span></span>&#123;  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doSynchronized</span><span class="params">()</span></span>&#123;  </span><br><span class="line">    <span class="comment">//éœ€è¦è¿è¡Œå¾ˆé•¿æ—¶é—´çš„æŸäº›ä»£ç </span></span><br><span class="line">  &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&nbsp;&nbsp;å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è°ƒç”¨äº†doSynchronized()æ–¹æ³•ï¼Œåœ¨ç¬¬ä¸€ä¸ªè·å¾—è®¿é—®çš„çº¿ç¨‹æœªå®Œæˆå‰ï¼Œå…¶ä»–çº¿ç¨‹å°†ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œè€Œä¸”åœ¨è¿™ç§å¤šçº¿ç¨‹è¢«é˜»å¡çš„åœºæ™¯ä¸‹ï¼Œæ¥ä¸‹æ¥å°†æ˜¯å“ªä¸ªçº¿ç¨‹è·å¾—è®¿é—®æ˜¯æ²¡æœ‰ä¿éšœçš„ã€‚<br><br>&nbsp;&nbsp;<strong>ç°åœ¨æˆ‘ä»¬ä½¿ç”¨<font color="red">é”æ–¹å¼æ›¿ä»£åŒæ­¥å—</font>æ¥è¯•è¯•:</strong><br><br><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Synchronizer</span>&#123;  </span><br><span class="line">  Lock <span class="keyword">lock</span> = <span class="keyword">new</span> Lock();   </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSynchronized</span>(<span class="params"></span>) throws InterruptedException</span>&#123;  </span><br><span class="line">    <span class="keyword">this</span>.<span class="keyword">lock</span>.<span class="keyword">lock</span>();  <span class="comment">//å½“å‰çº¿ç¨‹é”ä½lockå¯¹è±¡  </span></span><br><span class="line">      <span class="comment">//æ—¶é—´ä¸´ç•ŒåŒº</span></span><br><span class="line">    <span class="keyword">this</span>.<span class="keyword">lock</span>.unlock();  <span class="comment">//å½“å‰çº¿ç¨‹é‡Šæ”¾lockå¯¹è±¡ä¸Šçš„é”  </span></span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&nbsp;&nbsp;æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°doSynchronized()ä¸å†å£°æ˜ä¸ºsynchronizedï¼Œè€Œæ˜¯ç”¨lock.lock()å’Œlock.unlock()æ¥æ›¿ä»£ã€‚<br>ä¸‹é¢æ˜¯ç”¨Lockç±»åšçš„ä¸€ä¸ªå®ç°:<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lock</span></span>&#123;  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> isLocked      = <span class="keyword">false</span>;  <span class="comment">//æ˜¯å¦åŠ è¿‡é”çš„ä¿¡å·  </span></span><br><span class="line">  <span class="keyword">private</span> Thread  lockingThread = <span class="keyword">null</span>;   <span class="comment">//è¿›è¡ŒåŠ é”çš„çº¿ç¨‹  </span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>&#123;  </span><br><span class="line">    <span class="keyword">while</span>(isLocked)&#123;  <span class="comment">//å¦‚æœlockå¯¹è±¡å·²è¢«å…¶ä»–çº¿ç¨‹åŠ é”äº†ï¼ˆçº¿ç¨‹å·²ç»é€€å‡ºäº†æœ¬lock()æ–¹æ³•ï¼‰  </span></span><br><span class="line">      wait();  <span class="comment">//å½“å‰çº¿ç¨‹é˜»å¡ï¼Œå®ƒé‡Šæ”¾é”å¯¹è±¡ä¸Šçš„é”ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥å†è¿›å…¥æœ¬lock()  </span></span><br><span class="line">    &#125;  </span><br><span class="line">    isLocked = <span class="keyword">true</span>;  <span class="comment">//å¦‚æœæ²¡åŠ é”ï¼Œåˆ™å½“å‰çº¿ç¨‹å¯¹é”å¯¹è±¡åŠ é”  </span></span><br><span class="line">    lockingThread = Thread.currentThread();  </span><br><span class="line">  &#125;  </span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span></span>&#123;  </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.lockingThread != Thread.currentThread())&#123;  <span class="comment">//å¦‚æœè°ƒç”¨lock()åŠ é”çš„ä¸æ˜¯å½“å‰çº¿ç¨‹  </span></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException(  </span><br><span class="line">        <span class="string">"æ‰€è°ƒç”¨çº¿ç¨‹å°šæœªé”å®š"</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    isLocked = <span class="keyword">false</span>;  <span class="comment">//é‡Šæ”¾é”ï¼Œæ ‡è®°ä¸ºæœªåŠ é”  </span></span><br><span class="line">    lockingThread = <span class="keyword">null</span>;  </span><br><span class="line">    notify();  <span class="comment">//é€šçŸ¥é˜»å¡åœ¨é”å¯¹è±¡ä¸Šçš„çº¿ç¨‹é˜Ÿåˆ—ï¼Œå”¤é†’å…¶ä¸­æŸä¸€ä¸ªçº¿ç¨‹  </span></span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&nbsp;&nbsp;æ³¨æ„åˆ°ä¸Šé¢å¯¹Lockçš„å®ç°ï¼Œå¦‚æœå­˜åœ¨å¤šçº¿ç¨‹å¹¶å‘è®¿é—®lock()ï¼Œè¿™äº›çº¿ç¨‹å°†é˜»å¡åœ¨å¯¹lock()æ–¹æ³•çš„è®¿é—®ä¸Šã€‚å¦å¤–ï¼Œå¦‚æœisLocked=trueæ—¶ï¼Œè¡¨ç¤ºé”å·²è¢«é”ä¸Šï¼Œè¿™äº›çº¿ç¨‹å°†é˜»å¡åœ¨while(isLocked)å¾ªç¯çš„wait()è°ƒç”¨é‡Œé¢ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œå½“çº¿ç¨‹æ­£åœ¨ç­‰å¾…è¿›å…¥lock() æ—¶ï¼Œå¯ä»¥è°ƒç”¨wait()é‡Šæ”¾å…¶é”å®ä¾‹å¯¹åº”çš„åŒæ­¥é”ï¼Œä½¿å¾—å…¶ä»–å¤šä¸ªçº¿ç¨‹å¯ä»¥è¿›å…¥lock()æ–¹æ³•ï¼Œå¹¶è°ƒç”¨wait()æ–¹æ³•ã€‚<br><br>&nbsp;&nbsp;æˆ‘ä»¬å›å¤´çœ‹doSynchronized()æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨lock()å’Œunlock()ä¹‹é—´ï¼šä¸€æ®µä»£ç å°†é•¿æ—¶é—´è¿è¡Œï¼Œå’Œè¿›å…¥lock()å¹¶è°ƒç”¨wait()æ¥æ¯”è¾ƒçš„è¯ã€‚è¿™æ„å‘³ç€å¤§éƒ¨åˆ†æ—¶é—´ç”¨åœ¨ç­‰å¾…è¿›å…¥é”å’Œè¿›å…¥ä¸´ç•ŒåŒºçš„è¿‡ç¨‹æ˜¯ç”¨åœ¨wait()çš„ç­‰å¾…ä¸­ï¼Œè€Œä¸æ˜¯è¢«é˜»å¡åœ¨è¯•å›¾è¿›å…¥lock()æ–¹æ³•ä¸­ã€‚<br><br>&nbsp;&nbsp;ç”±äºåŒæ­¥å—ä¸ä¼šå¯¹ç­‰å¾…è¿›å…¥çš„å¤šä¸ªçº¿ç¨‹è°èƒ½è·å¾—è®¿é—®åšä»»ä½•ä¿éšœï¼ŒåŒæ ·å½“è°ƒç”¨notify()æ—¶ï¼Œwait()ä¹Ÿä¸ä¼šåšä¿éšœä¸€å®šèƒ½å”¤é†’çº¿ç¨‹ã€‚å› æ­¤è¿™ä¸ªç‰ˆæœ¬çš„Lockç±»å’ŒdoSynchronized()é‚£ä¸ªç‰ˆæœ¬å°±ä¿éšœå…¬å¹³æ€§è€Œè¨€ï¼Œæ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚<br><br>&nbsp;&nbsp;ä½†æˆ‘ä»¬èƒ½æ”¹å˜è¿™ç§æƒ…å†µã€‚å½“å‰çš„Lockç±»ç‰ˆæœ¬è°ƒç”¨è‡ªå·±çš„wait()æ–¹æ³•ï¼Œå¦‚æœæ¯ä¸ªçº¿ç¨‹åœ¨ä¸åŒçš„å¯¹è±¡ä¸Šè°ƒç”¨wait()ï¼Œé‚£ä¹ˆåªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šåœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨wait()ï¼ŒLockç±»å¯ä»¥å†³å®šå“ªä¸ªå¯¹è±¡èƒ½å¯¹å…¶è°ƒç”¨notify()ï¼Œå› æ­¤èƒ½åšåˆ°æœ‰æ•ˆçš„é€‰æ‹©å”¤é†’å“ªä¸ªçº¿ç¨‹ã€‚<br><br>&nbsp;&nbsp;<strong>ä¸‹é¢çœ‹çœ‹å¦‚ä½•æŠŠLockç±»è½¬å˜ä¸ºå…¬å¹³é”FairLock</strong>ã€‚<br><br>&nbsp;&nbsp;æ–°çš„å®ç°å’Œä¹‹å‰çš„Lockç±»ä¸­çš„åŒæ­¥å’Œwait()/notify()å°†ä¼šç¨æœ‰ä¸åŒã€‚<br>æ¯ä¸€ä¸ªè°ƒç”¨lock()çš„çº¿ç¨‹éƒ½ä¼šè¿›å…¥ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå½“è§£é”åï¼Œåªæœ‰é˜Ÿåˆ—é‡Œçš„ç¬¬ä¸€ä¸ªçº¿ç¨‹è¢«å…è®¸é”ä½FairLockå®ä¾‹ï¼Œæ‰€æœ‰å…¶å®ƒçš„çº¿ç¨‹éƒ½å°†å¤„äºç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°ä»–ä»¬å¤„äºé˜Ÿåˆ—å¤´éƒ¨ã€‚<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FairLock</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isLocked = <span class="keyword">false</span>;  <span class="comment">//æ˜¯å¦åŠ é”çš„ä¿¡å·  </span></span><br><span class="line">    <span class="keyword">private</span> Thread lockingThread = <span class="keyword">null</span>;   <span class="comment">//åŠ é”çš„çº¿ç¨‹  </span></span><br><span class="line">    <span class="keyword">private</span> List&lt;QueueObject&gt; waitingThreads =  </span><br><span class="line">            <span class="keyword">new</span> ArrayList&lt;QueueObject&gt;();   <span class="comment">//ä¿¡å·é‡é˜Ÿåˆ—  </span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>&#123;  <span class="comment">//å¤šä¸ªçº¿ç¨‹å¯åŒæ—¶è¿›å…¥  </span></span><br><span class="line">    QueueObject queueObject = <span class="keyword">new</span> QueueObject();  <span class="comment">//å±€éƒ¨å¯¹è±¡ï¼Œçº¿ç¨‹å®‰å…¨  </span></span><br><span class="line">    <span class="keyword">boolean</span> isLockedForThisThread = <span class="keyword">true</span>;  <span class="comment">//æ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹åŠ é”  </span></span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123;  <span class="comment">//å°†å½“å‰çº¿ç¨‹ï¼ˆç”¨ä¿¡å·é‡ï¼‰æ¨å…¥é˜Ÿåˆ—  </span></span><br><span class="line">        waitingThreads.add(queueObject);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">while</span>(isLockedForThisThread)&#123;  </span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123;  <span class="comment">//åŠ é”æ“ä½œéœ€è¦åŒæ­¥  </span></span><br><span class="line">          <span class="comment">//é”çŠ¶æ€ä¾ç„¶è¢«æ£€æŸ¥å’Œè®¾ç½®ï¼Œä»¥é¿å…å‡ºç°æ»‘æ¼æ¡ä»¶  </span></span><br><span class="line">          isLockedForThisThread = isLocked || waitingThreads.get(<span class="number">0</span>) != queueObject;  </span><br><span class="line">          <span class="keyword">if</span>(!isLockedForThisThread)&#123; <span class="comment">//å¦‚æœå¯¹è±¡æœªåŠ é”ä¸”é˜Ÿåˆ—å¤´éƒ¨æ˜¯å½“å‰çº¿ç¨‹  </span></span><br><span class="line">              isLocked = <span class="keyword">true</span>; <span class="comment">//åŠ é”  </span></span><br><span class="line">              waitingThreads.remove(queueObject); <span class="comment">//ä»é˜Ÿåˆ—ä¸­ç§»é™¤å½“å‰çº¿ç¨‹  </span></span><br><span class="line">              lockingThread = Thread.currentThread(); <span class="keyword">return</span>;   </span><br><span class="line">          &#125;   </span><br><span class="line">        &#125;   </span><br><span class="line">        <span class="keyword">try</span>&#123; <span class="comment">//æ”¾åœ¨åŒæ­¥å—ä¹‹å¤–ï¼Œé¿å…monitoråµŒå¥—é”æ­»   </span></span><br><span class="line">            queueObject.doWait(); <span class="comment">//ç›‘è§†å™¨å¯¹è±¡ï¼ˆæŒæœ‰ä¿¡å·é‡isNotifiedï¼‰ç­‰å¾…  </span></span><br><span class="line">        &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;   </span><br><span class="line">           <span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123; waitingThreads.remove(queueObject); &#125;   </span><br><span class="line">            <span class="keyword">throw</span> e;   </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;   </span><br><span class="line">  &#125;   </span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span></span>&#123;   </span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">this</span>.lockingThread != Thread.currentThread())&#123; <span class="comment">//åŠ é”çš„ä¸æ˜¯å½“å‰çº¿ç¨‹   </span></span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException( <span class="string">"è¯¥çº¿ç¨‹å°šæœªé”"</span>);   </span><br><span class="line">      &#125;   </span><br><span class="line">      isLocked = <span class="keyword">false</span>; <span class="comment">//è§£é”   </span></span><br><span class="line">      lockingThread = <span class="keyword">null</span>;   </span><br><span class="line">      <span class="keyword">if</span>(waitingThreads.size() &gt; <span class="number">0</span>)&#123; <span class="comment">//å”¤é†’ç¬¬ä¸€ä¸ªçº¿ç¨‹   </span></span><br><span class="line">          waitingThreads.get(<span class="number">0</span>).doNotify();   </span><br><span class="line">      &#125;   </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueueObject</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> isNotified = <span class="keyword">false</span>;  </span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doWait</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;  </span><br><span class="line">    <span class="keyword">while</span>(!isNotified)&#123;  </span><br><span class="line">        <span class="keyword">this</span>.wait();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">this</span>.isNotified = <span class="keyword">false</span>;  </span><br><span class="line">  &#125;  </span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doNotify</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">this</span>.isNotified = <span class="keyword">true</span>;  </span><br><span class="line">    <span class="keyword">this</span>.notify();  </span><br><span class="line">  &#125;  </span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span> == o;  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;é¦–å…ˆæ³¨æ„åˆ°lock()æ–¹æ³•ä¸å†å£°æ˜ä¸ºsynchronizedï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å¯¹å¿…éœ€åŒæ­¥çš„ä»£ç ï¼Œåœ¨synchronizedä¸­è¿›è¡ŒåµŒå¥—ã€‚<br><br>&nbsp;&nbsp;FairLockæ–°åˆ›å»ºäº†ä¸€ä¸ªQueueObjectçš„å®ä¾‹ï¼Œå¹¶å¯¹æ¯ä¸ªè°ƒç”¨lock()çš„çº¿ç¨‹éƒ½å°†å…¶QueueObjectå®ä¾‹æ¨å…¥é˜Ÿåˆ—ã€‚è°ƒç”¨unlock()çš„çº¿ç¨‹å°†ä»é˜Ÿåˆ—å¤´éƒ¨è·å–QueueObjectï¼Œå¹¶å¯¹å…¶è°ƒç”¨doNotify()ï¼Œä»¥å”¤é†’åœ¨è¯¥å¯¹è±¡ä¸Šç­‰å¾…çš„çº¿ç¨‹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œåœ¨åŒä¸€æ—¶é—´ä»…æœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹è·å¾—å”¤é†’ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„ç­‰å¾…çº¿ç¨‹ã€‚è¿™ä¹Ÿæ˜¯å®ç°FairLockå…¬å¹³æ€§çš„æ ¸å¿ƒæ‰€åœ¨ã€‚<br><br>&nbsp;&nbsp;è¯·æ³¨æ„ï¼Œ<font color="red">åœ¨åŒä¸€ä¸ªåŒæ­¥å—ä¸­ï¼Œé”çŠ¶æ€ä¾ç„¶è¢«æ£€æŸ¥å’Œè®¾ç½®ï¼Œä»¥é¿å…å‡ºç°æ»‘æ¼æ¡ä»¶</font>ã€‚<br><br>&nbsp;&nbsp;è¿˜éœ€æ³¨æ„åˆ°ï¼ŒQueueObjectå®é™…æ˜¯ä¸€ä¸ªsemaphoreã€‚doWait()å’ŒdoNotify()æ–¹æ³•åœ¨QueueObjectä¸­ä¿å­˜ç€ä¿¡å·ã€‚è¿™æ ·åšä»¥é¿å…ä¸€ä¸ªçº¿ç¨‹åœ¨è°ƒç”¨queueObject.doWait()ä¹‹å‰è¢«å¦ä¸€ä¸ªè°ƒç”¨unlock()å¹¶éšä¹‹è°ƒç”¨queueObject.doNotify()çš„çº¿ç¨‹é‡å…¥ï¼Œä»è€Œå¯¼è‡´ä¿¡å·ä¸¢å¤±ã€‚queueObject.doWait()è°ƒç”¨æ”¾ç½®åœ¨synchronized(this)å—ä¹‹å¤–ï¼Œä»¥é¿å…è¢«monitoråµŒå¥—é”æ­»ï¼Œæ‰€ä»¥å¦å¤–çš„çº¿ç¨‹å¯ä»¥è¿›å…¥unlock()æ¥è§£é”ï¼Œåªè¦å½“æ²¡æœ‰çº¿ç¨‹åœ¨lockæ–¹æ³•çš„synchronized(this)å—ä¸­æ‰§è¡Œå³å¯ã€‚<br><br>&nbsp;&nbsp;æœ€åï¼Œæ³¨æ„åˆ°queueObject.doWait()åœ¨try â€“ catchå—ä¸­æ˜¯æ€æ ·è°ƒç”¨çš„ã€‚åœ¨InterruptedExceptionæŠ›å‡ºçš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹å¾—ä»¥ç¦»å¼€lock()ï¼Œå¹¶éœ€è®©å®ƒä»é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚<br><br><strong>æ€§èƒ½è€ƒè™‘<br></strong><br>&nbsp;&nbsp;å¦‚æœæ¯”è¾ƒLockå’ŒFairLockç±»ï¼Œä½ ä¼šæ³¨æ„åˆ°åœ¨FairLockç±»ä¸­lock()å’Œunlock()è¿˜æœ‰æ›´å¤šéœ€è¦æ·±å…¥çš„åœ°æ–¹ã€‚è¿™äº›é¢å¤–çš„ä»£ç ä¼šå¯¼è‡´FairLockçš„åŒæ­¥æœºåˆ¶å®ç°æ¯”Lockè¦ç¨å¾®æ…¢äº›ã€‚ç©¶ç«Ÿå­˜åœ¨å¤šå°‘å½±å“ï¼Œè¿˜ä¾èµ–äºåº”ç”¨åœ¨FairLockä¸´ç•ŒåŒºæ‰§è¡Œçš„æ—¶é•¿ã€‚æ‰§è¡Œæ—¶é•¿è¶Šå¤§ï¼ŒFairLockå¸¦æ¥çš„è´Ÿæ‹…å½±å“å°±è¶Šå°ï¼Œå½“ç„¶è¿™ä¹Ÿå’Œä»£ç æ‰§è¡Œçš„é¢‘ç¹åº¦ç›¸å…³ã€‚</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
        <tag>é¥¥é¥¿</tag>
        <tag>å…¬å¹³</tag>
      </tags>
  </entry>
  <entry>
    <title>å®éªŒæ’å…¥bç«™h5æ’­æ”¾å™¨</title>
    <url>/2017/02/18/%E5%AE%9E%E9%AA%8C%E6%8F%92%E5%85%A5b%E7%AB%99h5%E6%92%AD%E6%94%BE%E5%99%A8/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>Hexo æ’ B ç«™çš„æ’­æ”¾å™¨å¾ˆç®€å•ï¼Œåœ¨ md æ–‡æ¡£ä¸­æ’ä¸ª iframe æ ‡ç­¾å°±è¡Œï¼Œaid å’Œ cid å€¼éœ€è¦æ‰‹åŠ¨å¡«å†™ï¼Œæ’­æ”¾å™¨å¤§å°å¯ä»¥è‡ªå·±è°ƒèŠ‚ï¼š</p>
<blockquote>
<p>B ç«™æ¯ä¸ªè§†é¢‘éƒ½æœ‰å¯¹åº”çš„ aid å’Œ cid å€¼ï¼Œåœ¨è§†é¢‘ç½‘é¡µçš„æºä»£ç ä¸­å¯ä»¥æ‰¾åˆ°</p>
</blockquote>
<a id="more"></a>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">&lt;iframe src=<span class="string">"https://www.bilibili.com/html/html5player.html?aid=3521416&amp;cid=6041635"</span> <span class="built_in">width</span>=<span class="string">"960"</span> <span class="built_in">height</span>=<span class="string">"600"</span> frameborder=<span class="string">"0"</span> webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>
<p><br></p>
<iframe src="https://www.bilibili.com/html/html5player.html?aid=3521416&cid=6041635" width="960" height="600" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>

]]></content>
      <categories>
        <category>åšå®¢</category>
      </categories>
      <tags>
        <tag>å°æ’ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMè™šæ‹Ÿæœºå…³äºâ€œä¸ä½¿ç”¨çš„å¯¹è±¡æ‰‹åŠ¨èµ‹å€¼ä¸ºnullâ€çš„ç†è§£</title>
    <url>/2017/02/18/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%85%B3%E4%BA%8E%E2%80%9C%E4%B8%8D%E4%BD%BF%E7%94%A8%E7%9A%84%E5%AF%B9%E8%B1%A1%E6%89%8B%E5%8A%A8%E8%B5%8B%E5%80%BC%E4%B8%BAnull%E2%80%9D%E7%9A%84%E7%90%86%E8%A7%A3/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä»Šå¤©é€›åšå®¢,çœ‹åˆ°äº†ä¸€ä¸ªå…³äº<code>ä¸€ä¸ªå¯¹è±¡æœ‰æ²¡æœ‰å¿…è¦æ‰‹åŠ¨èµ‹å€¼ä¸ºnull</code>çš„é—®é¢˜ï¼Œæ‹äº†æ‹æ€è·¯ï¼Œå†³å®šå†™ä¸ªæµ‹è¯•ä»£ç æ¥å®è·µä¸€ä¸‹ã€‚<br><a id="more"></a><br><br><br>ç™¾è¯´ä¸å¦‚ä¸€ç”¨ï¼Œç›´æ¥ä¸Šä»£ç :<br><br><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> &#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">64</span> * <span class="number">1024</span> * <span class="number">1024</span>];<span class="comment">//ä½œç”¨å°±æ˜¯å‘å†…å­˜ä¸­å¡«å……ä¸€ä¸ª10MBçš„å¯¹è±¡</span></span><br><span class="line">		System.gc();<span class="comment">//æ‰‹åŠ¨æ‰§è¡ŒGCæ“ä½œ</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œç¨‹åºå‰ï¼Œå¯ä»¥å°†JVMå‚æ•°è®¾ç½®ä¸ºå¦‚ä¸‹:<br><br>-verbose:gc<br><br>-XX:+PrintGCDetails<br><br>æ§åˆ¶å°éƒ¨åˆ†è¾“å‡ºç»“æœå¦‚ä¸‹:<br><br><figure class="highlight scheme"><table><tr><td class="code"><pre><span class="line">[<span class="name">GC</span> (<span class="name">System.gc</span>()) [<span class="name">PSYoungGen:</span> <span class="number">3932</span>K-&gt;744K(<span class="name">76288K</span>)] <span class="number">69468</span>K-&gt;66288K(<span class="name">251392K</span>), <span class="number">0.0016500</span> secs] [<span class="name">Times:</span> user=0.00 sys=0.03, real=0.00 secs] </span><br><span class="line">[<span class="name">Full</span> GC (<span class="name">System.gc</span>()) [<span class="name">PSYoungGen:</span> <span class="number">744</span>K-&gt;0K(<span class="name">76288K</span>)] [<span class="name">ParOldGen:</span> <span class="number">65544</span>K-&gt;66145K(<span class="name">175104K</span>)] <span class="number">66288</span>K-&gt;66145K(<span class="name">251392K</span>), [<span class="name">Metaspace:</span> <span class="number">3169</span>K-&gt;3169K(<span class="name">1056768K</span>)], <span class="number">0.0101306</span> secs] [<span class="name">Times:</span> user=0.00 sys=0.00, real=0.01 secs]</span><br></pre></td></tr></table></figure></p>
<p>æ ¹æ®ParOldGen: 65544K-&gt;66145K(175104K)å¯ä»¥çœ‹å‡ºï¼Œbyteså¯¹è±¡å¹¶æ²¡æœ‰å› ä¸ºæ²¡æœ‰ä½¿ç”¨è€Œè¢«gcå›æ”¶ã€‚<br><br><br><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> &#123;</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * -verbose:GC</span></span><br><span class="line"><span class="comment">	 * -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment">	 * @param args</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">		&#123;</span><br><span class="line">	           <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">64</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		System.gc();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ§åˆ¶å°è¾“å‡ºç»“æœå¦‚ä¸‹:<br><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">[GC (System<span class="number">.</span>gc()) [PSYoungGen: 3932K-&gt;776K(76288K)] 69468K-&gt;66320K(251392K), <span class="number">0.0013737</span> secs] [<span class="built_in">Times</span>: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[Full GC (System<span class="number">.</span>gc()) [PSYoungGen: 776K-&gt;0K(76288K)] [ParOldGen: 65544K-&gt;66145K(175104K)] 66320K-&gt;66145K(251392K), [Metaspace: 3169K-&gt;3169K(1056768K)], <span class="number">0.0063873</span> secs] [<span class="built_in">Times</span>: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs] </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 76288K, used 655K [<span class="number">0x000000076b500000</span>, <span class="number">0x0000000770a00000</span>, <span class="number">0x00000007c0000000</span>)</span><br><span class="line">  eden space 65536K, <span class="number">1</span>% used [<span class="number">0x000000076b500000</span>,<span class="number">0x000000076b5a3ee8</span>,<span class="number">0x000000076f500000</span>)</span><br><span class="line">  from space 10752K, <span class="number">0</span>% used [<span class="number">0x000000076f500000</span>,<span class="number">0x000000076f500000</span>,<span class="number">0x000000076ff80000</span>)</span><br><span class="line">  to   space 10752K, <span class="number">0</span>% used [<span class="number">0x000000076ff80000</span>,<span class="number">0x000000076ff80000</span>,<span class="number">0x0000000770a00000</span>)</span><br><span class="line"> ParOldGen       total 175104K, used 66145K [<span class="number">0x00000006c1e00000</span>, <span class="number">0x00000006cc900000</span>, <span class="number">0x000000076b500000</span>)</span><br><span class="line">  object space 175104K, <span class="number">37</span>% used [<span class="number">0x00000006c1e00000</span>,<span class="number">0x00000006c5e987b8</span>,<span class="number">0x00000006cc900000</span>)</span><br><span class="line"> Metaspace       used 3176K, capacity 4494K, committed 4864K, reserved 1056768K</span><br><span class="line">  class space    used 346K, capacity 386K, committed 512K, reserved 1048576K</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œæ ¹æ®gcæ—¥å¿—[ParOldGen: 65544K-&gt;66145K(175104K)] ï¼Œgcä¾ç„¶æ²¡æœ‰å›æ”¶byteså¯¹è±¡ï¼Œå“ªæ€•å·²ç»ä¸åœ¨æ–¹æ³•åŒºäº†ï¼Œæˆ‘ä»¬å†æ¬¡ä¿®æ”¹ä»£ç ã€‚<br><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test3</span> &#123;</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * -verbose:GC</span></span><br><span class="line"><span class="comment">	 * -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment">	 * @param args</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">64</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">		System.gc();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>gcæ—¥å¿—è¾“å‡ºå¦‚ä¸‹:<br><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">[GC (System<span class="number">.</span>gc()) [PSYoungGen: 3932K-&gt;776K(76288K)] 69468K-&gt;66320K(251392K), <span class="number">0.0014193</span> secs] [<span class="built_in">Times</span>: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[Full GC (System<span class="number">.</span>gc()) [PSYoungGen: 776K-&gt;0K(76288K)] [ParOldGen: 65544K-&gt;609K(175104K)] 66320K-&gt;609K(251392K), [Metaspace: 3169K-&gt;3169K(1056768K)], <span class="number">0.0076485</span> secs] [<span class="built_in">Times</span>: user=<span class="number">0.02</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs] </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 76288K, used 655K [<span class="number">0x000000076b500000</span>, <span class="number">0x0000000770a00000</span>, <span class="number">0x00000007c0000000</span>)</span><br><span class="line">  eden space 65536K, <span class="number">1</span>% used [<span class="number">0x000000076b500000</span>,<span class="number">0x000000076b5a3ee8</span>,<span class="number">0x000000076f500000</span>)</span><br><span class="line">  from space 10752K, <span class="number">0</span>% used [<span class="number">0x000000076f500000</span>,<span class="number">0x000000076f500000</span>,<span class="number">0x000000076ff80000</span>)</span><br><span class="line">  to   space 10752K, <span class="number">0</span>% used [<span class="number">0x000000076ff80000</span>,<span class="number">0x000000076ff80000</span>,<span class="number">0x0000000770a00000</span>)</span><br><span class="line"> ParOldGen       total 175104K, used 609K [<span class="number">0x00000006c1e00000</span>, <span class="number">0x00000006cc900000</span>, <span class="number">0x000000076b500000</span>)</span><br><span class="line">  object space 175104K, <span class="number">0</span>% used [<span class="number">0x00000006c1e00000</span>,<span class="number">0x00000006c1e987a8</span>,<span class="number">0x00000006cc900000</span>)</span><br><span class="line"> Metaspace       used 3176K, capacity 4494K, committed 4864K, reserved 1056768K</span><br><span class="line">  class space    used 346K, capacity 386K, committed 512K, reserved 1048576K</span><br></pre></td></tr></table></figure></p>
<p>è§è¯å¥‡è¿¹çš„æ—¶å€™åˆ°ï¼Œ[ParOldGen: 65544K-&gt;609K(175104K)]ï¼Œç«Ÿç„¶è¢«å›æ”¶äº†ï¼è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿå½“åˆ›å»ºbyteså¯¹è±¡çš„æ—¶å€™ï¼Œé‚£æ˜¯å› ä¸ºå½“æˆ‘ä»¬åˆ›å»ºbyteså¯¹è±¡çš„æ—¶å€™ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸­å½“ç„¶æœ‰bytesçš„å¼•ç”¨ï¼Œå“ªæ€•æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ï¼Œä½†GC rootsä¾ç„¶å­˜åœ¨ç€å’Œbyteså¯¹è±¡çš„å…³è”ã€‚æ ¹æ®test2å’Œä»£ç test3ï¼Œæˆ‘ä»¬å¤§æ¦‚å¯ä»¥çŒœåˆ°å¦‚æœä¸æ“ä½œå±€éƒ¨å˜é‡è¡¨ï¼Œé‚£ä¹ˆGC rootsä¾ç„¶ä¼šä¿ç•™ï¼Œæ‰€ä»¥test2ä¾ç„¶æ²¡æœ‰å›æ”¶ï¼Œä½†æ˜¯åˆ°äº†test3ï¼Œå°±å›æ”¶äº†ã€‚å¥½å§ï¼Œå†æ¥ä¸€ä¸ªæ— ç”¨çš„æµ‹è¯•ï¼Œæˆ‘ä»¬æ‰‹åŠ¨èµ‹å€¼ä¸ºnullçœ‹çœ‹ç»“æœã€‚<br><br><br><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMain</span> &#123;</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * -verbose:GC</span></span><br><span class="line"><span class="comment">	 * -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment">	 * @param args</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">64</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">		<span class="comment">//do something</span></span><br><span class="line">		bytes = null;</span><br><span class="line">		System.gc();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å…¶å®éƒ½èƒ½æƒ³åˆ°ï¼Œæœç„¶è¢«gcå¹²æ‰äº†â€¦â€¦å½“ç„¶è¿™åªæ˜¯ä¸€ä¸ªå®éªŒï¼Œæ€»ç»“æ€§çš„è¯å°±ä¸è¯´äº†ï¼Œåæ­£æˆ‘ä¹Ÿè¯´ä¸æ¥ï¼Œä¸è¿‡å®è·µå‡ºçœŸç†ï¼</p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Jvm</tag>
        <tag>å¯¹è±¡</tag>
      </tags>
  </entry>
  <entry>
    <title>é»‘è½¦å¸æœºå‘è½¦å™¨Javaç‰ˆ</title>
    <url>/2017/02/18/%E9%BB%91%E8%BD%A6%E5%8F%B8%E6%9C%BA%E5%8F%91%E8%BD%A6%E5%99%A8Java%E7%89%88/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æ—¢ç„¶æ˜¯å‘çš„é»‘è½¦ï¼Œç£åŠ›é“¾æ¥é‚£å¥—å°±ä¸å¿…ä»”ç»†ç ”ç©¶äº†ï¼Œ<br>ç£åŠ›é“¾æ¥å…¶å®ç±»ä¼¼äºè¿™æ ·ï¼ˆä¸‹é¢çš„è¿™ä¸ªæ˜¯çœŸè½¦ï¼‰ï¼š</p>
<blockquote>
<p>magnet:?xt=urn:btih:3AEA94481B0A406C66083F14C6F42635C14562C2</p>
</blockquote>
<a id="more"></a>
<p>è¯´ç™½äº†å°±æ˜¯éšæœºå¡«å…… 40 ä¸ªå­—æ¯æˆ–æ•°å­—ï¼Œä¸è¿‡æœ‰ä¸€å®šå‡ ç‡ä¼šå‘å‡ºçœŸè½¦ã€‚</p>
<p> <img src="https://ooo.0o0.ooo/2016/12/25/585f760101362.png " width="300" height="300" alt="å›¾ç‰‡åç§°" align="center"></p>
<hr>

<p>ä»£ç å®ç°ï¼š<br><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OldDriver</span> &#123;</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">		java.util.Scanner input = <span class="keyword">new</span> java.util.Scanner(System.in);</span><br><span class="line">		System.out.<span class="built_in">println</span>(<span class="string">"é»‘è½¦å¸æœºè™šå‡ç£åŠ›é“¾æ¥å‘è½¦å™¨"</span>);</span><br><span class="line">		System.out.<span class="built_in">print</span>(<span class="string">"è¾“å…¥éœ€è¦å‘çš„é»‘è½¦æ•°é‡ï¼š"</span>);</span><br><span class="line">		<span class="keyword">int</span> ljs = input.nextInt();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=ljs;i++)&#123;</span><br><span class="line">			System.out.<span class="built_in">println</span>(<span class="string">"magnet:?xt=urn:btih:"</span>+CLSC());</span><br><span class="line"><span class="comment">/*è°ƒç”¨ CLSC å‡½æ•°ï¼Œè·å– 40 ä¸ªéšæœºç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼ˆCLSCæŒ‡ ç£åŠ›ç”Ÿæˆï¼‰*/</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> <span class="title">CLSC</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">String</span> cllj = <span class="string">""</span>;</span><br><span class="line">		<span class="keyword">String</span> randomchar;</span><br><span class="line">		<span class="keyword">String</span> chars = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">40</span>;i++)&#123;</span><br><span class="line">			<span class="keyword">int</span> RandomNumber = (<span class="keyword">int</span>)(Math.<span class="built_in">random</span>()*<span class="number">35</span>);</span><br><span class="line"><span class="comment">/*éšæœºç”Ÿæˆä¸€ä¸ªèŒƒå›´åœ¨ [0,35] çš„æ•°å­—*/</span></span><br><span class="line">			randomchar = <span class="string">""</span> + chars.charAt(RandomNumber);</span><br><span class="line"><span class="comment">/*éšæœºé€‰æ‹©ä¸€ä¸ªå­—ç¬¦ï¼Œå­—ç¬¦ä½ç½®ç”±ä¸Šä¸€æ­¥éšæœºæ•°å­—å†³å®š*/</span></span><br><span class="line">			cllj = cllj+randomchar;</span><br><span class="line"><span class="comment">/*å°†éšæœºå­—ç¬¦é™„åˆ° cllj å­—ç¬¦ä¸²ä¸Šï¼Œé‡å¤ 40 æ¬¡*/</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> cllj;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œæ•ˆæœï¼š<br><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">é»‘è½¦å¸æœºè™šå‡ç£åŠ›é“¾æ¥å‘è½¦å™¨</span><br><span class="line">è¾“å…¥éœ€è¦å‘çš„é»‘è½¦æ•°é‡ï¼š<span class="number">5</span></span><br><span class="line"><span class="string">magnet:</span>?xt=urn:<span class="string">btih:</span><span class="number">126</span>XT8JCPZ6ZWV1Q77OSOAD2P2UOWOAZEIGNN0UH</span><br><span class="line"><span class="string">magnet:</span>?xt=urn:<span class="string">btih:</span>VEKIXXTDDC6STSZN2IS1IQSW6RHJ6ZGC7NEGYIAJ</span><br><span class="line"><span class="string">magnet:</span>?xt=urn:<span class="string">btih:</span>G8Z7O3AIGY2C1PRRNJEZ6Q1VY3HGZQ34E2MOQUWR</span><br><span class="line"><span class="string">magnet:</span>?xt=urn:<span class="string">btih:</span>MRXYGZUFONLDPN5G4E5EDCWMWLI00PB8ZVK6IIKQ</span><br><span class="line"><span class="string">magnet:</span>?xt=urn:<span class="string">btih:</span><span class="number">3</span>WQ1IYXW0MD3Z32DT80NCJBLTAJ0FC837TB2HW2M</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>JavaäºŒä¸‰äº‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>é»‘è½¦</tag>
        <tag>ç§å­</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello Hexo</title>
    <url>/2017/02/17/Hello-Hexo/</url>
    <content><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æœ¬åšå®¢ç”± Hexo å¼ºåŠ›é©±åŠ¨ï¼Œæ‰˜ç®¡äº Github ï¼Œæ”¯æŒ https ã€‚</p>
<a id="more"></a>
<p>æ—©å°±æœ‰è‡ªå·±å»ºåšå®¢çš„å¿µå¤´äº†ï¼Œå…ˆå‰åœ¨æŠŠcsdnå’Œç®€ä¹¦ä½œä¸ºåšå®¢ï¼Œå†™äº†æœ‰å¤§åŠå¹´å§ï¼Œåæ¥å­¦ç”Ÿè®¡åˆ’ä¹°äº†ä¸ªäº‘æœåŠ¡å™¨ï¼Œç”¨ghostæ­å»ºäº†ä¸€ä¸ªåšå®¢ï¼Œä½†æ˜¯å¤ªç®€æ´äº†ï¼ï¼ äºæ˜¯æ˜¨å¤©å¤©èŠ±äº†å¤§åŠå¤©çš„æ—¶é—´ç»ˆäºæå¥½äº†è¿™ä¸ªåšå®¢ã€‚</p>
<p>ä¹‹åä¼šå°†ç®€ä¹¦ä¸Šçš„æ–‡ç« æ¬è¿è¿‡æ¥ï¼ŒMarkdown è¯­æ³•çš„æ–‡ç« å¤åˆ¶ä¸€ä¸‹å°±è¡Œï¼Œå¯Œæ–‡æœ¬å†™çš„ï¼Œè¿˜å¾—è½¬æˆ Markdown è¯­æ³•ã€‚ï¼ˆcsdnçš„Markdownå¤åˆ¶ååˆ†å¥½ç”¨ï¼ï¼‰</p>
<p>åšå®¢ä¸csdnå°†åŒæ­¥æ›´æ–°ï¼Œä¸¤è¾¹çš„ç•™è¨€éƒ½ä¼šè®¤çœŸå›å¤ï¼Œåæ­£æœ‰(mei)çš„(you)æ˜¯(nv)æ—¶(peng)é—´(you)</p>
<p> <img src="http://oa0thinbz.bkt.clouddn.com/0.jpeg " width="350" height="320" alt="å›¾ç‰‡åç§°" align="center"></p>
]]></content>
      <categories>
        <category>èœœæ±å¼€å§‹</category>
      </categories>
      <tags>
        <tag>è¿ç§»</tag>
      </tags>
  </entry>
</search>
